<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;all,&lt;br&gt;&lt;br&gt;&lt;/div&gt;So,&nbsp;we&#39;ve&nbsp;been&nbsp;(slowly)&nbsp;investigating&nbsp;this&nbsp;issue&nbsp;these&nbsp;past&nbsp;days,&nbsp;and&nbsp;have&nbsp;reached&nbsp;some&nbsp;conclusions.&lt;br&gt;&lt;br&gt;&lt;/div&gt;a)&nbsp;First,&nbsp;and&nbsp;sorry&nbsp;for&nbsp;not&nbsp;being&nbsp;clear&nbsp;on&nbsp;that,&nbsp;this&nbsp;only&nbsp;happens&nbsp;on&nbsp;&quot;squid&nbsp;reload&quot;,&nbsp;not&nbsp;on&nbsp;full&nbsp;stop/start&nbsp;cycles.&lt;/div&gt;&lt;div&gt;A&nbsp;full&nbsp;start&nbsp;cycle&nbsp;does&nbsp;not&nbsp;give&nbsp;this&nbsp;error,&nbsp;that&#39;s&nbsp;why&nbsp;we&nbsp;are&nbsp;pretty&nbsp;sure&nbsp;the&nbsp;issue&nbsp;is&nbsp;not&nbsp;a&nbsp;bungled&nbsp;ACL,&nbsp;per&nbsp;se.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;b)&nbsp;Besides&nbsp;that,&nbsp;it&nbsp;only&nbsp;happens&nbsp;when&nbsp;the&nbsp;proxy&nbsp;has&nbsp;some&nbsp;load&nbsp;on&nbsp;it,&nbsp;we&nbsp;have&nbsp;been&nbsp;unable&nbsp;to&nbsp;reproduce&nbsp;this&nbsp;on&lt;/div&gt;&lt;div&gt;our&nbsp;test&nbsp;machines,&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;have&nbsp;a&nbsp;significant&nbsp;load.&nbsp;We&#39;ve&nbsp;been&nbsp;postponing&nbsp;our&nbsp;ACL&#39;s&nbsp;changes&nbsp;for&lt;/div&gt;&lt;div&gt;early&nbsp;morning/lunch-hour&nbsp;these&nbsp;past&nbsp;days,&nbsp;and&nbsp;we&nbsp;didn&#39;t&nbsp;have&nbsp;had&nbsp;a&nbsp;FATAL&nbsp;error&nbsp;since&nbsp;last&nbsp;week.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;c)&nbsp;Although&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;non&nbsp;US-ASCII&nbsp;on&nbsp;the&nbsp;ACL&#39;s&nbsp;themselves,&nbsp;we&nbsp;have&nbsp;a&nbsp;lot&nbsp;of&nbsp;them&nbsp;on&nbsp;comments,&nbsp;so&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;stripped&nbsp;down&nbsp;all&nbsp;the&nbsp;comments&nbsp;of&nbsp;the&nbsp;ACL&#39;s&nbsp;files&nbsp;and&nbsp;tried&nbsp;that&nbsp;on&nbsp;our&nbsp;test&nbsp;bed,&nbsp;it&nbsp;didn&#39;t&nbsp;generare&nbsp;any&lt;/div&gt;&lt;div&gt;kind&nbsp;of&nbsp;errors,&nbsp;but&nbsp;since&nbsp;they&nbsp;do&nbsp;not&nbsp;have&nbsp;some&nbsp;load&nbsp;on&nbsp;it,&nbsp;we&nbsp;are&nbsp;not&nbsp;sure&nbsp;if&nbsp;it&nbsp;was&nbsp;the&nbsp;comments&nbsp;stripping &nbsp;&lt;br&gt;&lt;/div&gt;or&nbsp;the&nbsp;lack&nbsp;of&nbsp;load&nbsp;on&nbsp;the&nbsp;server...&lt;br&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;So,&nbsp;we&nbsp;are&nbsp;now&nbsp;searching&nbsp;for&nbsp;an&nbsp;&quot;easy&quot;&nbsp;way&nbsp;of&nbsp;generating&nbsp;traffic&nbsp;on&nbsp;a&nbsp;squid&nbsp;server,&nbsp;so&nbsp;we&nbsp;can,&nbsp;at&nbsp;least,&nbsp;be&lt;/div&gt;&lt;div&gt;able&nbsp;to&nbsp;reproduce&nbsp;the&nbsp;error,&nbsp;so&nbsp;we&nbsp;can&nbsp;try&nbsp;the&nbsp;different&nbsp;solutions....&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2017-10-18&nbsp;1:06&nbsp;GMT+01:00&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&nbsp;target=&quot;_blank&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Are&nbsp;you&nbsp;validating&nbsp;your&nbsp;config&nbsp;files&nbsp;before&nbsp;committing&nbsp;them??&lt;br&gt;<br>
If&nbsp;you&nbsp;have&nbsp;about&nbsp;100&nbsp;clients&nbsp;this&nbsp;is&nbsp;the&nbsp;first&nbsp;thing&nbsp;to&nbsp;do...&lt;br&gt;<br>
Either&nbsp;run&nbsp;a&nbsp;asciii&nbsp;validation&nbsp;script&nbsp;for&nbsp;the&nbsp;whole&nbsp;file(I&nbsp;can&nbsp;write&nbsp;it&nbsp;if&nbsp;you&nbsp;really&nbsp;need&nbsp;it)&nbsp;or&nbsp;maintain&nbsp;two&nbsp;configuration&nbsp;testing&nbsp;node&nbsp;(CentOS&nbsp;6+7).&lt;br&gt;<br>
You&nbsp;don&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;apply&nbsp;the&nbsp;configurations&nbsp;into&nbsp;the&nbsp;a&nbsp;running&nbsp;squid,&nbsp;you&nbsp;just&nbsp;need&nbsp;to&nbsp;run&nbsp;a&nbsp;command&nbsp;like&nbsp;&quot;squid&nbsp;-kparse&nbsp;-f&nbsp;/etc/squid/squid.conf&quot;&nbsp;and&nbsp;it&nbsp;will&nbsp;tell&nbsp;you&nbsp;what&#39;s&nbsp;wrong.&lt;br&gt;<br>
&lt;br&gt;<br>
Let&nbsp;me&nbsp;know&nbsp;if&nbsp;you&nbsp;need&nbsp;more&nbsp;help.&lt;br&gt;<br>
&lt;br&gt;<br>
Eliezer&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;CC&nbsp;me&nbsp;since&nbsp;I&#39;m&nbsp;not&nbsp;watching&nbsp;the&nbsp;list&nbsp;daily&nbsp;these&nbsp;days.&lt;br&gt;<br>
&lt;br&gt;<br>
----&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://ngtech.co.il/lmgtfy/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://ngtech.co.il/lmgtfy/&lt;/a&gt;&lt;br&gt;<br>
Linux&nbsp;System&nbsp;Administrator&lt;br&gt;<br>
Mobile:&nbsp;&lt;a&nbsp;href=&quot;tel:%2B972-5-28704261&quot;&nbsp;value=&quot;+972528704261&quot;&gt;+972-5-28704261&lt;/a&gt;&lt;br&gt;<br>
Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:eliezer@ngtech.co.il&quot;&gt;eliezer@ngtech.co.il&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
From:&nbsp;squid-users&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&gt;squid-users-bounces@&lt;wbr&gt;lists.squid-cache.org&lt;/a&gt;]&nbsp;On&nbsp;Behalf&nbsp;Of&nbsp;Francisco&nbsp;Amaro&lt;br&gt;<br>
Sent:&nbsp;Thursday,&nbsp;October&nbsp;12,&nbsp;2017&nbsp;19:25&lt;br&gt;<br>
To:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
Subject:&nbsp;[squid-users]&nbsp;Squid&nbsp;3.5.20&nbsp;and&nbsp;3.1.23&nbsp;getting&nbsp;re-started&nbsp;with&nbsp;bogus&nbsp;&quot;FATAL:&nbsp;Bungled&quot;&nbsp;acls&lt;br&gt;<br>
&lt;div&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
Hello&nbsp;all,&lt;br&gt;<br>
&lt;br&gt;<br>
We&nbsp;are&nbsp;running&nbsp;stock&nbsp;CentOS&nbsp;6&nbsp;and&nbsp;CentOS&nbsp;7&nbsp;Squid&nbsp;builds,&nbsp;patched&nbsp;to&nbsp;the&nbsp;latest&nbsp;version,&nbsp;3.1.23&nbsp;and&nbsp;3.5.20.&lt;br&gt;<br>
We&nbsp;have&nbsp;several&nbsp;machines,&nbsp;running&nbsp;on&nbsp;separate&nbsp;locations,&nbsp;with&nbsp;an&nbsp;ACL&nbsp;file&nbsp;unique&nbsp;to&nbsp;all,&nbsp;that&nbsp;get&#39;s&nbsp;pushed&nbsp;to&nbsp;all&nbsp;machines&nbsp;using&nbsp;an&nbsp;homemade&nbsp;script.&nbsp;So&nbsp;local&nbsp;configuration&nbsp;(interfaces,&nbsp;cache&nbsp;locations,&nbsp;etc)&nbsp;is&nbsp;one&nbsp;file,&nbsp;and&nbsp;the&nbsp;bulk&nbsp;of&nbsp;the&nbsp;ACL&#39;s&nbsp;are&nbsp;included&nbsp;on&lt;br&gt;<br>
a&nbsp;separate&nbsp;file,&nbsp;that&nbsp;is&nbsp;the&nbsp;same&nbsp;on&nbsp;all&nbsp;servers.&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;some&nbsp;time&nbsp;now,&nbsp;but&nbsp;getting&nbsp;more&nbsp;frequent&nbsp;on&nbsp;the&nbsp;last&nbsp;couple&nbsp;of&nbsp;weeks,&nbsp;we&nbsp;have&nbsp;been&nbsp;getting&nbsp;errors&nbsp;on&nbsp;our&nbsp;cache.log&nbsp;about&nbsp;bogus&nbsp;ACL&#39;s,&nbsp;forcing&nbsp;a&nbsp;squid&nbsp;restart.&nbsp;This&nbsp;happens&nbsp;on&nbsp;configuration&nbsp;reloads,&nbsp;which&nbsp;we&nbsp;do&nbsp;very&nbsp;frequently, &nbsp;maybe&nbsp;10-20&nbsp;times&nbsp;a&nbsp;day.&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;CentOS&nbsp;6,&nbsp;the&nbsp;most&nbsp;frequent&nbsp;error&nbsp;is&nbsp;:&lt;br&gt;<br>
&lt;br&gt;<br>
FATAL:&nbsp;Bungled&nbsp;(null)&nbsp;line&nbsp;203:&nbsp;icap_retry&nbsp;deny&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
We&nbsp;do&nbsp;not&nbsp;use&nbsp;icap_retry,&nbsp;it&nbsp;is&nbsp;missing&nbsp;from&nbsp;the&nbsp;config&nbsp;file,&nbsp;but&nbsp;this&nbsp;seems&nbsp;to&nbsp;be&nbsp;fixed&nbsp;on&nbsp;3.2.4:&lt;br&gt;<br>
&lt;br&gt;<br>
Changes&nbsp;to&nbsp;squid-3.2.4&nbsp;(03&nbsp;Dec&nbsp;2012):&lt;br&gt;<br>
-&nbsp;Remove&nbsp;&#39;Bungled&#39;&nbsp;warning&nbsp;on&nbsp;missing&nbsp;component&nbsp;directives&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;CentOS&nbsp;7,&nbsp;the&nbsp;most&nbsp;frequent&nbsp;error&nbsp;is&nbsp;:&lt;br&gt;<br>
&lt;br&gt;<br>
FATAL:&nbsp;Bungled&nbsp;(null)&nbsp;line&nbsp;3:&nbsp;sslproxy_cert_sign&nbsp;signTrusted&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
Now&nbsp;this&nbsp;one&nbsp;even&nbsp;has&nbsp;a&nbsp;bug&nbsp;entry,&nbsp;and&nbsp;was&nbsp;fixed&nbsp;on&nbsp;3.3.5:&lt;br&gt;<br>
&lt;br&gt;<br>
Changes&nbsp;to&nbsp;squid-3.3.5&nbsp;(20&nbsp;May&nbsp;2013):&lt;br&gt;<br>
-&nbsp;Bug&nbsp;3744:&nbsp;squid&nbsp;terminated:&nbsp;FATAL:&nbsp;Bungled&nbsp;(null)&nbsp;line&nbsp;3:&nbsp;sslproxy_cert_sign&nbsp;signTrusted&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
But&nbsp;we&nbsp;are&nbsp;still&nbsp;seeing&nbsp;it&nbsp;on&nbsp;3.5.20...&lt;br&gt;<br>
&lt;br&gt;<br>
Now&nbsp;what&nbsp;is&nbsp;even&nbsp;more&nbsp;weird&nbsp;is&nbsp;that&nbsp;besides&nbsp;that,&nbsp;we&nbsp;are&nbsp;getting&nbsp;what&nbsp;seem&nbsp;complete&nbsp;random&nbsp;bogus&nbsp;entries,&nbsp;like&nbsp;this&nbsp;ones:&lt;br&gt;<br>
&lt;br&gt;<br>
FATAL:&nbsp;Bungled&nbsp;/etc/squid/squid_acls&nbsp;line&nbsp;11796:&nbsp;acl&nbsp;xyz_allow_url&lt;br&gt;<br>
FATAL:&nbsp;Bungled&nbsp;/etc/squid/squid_acls&nbsp;line&nbsp;10905:&nbsp;acl&nbsp;abc_url108&nbsp;dstdomai&lt;br&gt;<br>
&lt;br&gt;<br>
FATAL:&nbsp;Bungled&nbsp;squid_acls&nbsp;line&nbsp;10033:&nbsp;http_access&nbsp;allow&nbsp;def_&lt;br&gt;<br>
FATAL:&nbsp;Bungled&nbsp;squid_acls&nbsp;line&nbsp;9605:&nbsp;http_access&nbsp;allow&nbsp;ms_src_teste&nbsp;ms_t&lt;br&gt;<br>
FATAL:&nbsp;Bungled&nbsp;squid_acls&nbsp;line&nbsp;11025:&nbsp;http_access&nbsp;allow&nbsp;xpto&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;problem&nbsp;is&nbsp;that&nbsp;these&nbsp;lines&nbsp;are&nbsp;100%&nbsp;correct&nbsp;,&nbsp;they&nbsp;are&nbsp;not&nbsp;&quot;bungled&quot;&nbsp;at&nbsp;all, &nbsp;it&nbsp;seems&nbsp;the&nbsp;parser&nbsp;as&nbsp;some&nbsp;issue&nbsp;with&nbsp;it.&lt;br&gt;<br>
&lt;br&gt;<br>
Each&nbsp;time&nbsp;we&nbsp;get&nbsp;an&nbsp;error&nbsp;like&nbsp;this,&nbsp;Squid&nbsp;does&nbsp;a&nbsp;full&nbsp;restart,&nbsp;and&nbsp;that&nbsp;on&nbsp;CentOS&nbsp;6&nbsp;is&nbsp;time&nbsp;consuming,&nbsp;maybe&nbsp;2-3&nbsp;minutes,&nbsp;time&nbsp;enough&nbsp;for&nbsp;our&nbsp;users&nbsp;reaching&nbsp;for&nbsp;the&nbsp;Helpdesk&nbsp;tickets...&nbsp;On&nbsp;CentOS&nbsp;7,&nbsp;since&nbsp;the&nbsp;restart&nbsp;is&nbsp;very&nbsp;fast,&nbsp;we&nbsp;do&nbsp;not&nbsp;have&nbsp;many&nbsp;complaints...&lt;br&gt;<br>
&lt;br&gt;<br>
Our&nbsp;ACL&nbsp;file&nbsp;is&nbsp;currently&nbsp;7500&nbsp;lines,&nbsp;mostly&nbsp;comprising&nbsp;of&nbsp;dstdomain&nbsp;and&nbsp;url_regex&nbsp;entries.&nbsp;We&nbsp;support&nbsp;a&nbsp;lot&nbsp;of&nbsp;costumers&nbsp;(about&nbsp;100)&nbsp;and&nbsp;each&nbsp;one&nbsp;has&nbsp;a&nbsp;specific&nbsp;configuration.&nbsp;Mostly&nbsp;have&nbsp;while&nbsp;lists,&nbsp;and&nbsp;there&nbsp;are&nbsp;a &nbsp;few&nbsp;blacklists&nbsp;in&nbsp;the&nbsp;middle...&nbsp;so,&nbsp;not&nbsp;very&nbsp;big&nbsp;in&nbsp;terms&nbsp;of&nbsp;line&nbsp;numbers,&nbsp;but&nbsp;somewhat &nbsp;complex&nbsp;regarding&nbsp;site/VLAN&nbsp;entries...&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;security/privacy&nbsp;reasons&nbsp;I&nbsp;cannot&nbsp;share&nbsp;my&nbsp;complete&nbsp;configuration,&nbsp;namely&nbsp;the&nbsp;ACL&#39;s&nbsp;part,&nbsp;since&nbsp;they&nbsp;contain&nbsp;client&nbsp;information,&nbsp;but&nbsp;I&nbsp;am&nbsp;able&nbsp;to&nbsp;get&nbsp;detailed&nbsp;logging&nbsp;and/or&nbsp;redacted&nbsp;information...&lt;br&gt;<br>
&lt;br&gt;<br>
So...&nbsp;anyone&nbsp;has&nbsp;any&nbsp;clue&nbsp;what&nbsp;is&nbsp;happenning&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Francisco&nbsp;Amaro&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;Email:&nbsp;mailto:&lt;a&nbsp;href=&quot;mailto:famaro@gmail.com&quot;&gt;famaro@gmail.com&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;Francisco&nbsp;Amaro&nbsp;&lt;br&gt;Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:famaro@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;famaro@gmail.com&lt;/a&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
