<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;You&nbsp;do&nbsp;realize&nbsp;that&nbsp;there&#39;s&nbsp;nothing&nbsp;&quot;weird&quot;&nbsp;about&nbsp;p0f,&nbsp;right?&nbsp;Perhaps&nbsp;you&nbsp;should&nbsp;have&nbsp;a&nbsp;read&nbsp;over:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;a&nbsp;href=&quot;http://lcamtuf.coredump.cx/p0f3/&quot;&gt;http://lcamtuf.coredump.cx/p0f3/&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;a&nbsp;href=&quot;https://blog.cloudflare.com/introducing-the-p0f-bpf-compiler/&quot;&gt;https://blog.cloudflare.com/introducing-the-p0f-bpf-compiler/&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Oct&nbsp;30,&nbsp;2017&nbsp;at&nbsp;11:22&nbsp;AM,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;On&nbsp;10/30/2017&nbsp;03:51&nbsp;AM,&nbsp;Troiano&nbsp;Alessio&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&#39;ve&nbsp;squid&nbsp;3.5.20&nbsp;running&nbsp;on&nbsp;RHEL&nbsp;7.4.&nbsp;I&nbsp;have&nbsp;a&nbsp;problem&nbsp;to&nbsp;access&lt;br&gt;<br>
&gt;&nbsp;some&nbsp;websites,&nbsp;for&nbsp;example&nbsp;&lt;a&nbsp;href=&quot;http://www.nato.int&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;www.nato.int&lt;/a&gt;.&nbsp;This&nbsp;website&nbsp;apply&nbsp;an&lt;br&gt;<br>
&gt;&nbsp;Anti-DDoS&nbsp;system&nbsp;that&nbsp;reset&nbsp;the&nbsp;first&nbsp;connection&nbsp;after&nbsp;the&nbsp;TCP&nbsp;3-way&lt;br&gt;<br>
&gt;&nbsp;handshake&nbsp;(SYN/SYN-ACK/ACK/RST-ACK).&nbsp;All&nbsp;subsequent&nbsp;TCP&nbsp;connections&lt;br&gt;<br>
&gt;&nbsp;are&nbsp;accepted.&nbsp;The&nbsp;website&nbsp;administrator&nbsp;say&#39;s&nbsp;it&nbsp;is&nbsp;by&nbsp;design.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&gt;&nbsp;When&nbsp;I&nbsp;browse&nbsp;the&nbsp;site&nbsp;with&nbsp;squid&nbsp;proxy&nbsp;the&nbsp;browser&nbsp;receive&nbsp;an&nbsp;&quot;Empty&lt;br&gt;<br>
&gt;&nbsp;Response&quot;&nbsp;squid&nbsp;error&nbsp;page&nbsp;(HTTP&nbsp;error&nbsp;code&nbsp;502&nbsp;Bad&nbsp;Gateway)&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;doesn&#39;t&nbsp;do&nbsp;the&nbsp;automatic&nbsp;retry:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;This&nbsp;is&nbsp;by&nbsp;design&nbsp;as&nbsp;well&nbsp;:-).&lt;br&gt;<br>
&lt;br&gt;<br>
We&nbsp;can&nbsp;change&nbsp;Squid&nbsp;behavior&nbsp;to&nbsp;retry&nbsp;connection&nbsp;resets,&nbsp;but&nbsp;I&nbsp;am&nbsp;sure&lt;br&gt;<br>
that&nbsp;some&nbsp;folks&nbsp;will&nbsp;not&nbsp;like&nbsp;the&nbsp;new&nbsp;behavior&nbsp;because&nbsp;in&nbsp;_their_&nbsp;use&lt;br&gt;<br>
cases&nbsp;a&nbsp;retry&nbsp;is&nbsp;wasteful&nbsp;and/or&nbsp;painful.&nbsp;IMHO,&nbsp;the&nbsp;new&nbsp;behavior&nbsp;should&lt;br&gt;<br>
be&nbsp;controlled&nbsp;by&nbsp;a&nbsp;configuration&nbsp;directive,&nbsp;possibly&nbsp;an&nbsp;ACL-driven&nbsp;one.&lt;br&gt;<br>
&lt;br&gt;<br>
Quality&nbsp;patches&nbsp;implementing&nbsp;the&nbsp;above&nbsp;feature&nbsp;should&nbsp;be&nbsp;welcomed&nbsp;IMO.&lt;br&gt;<br>
The&nbsp;tip&nbsp;of&nbsp;the&nbsp;relevant&nbsp;code&nbsp;is&nbsp;probably&nbsp;in&nbsp;ERR_ZERO_SIZE_OBJECT&lt;br&gt;<br>
handling&nbsp;inside&nbsp;FwdState::fail().&nbsp;There&nbsp;is&nbsp;a&nbsp;similar&nbsp;code&nbsp;that&nbsp;handles&lt;br&gt;<br>
persistent&nbsp;connection&nbsp;races&nbsp;there&nbsp;already,&nbsp;but&nbsp;the&nbsp;zero-size&nbsp;reply&nbsp;code&lt;br&gt;<br>
may&nbsp;need&nbsp;a&nbsp;new&nbsp;dedicated&nbsp;FwdState&nbsp;flag&nbsp;to&nbsp;prevent&nbsp;infinite&nbsp;retry&nbsp;loops&lt;br&gt;<br>
when&nbsp;the&nbsp;origin&nbsp;server&nbsp;is&nbsp;broken&nbsp;(a&nbsp;much&nbsp;more&nbsp;typical&nbsp;use&nbsp;case&nbsp;than&nbsp;the&lt;br&gt;<br>
weird&nbsp;attempt&nbsp;at&nbsp;DDoS&nbsp;mitigation&nbsp;that&nbsp;you&nbsp;have&nbsp;described&nbsp;above).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/&lt;wbr&gt;SquidFaq/AboutSquid#How_to_&lt;wbr&gt;add_a_new_Squid_feature.2C_&lt;wbr&gt;enhance.2C_of_fix_something.3F&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;gmail-HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;gmail-h5&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;[root@soc-pe-nagios01&nbsp;~]#&nbsp;wget&nbsp;&lt;a&nbsp;href=&quot;http://www.nato.int&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;www.nato.int&lt;/a&gt;&nbsp;-e&nbsp;use_proxy=yes&nbsp;-e&nbsp;http_proxy=&lt;a&nbsp;href=&quot;http://172.31.1.67:8080&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.31.1.67:8080&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;--2017-10-30&nbsp;10:41:09-- &nbsp;&lt;a&nbsp;href=&quot;http://www.nato.int/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.nato.int/&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;Connecting&nbsp;to&nbsp;172.31.1.67:8080...&nbsp;connected.&lt;br&gt;<br>
&gt;&nbsp;Proxy&nbsp;request&nbsp;sent,&nbsp;awaiting&nbsp;response...&nbsp;502&nbsp;Bad&nbsp;Gateway&lt;br&gt;<br>
&gt;&nbsp;2017-10-30&nbsp;10:41:09&nbsp;ERROR&nbsp;502:&nbsp;Bad&nbsp;Gateway.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;can&#39;t&nbsp;find&nbsp;an&nbsp;RFC&nbsp;that&nbsp;confirm&nbsp;if&nbsp;browser&nbsp;and&nbsp;proxyes&nbsp;should&nbsp;try&nbsp;a&nbsp;page&nbsp;reload,&nbsp;or&nbsp;if&nbsp;squid&nbsp;has&nbsp;an&nbsp;option&nbsp;to&nbsp;do&nbsp;that.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Any&nbsp;help&nbsp;is&nbsp;appreciated.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Best&nbsp;Regards,&nbsp;Alessio.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Il&nbsp;presente&nbsp;messaggio&nbsp;e-mail&nbsp;e&nbsp;ogni&nbsp;suo&nbsp;allegato&nbsp;devono&nbsp;intendersi&nbsp;indirizzati&nbsp;esclusivamente&nbsp;al&nbsp;destinatario&nbsp;indicato&nbsp;e&nbsp;considerarsi&nbsp;dal&nbsp;contenuto&nbsp;strettamente&nbsp;riservato&nbsp;e&nbsp;confidenziale.&nbsp;Se&nbsp;non&nbsp;siete&nbsp;l&#39;effettivo&nbsp;destinatario&nbsp;o&nbsp;avete&nbsp;ricevuto&nbsp;il&nbsp;messaggio&nbsp;e-mail&nbsp;per&nbsp;errore,&nbsp;siete&nbsp;pregati&nbsp;di&nbsp;avvertire&nbsp;immediatamente&nbsp;il&nbsp;mittente&nbsp;e&nbsp;di&nbsp;cancellare&nbsp;il&nbsp;suddetto&nbsp;messaggio&nbsp;e&nbsp;ogni&nbsp;suo&nbsp;allegato&nbsp;dal&nbsp;vostro&nbsp;sistema&nbsp;informatico.&nbsp;Qualsiasi&nbsp;utilizzo,&nbsp;diffusione,&nbsp;copia&nbsp;o&nbsp;archiviazione&nbsp;del&nbsp;presente&nbsp;messaggio&nbsp;da&nbsp;parte&nbsp;di&nbsp;chi&nbsp;non&nbsp;ne&nbsp;è&nbsp;il&nbsp;destinatario&nbsp;è&nbsp;strettamente&nbsp;proibito&nbsp;e&nbsp;può&nbsp;dar&nbsp;luogo&nbsp;a&nbsp;responsabilità&nbsp;di&nbsp;carattere&nbsp;civile&nbsp;e&nbsp;penale&nbsp;punibili&nbsp;ai&nbsp;sensi&nbsp;di&nbsp;legge.&lt;br&gt;<br>
&gt;&nbsp;Questa&nbsp;e-mail&nbsp;ha&nbsp;valore&nbsp;legale&nbsp;solo&nbsp;se&nbsp;firmata&nbsp;digitalmente&nbsp;ai&nbsp;sensi&nbsp;della&nbsp;normativa&nbsp;vigente.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;contents&nbsp;of&nbsp;this&nbsp;email&nbsp;message&nbsp;and&nbsp;any&nbsp;attachments&nbsp;are&nbsp;intended&nbsp;solely&nbsp;for&nbsp;the&nbsp;addressee(s)&nbsp;and&nbsp;contain&nbsp;confidential&nbsp;and/or&nbsp;privileged&nbsp;information.&lt;br&gt;<br>
&gt;&nbsp;If&nbsp;you&nbsp;are&nbsp;not&nbsp;the&nbsp;intended&nbsp;recipient&nbsp;of&nbsp;this&nbsp;message,&nbsp;or&nbsp;if&nbsp;this&nbsp;message&nbsp;has&nbsp;been&nbsp;addressed&nbsp;to&nbsp;you&nbsp;in&nbsp;error,&nbsp;please&nbsp;immediately&nbsp;notify&nbsp;the&nbsp;sender&nbsp;and&nbsp;then&nbsp;delete&nbsp;this&nbsp;message&nbsp;and&nbsp;any&nbsp;attachments&nbsp;from&nbsp;your&nbsp;system.&nbsp;If&nbsp;you&nbsp;are&nbsp;not&nbsp;the&nbsp;intended&nbsp;recipient,&nbsp;you&nbsp;are&nbsp;hereby&nbsp;notified&nbsp;that&nbsp;any&nbsp;use,&nbsp;dissemination,&nbsp;copying,&nbsp;or&nbsp;storage&nbsp;of&nbsp;this&nbsp;message&nbsp;or&nbsp;its&nbsp;attachments&nbsp;is&nbsp;strictly&nbsp;prohibited.&nbsp;Unauthorized&nbsp;disclosure&nbsp;and/or&nbsp;use&nbsp;of&nbsp;information&nbsp;contained&nbsp;in&nbsp;this&nbsp;email&nbsp;message&nbsp;may&nbsp;result&nbsp;in&nbsp;civil&nbsp;and&nbsp;criminal&nbsp;liability.&nbsp;“&lt;br&gt;<br>
&gt;&nbsp;This&nbsp;e-mail&nbsp;has&nbsp;legal&nbsp;value&nbsp;according&nbsp;to&nbsp;the&nbsp;applicable&nbsp;laws&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;digitally&nbsp;signed&nbsp;by&nbsp;the&nbsp;sender&lt;br&gt;<br>
&gt;&nbsp;______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/&lt;wbr&gt;listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/&lt;wbr&gt;listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
