<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;span&nbsp;style=&quot;font-family:sans-serif;font-size:13.696px&quot;&gt;It&#39;s&nbsp;regarding&nbsp;active&nbsp;fingerprinting&nbsp;and&nbsp;mitigating&nbsp;attacks,&nbsp;not&nbsp;just&nbsp;it&#39;s&nbsp;passive&nbsp;use.&nbsp;(Sorry&nbsp;for&nbsp;the&nbsp;dbl&nbsp;send)&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Oct&nbsp;30,&nbsp;2017&nbsp;21:41,&nbsp;&quot;Alex&nbsp;Rousskov&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&nbsp;type=&quot;attribution&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;10/30/2017&nbsp;12:15&nbsp;PM,&nbsp;Andrei&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;You&nbsp;do&nbsp;realize&nbsp;that&nbsp;there&#39;s&nbsp;nothing&nbsp;&quot;weird&quot;&nbsp;about&nbsp;p0f,&nbsp;right?&lt;br&gt;<br>
&lt;br&gt;<br>
Right.&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;why&nbsp;you&nbsp;had&nbsp;to&nbsp;ask&nbsp;though:&nbsp;There&nbsp;is&nbsp;nothing&nbsp;related&lt;br&gt;<br>
to&nbsp;p0f&nbsp;(i.e.,&nbsp;a&nbsp;passive&nbsp;traffic&nbsp;analysis&nbsp;tool)&nbsp;in&nbsp;my&nbsp;response.&nbsp;And&nbsp;the&lt;br&gt;<br>
original&nbsp;question&nbsp;is&nbsp;probably&nbsp;unrelated&nbsp;to&nbsp;p0f&nbsp;as&nbsp;well&nbsp;since&nbsp;active&lt;br&gt;<br>
connection&nbsp;resets&nbsp;are&nbsp;incompatible&nbsp;with&nbsp;the&nbsp;idea&nbsp;of&nbsp;passive&nbsp;analysis.&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Mon,&nbsp;Oct&nbsp;30,&nbsp;2017&nbsp;at&nbsp;11:22&nbsp;AM,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; On&nbsp;10/30/2017&nbsp;03:51&nbsp;AM,&nbsp;Troiano&nbsp;Alessio&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;I&#39;ve&nbsp;squid&nbsp;3.5.20&nbsp;running&nbsp;on&nbsp;RHEL&nbsp;7.4.&nbsp;I&nbsp;have&nbsp;a&nbsp;problem&nbsp;to&nbsp;access&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;some&nbsp;websites,&nbsp;for&nbsp;example&nbsp;&lt;a&nbsp;href=&quot;http://www.nato.int&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;www.nato.int&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://www.nato.int&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.nato.int&lt;/a&gt;&gt;.&nbsp;This&nbsp;website&nbsp;apply&nbsp;an&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;Anti-DDoS&nbsp;system&nbsp;that&nbsp;reset&nbsp;the&nbsp;first&nbsp;connection&nbsp;after&nbsp;the&nbsp;TCP&nbsp;3-way&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;handshake&nbsp;(SYN/SYN-ACK/ACK/RST-ACK).&nbsp;All&nbsp;subsequent&nbsp;TCP&nbsp;connections&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;are&nbsp;accepted.&nbsp;The&nbsp;website&nbsp;administrator&nbsp;say&#39;s&nbsp;it&nbsp;is&nbsp;by&nbsp;design.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;When&nbsp;I&nbsp;browse&nbsp;the&nbsp;site&nbsp;with&nbsp;squid&nbsp;proxy&nbsp;the&nbsp;browser&nbsp;receive&nbsp;an&nbsp;&quot;Empty&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;Response&quot;&nbsp;squid&nbsp;error&nbsp;page&nbsp;(HTTP&nbsp;error&nbsp;code&nbsp;502&nbsp;Bad&nbsp;Gateway)&nbsp;and&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;doesn&#39;t&nbsp;do&nbsp;the&nbsp;automatic&nbsp;retry:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; This&nbsp;is&nbsp;by&nbsp;design&nbsp;as&nbsp;well&nbsp;:-).&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; We&nbsp;can&nbsp;change&nbsp;Squid&nbsp;behavior&nbsp;to&nbsp;retry&nbsp;connection&nbsp;resets,&nbsp;but&nbsp;I&nbsp;am&nbsp;sure&lt;br&gt;<br>
&gt; &nbsp; &nbsp; that&nbsp;some&nbsp;folks&nbsp;will&nbsp;not&nbsp;like&nbsp;the&nbsp;new&nbsp;behavior&nbsp;because&nbsp;in&nbsp;_their_&nbsp;use&lt;br&gt;<br>
&gt; &nbsp; &nbsp; cases&nbsp;a&nbsp;retry&nbsp;is&nbsp;wasteful&nbsp;and/or&nbsp;painful.&nbsp;IMHO,&nbsp;the&nbsp;new&nbsp;behavior&nbsp;should&lt;br&gt;<br>
&gt; &nbsp; &nbsp; be&nbsp;controlled&nbsp;by&nbsp;a&nbsp;configuration&nbsp;directive,&nbsp;possibly&nbsp;an&nbsp;ACL-driven&nbsp;one.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Quality&nbsp;patches&nbsp;implementing&nbsp;the&nbsp;above&nbsp;feature&nbsp;should&nbsp;be&nbsp;welcomed&nbsp;IMO.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; The&nbsp;tip&nbsp;of&nbsp;the&nbsp;relevant&nbsp;code&nbsp;is&nbsp;probably&nbsp;in&nbsp;ERR_ZERO_SIZE_OBJECT&lt;br&gt;<br>
&gt; &nbsp; &nbsp; handling&nbsp;inside&nbsp;FwdState::fail().&nbsp;There&nbsp;is&nbsp;a&nbsp;similar&nbsp;code&nbsp;that&nbsp;handles&lt;br&gt;<br>
&gt; &nbsp; &nbsp; persistent&nbsp;connection&nbsp;races&nbsp;there&nbsp;already,&nbsp;but&nbsp;the&nbsp;zero-size&nbsp;reply&nbsp;code&lt;br&gt;<br>
&gt; &nbsp; &nbsp; may&nbsp;need&nbsp;a&nbsp;new&nbsp;dedicated&nbsp;FwdState&nbsp;flag&nbsp;to&nbsp;prevent&nbsp;infinite&nbsp;retry&nbsp;loops&lt;br&gt;<br>
&gt; &nbsp; &nbsp; when&nbsp;the&nbsp;origin&nbsp;server&nbsp;is&nbsp;broken&nbsp;(a&nbsp;much&nbsp;more&nbsp;typical&nbsp;use&nbsp;case&nbsp;than&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; weird&nbsp;attempt&nbsp;at&nbsp;DDoS&nbsp;mitigation&nbsp;that&nbsp;you&nbsp;have&nbsp;described&nbsp;above).&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/SquidFaq/AboutSquid#How_to_add_a_new_Squid_feature.2C_enhance.2C_of_fix_something.3F&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/&lt;wbr&gt;SquidFaq/AboutSquid#How_to_&lt;wbr&gt;add_a_new_Squid_feature.2C_&lt;wbr&gt;enhance.2C_of_fix_something.3F&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
