<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;&lt;br&nbsp;type=&quot;attribution&quot;&gt;&lt;blockquote&nbsp;class=&quot;quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;hey&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;thanks:&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;i&nbsp;post&nbsp;in&nbsp;detail&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;i&nbsp;have&nbsp;an&nbsp;openwrt&nbsp;box.&nbsp;clients&nbsp;are&nbsp;attached&nbsp;there&nbsp;to&nbsp;the&nbsp;&lt;a&nbsp;href=&quot;http://192.168.2.0/24&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.2.0/24&lt;/a&gt;&nbsp;network&nbsp;via&nbsp;nat.&nbsp;i&nbsp;attached&nbsp;the&nbsp;router&nbsp;as&nbsp;a&nbsp;wan&nbsp;device&nbsp;on&nbsp;my&nbsp;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.0/24&lt;/a&gt;&nbsp;with&nbsp;192.168.1.254&nbsp;as&nbsp;my&nbsp;internet&nbsp;gateway.&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;i&nbsp;have&nbsp;a&nbsp;squidbox &nbsp;with&nbsp;squid&nbsp;4&nbsp;running&nbsp;on&nbsp;ports&nbsp;3128&nbsp;and&nbsp;3129&nbsp;and&nbsp;3130.&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt; i&nbsp;forward&nbsp;the&nbsp;traffic&nbsp;from&nbsp;the&nbsp;openwrt&nbsp;via:&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-j&nbsp;ACCEPT&nbsp;-p&nbsp;tcp&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt; --dport&nbsp;80&nbsp;-s&nbsp;192.168.1.222 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-j&nbsp;MARK&nbsp;--set-ma&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;rk&nbsp;3&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-j&nbsp;ACCEPT&nbsp;-p&nbsp;tcp&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt; --dport&nbsp;443&nbsp;-s&nbsp;192.168.1.222 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-j&nbsp;MARK&nbsp;--set-ma&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;rk&nbsp;3&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;443 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;ip&nbsp;rule&nbsp;add&nbsp;fwmark&nbsp;3&nbsp;table&nbsp;2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;ip&nbsp;route&nbsp;add&nbsp;default&nbsp;via&nbsp;192.168.1.222&nbsp;dev&nbsp;eth0.2&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt; table&nbsp;2&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;on&nbsp;the&nbsp;squid&nbsp;box&nbsp;redirected&nbsp;it&nbsp;via&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;iptables&nbsp;-A&nbsp;PREROUTING&nbsp;-t&nbsp;nat&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;--dp&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;ort&nbsp;443&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;3129 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;iptables&nbsp;-A&nbsp;PREROUTING&nbsp;-t&nbsp;nat&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;--dp&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;ort&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;3128&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;http&nbsp;works&nbsp;fine&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;https&nbsp;brings:&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;div&nbsp;style=&quot;font-family:verdana,sans-serif;margin-left:15px;padding:10px&nbsp;10px&nbsp;10px&nbsp;100px;background-image:initial;background-position:left&nbsp;center;background-size:initial;background-repeat:no-repeat;background-origin:initial;background-clip:initial;color:rgb(30,30,30);font-size:12px&quot;&nbsp;dir=&quot;auto&quot;&gt;&lt;h1&nbsp;style=&quot;color:rgb(0,0,0)&quot;&gt;ERROR&lt;/h1&gt;&lt;h2&nbsp;style=&quot;color:rgb(0,0,0)&quot;&gt;The&nbsp;requested&nbsp;URL&nbsp;could&nbsp;not&nbsp;be&nbsp;retrieved&lt;/h2&gt;&lt;/div&gt;&lt;hr&nbsp;style=&quot;font-family:verdana,sans-serif;margin:0px;color:rgb(30,30,30);font-size:12px&quot;&gt;&lt;div&nbsp;style=&quot;font-family:verdana,sans-serif;padding:10px;background:rgb(255,255,255);color:rgb(30,30,30);font-size:12px&quot;&nbsp;dir=&quot;auto&quot;&gt;&lt;p&gt;The&nbsp;following&nbsp;error&nbsp;was&nbsp;encountered&nbsp;while&nbsp;trying&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;URL: &lt;a&nbsp;href=&quot;https://192.168.1.222/*&quot;&nbsp;target=&quot;_blank&quot;&gt;https://192.168.1.222/*&lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&lt;b&gt;Connection&nbsp;to&nbsp;192.168.1.222&nbsp;failed.&lt;/b&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;The&nbsp;system&nbsp;returned: &lt;i&gt;(111)&nbsp;Connection&nbsp;refused&lt;/i&gt;&lt;/p&gt;&lt;p&gt;The&nbsp;remote&nbsp;host&nbsp;or&nbsp;network&nbsp;may&nbsp;be&nbsp;down.&nbsp;Please&nbsp;try&nbsp;the&nbsp;request&nbsp;again.&lt;/p&gt;&lt;p&gt;Your&nbsp;cache&nbsp;administrator&nbsp;is &lt;a&nbsp;href=&quot;mailto:webmaster?subject=CacheErrorInfo%20-%20ERR_CONNECT_FAIL&amp;body=CacheHost%3A%20raspberrypi%0D%0AErrPage%3A%20ERR_CONNECT_FAIL%0D%0AErr%3A%20%28111%29%20Connection%20refused%0D%0ATimeStamp%3A%20Sun,%2012%20Nov%202017%2011%3A44%3A04%20GMT%0D%0A%0D%0AClientIP%3A%20192.168.1.200%0D%0AServerIP%3A%20192.168.1.222%0D%0A%0D%0AHTTP%20Request%3A%0D%0ACONNECT%20%2F%20HTTP%2F1.1%0AHost%3A%20192.168.1.222%0D%0A%0D%0A%0D%0A&quot;&nbsp;target=&quot;_blank&quot;&gt;webmaster&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;i&nbsp;had&nbsp;this&nbsp;working&nbsp;a&nbsp;while&nbsp;ago&nbsp;but&nbsp;i&nbsp;forget&nbsp;how.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;elided-text&quot;&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;Am&nbsp;08.11.2017&nbsp;05:32&nbsp;schrieb&nbsp;&quot;Amos&nbsp;Jeffries&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;:&lt;br&nbsp;type=&quot;attribution&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;08/11/17&nbsp;04:52,&nbsp;snable&nbsp;snable&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hello&lt;br&gt;<br>
&lt;br&gt;<br>
i&nbsp;forward&nbsp;from.my&nbsp;openwrt&nbsp;router&nbsp;the&nbsp;traffic&nbsp;for&nbsp;443&nbsp;and&nbsp;80&nbsp;to&nbsp;my&nbsp;squid&nbsp;box&nbsp;to&nbsp;port&nbsp;3129&nbsp;and&nbsp;3128&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
What&nbsp;do&nbsp;you&nbsp;mean&nbsp;by&nbsp;&quot;forward&quot;&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
Any&nbsp;dst-IP:port&nbsp;NAT&nbsp;operation&nbsp;*MUST*&nbsp;only&nbsp;happen&nbsp;on&nbsp;the&nbsp;Squid&nbsp;device&nbsp;itself&nbsp;or&nbsp;_later_&nbsp;down&nbsp;the&nbsp;traffic&nbsp;path.&nbsp;Traffic&nbsp;must&nbsp;be&nbsp;*routed*&nbsp;to&nbsp;that&nbsp;Squid&nbsp;device.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/l&lt;wbr&gt;istinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
