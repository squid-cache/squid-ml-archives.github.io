<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;have&nbsp;an&nbsp;issue&nbsp;with&nbsp;squid&nbsp;when&nbsp;it&nbsp;tries&nbsp;to&nbsp;re-forward&nbsp;/&nbsp;retry&nbsp;failed&nbsp;request&nbsp;even&nbsp;when forward_max_tries&nbsp;is&nbsp;set&nbsp;to&nbsp;1.&nbsp;The&nbsp;situation&nbsp;when&nbsp;it&nbsp;happens&nbsp;is&nbsp;when&nbsp;there&#39;s&nbsp;no&nbsp;response,&nbsp;parent&nbsp;just&nbsp;closes&nbsp;the&nbsp;connection.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Relevant&nbsp;parts&nbsp;of&nbsp;configuration&nbsp;so&nbsp;you&nbsp;understand&nbsp;the&nbsp;architecture:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cache_peer&nbsp;127.0.0.1&nbsp;parent&nbsp;18070&nbsp;0&nbsp;no-query&nbsp;no-digest&nbsp;no-netdb-exchange&nbsp;name=proxy&lt;/div&gt;&lt;div&gt;never_direct&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;negative_ttl&nbsp;0&nbsp;seconds&lt;/div&gt;&lt;div&gt;forward_max_tries&nbsp;1&lt;/div&gt;&lt;div&gt;retry_on_error&nbsp;off&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;traffic&nbsp;flow&nbsp;from&nbsp;tcpdump&nbsp;is&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;squid&nbsp;to&nbsp;parent&lt;/div&gt;&lt;div&gt;GET&nbsp;&lt;a&nbsp;href=&quot;http://HOST/&quot;&gt;http://HOST/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;parent&nbsp;to&nbsp;squid&lt;/div&gt;&lt;div&gt;ACK&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;waiting&nbsp;(no&nbsp;response&nbsp;for&nbsp;~40&nbsp;seconds)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;parent&nbsp;to&nbsp;squid&lt;/div&gt;&lt;div&gt;FIN,&nbsp;ACK&lt;/div&gt;&lt;div&gt;squid&nbsp;to&nbsp;parent&lt;/div&gt;&lt;div&gt;FIN,&nbsp;ACK&lt;/div&gt;&lt;div&gt;parent&nbsp;to&nbsp;squid&lt;/div&gt;&lt;div&gt;FIN&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Immediately&nbsp;after&nbsp;that:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;squid&nbsp;to&nbsp;parent&lt;/div&gt;&lt;div&gt;GET&nbsp;&lt;a&nbsp;href=&quot;http://HOST/&quot;&gt;http://HOST/&lt;/a&gt;&nbsp;(again)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Debug&nbsp;logs&nbsp;from&nbsp;ALL,2:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;…&lt;/div&gt;&lt;div&gt;http.cc(2229)&nbsp;sendRequest:&nbsp;HTTP&nbsp;Server&nbsp;local=&lt;a&nbsp;href=&quot;http://127.0.0.2:46867&quot;&gt;127.0.0.2:46867&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://127.0.0.1:18070&quot;&gt;127.0.0.1:18070&lt;/a&gt;&nbsp;FD&nbsp;26&nbsp;flags=1&lt;/div&gt;&lt;div&gt;http.cc(2230)&nbsp;sendRequest:&nbsp;HTTP&nbsp;Server&nbsp;REQUEST:&lt;/div&gt;&lt;div&gt;---------&lt;/div&gt;&lt;div&gt;GET&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&nbsp;HTTP/1.1&lt;/div&gt;&lt;div&gt;…&lt;/div&gt;&lt;div&gt;http.cc(1299)&nbsp;continueAfterParsingHeader:&nbsp;WARNING:&nbsp;HTTP:&nbsp;Invalid&nbsp;Response:&nbsp;No&nbsp;object&nbsp;data&nbsp;received&nbsp;for&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&nbsp;AKA&nbsp;HOST/&lt;/div&gt;&lt;div&gt;FwdState.cc(655)&nbsp;handleUnregisteredServerEnd:&nbsp;self=0x430a438*2&nbsp;err=0x445fcf8&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;http.cc(2229)&nbsp;sendRequest:&nbsp;HTTP&nbsp;Server&nbsp;local=&lt;a&nbsp;href=&quot;http://127.0.0.2:34417&quot;&gt;127.0.0.2:34417&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://127.0.0.1:18070&quot;&gt;127.0.0.1:18070&lt;/a&gt;&nbsp;FD&nbsp;26&nbsp;flags=1&lt;/div&gt;&lt;div&gt;http.cc(2230)&nbsp;sendRequest:&nbsp;HTTP&nbsp;Server&nbsp;REQUEST:&lt;/div&gt;&lt;div&gt;---------&lt;/div&gt;&lt;div&gt;GET&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&nbsp;HTTP/1.1&lt;/div&gt;&lt;div&gt;…&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;doesn&#39;t&nbsp;happen&nbsp;100%&nbsp;times.&nbsp;Sometimes&nbsp;squid&nbsp;returns&nbsp;502&nbsp;after&nbsp;the&nbsp;1st&nbsp;try,&nbsp;sometimes&nbsp;it&nbsp;retries&nbsp;once.&nbsp;Also&nbsp;I&nbsp;haven&#39;t&nbsp;seen&nbsp;more&nbsp;than&nbsp;1&nbsp;retry.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Could&nbsp;it&nbsp;be&nbsp;a&nbsp;bug?&nbsp;We&#39;d&nbsp;really&nbsp;like&nbsp;to&nbsp;disable&nbsp;these&nbsp;retries.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;3.5.27&lt;/div&gt;&lt;div&gt;Service&nbsp;Name:&nbsp;squid&lt;/div&gt;&lt;div&gt;configure&nbsp;options: &nbsp;&#39;--program-prefix=&#39;&nbsp;&#39;--prefix=/usr&#39;&nbsp;&#39;--exec-prefix=/usr&#39;&nbsp;&#39;--bindir=/usr/sbin&#39;&nbsp;&#39;--sbindir=/usr/sbin&#39;&nbsp;&#39;--sysconfdir=/etc/squid&#39;&nbsp;&#39;--libdir=/usr/lib&#39;&nbsp;&#39;--libexecdir=/usr/lib/squid&#39;&nbsp;&#39;--includedir=/usr/include&#39;&nbsp;&#39;--datadir=/usr/share&#39;&nbsp;&#39;--sharedstatedir=/usr/com&#39;&nbsp;&#39;--localstatedir=/var&#39;&nbsp;&#39;--mandir=/usr/share/man&#39;&nbsp;&#39;--infodir=/usr/share/info&#39;&nbsp;&#39;--enable-epoll&#39;&nbsp;&#39;--enable-removal-policies=heap,lru&#39;&nbsp;&#39;--enable-storeio=aufs,rock&#39;&nbsp;&#39;--enable-delay-pools&#39;&nbsp;&#39;--with-pthreads&#39;&nbsp;&#39;--enable-cache-digests&#39;&nbsp;&#39;--with-large-files&#39;&nbsp;&#39;--with-maxfd=16384&#39;&nbsp;&#39;--enable-htcp&#39;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;With&nbsp;best&nbsp;regards,&nbsp;Ivan&nbsp;Larionov.&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
