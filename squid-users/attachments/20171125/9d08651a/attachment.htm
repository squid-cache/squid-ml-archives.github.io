<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Dear&nbsp;Amos,&nbsp;thank&nbsp;you&nbsp;so&nbsp;much&nbsp;for&nbsp;your&nbsp;quickly&nbsp;reply&nbsp;.&lt;div&gt;I&nbsp;have&nbsp;tried&nbsp;to&nbsp;replace&nbsp;my&nbsp;SSL&nbsp;config&nbsp;with&nbsp;your&nbsp;suggestion.&nbsp;But&nbsp;my&nbsp;squid&nbsp;get&nbsp;a&nbsp;error&nbsp;like&nbsp;this&nbsp;in&nbsp;cache.log:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;2017/11/25&nbsp;13:21:49&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detected&nbsp;on&nbsp;local=&lt;a&nbsp;href=&quot;http://216.58.199.110:443&quot;&gt;216.58.199.110:443&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://172.18.18.15:55704&quot;&gt;172.18.18.15:55704&lt;/a&gt;&nbsp;FD&nbsp;13&nbsp;flags=33&nbsp;(local&nbsp;IP&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;domain&nbsp;IP)&lt;/div&gt;&lt;div&gt;2017/11/25&nbsp;13:21:49&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;on&nbsp;URL:&nbsp;&lt;a&nbsp;href=&quot;http://apis.google.com:443&quot;&gt;apis.google.com:443&lt;/a&gt;&lt;/div&gt;&lt;div&gt;2017/11/25&nbsp;13:21:49&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detected&nbsp;on&nbsp;local=&lt;a&nbsp;href=&quot;http://172.217.25.3:443&quot;&gt;172.217.25.3:443&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://172.18.18.15:55705&quot;&gt;172.18.18.15:55705&lt;/a&gt;&nbsp;FD&nbsp;17&nbsp;flags=33&nbsp;(local&nbsp;IP&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;domain&nbsp;IP)&lt;/div&gt;&lt;div&gt;2017/11/25&nbsp;13:21:49&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;on&nbsp;URL:&nbsp;&lt;a&nbsp;href=&quot;http://www.google.com.vn:443&quot;&gt;www.google.com.vn:443&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;2017/11/25&nbsp;13:21:53&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detected&nbsp;on&nbsp;local=&lt;a&nbsp;href=&quot;http://157.240.13.35:443&quot;&gt;157.240.13.35:443&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://172.18.18.15:55720&quot;&gt;172.18.18.15:55720&lt;/a&gt;&nbsp;FD&nbsp;22&nbsp;flags=33&nbsp;(local&nbsp;IP&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;domain&nbsp;IP)&lt;/div&gt;&lt;div&gt;2017/11/25&nbsp;13:21:53&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;on&nbsp;URL:&nbsp;&lt;a&nbsp;href=&quot;http://www.facebook.com:443&quot;&gt;www.facebook.com:443&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;2017/11/25&nbsp;13:21:54&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detected&nbsp;on&nbsp;local=&lt;a&nbsp;href=&quot;http://157.240.13.35:443&quot;&gt;157.240.13.35:443&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://172.18.18.15:55724&quot;&gt;172.18.18.15:55724&lt;/a&gt;&nbsp;FD&nbsp;22&nbsp;flags=33&nbsp;(local&nbsp;IP&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;domain&nbsp;IP)&lt;/div&gt;&lt;div&gt;2017/11/25&nbsp;13:21:54&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;on&nbsp;URL:&nbsp;&lt;a&nbsp;href=&quot;http://www.facebook.com:443&quot;&gt;www.facebook.com:443&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;i&nbsp;can&#39;t&nbsp;access&nbsp;&lt;a&nbsp;href=&quot;http://www.facebook.com&quot;&gt;www.facebook.com&lt;/a&gt;.&nbsp;It&#39;s&nbsp;error&nbsp;on&nbsp;my&nbsp;browser&nbsp;: &lt;span&nbsp;style=&quot;background-color:rgb(247,247,247);color:rgb(100,100,100);font-family:&quot;Segoe&nbsp;UI&quot;,Tahoma,sans-serif;font-size:12px;text-transform:uppercase&quot;&gt;&lt;b&gt;ERR_SSL_PROTOCOL_ERROR&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;background-color:rgb(247,247,247);color:rgb(100,100,100);font-family:&quot;Segoe&nbsp;UI&quot;,Tahoma,sans-serif;font-size:12px;text-transform:uppercase&quot;&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;find&nbsp;out&nbsp;the&nbsp;same&nbsp;issue&nbsp;in&nbsp;this&nbsp;discussion&nbsp;: &lt;a&nbsp;href=&quot;http://lists.squid-cache.org/pipermail/squid-users/2016-June/011014.html&quot;&gt;http://lists.squid-cache.org/pipermail/squid-users/2016-June/011014.html&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;then&nbsp;i&nbsp;try&nbsp;to&nbsp;make&nbsp;my&nbsp;squid&nbsp;becomes&nbsp;a&nbsp;cache&nbsp;DNS&nbsp;itself&nbsp;using&nbsp;Unbound.&nbsp;But&nbsp;look&nbsp;like&nbsp;it&nbsp;does&#39;nt&nbsp;work&nbsp;.&nbsp;I&nbsp;get&nbsp;same&nbsp;error&nbsp;before&nbsp;install&nbsp;cache&nbsp;DNS.&lt;/div&gt;&lt;div&gt;Here&nbsp;is&nbsp;my&nbsp;DNS&nbsp;test&nbsp;on&nbsp;my&nbsp;Squid:&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@localhost&nbsp;~]#&nbsp;nslookup&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://google.com&quot;&gt;google.com&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Server:&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;127.0.0.1&lt;/div&gt;&lt;div&gt;Address:&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;127.0.0.1#53&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Non-authoritative&nbsp;answer:&lt;/div&gt;&lt;div&gt;Name:&lt;span&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://google.com&quot;&gt;google.com&lt;/a&gt;&lt;/div&gt;&lt;div&gt;Address:&nbsp;216.58.203.46&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;this&nbsp;is&nbsp;my&nbsp;dns&nbsp;config&nbsp;in&nbsp;squid.config&nbsp;:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;#&nbsp;---------&nbsp;DNS&nbsp;AND&nbsp;IP&nbsp;CACHES&nbsp;[4341]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;dns_nameservers&nbsp;127.0.0.1&lt;/div&gt;&lt;div&gt;dns_v4_first&nbsp;on&lt;/div&gt;&lt;div&gt;#original_dst&nbsp;off&lt;/div&gt;&lt;div&gt;client_dst_passthru&nbsp;off&lt;/div&gt;&lt;div&gt;host_verify_strict&nbsp;off&lt;/div&gt;&lt;div&gt;ignore_unknown_nameservers&nbsp;off&lt;/div&gt;&lt;div&gt;dns_timeout&nbsp;120&nbsp;seconds&lt;/div&gt;&lt;div&gt;ipcache_size&nbsp;1024&lt;/div&gt;&lt;div&gt;ipcache_low&nbsp;90&lt;/div&gt;&lt;div&gt;ipcache_high&nbsp;95&lt;/div&gt;&lt;div&gt;fqdncache_size&nbsp;1024&lt;/div&gt;&lt;div&gt;positive_dns_ttl&nbsp;6&nbsp;hours&lt;/div&gt;&lt;div&gt;negative_dns_ttl&nbsp;300&nbsp;seconds&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Could&nbsp;you&nbsp;help&nbsp;me&nbsp;please&nbsp;:(&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2017-11-24&nbsp;20:27&nbsp;GMT+07:00&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;On&nbsp;25/11/17&nbsp;02:04,&nbsp;minh&nbsp;hưng&nbsp;đỗ&nbsp;hoàng&nbsp;wrote:&lt;br&gt;<br>
&lt;/span&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Dear&nbsp;Squid-users,&lt;br&gt;<br>
I&nbsp;want&nbsp;to&nbsp;setup&nbsp;a&nbsp;Squid&nbsp;proxy&nbsp;in&nbsp;transparent&nbsp;mode&nbsp;http/https&nbsp;traffic&nbsp;without&nbsp;any&nbsp;config&nbsp;in&nbsp;Client&nbsp;site.&lt;br&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
I&nbsp;use&nbsp;Squid&nbsp;3.5.20&nbsp;on&nbsp;Centos7.I&nbsp;just&nbsp;install&nbsp;squid&nbsp;with&nbsp;default&nbsp;feature&nbsp;as&nbsp;*yum&nbsp;install&nbsp;squid.*&lt;br&gt;<br>
*&lt;br&gt;<br>
*&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&lt;br&gt;<br>
I&nbsp;just&nbsp;do&nbsp;that&nbsp;,&nbsp;but&nbsp;i&nbsp;have&nbsp;some&nbsp;problem&nbsp;with&nbsp;my&nbsp;output&nbsp;logging&nbsp;in&nbsp;access.log&nbsp;.&lt;br&gt;<br>
Specifically,&nbsp;my&nbsp;access.log&nbsp;only&nbsp;show&nbsp;ip_address_server:443&nbsp;instead&nbsp;domain&nbsp;name&nbsp;of&nbsp;destination&nbsp;server&nbsp;like&nbsp;that&nbsp;:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
*1511525732.912 &nbsp; &nbsp;206&nbsp;172.18.18.15&nbsp;TAG_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://172.217.24.35:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.217.24.35:443&lt;/a&gt;&nbsp;-&nbsp;ORIGINAL_DST/&lt;a&nbsp;href=&quot;http://172.217.24.35&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.217.24.35&lt;/a&gt;&nbsp;-*&lt;br&gt;<br>
*&lt;br&gt;<br>
*&lt;span&nbsp;class=&quot;gmail-&quot;&gt;&lt;br&gt;<br>
I&nbsp;know&nbsp;that&nbsp;i&nbsp;take&nbsp;some&nbsp;mistake&nbsp;in&nbsp;my&nbsp;squid.conf&nbsp;.&nbsp;But&nbsp;i&nbsp;can&#39;t&nbsp;find&nbsp;out&nbsp;how&nbsp;to&nbsp;fix&nbsp;it.&nbsp;Could&nbsp;you&nbsp;please&nbsp;show&nbsp;me&nbsp;how&nbsp;to improve&nbsp;my&nbsp;squid.conf&nbsp;.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/span&gt;&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
You&nbsp;configured&nbsp;&quot;ssl_bump&nbsp;none&nbsp;all&quot;.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/SslPeekAndSplice#Actions&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/&lt;wbr&gt;Features/SslPeekAndSplice#Acti&lt;wbr&gt;ons&lt;/a&gt;&gt;&lt;br&gt;<br>
&quot;do&nbsp;not&nbsp;use&nbsp;these&nbsp;with&nbsp;Squid-3.5&nbsp;and&nbsp;newer&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Use&nbsp;this&nbsp;instead:&lt;br&gt;<br>
&lt;br&gt;<br>
 acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
 ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
 ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;should&nbsp;be&nbsp;two&nbsp;log&nbsp;entries&nbsp;per&nbsp;HTTPS&nbsp;connection.&nbsp;One&nbsp;before&nbsp;peek&nbsp;happens&nbsp;with&nbsp;raw-IP:port&nbsp;details.&nbsp;And&nbsp;a&nbsp;second&nbsp;one&nbsp;after&nbsp;peek&nbsp;which&nbsp;may&nbsp;have&nbsp;a&nbsp;_server_&nbsp;name&nbsp;(*not*&nbsp;domain&nbsp;name)&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;client&nbsp;sends&nbsp;TLS&nbsp;SNI&nbsp;extension&nbsp;data.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/l&lt;wbr&gt;istinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Thanks&nbsp;&amp;&nbsp;Best&nbsp;Regards,&lt;br&gt;--------------&lt;br&gt;&lt;/div&gt;Đỗ&nbsp;Hoàng&nbsp;Minh&nbsp;Hưng&lt;br&gt;&lt;/div&gt;Gmail&nbsp;:&nbsp;&lt;a&nbsp;href=&quot;mailto:hoangminhung@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;hoangminhung@gmail.com&lt;/a&gt;&lt;br&gt;&lt;/div&gt;SĐT&nbsp;:&nbsp;01234454115&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
