<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;I&nbsp;think&nbsp;I&nbsp;found&nbsp;part&nbsp;of&nbsp;the&nbsp;config&nbsp;which&nbsp;triggers&nbsp;the&nbsp;retry.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;======&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;#&nbsp;Check&nbsp;for&nbsp;newproxy&nbsp;request&nbsp;header&lt;/div&gt;&lt;div&gt;acl&nbsp;newproxy_acl&nbsp;req_header&nbsp;x-use-newproxy&nbsp;-i&nbsp;true&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;proxy&lt;/div&gt;&lt;div&gt;cache_peer&nbsp;127.0.0.1&nbsp;parent&nbsp;18070&nbsp;0&nbsp;no-query&nbsp;no-digest&nbsp;no-netdb-exchange&nbsp;name=proxy&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;proxy&nbsp;deny&nbsp;newproxy_acl&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;newproxy&lt;/div&gt;&lt;div&gt;cache_peer&nbsp;127.0.0.1&nbsp;parent&nbsp;18079&nbsp;0&nbsp;no-query&nbsp;no-digest&nbsp;no-netdb-exchange&nbsp;name=newproxy&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;newproxy&nbsp;allow&nbsp;newproxy_acl&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;newproxy&nbsp;deny&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;never_direct&nbsp;allow&nbsp;all&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;======&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;see&nbsp;retries&nbsp;only&nbsp;when&nbsp;squid&nbsp;config&nbsp;has&nbsp;2&nbsp;parents.&nbsp;If&nbsp;I&nbsp;comment&nbsp;out&nbsp;everything&nbsp;related&nbsp;to&nbsp;&quot;newproxy&quot;&nbsp;I&nbsp;can&#39;t&nbsp;reproduce&nbsp;this&nbsp;behavior&nbsp;anymore.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;BUT&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;test&nbsp;request&nbsp;could&nbsp;only&nbsp;be&nbsp;forwarded&nbsp;to&nbsp;&quot;proxy&quot;&nbsp;since&nbsp;it&nbsp;doesn&#39;t&nbsp;have&nbsp;&quot;x-use-newproxy&quot;&nbsp;header.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Which&nbsp;results&nbsp;in&nbsp;the&nbsp;following:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;squid&nbsp;has&nbsp;2&nbsp;parents&lt;/div&gt;&lt;div&gt;request&nbsp;could&nbsp;only&nbsp;be&nbsp;forwarded&nbsp;to&nbsp;the&nbsp;1st&nbsp;parent&nbsp;due&nbsp;to&nbsp;ACL&lt;/div&gt;&lt;div&gt;parent&nbsp;doesn&#39;t&nbsp;respond&nbsp;and&nbsp;closes&nbsp;the&nbsp;TCP&nbsp;connection&lt;/div&gt;&lt;div&gt;squid&nbsp;retries&nbsp;with&nbsp;the&nbsp;same&nbsp;parent&nbsp;ignoring&nbsp;&quot;forward_max_tries&nbsp;1&quot;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;I&nbsp;also&nbsp;want&nbsp;to&nbsp;clarify&nbsp;some&nbsp;facts&nbsp;which&nbsp;make&nbsp;me&nbsp;think&nbsp;that&nbsp;it&nbsp;could&nbsp;be&nbsp;a&nbsp;bug.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;1.&nbsp;There&#39;re&nbsp;no&nbsp;issues&nbsp;with&nbsp;TCP&nbsp;connection.&nbsp;Squid&nbsp;successfully&nbsp;connects&nbsp;to&nbsp;parent&nbsp;and&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;2.&nbsp;Parent&nbsp;ACKs&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;then&nbsp;correctly&nbsp;closes&nbsp;the&nbsp;connection&nbsp;with&nbsp;FIN,ACK&nbsp;after&nbsp;40&nbsp;seconds.&nbsp;There&#39;re&nbsp;no&nbsp;TCP&nbsp;timeouts/reconnects&nbsp;involved. &lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;The&nbsp;only&nbsp;issue&nbsp;here&nbsp;is&nbsp;that&nbsp;parent&nbsp;doesn&#39;t&nbsp;send&nbsp;any&nbsp;HTTP&nbsp;response.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;3. &lt;/span&gt;&lt;font&nbsp;color=&quot;#500050&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;forward_max_tries&nbsp;is&nbsp;set&nbsp;to&nbsp;1&nbsp;to&nbsp;make&nbsp;sure&nbsp;squid&nbsp;won&#39;t&nbsp;retry.&nbsp;Parent&nbsp;handles&nbsp;the&nbsp;retry&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;squid&nbsp;to&nbsp;make&nbsp;any&nbsp;additional&nbsp;retries.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;Also&nbsp;see &lt;/span&gt;&lt;font&nbsp;color=&quot;#500050&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/SquidFaq/InnerWorkings#When_does_Squid_re-forward_a_client_request.3F&quot;&gt;https://wiki.squid-cache.org/SquidFaq/InnerWorkings#When_does_Squid_re-forward_a_client_request.3F&lt;/a&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#500050&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#500050&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&gt;&nbsp;Squid&nbsp;does&nbsp;not&nbsp;try&nbsp;to&nbsp;re-forward&nbsp;a&nbsp;request&nbsp;if&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;conditions&nbsp;is&nbsp;true:&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#500050&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&gt;&nbsp;…&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#500050&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&gt; The&nbsp;number&nbsp;of&nbsp;forwarding&nbsp;attempts&nbsp;exceeded&nbsp;forward_max_tries.&nbsp;For&nbsp;example,&nbsp;if&nbsp;you&nbsp;set&nbsp;forward_max_tries&nbsp;to&nbsp;1&nbsp;(one),&nbsp;then&nbsp;no&nbsp;requests&nbsp;will&nbsp;be&nbsp;re-forwarded.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&gt;&nbsp;…&lt;/span&gt;&lt;font&nbsp;color=&quot;#500050&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;color=&quot;#500050&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8px&quot;&gt;&gt; Squid&nbsp;has&nbsp;no&nbsp;alternative&nbsp;destinations&nbsp;to&nbsp;try.&nbsp;Please&nbsp;note&nbsp;that&nbsp;alternative&nbsp;destinations&nbsp;may&nbsp;include&nbsp;multiple&nbsp;next&nbsp;hop&nbsp;IP&nbsp;addresses&nbsp;and&nbsp;multiple&nbsp;peers.&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&gt;&nbsp;…&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;Another&nbsp;part&nbsp;of&nbsp;config&nbsp;which&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;be&nbsp;related&nbsp;(this&nbsp;is&nbsp;to&nbsp;increase&nbsp;the&nbsp;amount&nbsp;of&nbsp;local&nbsp;ports&nbsp;to&nbsp;use):&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;#&nbsp;33%&nbsp;of&nbsp;traffic&nbsp;per&nbsp;local&nbsp;IP&lt;/div&gt;&lt;div&gt;acl&nbsp;third&nbsp;random&nbsp;1/3&lt;/div&gt;&lt;div&gt;acl&nbsp;half&nbsp;random&nbsp;1/2&lt;/div&gt;&lt;div&gt;tcp_outgoing_address&nbsp;127.0.0.2&nbsp;third&lt;/div&gt;&lt;div&gt;tcp_outgoing_address&nbsp;127.0.0.3&nbsp;half&lt;/div&gt;&lt;div&gt;tcp_outgoing_address&nbsp;127.0.0.4&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;Logs:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80);font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;ALL,2&nbsp;(includes&nbsp;44,2):&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.542|&nbsp;5,2|&nbsp;TcpAcceptor.cc(220)&nbsp;doAccept:&nbsp;New&nbsp;connection&nbsp;on&nbsp;FD&nbsp;15&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.542|&nbsp;5,2|&nbsp;TcpAcceptor.cc(295)&nbsp;acceptNext:&nbsp;connection&nbsp;on&nbsp;local=&lt;a&nbsp;href=&quot;http://0.0.0.0:3128&quot;&gt;0.0.0.0:3128&lt;/a&gt;&nbsp;remote=[::]&nbsp;FD&nbsp;15&nbsp;flags=9&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;11,2|&nbsp;client_side.cc(2372)&nbsp;parseHttpRequest:&nbsp;HTTP&nbsp;Client&nbsp;local=&lt;a&nbsp;href=&quot;http://127.0.0.1:3128&quot;&gt;127.0.0.1:3128&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://127.0.0.1:53798&quot;&gt;127.0.0.1:53798&lt;/a&gt;&nbsp;FD&nbsp;45&nbsp;flags=1&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;11,2|&nbsp;client_side.cc(2373)&nbsp;parseHttpRequest:&nbsp;HTTP&nbsp;Client&nbsp;REQUEST:&lt;/div&gt;&lt;div&gt;---------&lt;/div&gt;&lt;div&gt;GET&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&nbsp;HTTP/1.1&lt;/div&gt;&lt;div&gt;Host:&nbsp;HOST:12345&lt;/div&gt;&lt;div&gt;User-Agent:&nbsp;curl/7.51.0&lt;/div&gt;&lt;div&gt;Accept:&nbsp;*/*&lt;/div&gt;&lt;div&gt;Proxy-Connection:&nbsp;Keep-Alive&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;----------&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;85,2|&nbsp;client_side_request.cc(745)&nbsp;clientAccessCheckDone:&nbsp;The&nbsp;request&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&nbsp;is&nbsp;ALLOWED;&nbsp;last&nbsp;ACL&nbsp;checked:&nbsp;localhost&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;85,2|&nbsp;client_side_request.cc(721)&nbsp;clientAccessCheck2:&nbsp;No&nbsp;adapted_http_access&nbsp;configuration.&nbsp;default:&nbsp;ALLOW&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;85,2|&nbsp;client_side_request.cc(745)&nbsp;clientAccessCheckDone:&nbsp;The&nbsp;request&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&nbsp;is&nbsp;ALLOWED;&nbsp;last&nbsp;ACL&nbsp;checked:&nbsp;localhost&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;17,2|&nbsp;FwdState.cc(133)&nbsp;FwdState:&nbsp;Forwarding&nbsp;client&nbsp;request&nbsp;local=&lt;a&nbsp;href=&quot;http://127.0.0.1:3128&quot;&gt;127.0.0.1:3128&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://127.0.0.1:53798&quot;&gt;127.0.0.1:53798&lt;/a&gt;&nbsp;FD&nbsp;45&nbsp;flags=1,&nbsp;url=&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;44,2|&nbsp;peer_select.cc(258)&nbsp;peerSelectDnsPaths:&nbsp;Find&nbsp;IP&nbsp;destination&nbsp;for:&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&#39;&nbsp;via&nbsp;127.0.0.1&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;44,2|&nbsp;peer_select.cc(280)&nbsp;peerSelectDnsPaths:&nbsp;Found&nbsp;sources&nbsp;for&nbsp;&#39;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&#39;&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;44,2|&nbsp;peer_select.cc(281)&nbsp;peerSelectDnsPaths: &nbsp; always_direct&nbsp;=&nbsp;DENIED&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;44,2|&nbsp;peer_select.cc(282)&nbsp;peerSelectDnsPaths: &nbsp; &nbsp;never_direct&nbsp;=&nbsp;ALLOWED&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;44,2|&nbsp;peer_select.cc(292)&nbsp;peerSelectDnsPaths: &nbsp; &nbsp; &nbsp;cache_peer&nbsp;=&nbsp;local=127.0.0.3&nbsp;remote=&lt;a&nbsp;href=&quot;http://127.0.0.1:18070&quot;&gt;127.0.0.1:18070&lt;/a&gt;&nbsp;flags=1&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;44,2|&nbsp;peer_select.cc(295)&nbsp;peerSelectDnsPaths: &nbsp; &nbsp; &nbsp; &nbsp;timedout&nbsp;=&nbsp;0&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;11,2|&nbsp;http.cc(2229)&nbsp;sendRequest:&nbsp;HTTP&nbsp;Server&nbsp;local=&lt;a&nbsp;href=&quot;http://127.0.0.3:57091&quot;&gt;127.0.0.3:57091&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://127.0.0.1:18070&quot;&gt;127.0.0.1:18070&lt;/a&gt;&nbsp;FD&nbsp;40&nbsp;flags=1&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:53:40.543|&nbsp;11,2|&nbsp;http.cc(2230)&nbsp;sendRequest:&nbsp;HTTP&nbsp;Server&nbsp;REQUEST:&lt;/div&gt;&lt;div&gt;---------&lt;/div&gt;&lt;div&gt;GET&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&nbsp;HTTP/1.1&lt;/div&gt;&lt;div&gt;User-Agent:&nbsp;curl/7.51.0&lt;/div&gt;&lt;div&gt;Accept:&nbsp;*/*&lt;/div&gt;&lt;div&gt;Host:&nbsp;HOST:12345&lt;/div&gt;&lt;div&gt;Cache-Control:&nbsp;max-age=259200&lt;/div&gt;&lt;div&gt;Connection:&nbsp;keep-alive&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;----------&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[SKIPPED&nbsp;40&nbsp;seconds&nbsp;until&nbsp;parent&nbsp;closes&nbsp;TCP&nbsp;connection&nbsp;with&nbsp;FIN,ACK]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:54:20.627|&nbsp;11,2|&nbsp;http.cc(1299)&nbsp;continueAfterParsingHeader:&nbsp;WARNING:&nbsp;HTTP:&nbsp;Invalid&nbsp;Response:&nbsp;No&nbsp;object&nbsp;data&nbsp;received&nbsp;for&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&nbsp;AKA&nbsp;HOST/&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:54:20.627|&nbsp;17,2|&nbsp;FwdState.cc(655)&nbsp;handleUnregisteredServerEnd:&nbsp;self=0x3e31838*2&nbsp;err=0x409b338&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:54:20.627|&nbsp;11,2|&nbsp;http.cc(2229)&nbsp;sendRequest:&nbsp;HTTP&nbsp;Server&nbsp;local=&lt;a&nbsp;href=&quot;http://127.0.0.3:41355&quot;&gt;127.0.0.3:41355&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://127.0.0.1:18070&quot;&gt;127.0.0.1:18070&lt;/a&gt;&nbsp;FD&nbsp;40&nbsp;flags=1&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:54:20.627|&nbsp;11,2|&nbsp;http.cc(2230)&nbsp;sendRequest:&nbsp;HTTP&nbsp;Server&nbsp;REQUEST:&lt;/div&gt;&lt;div&gt;---------&lt;/div&gt;&lt;div&gt;GET&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&nbsp;HTTP/1.1&lt;/div&gt;&lt;div&gt;User-Agent:&nbsp;curl/7.51.0&lt;/div&gt;&lt;div&gt;Accept:&nbsp;*/*&lt;/div&gt;&lt;div&gt;Host:&nbsp;HOST:12345&lt;/div&gt;&lt;div&gt;Cache-Control:&nbsp;max-age=259200&lt;/div&gt;&lt;div&gt;Connection:&nbsp;keep-alive&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;----------&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[SKIPPED&nbsp;40&nbsp;seconds&nbsp;again&nbsp;until&nbsp;parent&nbsp;closes&nbsp;TCP&nbsp;connection&nbsp;with&nbsp;FIN,ACK]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:55:00.728|&nbsp;ctx:&nbsp;enter&nbsp;level &nbsp;0:&nbsp;&#39;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&#39;&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:55:00.728|&nbsp;11,2|&nbsp;http.cc(719)&nbsp;processReplyHeader:&nbsp;HTTP&nbsp;Server&nbsp;local=&lt;a&nbsp;href=&quot;http://127.0.0.3:41355&quot;&gt;127.0.0.3:41355&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://127.0.0.1:18070&quot;&gt;127.0.0.1:18070&lt;/a&gt;&nbsp;FD&nbsp;40&nbsp;flags=1&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:55:00.728|&nbsp;11,2|&nbsp;http.cc(720)&nbsp;processReplyHeader:&nbsp;HTTP&nbsp;Server&nbsp;REPLY:&lt;/div&gt;&lt;div&gt;---------&lt;/div&gt;&lt;div&gt;HTTP/1.0&nbsp;502&nbsp;Bad&nbsp;Gateway&lt;/div&gt;&lt;div&gt;Cache-Control:&nbsp;no-cache&lt;/div&gt;&lt;div&gt;Connection:&nbsp;close&lt;/div&gt;&lt;div&gt;Content-Type:&nbsp;text/html&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;html&gt;&lt;body&gt;&lt;h1&gt;502&nbsp;Bad&nbsp;Gateway&lt;/h1&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;server&nbsp;returned&nbsp;an&nbsp;invalid&nbsp;or&nbsp;incomplete&nbsp;response.&lt;/div&gt;&lt;div&gt;&lt;/body&gt;&lt;/html&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;----------&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:55:00.728|&nbsp;ctx:&nbsp;exit&nbsp;level &nbsp;0&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:55:00.728|&nbsp;20,2|&nbsp;store.cc(996)&nbsp;checkCachable:&nbsp;StoreEntry::checkCachable:&nbsp;NO:&nbsp;not&nbsp;cachable&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:55:00.728|&nbsp;20,2|&nbsp;store.cc(996)&nbsp;checkCachable:&nbsp;StoreEntry::checkCachable:&nbsp;NO:&nbsp;not&nbsp;cachable&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:55:00.728|&nbsp;88,2|&nbsp;client_side_reply.cc(2073)&nbsp;processReplyAccessResult:&nbsp;The&nbsp;reply&nbsp;for&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://HOST:12345/&quot;&gt;http://HOST:12345/&lt;/a&gt;&nbsp;is&nbsp;ALLOWED,&nbsp;because&nbsp;it&nbsp;matched&nbsp;(access_log&nbsp;stdio:/var/log/squid/access.log&nbsp;line)&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:55:00.728|&nbsp;11,2|&nbsp;client_side.cc(1409)&nbsp;sendStartOfMessage:&nbsp;HTTP&nbsp;Client&nbsp;local=&lt;a&nbsp;href=&quot;http://127.0.0.1:3128&quot;&gt;127.0.0.1:3128&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://127.0.0.1:53798&quot;&gt;127.0.0.1:53798&lt;/a&gt;&nbsp;FD&nbsp;45&nbsp;flags=1&lt;/div&gt;&lt;div&gt;2017/11/27&nbsp;15:55:00.728|&nbsp;11,2|&nbsp;client_side.cc(1410)&nbsp;sendStartOfMessage:&nbsp;HTTP&nbsp;Client&nbsp;REPLY:&lt;/div&gt;&lt;div&gt;---------&lt;/div&gt;&lt;div&gt;HTTP/1.1&nbsp;502&nbsp;Bad&nbsp;Gateway&lt;/div&gt;&lt;div&gt;Date:&nbsp;Mon,&nbsp;27&nbsp;Nov&nbsp;2017&nbsp;23:54:20&nbsp;GMT&lt;/div&gt;&lt;div&gt;Cache-Control:&nbsp;no-cache&lt;/div&gt;&lt;div&gt;Content-Type:&nbsp;text/html&lt;/div&gt;&lt;div&gt;X-Cache:&nbsp;MISS&nbsp;from&nbsp;ip-172-23-18-130&lt;/div&gt;&lt;div&gt;X-Cache-Lookup:&nbsp;MISS&nbsp;from&nbsp;ip-172-23-18-130:3128&lt;/div&gt;&lt;div&gt;Transfer-Encoding:&nbsp;chunked&lt;/div&gt;&lt;div&gt;Connection:&nbsp;keep-alive&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;----------&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Thu,&nbsp;Nov&nbsp;23,&nbsp;2017&nbsp;at&nbsp;11:43&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
On&nbsp;24/11/17&nbsp;10:03,&nbsp;Ivan&nbsp;Larionov&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
On&nbsp;Nov&nbsp;23,&nbsp;2017,&nbsp;at&nbsp;12:32&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;23/11/17&nbsp;14:20,&nbsp;Ivan&nbsp;Larionov&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Hello.&lt;br&gt;<br>
We&nbsp;have&nbsp;an&nbsp;issue&nbsp;with&nbsp;squid&nbsp;when&nbsp;it&nbsp;tries&nbsp;to&nbsp;re-forward&nbsp;/&nbsp;retry&nbsp;failed&nbsp;request&nbsp;even&nbsp;when&nbsp;forward_max_tries&nbsp;is&nbsp;set&nbsp;to&nbsp;1.&nbsp;The&nbsp;situation&nbsp;when&nbsp;it&nbsp;happens&nbsp;is&nbsp;when&nbsp;there&#39;s&nbsp;no&nbsp;response,&nbsp;parent&nbsp;just&nbsp;closes&nbsp;the&nbsp;connection.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
...&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
It&nbsp;doesn&#39;t&nbsp;happen&nbsp;100%&nbsp;times.&nbsp;Sometimes&nbsp;squid&nbsp;returns&nbsp;502&nbsp;after&nbsp;the&nbsp;1st&nbsp;try,&nbsp;sometimes&nbsp;it&nbsp;retries&nbsp;once.&nbsp;Also&nbsp;I&nbsp;haven&#39;t&nbsp;seen&nbsp;more&nbsp;than&nbsp;1&nbsp;retry.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Please&nbsp;enable&nbsp;debug_options&nbsp;44,2&nbsp;to&nbsp;see&nbsp;what&nbsp;destinations&nbsp;your&nbsp;Squid&nbsp;is&nbsp;actually&nbsp;finding.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
I&#39;ll&nbsp;check&nbsp;this&nbsp;on&nbsp;Monday.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
max_forward_tries&nbsp;is&nbsp;just&nbsp;a&nbsp;rough&nbsp;cap&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;server&nbsp;names&nbsp;which&nbsp;can&nbsp;be&nbsp;found&nbsp;when&nbsp;generating&nbsp;that&nbsp;list.&nbsp;The&nbsp;actual&nbsp;destinations&nbsp;count&nbsp;can&nbsp;exceed&nbsp;it&nbsp;if&nbsp;one&nbsp;or&nbsp;more&nbsp;of&nbsp;the&nbsp;servers&nbsp;happens&nbsp;to&nbsp;have&nbsp;multiple&nbsp;IPs&nbsp;to&nbsp;try.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;overall&nbsp;transaction&nbsp;can&nbsp;involve&nbsp;retries&nbsp;if&nbsp;one&nbsp;of&nbsp;the&nbsp;other&nbsp;layers&nbsp;(TCP&nbsp;or&nbsp;HTTP)&nbsp;contains&nbsp;retry&nbsp;semantics&nbsp;to&nbsp;a&nbsp;single&nbsp;server.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Could&nbsp;it&nbsp;be&nbsp;a&nbsp;bug?&nbsp;We&#39;d&nbsp;really&nbsp;like&nbsp;to&nbsp;disable&nbsp;these&nbsp;retries.&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Why&nbsp;are&nbsp;trying&nbsp;to&nbsp;break&nbsp;HTTP?&lt;br&gt;<br>
What&nbsp;is&nbsp;the&nbsp;actual&nbsp;problem&nbsp;you&nbsp;are&nbsp;trying&nbsp;to&nbsp;resolve&nbsp;here?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
Why&nbsp;do&nbsp;you&nbsp;think&nbsp;I&#39;m&nbsp;trying&nbsp;to&nbsp;break&nbsp;HTTP?&lt;br&gt;<br>
&lt;br&gt;<br>
squid&nbsp;forwards&nbsp;the&nbsp;request&nbsp;to&nbsp;parent&nbsp;but&nbsp;parent&nbsp;misbehaves&nbsp;and&nbsp;just&nbsp;closes&nbsp;the&nbsp;connection&nbsp;after&nbsp;40&nbsp;seconds.&nbsp;I&#39;m&nbsp;trying&nbsp;to&nbsp;prevent&nbsp;retry&nbsp;of&nbsp;request&nbsp;in&nbsp;such&nbsp;situation.&nbsp;Why&nbsp;squid&nbsp;retries&nbsp;if&nbsp;I&nbsp;never&nbsp;asked&nbsp;him&nbsp;to&nbsp;do&nbsp;it&nbsp;and&nbsp;specifically&nbsp;said&nbsp;&quot;forward_max_tries&nbsp;1&quot;.&lt;br&gt;<br>
&lt;br&gt;<br>
And&nbsp;this&nbsp;is&nbsp;not&nbsp;a&nbsp;connection&nbsp;failure,&nbsp;squid&nbsp;successfully&nbsp;establishes&nbsp;the&nbsp;connection&nbsp;and&nbsp;sends&nbsp;the&nbsp;request,&nbsp;parent&nbsp;ACKs&nbsp;it,&nbsp;just&nbsp;never&nbsp;responses&nbsp;back&nbsp;and&nbsp;proactively&nbsp;closes&nbsp;the&nbsp;connection.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
This&nbsp;is&nbsp;not&nbsp;misbehaviour&nbsp;on&nbsp;the&nbsp;part&nbsp;of&nbsp;either&nbsp;Squid&nbsp;nor&nbsp;the&nbsp;parent.&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;https://tools.ietf.org/html/rfc7230#section-6.3.1&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://tools.ietf.org/html/r&lt;wbr&gt;fc7230#section-6.3.1&lt;/a&gt;&gt;&lt;br&gt;<br>
&quot;Connections&nbsp;can&nbsp;be&nbsp;closed&nbsp;at&nbsp;any&nbsp;time,&nbsp;with&nbsp;or&nbsp;without&nbsp;intention.&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
As&nbsp;has&nbsp;been&nbsp;discussed&nbsp;in&nbsp;other&nbsp;threads&nbsp;recently&nbsp;there&nbsp;are&nbsp;servers&nbsp;out&nbsp;there&nbsp;starting&nbsp;to&nbsp;greylist&nbsp;TCP&nbsp;connections,&nbsp;closing&nbsp;the&nbsp;first&nbsp;one&nbsp;some&nbsp;time&nbsp;*after*&nbsp;SYN+ACK&nbsp;regardless&nbsp;of&nbsp;what&nbsp;the&nbsp;proxy&nbsp;sends&nbsp;and&nbsp;accepting&nbsp;any&nbsp;followup&nbsp;connection&nbsp;attempts.&lt;br&gt;<br>
&lt;br&gt;<br>
NP:&nbsp;That&nbsp;can&nbsp;result&nbsp;in&nbsp;exactly&nbsp;the&nbsp;behaviour&nbsp;you&nbsp;describe&nbsp;from&nbsp;the&nbsp;peer&nbsp;as&nbsp;Squid&nbsp;does&nbsp;not&nbsp;wait&nbsp;for&nbsp;a&nbsp;FIN&nbsp;to&nbsp;arrive&nbsp;before&nbsp;sending&nbsp;its&nbsp;upstream&nbsp;HTTP&nbsp;request&nbsp;-&nbsp;Squid&nbsp;will&nbsp;&quot;randomly&quot;&nbsp;get&nbsp;a&nbsp;FIN&nbsp;or&nbsp;a&nbsp;RST&nbsp;depending&nbsp;on&nbsp;whether&nbsp;the&nbsp;FIN&nbsp;or&nbsp;the&nbsp;DATA&nbsp;packet&nbsp;wins&nbsp;the&nbsp;race&nbsp;into&nbsp;the&nbsp;Squid&nbsp;machines&nbsp;TCP&nbsp;stack.&nbsp;FIN&nbsp;and&nbsp;RST&nbsp;have&nbsp;different&nbsp;retry&nbsp;properties&nbsp;which&nbsp;might&nbsp;explain&nbsp;your&nbsp;&quot;sometimes&nbsp;retries&quot;&nbsp;behaviour.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Also,&nbsp;TCP&nbsp;connections&nbsp;fail&nbsp;quite&nbsp;often&nbsp;for&nbsp;many&nbsp;other&nbsp;reasons&nbsp;anyway.&nbsp;Anything&nbsp;from&nbsp;power&nbsp;fluctuations&nbsp;at&nbsp;a&nbsp;router&nbsp;to&nbsp;BGP&nbsp;switching&nbsp;the&nbsp;packet&nbsp;route&nbsp;dropping&nbsp;packets.&nbsp;They&nbsp;are&nbsp;most&nbsp;often&nbsp;a&nbsp;short-term&nbsp;situation&nbsp;which&nbsp;is&nbsp;resolved&nbsp;by&nbsp;the&nbsp;time&nbsp;the&nbsp;repeat&nbsp;is&nbsp;attempted.&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;you&nbsp;are&nbsp;trying&nbsp;to&nbsp;do&nbsp;will&nbsp;result&nbsp;in&nbsp;Squid&nbsp;being&nbsp;unable&nbsp;to&nbsp;cope&nbsp;with&nbsp;any&nbsp;of&nbsp;these&nbsp;transitory&nbsp;restrictions&nbsp;from&nbsp;the&nbsp;TCP&nbsp;environment&nbsp;and&nbsp;force&nbsp;the&nbsp;client&nbsp;to&nbsp;receive&nbsp;a&nbsp;terminal&nbsp;error&nbsp;page.&lt;br&gt;<br>
 That&nbsp;will&nbsp;greatly&nbsp;slow&nbsp;down&nbsp;detection&nbsp;and&nbsp;recovery&nbsp;from&nbsp;the&nbsp;slightly&nbsp;longer-lived&nbsp;TCP&nbsp;issues&nbsp;in&nbsp;Squid&nbsp;itself&nbsp;and&nbsp;may&nbsp;result&nbsp;in&nbsp;N&nbsp;other&nbsp;clients&nbsp;also&nbsp;unnecessarily&nbsp;receiving&nbsp;the&nbsp;same&nbsp;error&nbsp;response&nbsp;as&nbsp;bad&nbsp;connection&nbsp;attempts&nbsp;gets&nbsp;spread&nbsp;between&nbsp;many&nbsp;clients&nbsp;(all&nbsp;getting&nbsp;errors)&nbsp;instead&nbsp;of&nbsp;isolated&nbsp;to&nbsp;the&nbsp;one/few&nbsp;who&nbsp;hit&nbsp;it&nbsp;when&nbsp;the&nbsp;issue&nbsp;initially&nbsp;occurs.&lt;br&gt;<br>
&lt;br&gt;<br>
Expanding&nbsp;the&nbsp;retries&nbsp;to&nbsp;large&nbsp;numbers&nbsp;(ie&nbsp;the&nbsp;recent&nbsp;default&nbsp;change&nbsp;to&nbsp;25),&nbsp;or&nbsp;to&nbsp;low&nbsp;numbers&nbsp;(eg&nbsp;the&nbsp;old&nbsp;default&nbsp;of&nbsp;5)&nbsp;are&nbsp;reasonable&nbsp;things&nbsp;to&nbsp;do&nbsp;depending&nbsp;on&nbsp;the&nbsp;network&nbsp;stability&nbsp;to&nbsp;your&nbsp;upstreams.&nbsp;But&nbsp;going&nbsp;all&nbsp;the&nbsp;way&nbsp;to&nbsp;0&nbsp;retries&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;lead&nbsp;to&nbsp;more&nbsp;client&nbsp;visible&nbsp;problems&nbsp;than&nbsp;necessary.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
All&nbsp;that&nbsp;asside&nbsp;I&nbsp;phrased&nbsp;it&nbsp;as&nbsp;a&nbsp;question&nbsp;because&nbsp;you&nbsp;might&nbsp;have&nbsp;had&nbsp;a&nbsp;good&nbsp;reason&nbsp;for&nbsp;increasing&nbsp;the&nbsp;visible&nbsp;failure&nbsp;rates.&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
We&#39;re&nbsp;already&nbsp;fixing&nbsp;parent&nbsp;behavior,&nbsp;but&nbsp;still&nbsp;want&nbsp;to&nbsp;disable&nbsp;retries&nbsp;on&nbsp;squid&nbsp;side.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
Since&nbsp;you&nbsp;describe&nbsp;this&nbsp;as&nbsp;peer&nbsp;misbehaviour,&nbsp;then&nbsp;treating&nbsp;it&nbsp;to&nbsp;Squids&nbsp;normal&nbsp;TCP&nbsp;failure&nbsp;recovery&nbsp;is&nbsp;the&nbsp;best&nbsp;behaviour.&nbsp;Retry&nbsp;is&nbsp;the&nbsp;intended&nbsp;correct&nbsp;behaviour&nbsp;for&nbsp;a&nbsp;proxy&nbsp;to&nbsp;perform&nbsp;on&nbsp;any&nbsp;non-idempotent&nbsp;requests.&nbsp;In&nbsp;your&nbsp;case&nbsp;up&nbsp;to&nbsp;a&nbsp;value&nbsp;of&nbsp;1&nbsp;retry&nbsp;before&nbsp;declaring&nbsp;non-temporary&nbsp;route&nbsp;failure.&lt;br&gt;<br>
&lt;br&gt;<br>
NP:&nbsp;idempotent&nbsp;vs&nbsp;non-idempotent&nbsp;may&nbsp;be&nbsp;another&nbsp;reason&nbsp;behind&nbsp;the&nbsp;observed&nbsp;behaviour&nbsp;of&nbsp;retry&nbsp;happening&nbsp;only&nbsp;sometimes.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;are&nbsp;doing&nbsp;this&nbsp;due&nbsp;to&nbsp;overall&nbsp;latency/delay&nbsp;on&nbsp;the&nbsp;affected&nbsp;client&nbsp;traffic&nbsp;you&nbsp;would&nbsp;be&nbsp;better&nbsp;off&nbsp;reducing&nbsp;the&nbsp;timeouts&nbsp;involved&nbsp;(cache_peer&nbsp;connect-timeout=&nbsp;parameter&nbsp;AFAICS)&nbsp;than&nbsp;aiming&nbsp;at&nbsp;a&nbsp;retry&nbsp;count&nbsp;of&nbsp;0.&nbsp;Perhapse&nbsp;also&nbsp;requiring&nbsp;a&nbsp;few&nbsp;standby=N&nbsp;persistent&nbsp;connections&nbsp;to&nbsp;be&nbsp;maintained&nbsp;if&nbsp;the&nbsp;peer&nbsp;is&nbsp;HTTP/1.1&nbsp;capable.&lt;span&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;font&nbsp;color=&quot;#888888&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;/font&gt;&lt;/span&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;With&nbsp;best&nbsp;regards,&nbsp;Ivan&nbsp;Larionov.&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
