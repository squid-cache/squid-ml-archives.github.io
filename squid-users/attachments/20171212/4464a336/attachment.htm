<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Amos,&lt;br&gt;&lt;div&gt;&lt;br&gt;The&nbsp;squid&nbsp;version&nbsp;is&nbsp;3.1.19. &nbsp;The&nbsp;network&nbsp;is&nbsp;set&nbsp;up&nbsp;<br>
with&nbsp;a&nbsp;192.168.0.X&nbsp;network&nbsp;on&nbsp;the&nbsp;lan&nbsp;side,&nbsp;and&nbsp;a&nbsp;192.168.1.x&nbsp;network&nbsp;on<br>
&nbsp;the&nbsp;internet&nbsp;side. &nbsp;Both&nbsp;ports&nbsp;3120&nbsp;and&nbsp;4120&nbsp;require&nbsp;authentication,&nbsp;<br>
but&nbsp;port&nbsp;4120&nbsp;is&nbsp;meant&nbsp;to&nbsp;be&nbsp;restricted&nbsp;to&nbsp;only&nbsp;the&nbsp;whitelisted&nbsp;sites&nbsp;<br>
which&nbsp;are&nbsp;in&nbsp;a&nbsp;separate&nbsp;file. &nbsp;Port&nbsp;3120&nbsp;allows&nbsp;access&nbsp;to&nbsp;any&nbsp;site. &nbsp;The<br>
&nbsp;browser&nbsp;causing&nbsp;trouble&nbsp;is&nbsp;configured&nbsp;for&nbsp;port&nbsp;3120,&nbsp;not&nbsp;4120. &nbsp;Here&nbsp;is<br>
&nbsp;my&nbsp;squid.conf&nbsp;file:&lt;br&gt;&lt;br&gt;http_port&nbsp;3120&lt;br&gt;http_port&nbsp;4120&nbsp;intercept&lt;br&gt;&lt;br&gt;cache_dir&nbsp;ufs&nbsp;/var/spool/squid3&nbsp;500&nbsp;16&nbsp;256&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#not&nbsp;sure&nbsp;what&nbsp;this&nbsp;block&nbsp;is&nbsp;for&lt;br&gt;&lt;/div&gt;&lt;div&gt;refresh_pattern&nbsp;^ftp:          &nbsp;1440   &nbsp;20%    &nbsp;10080&lt;br&gt;refresh_pattern&nbsp;^gopher:       &nbsp;1440   &nbsp;0%     &nbsp;1440&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0    &nbsp;0%     &nbsp;0&lt;br&gt;refresh_pattern&nbsp;.              &nbsp;0      &nbsp;20%    &nbsp;4320&lt;br&gt;&lt;br&gt;acl&nbsp;whitelist&nbsp;dstdomain&nbsp;&quot;/etc/squid3/whitelist.conf&quot;&lt;br&gt;&lt;br&gt;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib/squid3/ncsa_auth&nbsp;/etc/squid3/passwd&lt;br&gt;auth_param&nbsp;basic&nbsp;children&nbsp;6&lt;br&gt;auth_param&nbsp;basic&nbsp;realm&nbsp;Squid&nbsp;proxy-caching&nbsp;web&nbsp;server&lt;br&gt;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;4&nbsp;hours&lt;br&gt;auth_param&nbsp;basic&nbsp;casesensitive&nbsp;off&lt;br&gt;&lt;br&gt;acl&nbsp;ncsa_users&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#not&nbsp;sure&nbsp;what&nbsp;this&nbsp;line&nbsp;does&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;manager&nbsp;url_regex&nbsp;-i&nbsp;^cache_object://&nbsp;+i&nbsp;^https?://[^/]+/squid-&lt;wbr&gt;internal-mgr/&lt;br&gt;&lt;br&gt;acl&nbsp;localhost&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1/32&quot;&nbsp;target=&quot;_blank&quot;&gt;127.0.0.1/32&lt;/a&gt;&nbsp;::1&lt;br&gt;acl&nbsp;to_localhost&nbsp;dst&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.0/8&quot;&nbsp;target=&quot;_blank&quot;&gt;127.0.0.0/8&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/32&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0/32&lt;/a&gt;&nbsp;::1&lt;br&gt;&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&nbsp;target=&quot;_blank&quot;&gt;10.0.0.0/8&lt;/a&gt;    &nbsp;#&nbsp;RFC&nbsp;1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://172.16.0.0/12&quot;&nbsp;target=&quot;_blank&quot;&gt;172.16.0.0/12&lt;/a&gt; &nbsp;#&nbsp;RFC&nbsp;1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/16&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.0.0/16&lt;/a&gt;&nbsp;#&nbsp;RFC&nbsp;1918&nbsp;possible&nbsp;internal&nbsp;network&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7      &nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10     &nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;&lt;br&gt;#acl&nbsp;http&nbsp;proto&nbsp;http&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;port_80&nbsp;port&nbsp;80&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80         &nbsp;#&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21         &nbsp;#&nbsp;ftp&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443        &nbsp;#&nbsp;https&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70         &nbsp;#&nbsp;gopher&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210        &nbsp;#&nbsp;wais&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535 &nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280        &nbsp;#&nbsp;http-mgmt&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488        &nbsp;#&nbsp;gss-http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591        &nbsp;#&nbsp;filemaker&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777        &nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;&lt;br&gt;#list&nbsp;of&nbsp;computers&nbsp;that&nbsp;have&nbsp;access&nbsp;by&nbsp;ip&nbsp;address&lt;br&gt;acl<br>
&nbsp;allowed_clients&nbsp;src&nbsp;192.168.0.9-192.168.0.45&nbsp;192.168.0.53&nbsp;192.168.0.65&nbsp;<br>
192.168.0.83&nbsp;192.168.0.90&nbsp;192.168.0.91&nbsp;192.168.0.179&nbsp;192.168.0.186&nbsp;<br>
192.168.0.220&nbsp;192.168.0.221&nbsp;192.168.0.244&lt;br&gt;&lt;br&gt;acl&nbsp;portX&nbsp;myportname&nbsp;4120&lt;br&gt;http_access&nbsp;allow&nbsp;portX&nbsp;whitelist&lt;br&gt;http_access&nbsp;deny&nbsp;portX&lt;br&gt;&lt;br&gt;acl&nbsp;deny_websites&nbsp;dstdomain&nbsp;&quot;/etc/squid3/deny_websites.&lt;wbr&gt;conf&quot;&lt;br&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;#acl&nbsp;wuCONNECT&nbsp;dstdomain&nbsp;&quot;/etc/squid3/whitelist.conf&quot;&lt;br&gt;#acl&nbsp;wuCONNECT&nbsp;dstdomain&nbsp;&lt;a&nbsp;href=&quot;http://sls.microsoft.com&quot;&nbsp;target=&quot;_blank&quot;&gt;sls.microsoft.com&lt;/a&gt;&lt;br&gt;&lt;br&gt;#rule&nbsp;allowing&nbsp;nonauthenticated&nbsp;users&lt;br&gt;#http_access&nbsp;allow&nbsp;http&nbsp;port_80&nbsp;whitelist&lt;br&gt;http_access&nbsp;allow&nbsp;CONNECT&nbsp;SSL_ports&nbsp;whitelist&lt;br&gt;&lt;br&gt;#other&nbsp;access&nbsp;rules&lt;br&gt;#http_access&nbsp;deny&nbsp;!ncsa_users&lt;br&gt;http_access&nbsp;allow&nbsp;CONNECT&nbsp;localnet&lt;br&gt;http_access&nbsp;deny&nbsp;deny_websites&lt;br&gt;http_access&nbsp;allow&nbsp;allowed_clients&nbsp;ncsa_users&lt;br&gt;http_access&nbsp;deny&nbsp;!allowed_clients&lt;br&gt;#http_access&nbsp;allow&nbsp;ncsa_users&lt;br&gt;http_access&nbsp;allow&nbsp;manager&nbsp;localhost&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;#http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;#http_access&nbsp;allow&nbsp;localnet&lt;br&gt;&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If<br>
&nbsp;the&nbsp;conf&nbsp;file&nbsp;is&nbsp;a&nbsp;mess,&nbsp;or&nbsp;has&nbsp;some&nbsp;problems,&nbsp;feel&nbsp;free&nbsp;to&nbsp;say&nbsp;so,&nbsp;as&nbsp;I<br>
&nbsp;don&#39;t&nbsp;know&nbsp;what&nbsp;all&nbsp;of&nbsp;the&nbsp;directives&nbsp;in&nbsp;it&nbsp;are&nbsp;for. &nbsp;I&nbsp;marked&nbsp;a&nbsp;couple<br>
&nbsp;of&nbsp;lines&nbsp;I&nbsp;don&#39;t&nbsp;understand. &nbsp;I&nbsp;would&nbsp;be&nbsp;happy&nbsp;for&nbsp;it&nbsp;to&nbsp;be&nbsp;optimized&nbsp;<br>
more&nbsp;if&nbsp;anyone&nbsp;has&nbsp;ideas.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;PH&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Mon,&nbsp;Dec&nbsp;11,&nbsp;2017&nbsp;at&nbsp;7:16&nbsp;PM,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;On&nbsp;12/12/17&nbsp;11:04,&nbsp;Paul&nbsp;Hackmann&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
Has&nbsp;anyone&nbsp;had&nbsp;the&nbsp;instance&nbsp;where&nbsp;the&nbsp;proxy&nbsp;will&nbsp;ask&nbsp;the&nbsp;user&nbsp;to&nbsp;authenticate&nbsp;several&nbsp;times&nbsp;as&nbsp;they&nbsp;are&nbsp;browsing&nbsp;the&nbsp;web? &nbsp;I&nbsp;have&nbsp;been&nbsp;seeing&nbsp;this&nbsp;as&nbsp;a&nbsp;random&nbsp;occurrence&nbsp;for&nbsp;some&nbsp;of&nbsp;the&nbsp;users&nbsp;on&nbsp;the&nbsp;server. &nbsp;It&nbsp;will&nbsp;pop&nbsp;up&nbsp;a&nbsp;login&nbsp;prompt&nbsp;in&nbsp;the&nbsp;browser&nbsp;repeatedly&nbsp;for&nbsp;a&nbsp;minute&nbsp;or&nbsp;two. &nbsp;Then&nbsp;it&nbsp;will&nbsp;settle&nbsp;down&nbsp;and&nbsp;be&nbsp;fine&nbsp;for&nbsp;hours. &nbsp;I&#39;m&nbsp;trying&nbsp;to&nbsp;track&nbsp;it&nbsp;down,&nbsp;but&nbsp;I&nbsp;can&#39;t&nbsp;find&nbsp;anything&nbsp;amiss. &nbsp;The&nbsp;access&nbsp;logs&nbsp;haven&#39;t&nbsp;shown&nbsp;anything&nbsp;unusual. &nbsp;I&nbsp;am&nbsp;using&nbsp;basic&nbsp;authentication&nbsp;with&nbsp;the&nbsp;proxy&nbsp;settings&nbsp;set&nbsp;in&nbsp;firefox. &nbsp;Is&nbsp;this&nbsp;something&nbsp;that&nbsp;a&nbsp;spike&nbsp;in&nbsp;traffic&nbsp;on&nbsp;the&nbsp;server&nbsp;could&nbsp;cause? &nbsp;Anybody&nbsp;have&nbsp;any&nbsp;suggestions? &nbsp;The&nbsp;server&nbsp;is&nbsp;linux&nbsp;based.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/span&gt;<br>
What&nbsp;version&nbsp;of&nbsp;Squid?&lt;br&gt;<br>
What&nbsp;ACLs&nbsp;and&nbsp;http_access&nbsp;configuration?&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;div&nbsp;class=&quot;HOEnZb&quot;&gt;&lt;div&nbsp;class=&quot;h5&quot;&gt;&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.&lt;wbr&gt;org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/l&lt;wbr&gt;istinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
