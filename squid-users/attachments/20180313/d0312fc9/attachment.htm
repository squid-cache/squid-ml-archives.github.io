<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;AFAIK,&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;SSL&nbsp;bump&nbsp;subsystem&nbsp;uses&nbsp;OpenSSL&nbsp;memory&nbsp;routines.&nbsp;So,&nbsp;first&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all,&nbsp;most&nbsp;probably&nbsp;leaks&nbsp;(if&nbsp;any)&nbsp;can&nbsp;be&nbsp;OpenSSL-related,&nbsp;but&nbsp;not<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;squid&nbsp;itself.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Now&nbsp;let's&nbsp;see&nbsp;your&nbsp;config&nbsp;snippets.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;13.03.2018&nbsp;23:00,&nbsp;Aaron&nbsp;Turner&nbsp;пишет:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
cite=&quot;mid:CANAZdzUsamD-_P2gB9oQEbjR=Y0XEK0mnKUdYgjXtRGAxnPQUQ@mail.gmail.com&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&quot;Usually&nbsp;misconfiguration&nbsp;leads&nbsp;to&nbsp;memory&nbsp;overhead.&quot;<br>
<br>
This&nbsp;may&nbsp;be&nbsp;true,&nbsp;but&nbsp;if&nbsp;you&nbsp;look&nbsp;in&nbsp;the&nbsp;list&nbsp;archives&nbsp;a&nbsp;few&nbsp;months<br>
ago&nbsp;I&nbsp;basically&nbsp;chased&nbsp;my&nbsp;tail&nbsp;in&nbsp;circles&nbsp;and&nbsp;nobody&nbsp;could&nbsp;tell&nbsp;me<br>
what&nbsp;I&nbsp;was&nbsp;doing&nbsp;wrong&nbsp;and&nbsp;so&nbsp;many&nbsp;of&nbsp;the&nbsp;docs&nbsp;are&nbsp;so&nbsp;old&nbsp;that&nbsp;they're<br>
worse&nbsp;then&nbsp;useless,&nbsp;they&nbsp;seem&nbsp;to&nbsp;suggest&nbsp;the&nbsp;wrong&nbsp;thing.<br>
<br>
It&nbsp;was&nbsp;literally&nbsp;leaking&nbsp;GB's&nbsp;worth&nbsp;of&nbsp;RAM.&nbsp;&nbsp;I&nbsp;even&nbsp;disabled&nbsp;all<br>
caching&nbsp;and&nbsp;process&nbsp;sizes&nbsp;were&nbsp;growing&nbsp;into&nbsp;the&nbsp;GB's.&nbsp;&nbsp;Turn&nbsp;off<br>
ssl-bump&nbsp;and&nbsp;the&nbsp;leak&nbsp;went&nbsp;away.<br>
<br>
This&nbsp;is&nbsp;what&nbsp;I&nbsp;was&nbsp;using:<br>
<br>
http_port&nbsp;10.0.0.1:3128&nbsp;ssl-bump&nbsp;generate-host-certificates=on<br>
dynamic_cert_mem_cache_size=400MB&nbsp;cert=/etc/squid/ssl_cert/myCA.pem<br>
sslflags=NO_DEFAULT_CA<br>
http_port&nbsp;localhost:3128<br>
ssl_bump&nbsp;bump&nbsp;all&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;bump&nbsp;all&nbsp;is&nbsp;useless&nbsp;without&nbsp;peek/splice.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Let's&nbsp;see&nbsp;on&nbsp;my&nbsp;config&nbsp;snippets:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;https_port&nbsp;3127&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on<br>
&nbsp;&nbsp;&nbsp;&nbsp;dynamic_cert_mem_cache_size=10MB<br>
&nbsp;&nbsp;&nbsp;&nbsp;cert=/usr/local/squid/etc/rootCA2.crt<br>
&nbsp;&nbsp;&nbsp;&nbsp;key=/usr/local/squid/etc/rootCA2.key<br>
&nbsp;&nbsp;&nbsp;&nbsp;tls-cafile=/usr/local/squid/etc/rootCA12.crt<br>
&nbsp;&nbsp;&nbsp;&nbsp;options=SINGLE_DH_USE:SINGLE_ECDH_USE<br>
&nbsp;&nbsp;&nbsp;&nbsp;tls-dh=secp384r1:/usr/local/squid/etc/dhparam.pem<br>
&nbsp;&nbsp;&nbsp;&nbsp;cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS<br>
&nbsp;&nbsp;&nbsp;&nbsp;tls-no-npn&nbsp;sslflags=NO_DEFAULT_CA:VERIFY_CRL_ALL&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_port&nbsp;3128&nbsp;ssl-bump&nbsp;generate-host-certificates=on<br>
&nbsp;&nbsp;&nbsp;&nbsp;dynamic_cert_mem_cache_size=10MB<br>
&nbsp;&nbsp;&nbsp;&nbsp;cert=/usr/local/squid/etc/rootCA2.crt<br>
&nbsp;&nbsp;&nbsp;&nbsp;key=/usr/local/squid/etc/rootCA2.key<br>
&nbsp;&nbsp;&nbsp;&nbsp;tls-cafile=/usr/local/squid/etc/rootCA12.crt<br>
&nbsp;&nbsp;&nbsp;&nbsp;options=SINGLE_DH_USE:SINGLE_ECDH_USE<br>
&nbsp;&nbsp;&nbsp;&nbsp;tls-dh=secp384r1:/usr/local/squid/etc/dhparam.pem<br>
&nbsp;&nbsp;&nbsp;&nbsp;cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS<br>
&nbsp;&nbsp;&nbsp;&nbsp;tls-no-npn&nbsp;sslflags=NO_DEFAULT_CA:VERIFY_CRL_ALL&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tls_outgoing_options&nbsp;cafile=/usr/local/squid/etc/ca-bundle.crt<br>
&nbsp;&nbsp;&nbsp;&nbsp;cipher=HIGH:MEDIUM:RC4:3DES:!aNULL:!eNULL:!LOW:!MD5:!EXP:!PSK:!SRP:!DSS&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Cert&nbsp;database&nbsp;on&nbsp;ramdisk&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sslcrtd_program&nbsp;/usr/local/squid/libexec/security_file_certgen&nbsp;-s<br>
&nbsp;&nbsp;&nbsp;&nbsp;/ramdisk1/ssl_db&nbsp;-M&nbsp;1GB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;sslcrtd_children&nbsp;32&nbsp;startup=10&nbsp;idle=5&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;SSL&nbsp;bump&nbsp;rules&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;DiscoverSNIHost&nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;NoSSLIntercept&nbsp;ssl::server_name_regex<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;/usr/local/squid/etc/acl.url.nobump&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ssl_bump&nbsp;peek&nbsp;DiscoverSNIHost&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ssl_bump&nbsp;splice&nbsp;NoSSLIntercept&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
cite=&quot;mid:CANAZdzUsamD-_P2gB9oQEbjR=Y0XEK0mnKUdYgjXtRGAxnPQUQ@mail.gmail.com&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
<br>
sslcrtd_program&nbsp;/usr/lib64/squid/ssl_crtd&nbsp;-s&nbsp;/var/lib/squid/ssl_db&nbsp;-M&nbsp;4MB<br>
sslcrtd_children&nbsp;32&nbsp;startup=2&nbsp;idle=2&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;is&nbsp;defaults.&nbsp;Pay&nbsp;attention,&nbsp;-M&nbsp;is&nbsp;limits&nbsp;use&nbsp;ssl_db&nbsp;directory<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;4&nbsp;Mb&nbsp;in&nbsp;size.&nbsp;It's&nbsp;too&nbsp;few&nbsp;for&nbsp;production&nbsp;servers.&nbsp;My&nbsp;ramdisk&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;ssl&nbsp;db&nbsp;is&nbsp;1+&nbsp;Gb&nbsp;in&nbsp;size:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;/dev/ramdisk/ramdisk1          &nbsp;961M  &nbsp;14M &nbsp;890M  &nbsp;2%<br>
&nbsp;&nbsp;&nbsp;&nbsp;/ramdisk1/ssl_db&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
cite=&quot;mid:CANAZdzUsamD-_P2gB9oQEbjR=Y0XEK0mnKUdYgjXtRGAxnPQUQ@mail.gmail.com&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
sslproxy_session_cache_size&nbsp;100&nbsp;MB&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;is&nbsp;disbalanced&nbsp;size&nbsp;instead&nbsp;of&nbsp;previous&nbsp;setting.&nbsp;Why&nbsp;so&nbsp;big?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;# &nbsp;TAG:&nbsp;sslproxy_session_cache_size&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#       &nbsp;Sets&nbsp;the&nbsp;cache&nbsp;size&nbsp;to&nbsp;use&nbsp;for&nbsp;ssl&nbsp;session&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#Default:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;sslproxy_session_cache_size&nbsp;2&nbsp;MB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
cite=&quot;mid:CANAZdzUsamD-_P2gB9oQEbjR=Y0XEK0mnKUdYgjXtRGAxnPQUQ@mail.gmail.com&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
sslproxy_cert_error&nbsp;allow&nbsp;all<br>
sslproxy_flags&nbsp;DONT_VERIFY_PEER&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;NEVER&nbsp;use&nbsp;this&nbsp;options.&nbsp;It&nbsp;is&nbsp;unsafe.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SSL&nbsp;Bump&nbsp;is&nbsp;dangerous&nbsp;enough&nbsp;itself.&nbsp;Don't&nbsp;do&nbsp;it&nbsp;more&nbsp;unsafe<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;additionally&nbsp;by&nbsp;yourself.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
cite=&quot;mid:CANAZdzUsamD-_P2gB9oQEbjR=Y0XEK0mnKUdYgjXtRGAxnPQUQ@mail.gmail.com&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
<br>
This&nbsp;was&nbsp;on&nbsp;a&nbsp;machine&nbsp;(EC2&nbsp;VM)&nbsp;with&nbsp;14GB&nbsp;of&nbsp;RAM.&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Pay&nbsp;attention&nbsp;on&nbsp;several&nbsp;places:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;OS&nbsp;memory&nbsp;allocator.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;OpenSSL&nbsp;version.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;OS&nbsp;configuration&nbsp;(IPC,&nbsp;shared&nbsp;memory,&nbsp;swap&nbsp;-&nbsp;all&nbsp;memory&nbsp;related).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;4.&nbsp;Squid's&nbsp;memory/pools&nbsp;configuration.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Don't&nbsp;forget&nbsp;about:&nbsp;Often&nbsp;memory&nbsp;fragmentation&nbsp;seems&nbsp;like&nbsp;leaks.&nbsp;But<br>
&nbsp;&nbsp;&nbsp;&nbsp;no&nbsp;leaks&nbsp;occurs&nbsp;indeed.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Also,&nbsp;don't&nbsp;forget&nbsp;-&nbsp;squid's&nbsp;memory&nbsp;consumption&nbsp;is&nbsp;not&nbsp;only<br>
&nbsp;&nbsp;&nbsp;&nbsp;cache_mem,&nbsp;but&nbsp;also&nbsp;caching&nbsp;on-disk&nbsp;metadata&nbsp;(swap.state),&nbsp;pools<br>
&nbsp;&nbsp;&nbsp;&nbsp;settings,&nbsp;working&nbsp;memory&nbsp;areas,&nbsp;processes&nbsp;memory.&nbsp;And&nbsp;-&nbsp;also&nbsp;-&nbsp;such<br>
&nbsp;&nbsp;&nbsp;&nbsp;things&nbsp;like&nbsp;content&nbsp;adaptation&nbsp;(did&nbsp;you&nbsp;know&nbsp;wide&nbsp;uses&nbsp;ecap&nbsp;gzip<br>
&nbsp;&nbsp;&nbsp;&nbsp;adapter&nbsp;is&nbsp;leaky&nbsp;itself?).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;But&nbsp;this&nbsp;is&nbsp;just&nbsp;for&nbsp;example.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;any&nbsp;case,&nbsp;dig&nbsp;to&nbsp;the&nbsp;OpenSSL/OS&nbsp;side.&nbsp;Squid's&nbsp;memory&nbsp;in&nbsp;most<br>
&nbsp;&nbsp;&nbsp;&nbsp;cases&nbsp;is&nbsp;ok.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;know,&nbsp;this&nbsp;appears&nbsp;SSL&nbsp;Bump&nbsp;is&nbsp;leaky.&nbsp;But&nbsp;this&nbsp;is&nbsp;not&nbsp;correct.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
cite=&quot;mid:CANAZdzUsamD-_P2gB9oQEbjR=Y0XEK0mnKUdYgjXtRGAxnPQUQ@mail.gmail.com&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
<br>
--<br>
Aaron&nbsp;Turner<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://synfin.net/&quot;&gt;https://synfin.net/&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Twitter:&nbsp;@synfinatic<br>
My&nbsp;father&nbsp;once&nbsp;told&nbsp;me&nbsp;that&nbsp;respect&nbsp;for&nbsp;the&nbsp;truth&nbsp;comes&nbsp;close&nbsp;to&nbsp;being<br>
the&nbsp;basis&nbsp;for&nbsp;all&nbsp;morality.&nbsp;&nbsp;&quot;Something&nbsp;cannot&nbsp;emerge&nbsp;from&nbsp;nothing,&quot;<br>
he&nbsp;said.&nbsp;&nbsp;This&nbsp;is&nbsp;profound&nbsp;thinking&nbsp;if&nbsp;you&nbsp;understand&nbsp;how&nbsp;unstable<br>
&quot;the&nbsp;truth&quot;&nbsp;can&nbsp;be.&nbsp;&nbsp;--&nbsp;Frank&nbsp;Herbert,&nbsp;Dune<br>
<br>
<br>
On&nbsp;Tue,&nbsp;Mar&nbsp;13,&nbsp;2018&nbsp;at&nbsp;9:47&nbsp;AM,&nbsp;Yuri&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:yvoinov@gmail.com&quot;&gt;&lt;yvoinov@gmail.com&gt;&lt;/a&gt;&nbsp;wrote:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;I've&nbsp;used&nbsp;it&nbsp;on&nbsp;all&nbsp;versions&nbsp;starting&nbsp;from&nbsp;3.4.<br>
<br>
Now&nbsp;I'm&nbsp;using&nbsp;Squid&nbsp;5.0.0.<br>
<br>
I'm&nbsp;afraid,&nbsp;my&nbsp;config&nbsp;is&nbsp;completely&nbsp;useless,&nbsp;because&nbsp;of&nbsp;it&nbsp;contains&nbsp;tons<br>
of&nbsp;optimizations/tweaks/tricks&nbsp;and&nbsp;designed&nbsp;for&nbsp;customized&nbsp;Squid&nbsp;5.0.0,<br>
with&nbsp;different&nbsp;memory&nbsp;allocator&nbsp;for&nbsp;custom&nbsp;infrastructure.<br>
<br>
You&nbsp;can't&nbsp;just&nbsp;take&nbsp;my&nbsp;config,&nbsp;implement&nbsp;it&nbsp;and&nbsp;hope&nbsp;it&nbsp;will&nbsp;give&nbsp;same<br>
results&nbsp;for&nbsp;you.<br>
<br>
At&nbsp;least,&nbsp;it&nbsp;uses&nbsp;non-system&nbsp;CA&nbsp;bundle,&nbsp;platform-specific&nbsp;configuration<br>
parameters&nbsp;combinations,&nbsp;etc.<br>
<br>
I&nbsp;can&nbsp;say,&nbsp;than&nbsp;SSL&nbsp;Bump&nbsp;is&nbsp;not&nbsp;directly&nbsp;related&nbsp;to&nbsp;memory&nbsp;leaks.&nbsp;Squid<br>
itself&nbsp;almost&nbsp;not&nbsp;contains&nbsp;memory&nbsp;leaks&nbsp;now.&nbsp;Usually&nbsp;misconfiguration<br>
leads&nbsp;to&nbsp;memory&nbsp;overhead.<br>
<br>
As&nbsp;a&nbsp;recommendation,&nbsp;I&nbsp;can&nbsp;give&nbsp;some&nbsp;advices.<br>
<br>
1.&nbsp;Use&nbsp;server&nbsp;with&nbsp;enough&nbsp;RAM.&nbsp;4&nbsp;Gb&nbsp;usually&nbsp;enough&nbsp;just&nbsp;for&nbsp;default<br>
squid&nbsp;configuration.&nbsp;Usually&nbsp;whole&nbsp;system&nbsp;RAM&nbsp;usage&nbsp;should&nbsp;never&nbsp;be<br>
bigger&nbsp;than&nbsp;1/2&nbsp;of&nbsp;overall&nbsp;physical&nbsp;RAM.&nbsp;(I.e.&nbsp;at&nbsp;least&nbsp;1/3&nbsp;of&nbsp;RAM<br>
should&nbsp;always&nbsp;be&nbsp;free&nbsp;during&nbsp;normal&nbsp;running.&nbsp;This&nbsp;prevents&nbsp;OS&nbsp;allocator<br>
pressure&nbsp;to&nbsp;your&nbsp;proxy&nbsp;and,&nbsp;also,&nbsp;increasing&nbsp;performance&nbsp;of&nbsp;proxy).&nbsp;In<br>
case&nbsp;of&nbsp;medium&nbsp;proxy&nbsp;server&nbsp;16&nbsp;Gb&nbsp;of&nbsp;RAM&nbsp;seems&nbsp;big&nbsp;enough,&nbsp;but&nbsp;never&nbsp;try<br>
to&nbsp;fill&nbsp;it&nbsp;up&nbsp;completely.<br>
<br>
2.&nbsp;Don't&nbsp;set&nbsp;giant&nbsp;cache_mem.&nbsp;Remember&nbsp;how&nbsp;you&nbsp;platform&nbsp;allocates&nbsp;whole<br>
RAM&nbsp;-&nbsp;kernel,&nbsp;anon&nbsp;pages,&nbsp;fs&nbsp;caches,&nbsp;etc.&nbsp;-&nbsp;and&nbsp;use&nbsp;reasonable&nbsp;squid's<br>
memory-related&nbsp;settings.<br>
<br>
3.&nbsp;Use&nbsp;sslflags=NO_DEFAULT_CA&nbsp;with&nbsp;your&nbsp;SSL&nbsp;Bump&nbsp;ports.<br>
<br>
4.&nbsp;Never&nbsp;remember&nbsp;-&nbsp;SSL&nbsp;Bump&nbsp;increases&nbsp;your&nbsp;cache&nbsp;memory&nbsp;pressure&nbsp;due&nbsp;to<br>
increasing&nbsp;caching.&nbsp;So,&nbsp;you&nbsp;still&nbsp;require&nbsp;to&nbsp;have&nbsp;enough&nbsp;memory&nbsp;in&nbsp;your<br>
system.<br>
<br>
<br>
13.03.2018&nbsp;22:25,&nbsp;Aaron&nbsp;Turner&nbsp;пишет:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;What&nbsp;version&nbsp;are&nbsp;you&nbsp;using&nbsp;Yuri?&nbsp;&nbsp;Can&nbsp;you&nbsp;share&nbsp;your&nbsp;config?<br>
Everytime&nbsp;I&nbsp;use&nbsp;ssl&nbsp;bump,&nbsp;I&nbsp;have&nbsp;massive&nbsp;memory&nbsp;leaks.&nbsp;&nbsp;It's&nbsp;been<br>
effectively&nbsp;unusable&nbsp;for&nbsp;me.<br>
--<br>
Aaron&nbsp;Turner<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://synfin.net/&quot;&gt;https://synfin.net/&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Twitter:&nbsp;@synfinatic<br>
My&nbsp;father&nbsp;once&nbsp;told&nbsp;me&nbsp;that&nbsp;respect&nbsp;for&nbsp;the&nbsp;truth&nbsp;comes&nbsp;close&nbsp;to&nbsp;being<br>
the&nbsp;basis&nbsp;for&nbsp;all&nbsp;morality.&nbsp;&nbsp;&quot;Something&nbsp;cannot&nbsp;emerge&nbsp;from&nbsp;nothing,&quot;<br>
he&nbsp;said.&nbsp;&nbsp;This&nbsp;is&nbsp;profound&nbsp;thinking&nbsp;if&nbsp;you&nbsp;understand&nbsp;how&nbsp;unstable<br>
&quot;the&nbsp;truth&quot;&nbsp;can&nbsp;be.&nbsp;&nbsp;--&nbsp;Frank&nbsp;Herbert,&nbsp;Dune<br>
<br>
<br>
On&nbsp;Tue,&nbsp;Mar&nbsp;13,&nbsp;2018&nbsp;at&nbsp;9:10&nbsp;AM,&nbsp;Yuri&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:yvoinov@gmail.com&quot;&gt;&lt;yvoinov@gmail.com&gt;&lt;/a&gt;&nbsp;wrote:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Moreover,<br>
<br>
SSL&nbsp;Bump&nbsp;combines&nbsp;with&nbsp;interception/explicit&nbsp;proxy&nbsp;in&nbsp;one&nbsp;setup.<br>
<br>
And&nbsp;works&nbsp;perfectly.<br>
<br>
<br>
13.03.2018&nbsp;21:14,&nbsp;Marcus&nbsp;Kool&nbsp;пишет:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&quot;SSL&nbsp;bump&quot;&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;complex&nbsp;Squid&nbsp;feature.<br>
With&nbsp;ssl_bump&nbsp;ACLs&nbsp;one&nbsp;can&nbsp;decide&nbsp;which&nbsp;domains&nbsp;can&nbsp;be&nbsp;'spliced'&nbsp;(go<br>
through&nbsp;the&nbsp;proxy&nbsp;untouched)&nbsp;or&nbsp;can&nbsp;be&nbsp;'bumped'&nbsp;(decrypted).<br>
<br>
Interception&nbsp;is&nbsp;not&nbsp;a&nbsp;requirement&nbsp;for&nbsp;SSL&nbsp;bump.<br>
<br>
Marcus<br>
<br>
On&nbsp;13/03/18&nbsp;11:44,&nbsp;Danilo&nbsp;V&nbsp;wrote:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;I&nbsp;mean&nbsp;SSL&nbsp;bump&nbsp;in&nbsp;explicit&nbsp;mode.<br>
So&nbsp;intercept&nbsp;is&nbsp;a&nbsp;essencial&nbsp;requirement&nbsp;for&nbsp;running&nbsp;SSL&nbsp;bump?<br>
<br>
Em&nbsp;ter,&nbsp;13&nbsp;de&nbsp;mar&nbsp;de&nbsp;2018&nbsp;às&nbsp;11:10,&nbsp;Matus&nbsp;UHLAR&nbsp;-&nbsp;fantomas<br>
&lt;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:uhlar@fantomas.sk&quot;&gt;uhlar@fantomas.sk&lt;/a&gt;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:uhlar@fantomas.sk&quot;&gt;&lt;mailto:uhlar@fantomas.sk&gt;&lt;/a&gt;&gt;&nbsp;escreveu:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;13.03.18&nbsp;13:44,&nbsp;Danilo&nbsp;V&nbsp;wrote:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;Is&nbsp;it&nbsp;possible/feasible&nbsp;to&nbsp;configure&nbsp;squid&nbsp;in&nbsp;explicit&nbsp;mode<br>
with&nbsp;ssl<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;intercept?<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;explicit&nbsp;is&nbsp;not&nbsp;intercept,&nbsp;intercept&nbsp;is&nbsp;not&nbsp;explicit.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;explicit&nbsp;is&nbsp;where&nbsp;browser&nbsp;is&nbsp;configured&nbsp;(manually&nbsp;or<br>
automatically&nbsp;via&nbsp;WPAD)<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;use&nbsp;the&nbsp;proxy.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;intercept&nbsp;is&nbsp;where&nbsp;network&nbsp;device&nbsp;forcifully&nbsp;redirects&nbsp;http/https<br>
connections<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;proxy.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;maybe&nbsp;you&nbsp;mean&nbsp;SSL&nbsp;bump&nbsp;in&nbsp;explicit&nbsp;mode?<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;Due&nbsp;to&nbsp;architecture&nbsp;of&nbsp;my&nbsp;network&nbsp;it&nbsp;is&nbsp;not&nbsp;possible&nbsp;to&nbsp;implement<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;transparent&nbsp;proxy.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;excuse&nbsp;me?<br>
&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;&quot;transparent&quot;&nbsp;people&nbsp;mean&nbsp;what&nbsp;we&nbsp;usually&nbsp;call&nbsp;&quot;intercept&quot;.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;What&nbsp;would&nbsp;be&nbsp;the&nbsp;behavior&nbsp;of&nbsp;applications&nbsp;that&nbsp;dont&nbsp;support<br>
proxy&nbsp;-&nbsp;i.e.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;dont&nbsp;forward&nbsp;requests&nbsp;to&nbsp;proxy?<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;they&nbsp;mest&nbsp;be&nbsp;intercepted.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;--<br>
&nbsp;&nbsp;&nbsp;&nbsp;Matus&nbsp;UHLAR&nbsp;-&nbsp;fantomas,&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:uhlar@fantomas.sk&quot;&gt;uhlar@fantomas.sk&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:uhlar@fantomas.sk&quot;&gt;&lt;mailto:uhlar@fantomas.sk&gt;&lt;/a&gt;&nbsp;;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.fantomas.sk/&quot;&gt;http://www.fantomas.sk/&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Warning:&nbsp;I&nbsp;wish&nbsp;NOT&nbsp;to&nbsp;receive&nbsp;e-mail&nbsp;advertising&nbsp;to&nbsp;this&nbsp;address.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Varovanie:&nbsp;na&nbsp;tuto&nbsp;adresu&nbsp;chcem&nbsp;NEDOSTAVAT&nbsp;akukolvek&nbsp;reklamnu&nbsp;postu.<br>
&nbsp;&nbsp;&nbsp;&nbsp;Micro$oft&nbsp;random&nbsp;number&nbsp;generator:&nbsp;0,&nbsp;0,&nbsp;0,&nbsp;4.33e+67,&nbsp;0,&nbsp;0,&nbsp;0...<br>
&nbsp;&nbsp;&nbsp;&nbsp;_______________________________________________<br>
&nbsp;&nbsp;&nbsp;&nbsp;squid-users&nbsp;mailing&nbsp;list<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;&lt;mailto:squid-users@lists.squid-cache.org&gt;&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
<br>
<br>
<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;--<br>
&quot;C++&nbsp;seems&nbsp;like&nbsp;a&nbsp;language&nbsp;suitable&nbsp;for&nbsp;firing&nbsp;other&nbsp;people's&nbsp;legs.&quot;<br>
<br>
*****************************<br>
*&nbsp;C++20&nbsp;:&nbsp;Bug&nbsp;to&nbsp;the&nbsp;future&nbsp;*<br>
*****************************<br>
<br>
<br>
<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
--<br>
&quot;C++&nbsp;seems&nbsp;like&nbsp;a&nbsp;language&nbsp;suitable&nbsp;for&nbsp;firing&nbsp;other&nbsp;people's&nbsp;legs.&quot;<br>
<br>
*****************************<br>
*&nbsp;C++20&nbsp;:&nbsp;Bug&nbsp;to&nbsp;the&nbsp;future&nbsp;*<br>
*****************************<br>
<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-signature&quot;&nbsp;cols=&quot;72&quot;&gt;--&nbsp;<br>
&quot;C++&nbsp;seems&nbsp;like&nbsp;a&nbsp;language&nbsp;suitable&nbsp;for&nbsp;firing&nbsp;other&nbsp;people's&nbsp;legs.&quot;<br>
<br>
*****************************<br>
*&nbsp;C++20&nbsp;:&nbsp;Bug&nbsp;to&nbsp;the&nbsp;future&nbsp;*<br>
*****************************&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
