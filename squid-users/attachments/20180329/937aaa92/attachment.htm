<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Hi&nbsp;all,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;have&nbsp;a&nbsp;solution&nbsp;in&nbsp;place&nbsp;with&nbsp;a&nbsp;dedicated&nbsp;squid&nbsp;LXC&nbsp;container&nbsp;(v<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.1.20-2.2).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Both&nbsp;http&nbsp;and&nbsp;https&nbsp;proxy&nbsp;run&nbsp;on&nbsp;default&nbsp;port&nbsp;3128.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Https&nbsp;in&nbsp;tunneled&nbsp;in&nbsp;http&nbsp;using&nbsp;CONNECT.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;authentication&nbsp;in&nbsp;place&nbsp;and&nbsp;both&nbsp;are&nbsp;working&nbsp;fine.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;testing&nbsp;purposes&nbsp;we&nbsp;also&nbsp;use&nbsp;an&nbsp;Apache&nbsp;(v&nbsp;2.2.22-13)&nbsp;proxy<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forwarder&nbsp;running&nbsp;on&nbsp;a&nbsp;different&nbsp;machine&nbsp;on&nbsp;port&nbsp;80&nbsp;as&nbsp;&quot;aproxy&quot;.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Config&nbsp;below:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;i&gt;#&nbsp;Authenticated&nbsp;proxy&nbsp;for&nbsp;testing&nbsp;purposes&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;#&nbsp;We&nbsp;forward&nbsp;http/s&nbsp;requests&nbsp;to&nbsp;the&nbsp;local&nbsp;proxy&nbsp;server&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;ProxyRequests&nbsp;On&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;ProxyVia&nbsp;On&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;ProxyRemote&nbsp;http&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://proxy.example.internal:3128&quot;&gt;http://proxy.example.internal:3128&lt;/a&gt;&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;ProxyRemote&nbsp;https&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://proxy.example.internal:3128&quot;&gt;http://proxy.example.internal:3128&lt;/a&gt;&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;ProxyDomain&nbsp;.example.internal&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;NoProxy&nbsp;.example.internal&nbsp;192.168.x.x/22&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;&lt;Proxy&nbsp;*&gt;&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;  &nbsp;Order&nbsp;Deny,Allow&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;  &nbsp;Deny&nbsp;from&nbsp;all&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;  &nbsp;Allow&nbsp;from&nbsp;192.168.x.x/22&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;  &nbsp;AuthType&nbsp;Basic&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;  &nbsp;AuthName&nbsp;ProxyAuth&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;  &nbsp;AuthUserFile&nbsp;/etc/apache2/proxypasswd&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;  &nbsp;Require&nbsp;valid-user&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;&lt;/Proxy&gt;&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;is&nbsp;working&nbsp;as&nbsp;expected&nbsp;for&nbsp;http&nbsp;requests:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;Unauthenticated&nbsp;(failure):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;i&gt;$&nbsp;http_proxy=&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://aproxy:80&quot;&gt;http://aproxy:80&lt;/a&gt;&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;$&nbsp;wget&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://example.com&quot;&gt;http://example.com&lt;/a&gt;&nbsp;2&gt;&amp;1&nbsp;|&nbsp;grep&nbsp;response&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;Proxy&nbsp;request&nbsp;sent,&nbsp;awaiting&nbsp;response...&nbsp;407&nbsp;Proxy<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Authentication&nbsp;Required&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Username&nbsp;with&nbsp;password&nbsp;(success):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;i&gt;$&nbsp;http_proxy=&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://username1:password@aproxy:80&quot;&gt;http://username1:password@aproxy:80&lt;/a&gt;&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;$&nbsp;wget&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://example.com&quot;&gt;http://example.com&lt;/a&gt;&nbsp;2&gt;&amp;1&nbsp;|&nbsp;grep&nbsp;response&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;Proxy&nbsp;request&nbsp;sent,&nbsp;awaiting&nbsp;response...&nbsp;200&nbsp;OK&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;Username&nbsp;without&nbsp;password&nbsp;(success):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;$&nbsp;http_proxy=&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://username2:@aproxy:80&quot;&gt;http://username2:@aproxy:80&lt;/a&gt;&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;$&nbsp;wget&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://example.com&quot;&gt;http://example.com&lt;/a&gt;&nbsp;2&gt;&amp;1&nbsp;|&nbsp;grep&nbsp;response&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;Proxy&nbsp;request&nbsp;sent,&nbsp;awaiting&nbsp;response...&nbsp;200&nbsp;OK&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;My&nbsp;&lt;b&gt;PROBLEM&lt;/b&gt;&nbsp;is&nbsp;I&nbsp;can't&nbsp;find&nbsp;a&nbsp;way&nbsp;to&nbsp;use&nbsp;authentication&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxied&nbsp;https&nbsp;requests.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;a&nbsp;LAN&nbsp;client&nbsp;trying&nbsp;to&nbsp;establish&nbsp;connection:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;i&gt;$&nbsp;echo&nbsp;$http_proxy&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://username1:password@aproxy:80&quot;&gt;http://username1:password@aproxy:80&lt;/a&gt;&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;i&gt;$&nbsp;echo&nbsp;$https_proxy&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://username1:password@aproxy:80&quot;&gt;http://username1:password@aproxy:80&lt;/a&gt;&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;&lt;i&gt;$&nbsp;wget&nbsp;--server-response&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://example.com&quot;&gt;https://example.com&lt;/a&gt;&nbsp;2&gt;&amp;1&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;--2018-03-29&nbsp;15:20:44-- &nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://example.com/&quot;&gt;https://example.com/&lt;/a&gt;&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;Resolving&nbsp;aproxy&nbsp;(aproxy)...&nbsp;192.168.x.x&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;Connecting&nbsp;to&nbsp;aproxy&nbsp;(aproxy)|192.168.x.x|:80...&nbsp;connected.&lt;/i&gt;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;i&gt;Proxy&nbsp;tunneling&nbsp;failed:&nbsp;Service&nbsp;Temporarily<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnavailableUnable&nbsp;to&nbsp;establish&nbsp;SSL&nbsp;connection.&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;&quot;aproxy&quot;&nbsp;only&nbsp;one&nbsp;line&nbsp;in&nbsp;apache&nbsp;error&nbsp;log&nbsp;(even&nbsp;in&nbsp;debug<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode):&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;i&gt;[Thu&nbsp;Mar&nbsp;29&nbsp;15:21:59&nbsp;2018]&nbsp;[error]&nbsp;(111)Connection&nbsp;refused:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy:&nbsp;CONNECT:&nbsp;attempt&nbsp;to&nbsp;connect&nbsp;to&nbsp;93.184.216.34:443<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(example.com)&nbsp;failed&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nothing&nbsp;is&nbsp;logged&nbsp;on&nbsp;squid&nbsp;&quot;proxy&quot;&nbsp;which&nbsp;is&nbsp;the&nbsp;next&nbsp;hop.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;What's&nbsp;the&nbsp;easiest&nbsp;way&nbsp;to&nbsp;enable&nbsp;authenticated&nbsp;https&nbsp;proxying?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;don't&nbsp;want&nbsp;to&nbsp;enable&nbsp;it&nbsp;for&nbsp;our&nbsp;main&nbsp;production&nbsp;proxy:3128&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Or&nbsp;maybe&nbsp;it's&nbsp;already&nbsp;supposed&nbsp;to&nbsp;work&nbsp;but&nbsp;I'm&nbsp;missing&nbsp;something?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Please&nbsp;advise.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thanks&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Adam&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
