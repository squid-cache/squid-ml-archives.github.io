<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;Wednesday&nbsp;02&nbsp;May&nbsp;2018&nbsp;10:05&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:c1acd07e-e685-7ef2-5e6a-cb4b8701994c@treenet.co.nz&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;02/05/18&nbsp;16:20,&nbsp;Amish&nbsp;wrote:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
Does&nbsp;request-&gt;masterXaction-&gt;tcpClient-&gt;local&nbsp;hold&nbsp;Squid&nbsp;IP&nbsp;incase&nbsp;of<br>
intercepted&nbsp;traffic&nbsp;too?<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
The&nbsp;listening&nbsp;address&nbsp;(if&nbsp;any)&nbsp;will&nbsp;be&nbsp;in<br>
request-&gt;masterXaction-&gt;squidPort-&gt;listenConn-&gt;local&nbsp;instead.&nbsp;It&nbsp;has&nbsp;no<br>
relation&nbsp;to&nbsp;the&nbsp;client&nbsp;TCP&nbsp;connection&nbsp;and&nbsp;may&nbsp;be&nbsp;::&nbsp;or&nbsp;0.0.0.0.<br>
&nbsp;In&nbsp;this&nbsp;chain&nbsp;case&nbsp;request,&nbsp;squidPort,&nbsp;and&nbsp;listenConn&nbsp;may&nbsp;be&nbsp;nil.<br>
<br>
Amos<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;am&nbsp;getting&nbsp;confused&nbsp;actually.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Squid&nbsp;3.5&lt;br&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.squid-cache.org/Versions/v3/3.5/cfgman/external_acl_type.html&quot;&gt;http://www.squid-cache.org/Versions/v3/3.5/cfgman/external_acl_type.html&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Above&nbsp;says&nbsp;%MYADDR&nbsp;=&nbsp;Squid&nbsp;interface&nbsp;address&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Squid&nbsp;4&nbsp;(external_acl_type&nbsp;uses&nbsp;logformat&nbsp;FORMATs)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;And&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.squid-cache.org/Doc/config/logformat/&quot;&gt;http://www.squid-cache.org/Doc/config/logformat/&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;says&nbsp;%la&nbsp;=&nbsp;Local&nbsp;listening&nbsp;IP&nbsp;address&nbsp;the&nbsp;client&nbsp;connection&nbsp;was<br>
&nbsp;&nbsp;&nbsp;&nbsp;connected&nbsp;to&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;So&nbsp;description&nbsp;of&nbsp;%MYADDR&nbsp;and&nbsp;%la&nbsp;is&nbsp;different,&nbsp;but&nbsp;from&nbsp;source&nbsp;code<br>
&nbsp;&nbsp;&nbsp;&nbsp;(src/format/Token.cc)&nbsp;both&nbsp;appear&nbsp;to&nbsp;be&nbsp;same&nbsp;thing&nbsp;i.e.<br>
&nbsp;&nbsp;&nbsp;&nbsp;LFT_LOCAL_LISTENING_IP&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;But&nbsp;the&nbsp;code&nbsp;in&nbsp;Format.cc&nbsp;looks&nbsp;complicated&nbsp;then&nbsp;simple&nbsp;one&nbsp;line:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;case&nbsp;LFT_LOCAL_LISTENING_IP:&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;           &nbsp;//&nbsp;avoid&nbsp;logging&nbsp;a&nbsp;dash&nbsp;if&nbsp;we&nbsp;have&nbsp;reliable&nbsp;info&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;           &nbsp;const&nbsp;bool&nbsp;interceptedAtKnownPort&nbsp;=&nbsp;al-&gt;request&nbsp;?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;                                               <br>
&nbsp;&nbsp;&nbsp;&nbsp;(al-&gt;request-&gt;flags.interceptTproxy&nbsp;||&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;                                                <br>
&nbsp;&nbsp;&nbsp;&nbsp;al-&gt;request-&gt;flags.intercepted)&nbsp;&amp;&amp;&nbsp;al-&gt;cache.port<br>
&nbsp;&nbsp;&nbsp;&nbsp;!=&nbsp;NULL&nbsp;:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;                                               &nbsp;false;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;           &nbsp;if&nbsp;(interceptedAtKnownPort)&nbsp;{&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;               &nbsp;const&nbsp;bool&nbsp;portAddressConfigured&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;!al-&gt;cache.port-&gt;s.isAnyAddr();&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;               &nbsp;if&nbsp;(portAddressConfigured)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;                   &nbsp;out&nbsp;=&nbsp;al-&gt;cache.port-&gt;s.toStr(tmp,<br>
&nbsp;&nbsp;&nbsp;&nbsp;sizeof(tmp));&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;           &nbsp;}&nbsp;else&nbsp;if&nbsp;(al-&gt;tcpClient&nbsp;!=&nbsp;NULL)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;               &nbsp;out&nbsp;=&nbsp;al-&gt;tcpClient-&gt;local.toStr(tmp,<br>
&nbsp;&nbsp;&nbsp;&nbsp;sizeof(tmp));&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;}&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;So&nbsp;which&nbsp;is&nbsp;right&nbsp;way?&nbsp;Above&nbsp;code&nbsp;which&nbsp;considers&nbsp;interception&nbsp;too?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;one&nbsp;of&nbsp;the&nbsp;lines&nbsp;below?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;request-&gt;masterXaction-&gt;tcpClient-&gt;local&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;request-&gt;masterXaction-&gt;squidPort-&gt;listenConn-&gt;local&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;i.e.&nbsp;something&nbsp;like&nbsp;(in&nbsp;errorpage.cc)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'A':&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;if&nbsp;(request&nbsp;&amp;&amp;&nbsp;request-&gt;masterXaction-&gt;squidPort<br>
&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;request-&gt;masterXaction-&gt;squidPort-&gt;listenConn)&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;mb.appendf(&quot;%s&quot;,<br>
request-&gt;masterXaction-&gt;squidPort-&gt;listenConn-&gt;local.toStr(ntoabuf,MAX_IPSTRLEN));&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;else&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;mb.&lt;span&nbsp;class=&quot;pl-c1&quot;&gt;appendf&lt;/span&gt;(&lt;span&nbsp;class=&quot;pl-s&quot;&gt;&lt;span<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;%s&lt;span&nbsp;class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,&nbsp;&lt;span<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class=&quot;pl-c1&quot;&gt;getMyHostname&lt;/span&gt;());&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Note:&nbsp;Here&nbsp;%A&nbsp;would&nbsp;be&nbsp;same&nbsp;as&nbsp;%h&nbsp;if&nbsp;required&nbsp;information&nbsp;is&nbsp;not<br>
&nbsp;&nbsp;&nbsp;&nbsp;available.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Amish.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;PS:&nbsp;Off&nbsp;for&nbsp;few&nbsp;days&nbsp;vacation&nbsp;-&nbsp;so&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;reply&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
