<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;I&nbsp;want&nbsp;to&nbsp;ask,&nbsp;if&nbsp;it&nbsp;is&nbsp;really&nbsp;needed&nbsp;to&nbsp;use&nbsp;ulimit&nbsp;or&nbsp;/etc/security/limits.conf&nbsp;to&nbsp;increase&nbsp;max_filedescriptors&nbsp;value?&nbsp;From&nbsp;my&nbsp;testing,&nbsp;it&nbsp;seems&nbsp;not.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;=&nbsp;my&nbsp;environment:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;CentOS&nbsp;6.9&lt;/div&gt;&lt;div&gt;Squid&nbsp;3.1.23&nbsp;/&nbsp;3.4.14&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;-&nbsp;default&nbsp;ulimits&nbsp;for&nbsp;root&nbsp;and&nbsp;other&nbsp;users:&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;ulimit&nbsp;-Sa&nbsp;|&nbsp;grep&nbsp;--&nbsp;&#39;-n&#39;&lt;br&gt;open&nbsp;files                     &nbsp;(-n)&nbsp;1024&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;[root@...]#&nbsp;ulimit&nbsp;-Ha&nbsp;|&nbsp;grep&nbsp;--&nbsp;&#39;-n&#39;&lt;br&gt;open&nbsp;files                     &nbsp;(-n)&nbsp;4096&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;-&nbsp;default&nbsp;ulimits&nbsp;for&nbsp;squid&nbsp;user:&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;sudo&nbsp;-u&nbsp;squid&nbsp;/bin/bash&lt;br&gt;bash-4.1$&nbsp;id&lt;br&gt;uid=23(squid)&nbsp;gid=23(squid)&nbsp;groups=23(squid),...&lt;br&gt;bash-4.1$&nbsp;ulimit&nbsp;-Sa&nbsp;|&nbsp;grep&nbsp;--&nbsp;&#39;-n&#39;&lt;br&gt;open&nbsp;files                     &nbsp;(-n)&nbsp;1024&lt;br&gt;bash-4.1$&nbsp;ulimit&nbsp;-Ha&nbsp;|&nbsp;grep&nbsp;--&nbsp;&#39;-n&#39;&lt;br&gt;open&nbsp;files                     &nbsp;(-n)&nbsp;4096&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;-&nbsp;processes:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;ps&nbsp;aux&nbsp;|&nbsp;grep&nbsp;squid&lt;br&gt;root     &nbsp;7194 &nbsp;0.0 &nbsp;0.1 &nbsp;73524 &nbsp;3492&nbsp;?       &nbsp;Ss  &nbsp;May17  &nbsp;0:00&nbsp;squid&nbsp;-f&nbsp;/etc/squid/squid.conf&lt;br&gt;squid    &nbsp;7197 &nbsp;0.2&nbsp;10.9&nbsp;276080&nbsp;210156&nbsp;?      &nbsp;S   &nbsp;May17  &nbsp;4:53&nbsp;(squid)&nbsp;-f&nbsp;/etc/squid/squid.conf&lt;br&gt;squid    &nbsp;7198 &nbsp;0.0 &nbsp;0.0 &nbsp;20080 &nbsp;1084&nbsp;?       &nbsp;S   &nbsp;May17  &nbsp;0:00&nbsp;(unlinkd)&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;-&nbsp;error&nbsp;and&nbsp;warning&nbsp;messages&nbsp;from&nbsp;cache.log:&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;client_side.cc(3070)&nbsp;okToAccept:&nbsp;WARNING!&nbsp;Your&nbsp;cache&nbsp;is&nbsp;running&nbsp;out&nbsp;of&nbsp;filedescriptors&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;comm_open:&nbsp;socket&nbsp;failure:&nbsp;(24)&nbsp;Too&nbsp;many&nbsp;open&nbsp;files&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;IpIntercept.cc(137)&nbsp;NetfilterInterception: &nbsp;NF&nbsp;getsockopt(SO_ORIGINAL_DST)&nbsp;failed&nbsp;on&nbsp;FD&nbsp;68:&nbsp;(2)&nbsp;No&nbsp;such&nbsp;file&nbsp;or&nbsp;directory&nbsp;...&nbsp;(many&nbsp;with&nbsp;different&nbsp;FD)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;found&nbsp;many&nbsp;How-tos&nbsp;like&nbsp;these&nbsp;-&nbsp;&lt;a&nbsp;href=&quot;https://access.redhat.com/solutions/63027&quot;&gt;https://access.redhat.com/solutions/63027&lt;/a&gt;&nbsp;and&nbsp;&lt;a&nbsp;href=&quot;https://www.cyberciti.biz/faq/squid-proxy-server-running-out-filedescriptors/&quot;&gt;https://www.cyberciti.biz/faq/squid-proxy-server-running-out-filedescriptors/&lt;/a&gt;.&nbsp;&lt;span&nbsp;id=&quot;gmail-result_box&quot;&nbsp;class=&quot;gmail-&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;Both&nbsp;how-tos&nbsp;mention&nbsp;editing&nbsp;the&nbsp;file&nbsp;/etc/security/limits.conf&nbsp;and&nbsp;adding&nbsp;the&nbsp;line&nbsp;&quot;*&nbsp;-&nbsp;nofile&nbsp;4096&quot;&nbsp;to&nbsp;increase&nbsp;the&nbsp;nofile&nbsp;limit&nbsp;for&nbsp;all&nbsp;users&nbsp;except&nbsp;root&nbsp;-&nbsp;I&nbsp;don&#39;t&nbsp;like&nbsp;this.&nbsp;&lt;span&nbsp;id=&quot;gmail-result_box&quot;&nbsp;class=&quot;gmail-&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;According&nbsp;to&nbsp;my&nbsp;test,&nbsp;see&nbsp;below, &nbsp;this&nbsp;is&nbsp;not&nbsp;necessary,&nbsp;but&nbsp;I&nbsp;want&nbsp;to&nbsp;be&nbsp;sure,&nbsp;so&nbsp;I&#39;m&nbsp;writing&nbsp;here.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;a)&nbsp;Squid&nbsp;default&nbsp;configuration&nbsp;(max_filedesc&nbsp;0)&nbsp;and&nbsp;default&nbsp;nofile&nbsp;limit&nbsp;(1024/4096):&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;ps&nbsp;aux&nbsp;|&nbsp;grep&nbsp;squid&lt;br&gt;root    &nbsp;17837 &nbsp;0.0 &nbsp;0.1 &nbsp;73524 &nbsp;3496&nbsp;?       &nbsp;Ss  &nbsp;13:45  &nbsp;0:00&nbsp;squid&nbsp;-f&nbsp;/etc/squid/squid.conf&lt;br&gt;squid   &nbsp;17840 &nbsp;0.3 &nbsp;0.5 &nbsp;76552&nbsp;10860&nbsp;?       &nbsp;S   &nbsp;13:45  &nbsp;0:00&nbsp;(squid)&nbsp;-f&nbsp;/etc/squid/squid.conf&lt;br&gt;squid   &nbsp;17841 &nbsp;0.0 &nbsp;0.0 &nbsp;20080 &nbsp;1084&nbsp;?       &nbsp;S   &nbsp;13:45  &nbsp;0:00&nbsp;(unlinkd)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;grep&nbsp;-E&nbsp;&quot;Limit|Max&nbsp;open&nbsp;files&quot;&nbsp;/proc/17837/limits&lt;br&gt;Limit                    &nbsp;Soft&nbsp;Limit          &nbsp;Hard&nbsp;Limit          &nbsp;Units&lt;br&gt;Max&nbsp;open&nbsp;files           &nbsp;1024                &nbsp;4096                &nbsp;files&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;grep&nbsp;-E&nbsp;&quot;Limit|Max&nbsp;open&nbsp;files&quot;&nbsp;/proc/17840/limits&lt;br&gt;Limit                    &nbsp;Soft&nbsp;Limit          &nbsp;Hard&nbsp;Limit          &nbsp;Units&lt;br&gt;Max&nbsp;open&nbsp;files           &nbsp;1024&nbsp;               &nbsp;4096                &nbsp;files&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;grep&nbsp;-E&nbsp;&quot;Limit|Max&nbsp;open&nbsp;files&quot;&nbsp;/proc/17841/limits&lt;br&gt;Limit                    &nbsp;Soft&nbsp;Limit          &nbsp;Hard&nbsp;Limit          &nbsp;Units&lt;br&gt;Max&nbsp;open&nbsp;files           &nbsp;1024&nbsp;               &nbsp;4096                &nbsp;files&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;b)&nbsp;Squid&nbsp;configuration&nbsp;with&nbsp;max_filedesc&nbsp;2048&nbsp;and&nbsp;default&nbsp;nofile&nbsp;limit&nbsp;(1024/4096):&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;[root@...]#&nbsp;ps&nbsp;aux&nbsp;|&nbsp;grep&nbsp;squid&lt;br&gt;root     &nbsp;7194 &nbsp;0.0 &nbsp;0.1 &nbsp;73524 &nbsp;3492&nbsp;?       &nbsp;Ss  &nbsp;May17  &nbsp;0:00&nbsp;squid&nbsp;-f&nbsp;/etc/squid/squid.conf&lt;br&gt;squid    &nbsp;7197 &nbsp;0.2&nbsp;10.9&nbsp;276080&nbsp;210156&nbsp;?      &nbsp;S   &nbsp;May17  &nbsp;4:53&nbsp;(squid)&nbsp;-f&nbsp;/etc/squid/squid.conf&lt;br&gt;squid    &nbsp;7198 &nbsp;0.0 &nbsp;0.0 &nbsp;20080 &nbsp;1084&nbsp;?       &nbsp;S   &nbsp;May17  &nbsp;0:00&nbsp;(unlinkd)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;grep&nbsp;-E&nbsp;&quot;Limit|Max&nbsp;open&nbsp;files&quot;&nbsp;/proc/7194/limits&lt;br&gt;Limit                    &nbsp;Soft&nbsp;Limit          &nbsp;Hard&nbsp;Limit          &nbsp;Units&lt;br&gt;Max&nbsp;open&nbsp;files           &nbsp;1024                &nbsp;4096                &nbsp;files&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;grep&nbsp;-E&nbsp;&quot;Limit|Max&nbsp;open&nbsp;files&quot;&nbsp;/proc/7197/limits&lt;br&gt;Limit                    &nbsp;Soft&nbsp;Limit          &nbsp;Hard&nbsp;Limit          &nbsp;Units&lt;br&gt;Max&nbsp;open&nbsp;files           &nbsp;&lt;b&gt;2048&lt;/b&gt;                &nbsp;4096                &nbsp;files&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;grep&nbsp;-E&nbsp;&quot;Limit|Max&nbsp;open&nbsp;files&quot;&nbsp;/proc/7198/limits&lt;br&gt;Limit                    &nbsp;Soft&nbsp;Limit          &nbsp;Hard&nbsp;Limit          &nbsp;Units&lt;br&gt;Max&nbsp;open&nbsp;files            &lt;b&gt;2048&lt;/b&gt;                &nbsp;4096                &nbsp;files&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;soft&nbsp;nofile&nbsp;limit&nbsp;was&nbsp;increased&nbsp;for&nbsp;processes&nbsp;running&nbsp;under&nbsp;squid&nbsp;user&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;c)&nbsp;Squid&nbsp;configuration&nbsp;with&nbsp;max_filedesc&nbsp;8192&nbsp;and&nbsp;default&nbsp;nofile&nbsp;limit&nbsp;(1024/4096):&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;ps&nbsp;aux&nbsp;|&nbsp;grep&nbsp;squid&lt;br&gt;root    &nbsp;18734 &nbsp;0.0 &nbsp;0.1 &nbsp;73524 &nbsp;3492&nbsp;?       &nbsp;Ss  &nbsp;14:00  &nbsp;0:00&nbsp;squid&nbsp;-f&nbsp;/etc/squid/squid.conf&lt;br&gt;squid   &nbsp;18737 &nbsp;0.3 &nbsp;0.6 &nbsp;80244&nbsp;11860&nbsp;?       &nbsp;S   &nbsp;14:00  &nbsp;0:00&nbsp;(squid)&nbsp;-f&nbsp;/etc/squid/squid.conf&lt;br&gt;squid   &nbsp;18740 &nbsp;0.0 &nbsp;0.0 &nbsp;20080 &nbsp;1088&nbsp;?       &nbsp;S   &nbsp;14:00  &nbsp;0:00&nbsp;(unlinkd)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;grep&nbsp;-E&nbsp;&quot;Limit|Max&nbsp;open&nbsp;files&quot;&nbsp;/proc/18734/limits&lt;br&gt;Limit                    &nbsp;Soft&nbsp;Limit          &nbsp;Hard&nbsp;Limit          &nbsp;Units&lt;br&gt;Max&nbsp;open&nbsp;files           &nbsp;1024                &nbsp;4096                &nbsp;files&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;grep&nbsp;-E&nbsp;&quot;Limit|Max&nbsp;open&nbsp;files&quot;&nbsp;/proc/18737/limits&lt;br&gt;Limit                    &nbsp;Soft&nbsp;Limit          &nbsp;Hard&nbsp;Limit          &nbsp;Units&lt;br&gt;Max&nbsp;open&nbsp;files           &nbsp;&lt;b&gt;8192&lt;/b&gt;                &nbsp;&lt;b&gt;8192&lt;/b&gt;                &nbsp;files&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[root@...]#&nbsp;grep&nbsp;-E&nbsp;&quot;Limit|Max&nbsp;open&nbsp;files&quot;&nbsp;/proc/18740/limits&lt;br&gt;Limit                    &nbsp;Soft&nbsp;Limit          &nbsp;Hard&nbsp;Limit          &nbsp;Units&lt;br&gt;Max&nbsp;open&nbsp;files            &lt;b&gt;8192&lt;/b&gt;                 &lt;b&gt;8192&lt;/b&gt;                &nbsp;files&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;both&nbsp;soft&nbsp;and&nbsp;hard&nbsp;nofile&nbsp;limits&nbsp;were&nbsp;increased&nbsp;for&nbsp;processes&nbsp;running&nbsp;under&nbsp;squid&nbsp;user&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;id=&quot;gmail-result_box&quot;&nbsp;class=&quot;gmail-&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;I&nbsp;think,&nbsp;that&nbsp;the&nbsp;limits&nbsp;could&nbsp;be&nbsp;increased&nbsp;in&nbsp;tests&nbsp;b)&nbsp;and&nbsp;c)&nbsp;because&nbsp;the&nbsp;master&nbsp;process&nbsp;runs&nbsp;under&nbsp;the&nbsp;root&nbsp;user.&nbsp;&lt;span&nbsp;id=&quot;gmail-result_box&quot;&nbsp;class=&quot;gmail-short_text&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;class=&quot;gmail-&quot;&gt;Am&nbsp;I&nbsp;right&nbsp;or&nbsp;not?&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Or&nbsp;need&nbsp;I&nbsp;to&nbsp;increase&nbsp;the&nbsp;limits&nbsp;for&nbsp;the&nbsp;master&nbsp;proccess&nbsp;too?&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;and&nbsp;with&nbsp;best&nbsp;regards,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;--&nbsp;&lt;br&gt;Karel&nbsp;Ziegler&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
