<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;Dear&nbsp;Squid&nbsp;users,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;There&nbsp;is&nbsp;a&nbsp;connection&nbsp;C1&nbsp;from&nbsp;the&nbsp;client&nbsp;to&nbsp;squid&nbsp;and&nbsp;that&nbsp;is&nbsp;bumped&nbsp;at&nbsp;squid&nbsp;which&nbsp;forms&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;with&nbsp;origin&nbsp;server&nbsp;S1.&nbsp;Having&nbsp;server&nbsp;persistent&nbsp;connection&nbsp;turned&nbsp;on,&nbsp;for&nbsp;subsequent&nbsp;requests,&nbsp;I&nbsp;see&nbsp;that&nbsp;the&nbsp;same&nbsp;TCP&nbsp;connection&nbsp;is&nbsp;used&nbsp;between&nbsp;the&nbsp;squid&nbsp;and&nbsp;the&nbsp;server&nbsp;and&nbsp;all&nbsp;was&nbsp;fine. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;had&nbsp;a&nbsp;problem&nbsp;after&nbsp;sending&nbsp;too&nbsp;many&nbsp;requests&nbsp;to&nbsp;the&nbsp;same&nbsp;server&nbsp;where&nbsp;my&nbsp;persistence&nbsp;stopped&nbsp;working&nbsp;suddenly.&nbsp;The&nbsp;connection&nbsp;was&nbsp;getting&nbsp;closed&nbsp;from&nbsp;the&nbsp;squid&nbsp;side&nbsp;sending&nbsp;a&nbsp;FIN&nbsp;packet&nbsp;to&nbsp;the&nbsp;origin&nbsp;server.&nbsp;When&nbsp;debugging&nbsp;on&nbsp;this,&nbsp;I&nbsp;found&nbsp;my&nbsp;access&nbsp;logs&nbsp;had&nbsp;states&nbsp;TCP_REFRESH_UNMODIFIED,&nbsp;instead&nbsp;of&nbsp;TCP_MISS&nbsp;which&nbsp;I&nbsp;was&nbsp;seeing&nbsp;earlier&nbsp;when&nbsp;all&nbsp;was&nbsp;fine.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;found&nbsp;that&nbsp;the&nbsp;results&nbsp;were&nbsp;from&nbsp;cache.&nbsp;I&nbsp;included&nbsp;the&nbsp; &lt;font&nbsp;face=&quot;comic&nbsp;sans&nbsp;ms,&nbsp;sans-serif&quot;&nbsp;style=&quot;font-style:italic&quot;&nbsp;color=&quot;#9900ff&quot;&gt;&lt;span&nbsp;style=&quot;background-color:rgb(255,255,255)&quot;&gt;cache&nbsp;deny&nbsp;all&lt;/span&gt;&nbsp;&lt;/font&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt; option&nbsp;and&nbsp;found&nbsp;that&nbsp;the&nbsp;access logs&nbsp;had&nbsp;TCP_MISS&nbsp;since&nbsp;it wasn&#39;t&nbsp;using&nbsp;cached results&nbsp;and&nbsp;my&nbsp;persistence&nbsp;is&nbsp;fine&nbsp;again.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;I&nbsp;have&nbsp;three&nbsp;questions&nbsp;in&nbsp;this&nbsp;scenario:&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;1. What&nbsp;is&nbsp;the&nbsp;relationship&nbsp;between&nbsp;the&nbsp;caching&nbsp;and&nbsp;the&nbsp;persistence&nbsp;connection&nbsp;established?&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;2.&nbsp;When&nbsp;will&nbsp;squid&nbsp;use&nbsp;cached&nbsp;results&nbsp;and&nbsp;when&nbsp;will&nbsp;it&nbsp;not&nbsp;if&nbsp;the&nbsp;cache&nbsp;deny&nbsp;all&nbsp;directive&nbsp;weren&#39;t&nbsp;specified. &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;3.&nbsp;However,&nbsp;this didn&#39;t work&nbsp;fully.&nbsp;Even&nbsp;with&nbsp;&lt;i&gt;cache&nbsp;deny&nbsp;all&lt;/i&gt;&nbsp;directive,&nbsp;persistence wasn&#39;t&nbsp;working&nbsp;when&nbsp;I&nbsp;peeked&nbsp;at&nbsp;the&nbsp;sslBump&nbsp;step&nbsp;1&nbsp;and&nbsp;then&nbsp;Bumped. &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;Persistence&nbsp;worked&nbsp;only&nbsp;when&nbsp;I&nbsp;directly&nbsp;did&nbsp;sslbump&nbsp;allow&nbsp;all&nbsp;(without&nbsp;peeking&nbsp;at&nbsp;first&nbsp;step).&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;Comments&nbsp;are&nbsp;appreciated&nbsp;on&nbsp;the&nbsp;scenario.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Thanks,&lt;/div&gt;Vishali&nbsp;Somaskanthan&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>

</tt>
