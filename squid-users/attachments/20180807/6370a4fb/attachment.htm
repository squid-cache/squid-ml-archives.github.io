<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;have&nbsp;our&nbsp;company&nbsp;proxy&nbsp;and&nbsp;this&nbsp;is&nbsp;how&nbsp;the&nbsp;topology&nbsp;is&nbsp;expected&nbsp;to&nbsp;look&nbsp;like&nbsp;for&nbsp;the&nbsp;deployment:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Client&nbsp;-------------------squid-host.com---------------------------company-proxy------------Internet&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Now&nbsp;I&nbsp;need&nbsp;to&nbsp;allow&nbsp;reverse&nbsp;proxy(3128)&nbsp;for&nbsp;some&nbsp;request&nbsp;from&nbsp;the&nbsp;client&nbsp;and&nbsp;tunnel&nbsp;(3129)&nbsp;as&nbsp;well.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Configuration:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;http_port&nbsp;3128&nbsp;accel&nbsp;allow-direct&lt;/div&gt;&lt;div&gt;http_port&nbsp;3129&lt;/div&gt;&lt;div&gt;never_direct&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;always_direct&nbsp;deny&nbsp;all&lt;/div&gt;&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;&lt;div&gt;&lt;div&gt;cache_peer&nbsp;company-proxy&nbsp;parent&nbsp;80 &nbsp; &nbsp; &nbsp; 0 &nbsp;no-query&nbsp;no-digest&nbsp;login=PASS&nbsp;originserver&lt;/div&gt;&lt;div&gt;url_rewrite_access&nbsp;allow&nbsp;all&lt;br&gt;&lt;/div&gt;&lt;div&gt;url_rewrite_program &nbsp;/usr/bin/python&nbsp;./rewriter_program.py&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Usecases:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1)&nbsp;Reverse&nbsp;proxy:&nbsp;Now&nbsp;I&nbsp;can&nbsp;successfully&nbsp;get&nbsp;the&nbsp;response&nbsp;for&nbsp;the&nbsp;query&nbsp;like&nbsp;curl&nbsp;-X&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://squid-host.com:3128/microsoftapi/api/something&quot;&gt;http://squid-host.com:3128/microsoftapi/api/something&lt;/a&gt;.&nbsp;Basically&nbsp;I&nbsp;rewrite&nbsp;URL&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;https://microsft.com/api/something&quot;&gt;https://microsft.com/api/something&lt;/a&gt;&nbsp;and&nbsp;through&nbsp;company-proxy&nbsp;I&nbsp;get&nbsp;the&nbsp;response&nbsp;successfully&nbsp;from&nbsp;e.g.,&nbsp;&lt;a&nbsp;href=&quot;http://microsoft.com&quot;&gt;microsoft.com&lt;/a&gt;.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2)&nbsp;Tunnel:&nbsp;It&nbsp;fails&nbsp;when&nbsp;the&nbsp;client&nbsp;do&nbsp;a&nbsp;query&nbsp;like&nbsp;curl&nbsp;-x&nbsp;&lt;a&nbsp;href=&quot;http://squid-host.com:3129&quot;&gt;http://squid-host.com:3129&lt;/a&gt;&nbsp;-X&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://googlecloudapis.com/api/something&quot;&gt;https://googlecloudapis.com/api/something&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;&nbsp;HTTP/1.1&nbsp;503&nbsp;Service&nbsp;Unavailable&lt;/div&gt;&lt;div&gt;&lt;&nbsp;Server:&nbsp;squid/3.5.20&lt;/div&gt;&lt;div&gt;&lt;&nbsp;Mime-Version:&nbsp;1.0&lt;/div&gt;&lt;div&gt;&lt;&nbsp;Date:&nbsp;Tue,&nbsp;07&nbsp;Aug&nbsp;2018&nbsp;12:36:07&nbsp;GMT&lt;/div&gt;&lt;div&gt;&lt;&nbsp;Content-Type:&nbsp;text/html;charset=utf-8&lt;/div&gt;&lt;div&gt;&lt;&nbsp;Content-Length:&nbsp;3879&lt;/div&gt;&lt;div&gt;&lt;&nbsp;X-Squid-Error:&nbsp;ERR_CANNOT_FORWARD&nbsp;0&lt;/div&gt;&lt;div&gt;&lt;&nbsp;Vary:&nbsp;Accept-Language&lt;/div&gt;&lt;div&gt;&lt;&nbsp;Content-Language:&nbsp;en&lt;/div&gt;&lt;div&gt;&lt;&lt;/div&gt;&lt;div&gt;*&nbsp;The&nbsp;requested&nbsp;URL&nbsp;returned&nbsp;error:&nbsp;503&lt;/div&gt;&lt;div&gt;*&nbsp;CONNECT&nbsp;phase&nbsp;completed!&lt;/div&gt;&lt;div&gt;*&nbsp;Connection&nbsp;#0&nbsp;to&nbsp;host&nbsp;&lt;a&nbsp;href=&quot;http://squidhostname.com&quot;&gt;squidhostname.com&lt;/a&gt;&nbsp;left&nbsp;intact&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Now,&nbsp;if&nbsp;I&nbsp;remove&nbsp;the&nbsp;origin&nbsp;server,&nbsp;the&nbsp;TUNNEL&nbsp;goes&nbsp;through&nbsp;and&nbsp;getting&nbsp;the&nbsp;response&nbsp;but&nbsp;the&nbsp;reverse&nbsp;proxy&nbsp;fails.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Could&nbsp;you&nbsp;let&nbsp;me&nbsp;know&nbsp;how&nbsp;I&nbsp;can&nbsp;handle&nbsp;both&nbsp;tunneling&nbsp;and&nbsp;reverse&nbsp;proxy&nbsp;through&nbsp;same&nbsp;cache&nbsp;peer?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Hari&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
