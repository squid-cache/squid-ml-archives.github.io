<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&lt;!--&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;--&gt;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;style=&quot;font-size:12pt;color:#000000;font-family:Calibri,Helvetica,sans-serif;&quot;&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&gt;Using&nbsp;&lt;span&gt;squid-4.2-1.el7.x86_64&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
I'm&nbsp;looking&nbsp;at&nbsp;ways&nbsp;to&nbsp;optimize&nbsp;Squid&nbsp;when&nbsp;using&nbsp;ssl_bump.&nbsp;We&nbsp;use&nbsp;the&nbsp;peek&nbsp;&amp;&nbsp;splice&nbsp;approach&nbsp;now&nbsp;and&nbsp;it&nbsp;works&nbsp;pretty&nbsp;well.&nbsp;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;Helvetica,&nbsp;EmojiFont,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;Helvetica,&nbsp;EmojiFont,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;While&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;Helvetica,&nbsp;EmojiFont,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;running&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;Helvetica,&nbsp;EmojiFont,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;&nbsp;some<br>
&nbsp;tests,&nbsp;I&nbsp;noticed&nbsp;that&nbsp;Squid&nbsp;always&nbsp;makes&nbsp;an&nbsp;outbound&nbsp;connection&nbsp;to&nbsp;the&nbsp;remote&nbsp;server&nbsp;regardless&nbsp;of&nbsp;when&nbsp;I&nbsp;terminate&nbsp;the&nbsp;connection.&nbsp;&lt;/span&gt;I'm&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;Helvetica,&nbsp;EmojiFont,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;16px;&quot;&gt;&nbsp;trying<br>
&nbsp;to&nbsp;build&nbsp;a&nbsp;configuration&nbsp;that&nbsp;denies&nbsp;traffic&nbsp;immediately&nbsp;if&nbsp;the&nbsp;client&nbsp;SNI&nbsp;header&nbsp;doesn't&nbsp;match&nbsp;without&nbsp;making&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;remote&nbsp;host.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Here&nbsp;is&nbsp;a&nbsp;very&nbsp;simple&nbsp;configuration&nbsp;that&nbsp;should&nbsp;terminate&nbsp;all&nbsp;connections&nbsp;after&nbsp;step1.&nbsp;The&nbsp;connection&nbsp;is&nbsp;terminated,&nbsp;but&nbsp;by&nbsp;running&nbsp;a&nbsp;tcpdump&nbsp;at&nbsp;the&nbsp;same&nbsp;time,&nbsp;I&nbsp;see&nbsp;that&nbsp;Squid&nbsp;still&nbsp;makes&nbsp;an&nbsp;outbound&nbsp;connection.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;&lt;i&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/i&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;ssl_bump&nbsp;terminate&nbsp;step1&lt;/span&gt;&lt;br&gt;<br>
&lt;/i&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;I&nbsp;would&nbsp;expect&nbsp;that&nbsp;if&nbsp;I&nbsp;terminate&nbsp;after&nbsp;step1,&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;remote&nbsp;server&nbsp;should&nbsp;never&nbsp;be&nbsp;made.&nbsp;Can&nbsp;anyone&nbsp;help&nbsp;me&nbsp;understand&nbsp;why&nbsp;Squid&nbsp;would&nbsp;still&nbsp;make&nbsp;the&nbsp;outbound&nbsp;connection&nbsp;in&nbsp;this&nbsp;instance?&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
