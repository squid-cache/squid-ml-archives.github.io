<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;I&#39;m&nbsp;trying&nbsp;to&nbsp;figure&nbsp;out&nbsp;this&nbsp;weird&nbsp;intermittent&nbsp;issue.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;two&nbsp;squid&nbsp;servers&nbsp;running,&nbsp;non-caching,&nbsp;non-transparent.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Client&nbsp;-&gt;&nbsp;Squid1&nbsp;-&gt;&nbsp;Squid2&nbsp;-&gt;&nbsp;Internet&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;All&nbsp;HTTPS&nbsp;requests&nbsp;work&nbsp;as&nbsp;expected,&nbsp;but&nbsp;randomly,&nbsp;about&nbsp;50%&nbsp;of&nbsp;the&nbsp;time,&nbsp;HTTP&nbsp;requests&nbsp;fail.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;reason&nbsp;for&nbsp;the&nbsp;failure&nbsp;is&nbsp;that&nbsp;the&nbsp;first&nbsp;squid&nbsp;server&nbsp;(Squid1)&nbsp;is&nbsp;not&nbsp;correctly&nbsp;forwarding&nbsp;the&nbsp;request&nbsp;to&nbsp;the&nbsp;second.&nbsp;It&nbsp;is&nbsp;stripping&nbsp;away&nbsp;the&nbsp;hostname,&nbsp;and&nbsp;obviously&nbsp;the&nbsp;second&nbsp;squid&nbsp;server&nbsp;has&nbsp;no&nbsp;clue&nbsp;what&nbsp;to&nbsp;do&nbsp;with&nbsp;it&nbsp;then!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Refreshing&nbsp;either&nbsp;create&nbsp;or&nbsp;resolves&nbsp;the&nbsp;issue,&nbsp;again,&nbsp;seemingly&nbsp;at&nbsp;random.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;following&nbsp;is&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;access&nbsp;logs&nbsp;for&nbsp;two&nbsp;successful&nbsp;requests,&nbsp;followed&nbsp;by&nbsp;a&nbsp;failure:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Squid1:&lt;/div&gt;&lt;div&gt;1535965629.452 &nbsp; &nbsp; 81&nbsp;3.3.3.3&nbsp;TCP_MISS/200&nbsp;5766&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://redacted.com/messages/391/&quot;&gt;http://redacted.com/messages/391/&lt;/a&gt;&nbsp;-&nbsp;FIRSTUP_PARENT/&lt;a&nbsp;href=&quot;http://2.2.2.2&quot;&gt;2.2.2.2&lt;/a&gt;&nbsp;text/html&lt;/div&gt;&lt;div&gt;1535965634.678 &nbsp; &nbsp; 71&nbsp;3.3.3.3&nbsp;TCP_MISS/200&nbsp;5759&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://redacted.com/messages/391/&quot;&gt;http://redacted.com/messages/391/&lt;/a&gt;&nbsp;-&nbsp;FIRSTUP_PARENT/&lt;a&nbsp;href=&quot;http://2.2.2.2&quot;&gt;2.2.2.2&lt;/a&gt;&nbsp;text/html&lt;/div&gt;&lt;div&gt;1535965636.673 &nbsp; &nbsp; &nbsp;1&nbsp;3.3.3.3&nbsp;TCP_MISS/400&nbsp;4009&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://redacted.com/messages/391/&quot;&gt;http://redacted.com/messages/391/&lt;/a&gt;&nbsp;-&nbsp;FIRSTUP_PARENT/&lt;a&nbsp;href=&quot;http://2.2.2.2&quot;&gt;2.2.2.2&lt;/a&gt;&nbsp;text/html&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Squid2:&lt;/div&gt;&lt;div&gt;1535965629.447 &nbsp; &nbsp; 79&nbsp;1.1.1.1&nbsp;TCP_MISS/200&nbsp;5673&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://redacted.com/messages/391/&quot;&gt;http://redacted.com/messages/391/&lt;/a&gt;&nbsp;connect&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://4.4.4.4&quot;&gt;4.4.4.4&lt;/a&gt;&nbsp;text/html&lt;/div&gt;&lt;div&gt;1535965634.673 &nbsp; &nbsp; 68&nbsp;1.1.1.1&nbsp;TCP_MISS/200&nbsp;5671&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://redacted.com/messages/391/&quot;&gt;http://redacted.com/messages/391/&lt;/a&gt;&nbsp;connect&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://4.4.4.4&quot;&gt;4.4.4.4&lt;/a&gt;&nbsp;text/html&lt;/div&gt;&lt;div&gt;1535965636.668 &nbsp; &nbsp; &nbsp;0&nbsp;1.1.1.1&nbsp;TAG_NONE/400&nbsp;3916&nbsp;GET&nbsp;/messages/391/&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;squid.conf&nbsp;from&nbsp;Squid1:&lt;/div&gt;&lt;div&gt;http_port&nbsp;3128&nbsp;name=port_3128&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;nonhierarchical_direct&nbsp;off&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;port_3128_acl&nbsp;myportname&nbsp;port_3128&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;always_direct&nbsp;deny&nbsp;port_3128_acl&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;never_direct&nbsp;allow&nbsp;port_3128_acl&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;3128&lt;/div&gt;&lt;div&gt;cache_peer&nbsp;2.2.2.2&nbsp;parent&nbsp;3128&nbsp;0&nbsp;no-query&nbsp;proxy-only&nbsp;default &nbsp;name=proxy3128&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;proxy3128&nbsp;allow&nbsp;port_3128_acl&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;proxy3128&nbsp;deny&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;squid.conf&nbsp;from&nbsp;Squid2:&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;http_port&nbsp;3128&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Where:&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://1.1.1.1&quot;&gt;1.1.1.1&lt;/a&gt;:&nbsp;Squid1&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://2.2.2.2&quot;&gt;2.2.2.2&lt;/a&gt;:&nbsp;Squid2&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://3.3.3.3&quot;&gt;3.3.3.3&lt;/a&gt;:&nbsp;client&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://4.4.4.4&quot;&gt;4.4.4.4&lt;/a&gt;:&nbsp;Web&nbsp;Server&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;can&#39;t&nbsp;see&nbsp;any&nbsp;obvious&nbsp;error&nbsp;in&nbsp;my&nbsp;configuration,&nbsp;and&nbsp;the&nbsp;intermittent&nbsp;nature&nbsp;of&nbsp;it&nbsp;makes&nbsp;me&nbsp;think&nbsp;it&nbsp;might&nbsp;be&nbsp;some&nbsp;sort&nbsp;of&nbsp;bug.&nbsp;I&#39;d&nbsp;love&nbsp;to&nbsp;hear&nbsp;if&nbsp;anyone&nbsp;else&nbsp;has&nbsp;run&nbsp;into&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Kind&nbsp;Regards,&lt;/div&gt;&lt;div&gt;Michael&nbsp;Thomas&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
