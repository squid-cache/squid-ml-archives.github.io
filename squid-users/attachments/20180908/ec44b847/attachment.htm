<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;But&nbsp;the&nbsp;partial&nbsp;data&nbsp;is&nbsp;been&nbsp;continuously&nbsp;sending&nbsp;back&nbsp;to&nbsp;client.&nbsp;Squid&nbsp;didn&#39;t&nbsp;wait&nbsp;for&nbsp;the&nbsp;complete&nbsp;file&nbsp;to&nbsp;download&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Sat,&nbsp;8&nbsp;Sep&nbsp;2018,&nbsp;20:08&nbsp;Amos&nbsp;Jeffries,&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;8/09/18&nbsp;7:44&nbsp;PM,&nbsp;Hariharan&nbsp;Sethuraman&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;And&nbsp;here&nbsp;is&nbsp;my&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;reply:&lt;br&gt;<br>
&gt;&nbsp;1.&nbsp;HEAD&nbsp;request&nbsp;to&nbsp;read&nbsp;image&nbsp;information&lt;br&gt;<br>
&gt;&nbsp;2.&nbsp;GET&nbsp;request&nbsp;to&nbsp;download&nbsp;the&nbsp;image&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Not&nbsp;quite.&nbsp;GET&nbsp;partial&nbsp;/&nbsp;Range&nbsp;request&nbsp;to&nbsp;fetch&nbsp;the&nbsp;content.&lt;br&gt;<br>
&lt;br&gt;<br>
Squid&nbsp;converted&nbsp;it&nbsp;into&nbsp;a&nbsp;full&nbsp;request&nbsp;for&nbsp;the&nbsp;backend&nbsp;server&nbsp;due&nbsp;to&lt;br&gt;<br>
range_offset_limit&nbsp;-1.&nbsp;But&nbsp;that&nbsp;does&nbsp;mean&nbsp;Squid&nbsp;had&nbsp;to&nbsp;download&nbsp;~240MB&lt;br&gt;<br>
of&nbsp;data&nbsp;before&nbsp;anything&nbsp;starts&nbsp;being&nbsp;sent&nbsp;to&nbsp;the&nbsp;client.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;(2)&lt;br&gt;<br>
&gt;&nbsp;2018/09/08&nbsp;07:28:39.155|&nbsp;11,2|&nbsp;client_side.cc(1278)&nbsp;parseHttpRequest:&lt;br&gt;<br>
&gt;&nbsp;HTTP&nbsp;Client&nbsp;REQUEST:&lt;br&gt;<br>
&gt;&nbsp;---------&lt;br&gt;<br>
&gt;&nbsp;GET&nbsp;/DcKbz9kqMQXK-zp95pv9LH11kjhTpxOJsJ-1FYEL4&lt;br&gt;<br>
&gt;&nbsp;Host:&nbsp;&lt;a&nbsp;href=&quot;http://example.com:3129&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;example.com:3129&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://example.com:3129&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://example.com:3129&lt;/a&gt;&gt;^M&lt;br&gt;<br>
&gt;&nbsp;Range:&nbsp;bytes=242819145-^M&lt;br&gt;<br>
&gt;&nbsp;User-Agent:&nbsp;curl/7.56.1^M&lt;br&gt;<br>
&gt;&nbsp;Accept:&nbsp;*/*^M&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;2018/09/08&nbsp;07:28:39.938|&nbsp;11,2|&nbsp;http.cc(2261)&nbsp;sendRequest:&nbsp;HTTP&nbsp;Server&lt;br&gt;<br>
&gt;&nbsp;REQUEST:&lt;br&gt;<br>
&gt;&nbsp;---------&lt;br&gt;<br>
&gt;&nbsp;GET&nbsp;/DcKbz9kqMQXK-zp95pv9LH11kjhTpxOJsJ-1FYEL4&lt;br&gt;<br>
&gt;&nbsp;User-Agent:&nbsp;curl/7.56.1^M&lt;br&gt;<br>
&gt;&nbsp;Accept:&nbsp;*/*^M&lt;br&gt;<br>
&gt;&nbsp;Host:&nbsp;&lt;a&nbsp;href=&quot;http://exampletarget.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;exampletarget.com&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://exampletarget.com&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://exampletarget.com&lt;/a&gt;&gt;^M&lt;br&gt;<br>
&gt;&nbsp;Via:&nbsp;1.1&nbsp;jb7mgd&nbsp;(squid/4.2)^M&lt;br&gt;<br>
&gt;&nbsp;Surrogate-Capability:&nbsp;jb7mgd=&quot;Surrogate/1.0&quot;^M&lt;br&gt;<br>
&gt;&nbsp;X-Forwarded-For:&nbsp;**.**.**.**^M&lt;br&gt;<br>
&gt;&nbsp;Cache-Control:&nbsp;max-age=0^M&lt;br&gt;<br>
&gt;&nbsp;Connection:&nbsp;keep-alive^M&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;2018/09/08&nbsp;07:28:44.359|&nbsp;11,2|&nbsp;http.cc(723)&nbsp;processReplyHeader:&nbsp;HTTP&lt;br&gt;<br>
&gt;&nbsp;Server&nbsp;RESPONSE:&lt;br&gt;<br>
&gt;&nbsp;---------&lt;br&gt;<br>
&gt;&nbsp;HTTP/1.1&nbsp;200&nbsp;OK&lt;br&gt;<br>
&gt;&nbsp;Date:&nbsp;Sat,&nbsp;08&nbsp;Sep&nbsp;2018&nbsp;07:28:40&nbsp;GMT^M&lt;br&gt;<br>
&gt;&nbsp;Server:&nbsp;Apache/2.2^M&lt;br&gt;<br>
&gt;&nbsp;Content-Disposition:&nbsp;attachment;&nbsp;filename=somefile.iso;^M&lt;br&gt;<br>
&gt;&nbsp;Last-Modified:&nbsp;Fri,&nbsp;20&nbsp;Jul&nbsp;2018&nbsp;18:23:10&nbsp;GMT^M&lt;br&gt;<br>
&gt;&nbsp;ETag:&nbsp;&quot;4a54c59-11653800-571726350bf80&quot;^M&lt;br&gt;<br>
&gt;&nbsp;Accept-Ranges:&nbsp;bytes^M&lt;br&gt;<br>
&gt;&nbsp;Content-Length:&nbsp;291846144^M&lt;br&gt;<br>
&gt;&nbsp;Keep-Alive:&nbsp;timeout=5,&nbsp;max=100^M&lt;br&gt;<br>
&gt;&nbsp;Connection:&nbsp;Keep-Alive^M&lt;br&gt;<br>
&gt;&nbsp;Content-Type:&nbsp;application/unknown^M&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;2018/09/08&nbsp;07:28:44.361|&nbsp;11,2|&nbsp;Stream.cc(267)&nbsp;sendStartOfMessage:&nbsp;HTTP&lt;br&gt;<br>
&gt;&nbsp;Client&nbsp;REPLY:&lt;br&gt;<br>
&gt;&nbsp;---------&lt;br&gt;<br>
&gt;&nbsp;HTTP/1.1&nbsp;206&nbsp;Partial&nbsp;Content^M&lt;br&gt;<br>
&gt;&nbsp;Date:&nbsp;Sat,&nbsp;08&nbsp;Sep&nbsp;2018&nbsp;07:28:40&nbsp;GMT^M&lt;br&gt;<br>
&gt;&nbsp;Server:&nbsp;Apache/2.2^M&lt;br&gt;<br>
&gt;&nbsp;Content-Disposition:&nbsp;attachment;&nbsp;filename=somefile.iso;^M&lt;br&gt;<br>
&gt;&nbsp;Last-Modified:&nbsp;Fri,&nbsp;20&nbsp;Jul&nbsp;2018&nbsp;18:23:10&nbsp;GMT^M&lt;br&gt;<br>
&gt;&nbsp;ETag:&nbsp;&quot;4a54c59-11653800-571726350bf80&quot;^M&lt;br&gt;<br>
&gt;&nbsp;Accept-Ranges:&nbsp;bytes^M&lt;br&gt;<br>
&gt;&nbsp;Content-Type:&nbsp;application/unknown^M&lt;br&gt;<br>
&gt;&nbsp;X-Cache:&nbsp;MISS&nbsp;from&nbsp;jb7mgd^M&lt;br&gt;<br>
&gt;&nbsp;X-Cache-Lookup:&nbsp;MISS&nbsp;from&nbsp;jb7mgd:3128^M&lt;br&gt;<br>
&gt;&nbsp;Via:&nbsp;1.1&nbsp;jb7mgd&nbsp;(squid/4.2)^M&lt;br&gt;<br>
&gt;&nbsp;Connection:&nbsp;keep-alive^M&lt;br&gt;<br>
&gt;&nbsp;Content-Range:&nbsp;bytes&nbsp;242819145-291846143/291846144^M&lt;br&gt;<br>
&gt;&nbsp;Content-Length:&nbsp;49026999^M&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Thanks,&lt;br&gt;<br>
&gt;&nbsp;Hari&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Sat,&nbsp;Sep&nbsp;8,&nbsp;2018&nbsp;at&nbsp;9:48&nbsp;AM&nbsp;Hariharan&nbsp;Sethuraman&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Hi&nbsp;Amos,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; This&nbsp;is&nbsp;what&nbsp;I&nbsp;see&nbsp;when&nbsp;the&nbsp;download&nbsp;is&nbsp;in&nbsp;progress:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; KEY&nbsp;44000000000000000902000000000000&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;STORE_PENDING&nbsp;NOT_IN_MEMORY&nbsp;SWAPOUT_NONE&nbsp;PING_DONE&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;RELEASE_REQUEST,DISPATCHED,PRIVATE,VALIDATED&lt;br&gt;<br>
&lt;br&gt;<br>
So&nbsp;file&nbsp;stored&nbsp;in&nbsp;memory&nbsp;and&nbsp;scheduled&nbsp;for&nbsp;removal.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;LV:1536379799&nbsp;LU:1536379801&nbsp;LM:1532110990&nbsp;EX:-1&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;4&nbsp;locks,&nbsp;1&nbsp;clients,&nbsp;1&nbsp;refs&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;Swap&nbsp;Dir&nbsp;-1,&nbsp;File&nbsp;0XFFFFFFFF&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;GET&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;https://example.com/DhAskLOUpvRG2oeR_f_FxYTyLVHIN5esRF-LXOUKwkwyT0TOf6xO-AUm3KaM&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://example.com/DhAskLOUpvRG2oeR_f_FxYTyLVHIN5esRF-LXOUKwkwyT0TOf6xO-AUm3KaM&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;inmem_lo:&nbsp;99225582&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;inmem_hi:&nbsp;99324372&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;swapout:&nbsp;0&nbsp;bytes&nbsp;queued&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
