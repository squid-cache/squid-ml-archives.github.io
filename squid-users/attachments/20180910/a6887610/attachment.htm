<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;Also&nbsp;can&nbsp;I&nbsp;achieve&nbsp;using&nbsp;reply_header_replace&nbsp;directive?&nbsp;I&nbsp;know&nbsp;it&nbsp;is&nbsp;violation,&nbsp;just&nbsp;to&nbsp;understand&nbsp;the&nbsp;available&nbsp;options.&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Mon,&nbsp;10&nbsp;Sep&nbsp;2018,&nbsp;19:57&nbsp;Hariharan&nbsp;Sethuraman,&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:srnhari@gmail.com&quot;&gt;srnhari@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Mon,&nbsp;10&nbsp;Sep&nbsp;2018,&nbsp;19:46&nbsp;Amos&nbsp;Jeffries,&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;11/09/18&nbsp;12:18&nbsp;AM,&nbsp;Hariharan&nbsp;Sethuraman&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;All,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;two&nbsp;things&nbsp;to&nbsp;clarify:&lt;br&gt;<br>
&gt;&nbsp;1)&nbsp;In&nbsp;earlier&nbsp;email&nbsp;(snipped&nbsp;below),&nbsp;Amos&nbsp;told&nbsp;that&nbsp;is&nbsp;caching&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;scheduled&nbsp;to&nbsp;download&lt;br&gt;<br>
&lt;br&gt;<br>
Thats&nbsp;not&nbsp;what&nbsp;I&nbsp;wrote.&nbsp;There&nbsp;is&nbsp;data&nbsp;and&nbsp;it&nbsp;is&nbsp;scheduled&nbsp;for&nbsp;removal&lt;br&gt;<br>
(erase)&nbsp;as&nbsp;soon&nbsp;as&nbsp;the&nbsp;current&nbsp;client&nbsp;gets&nbsp;responded&nbsp;to.&nbsp;It&nbsp;is&lt;br&gt;<br>
specifically&nbsp;*not*&nbsp;caching.&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;confirms&nbsp;why&nbsp;you&nbsp;are&nbsp;not&nbsp;seeing&nbsp;anything&nbsp;in&nbsp;the&nbsp;disk&nbsp;cache.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;-&nbsp;does&nbsp;it&nbsp;mean&nbsp;that&nbsp;we&nbsp;got&nbsp;the&nbsp;answer&nbsp;and&nbsp;do&nbsp;some&lt;br&gt;<br>
&gt;&nbsp;override?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;--------------------&lt;br&gt;<br>
&gt;&nbsp;---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- &lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; This&nbsp;is&nbsp;what&nbsp;I&nbsp;see&nbsp;when&nbsp;the&nbsp;download&nbsp;is&nbsp;in&nbsp;progress:&lt;br&gt;<br>
&gt;&gt; &lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp; KEY&nbsp;44000000000000000902000000000000&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;STORE_PENDING&nbsp;NOT_IN_MEMORY&nbsp;SWAPOUT_NONE&nbsp;PING_DONE&lt;br&gt;<br>
&gt;&gt; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp;RELEASE_REQUEST,DISPATCHED,PRIVATE,VALIDATED&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;So&nbsp;file&nbsp;stored&nbsp;in&nbsp;memory&nbsp;and&nbsp;scheduled&nbsp;for&nbsp;removal. &lt;br&gt;<br>
&gt;&nbsp;--------------------&lt;br&gt;<br>
&gt;&nbsp;----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;br&gt;<br>
&gt;&nbsp; &lt;br&gt;<br>
&gt;&nbsp;2)&nbsp;With&nbsp;more&nbsp;debug_options&nbsp;enabled,&nbsp;I&nbsp;see&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;caching&nbsp;because&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;response&nbsp;is&nbsp;part&nbsp;of&nbsp;authenticated&nbsp;flow.&nbsp;Is&nbsp;there&nbsp;a&nbsp;way&nbsp;I&nbsp;can&lt;br&gt;<br>
&gt;&nbsp;override&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
No.&nbsp;The&nbsp;server&nbsp;is&nbsp;supplying&nbsp;sufficient&nbsp;headers&nbsp;for&nbsp;caching&nbsp;to&nbsp;make&nbsp;it&lt;br&gt;<br>
appear&nbsp;that&nbsp;the&nbsp;site&nbsp;authors&nbsp;intentionally&nbsp;are&nbsp;sending&nbsp;what&nbsp;does&nbsp;get&lt;br&gt;<br>
delivered.&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;If&nbsp;I&nbsp;understand&nbsp;correctly,&nbsp;you&nbsp;are&nbsp;saying&nbsp;the&nbsp;caching&nbsp;will&nbsp;not&nbsp;be&nbsp;done&nbsp;on&nbsp;squid&nbsp;as&nbsp;the&nbsp;content&nbsp;is&nbsp;authorised&nbsp;by&nbsp;the&nbsp;specific&nbsp;client.&nbsp;We&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;until&nbsp;I&nbsp;ask&nbsp;site&nbsp;owners&nbsp;to&nbsp;change&nbsp;cache&nbsp;control&nbsp;as&nbsp;public?&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;- &nbsp; Initially&nbsp;when&nbsp;this&nbsp;file&nbsp;download&nbsp;starts,&nbsp;it&nbsp;gets&nbsp;authorized&nbsp;(I&lt;br&gt;<br>
&gt;&nbsp;think&nbsp;that&nbsp;is&nbsp;why&nbsp;I&nbsp;see&nbsp;HEAD&nbsp;request&nbsp;is&nbsp;sent&nbsp;to&nbsp;target&nbsp;which&nbsp;has&lt;br&gt;<br>
&gt;&nbsp;Cache-Control:&nbsp;max-age=0)&nbsp;and&nbsp;then&nbsp;the&nbsp;subsequent&nbsp;GET&nbsp;requests&nbsp;(dont&lt;br&gt;<br>
&gt;&nbsp;have&nbsp;any&nbsp;cache-control&nbsp;header)&nbsp;download&nbsp;the&nbsp;chunk&nbsp;using&nbsp;adjusted&nbsp;range&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;offset.&lt;br&gt;<br>
&lt;br&gt;<br>
Client&nbsp;delivered&nbsp;Cache-Control&nbsp;do&nbsp;not&nbsp;matter.&nbsp;It&nbsp;is&nbsp;the&nbsp;*server*&lt;br&gt;<br>
Cache-Control&nbsp;which&nbsp;matters&nbsp;here.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;client&nbsp;can&nbsp;also&nbsp;*not*&nbsp;send&nbsp;the&nbsp;authentication&nbsp;header.&nbsp;That&nbsp;would&nbsp;let&lt;br&gt;<br>
Squid&nbsp;cache&nbsp;the&nbsp;object&nbsp;IF&nbsp;the&nbsp;server&nbsp;sent&nbsp;this&nbsp;same&nbsp;object&nbsp;without&lt;br&gt;<br>
credentials&nbsp;being&nbsp;needed.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;- &nbsp; But&nbsp;the&nbsp;subsequent&nbsp;GET&nbsp;reply&nbsp;seems&nbsp;set&nbsp;with&nbsp;auth&nbsp;flag,&nbsp;see&nbsp;the&nbsp;code&lt;br&gt;<br>
&gt;&nbsp;below&nbsp;snipped&nbsp;from&nbsp;source&lt;br&gt;<br>
&gt;&nbsp;(&lt;a&nbsp;href=&quot;https://github.com/squid-cache/squid/blob/4f1c93a7a0d14eec223e199275ce570d840f71bc/src/http.cc&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&nbsp;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/squid-cache/squid/blob/4f1c93a7a0d14eec223e199275ce570d840f71bc/src/http.cc&lt;/a&gt;). &lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//&nbsp;RFC&nbsp;2068,&nbsp;sec&nbsp;14.9.4&nbsp;-&nbsp;MUST&nbsp;NOT&nbsp;cache&nbsp;any&nbsp;response&nbsp;with&lt;br&gt;<br>
&gt;&nbsp;Authentication&nbsp;UNLESS&nbsp;certain&nbsp;CC&nbsp;controls&nbsp;are&nbsp;present&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp;//&nbsp;allow&nbsp;HTTP&nbsp;violations&nbsp;to&nbsp;IGNORE&nbsp;those&nbsp;controls&nbsp;(ie&nbsp;re-block&lt;br&gt;<br>
&gt;&nbsp;caching&nbsp;Auth)&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp;if&nbsp;(request&nbsp;&amp;&amp;&nbsp;(request-&gt;flags.auth&nbsp;||&nbsp;request-&gt;flags.authSent))&nbsp;{&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;(!rep-&gt;cache_control)&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;decision.make(ReuseDecision::reuseNot,&lt;br&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;authenticated&nbsp;and&nbsp;server&nbsp;reply&nbsp;missing&lt;br&gt;<br>
&gt;&nbsp;Cache-Control&quot;);&lt;br&gt;<br>
&gt;&nbsp;- &nbsp; I&nbsp;tried&nbsp;adding&nbsp;override-expire&nbsp;in&nbsp;the&nbsp;cgi-bin&nbsp;refresh&nbsp;pattern,&nbsp;but&lt;br&gt;<br>
&gt;&nbsp;that&nbsp;will&nbsp;override&nbsp;only&nbsp;for&nbsp;max-age&nbsp;in&nbsp;Cache-control&nbsp;but&nbsp;not&nbsp;relevant&lt;br&gt;<br>
&gt;&nbsp;for&nbsp;auth&nbsp;flag.&lt;br&gt;<br>
&lt;br&gt;<br>
Indeed.&nbsp;It&nbsp;also&nbsp;will&nbsp;only&nbsp;do&nbsp;anything&nbsp;for&nbsp;certain&nbsp;outdated&nbsp;dynamic&lt;br&gt;<br>
content&nbsp;URLs.&lt;br&gt;<br>
&lt;br&gt;<br>
As&nbsp;far&nbsp;as&nbsp;Squid&nbsp;is&nbsp;able&nbsp;to&nbsp;tell&nbsp;the&nbsp;content&nbsp;was&nbsp;generated&nbsp;specifically&lt;br&gt;<br>
for&nbsp;this&nbsp;authenticated&nbsp;user.&nbsp;You&nbsp;need&nbsp;the&nbsp;server&nbsp;to&nbsp;send&nbsp;Cache-Control&lt;br&gt;<br>
with&nbsp;one&nbsp;of&nbsp;public,&nbsp;must-revalidate,&nbsp;or&nbsp;s-maxage&nbsp;which&nbsp;indicate&nbsp;that&nbsp;it&lt;br&gt;<br>
is&nbsp;actually&nbsp;cacheable&nbsp;by&nbsp;a&nbsp;shared&nbsp;cache&nbsp;(ie&nbsp;Squid).&lt;br&gt;<br>
&lt;br&gt;<br>
Otherwise&nbsp;the&nbsp;object&nbsp;is&nbsp;&quot;private&quot;,&nbsp;and&nbsp;the&nbsp;cache&nbsp;related&nbsp;settings&nbsp;are&lt;br&gt;<br>
intended&nbsp;for&nbsp;a&nbsp;client-specific&nbsp;cache,&nbsp;such&nbsp;as&nbsp;a&nbsp;Browser&nbsp;has.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
