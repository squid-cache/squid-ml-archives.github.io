<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;font-family:Helvetica&nbsp;Neue,&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;font-size:16px;&quot;&gt;&lt;div&nbsp;style=&quot;font-family:Helvetica&nbsp;Neue,&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;font-size:16px;&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;pre&nbsp;class=&quot;ydp76dbc839yiv7064100023ydped22fd51code-java&quot;&gt;Hi<br>
I&nbsp;am&nbsp;in&nbsp;a&nbsp;dire&nbsp;need&nbsp;about&nbsp;using&nbsp;squid&nbsp;in&nbsp;my&nbsp;Linux&nbsp;iptables&nbsp;firewall&nbsp;as&nbsp;a&nbsp;transparent&nbsp;proxy.&lt;br&gt;&lt;span&gt;&lt;pre&nbsp;class=&quot;ydp76dbc839yiv7064100023ydp9f69da87code-java&quot;&gt;In&nbsp;my&nbsp;linux&nbsp;iptables&nbsp;firewall&nbsp;i&nbsp;want&nbsp;to&nbsp;&lt;span&nbsp;class=&quot;ydp76dbc839yiv7064100023ydp9f69da87code-keyword&quot;&gt;do&lt;/span&gt;&nbsp;iptables&nbsp;rules&nbsp;and&nbsp;controls&nbsp;in&nbsp;forward&nbsp;chain&nbsp;and&nbsp;after&nbsp;that&nbsp;&lt;span&nbsp;class=&quot;ydp76dbc839yiv7064100023ydp9f69da87code-keyword&quot;&gt;do&lt;/span&gt;&nbsp;http&nbsp;filtering&nbsp;with&nbsp;squid,&nbsp;because&nbsp;of&nbsp;that&nbsp;i&nbsp;need&nbsp;to&nbsp;change&nbsp;netfilter&nbsp;packet&nbsp;flow&nbsp;and&nbsp;send&nbsp;packets&nbsp;to&nbsp;squid(app&nbsp;layer,&nbsp;user&nbsp;space)&nbsp;after&nbsp;forward&nbsp;chain,&nbsp;and&nbsp;then&nbsp;get&nbsp;them&nbsp;back&nbsp;to&nbsp;kernel&nbsp;space&nbsp;to&nbsp;&lt;span&nbsp;class=&quot;ydp76dbc839yiv7064100023ydp9f69da87code-keyword&quot;&gt;continue&lt;/span&gt;&nbsp;their's&nbsp;way&nbsp;in&nbsp;forward&nbsp;chain&nbsp;and&nbsp;then&nbsp;go&nbsp;out,&nbsp;&lt;b&gt;something&nbsp;like&nbsp;other&nbsp;firewals&nbsp;and&nbsp;utm&lt;/b&gt;(like&nbsp;Pfsense&nbsp;or&nbsp;opensense&nbsp;and&nbsp;....)&nbsp;does.&lt;/pre&gt;&lt;/span&gt;In&nbsp;my&nbsp;situation,&nbsp;i&nbsp;want&nbsp;squid&nbsp;to&nbsp;place&nbsp;&lt;b&gt;after&lt;/b&gt;&nbsp;my&nbsp;&lt;b&gt;forwards&lt;/b&gt;&nbsp;iptables&nbsp;rules,by&nbsp;default&nbsp;squid&nbsp;is&nbsp;listen&nbsp;on&nbsp;input&nbsp;port&nbsp;of&nbsp;machine&nbsp;but&nbsp;its&nbsp;not&nbsp;what&nbsp;i&nbsp;want&nbsp;and&nbsp;redirect&nbsp;packets&nbsp;to&nbsp;the&nbsp;input&nbsp;chain&nbsp;does&nbsp;not&nbsp;work&nbsp;&lt;span&nbsp;class=&quot;ydp76dbc839yiv7064100023ydped22fd51code-keyword&quot;&gt;for&lt;/span&gt;&nbsp;me.&lt;br&gt;I&nbsp;think&nbsp;&lt;b&gt;NFqueue&lt;/b&gt;&nbsp;is&nbsp;a&nbsp;good&nbsp;solution&nbsp;for&nbsp;my&nbsp;problem&nbsp;but&nbsp;i&nbsp;don't&nbsp;know&nbsp;that&nbsp;is&nbsp;possible&nbsp;to&nbsp;change&nbsp;squid&nbsp;source&nbsp;code&nbsp;to&nbsp;get&nbsp;packets&nbsp;from&nbsp;nfqueue?&nbsp;or&nbsp;does&nbsp;nfqueue&nbsp;can&nbsp;keep&nbsp;the&nbsp;packet&nbsp;state&nbsp;and&nbsp;handle&nbsp;TCP&nbsp;connection?&lt;br&gt;I&nbsp;want&nbsp;to&nbsp;change&nbsp;My&nbsp;packet&nbsp;flow&nbsp;like&nbsp;this:&nbsp;client-request&nbsp;&gt;&gt;&gt;&nbsp;prerouting&nbsp;&nbsp;&gt;&nbsp;&nbsp;Nat&nbsp;&nbsp;&gt;&nbsp;forward&nbsp;&nbsp;&gt;&nbsp;squid-cache&nbsp;&gt;&nbsp;post-routing&nbsp;&nbsp;&gt;&gt;&gt;&gt;&nbsp;HTTP(s)-server&lt;br&gt;The&nbsp;&lt;b&gt;important&lt;/b&gt;&nbsp;part&nbsp;is&nbsp;that&nbsp;forward&nbsp;rules&nbsp;must&nbsp;check&nbsp;before&nbsp;packets&nbsp;forwards&nbsp;to&nbsp;squid.&nbsp;i&nbsp;don't&nbsp;want&nbsp;packets&nbsp;destinate&nbsp;to&nbsp;input&nbsp;chain&nbsp;of&nbsp;firewall.<br>
I&nbsp;thought&nbsp;maybe&nbsp;its&nbsp;possible&nbsp;to&nbsp;use&nbsp;DAQ&nbsp;,like&nbsp;the&nbsp;way&nbsp;snort&nbsp;use&nbsp;or&nbsp;nfqueue&nbsp;in&nbsp;iptables.&nbsp;I&nbsp;need&nbsp;some&nbsp;help&nbsp;about&nbsp;that,&nbsp;please&nbsp;help&nbsp;me&nbsp;&lt;span&nbsp;class=&quot;ydp76dbc839yiv7064100023ydped22fd51code-keyword&quot;&gt;if&lt;/span&gt;&nbsp;its&nbsp;possible&nbsp;or&nbsp;&lt;b&gt;there&nbsp;are&nbsp;any&nbsp;other&nbsp;ways&nbsp;to&nbsp;solve&nbsp;it&lt;/b&gt;.<br>
&lt;br&gt;&lt;br&gt;Thanks&nbsp;a&nbsp;lot&lt;br&gt;Morteza&nbsp;Omidian&lt;/pre&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
