<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Dear&nbsp;Ones,&nbsp;the&nbsp;more&nbsp;I&nbsp;use&nbsp;Squid&nbsp;the&nbsp;more&nbsp;I&nbsp;realize&nbsp;how&nbsp;powerful&nbsp;it&nbsp;is.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;And&nbsp;like&nbsp;all&nbsp;powerful&nbsp;software&nbsp;it&nbsp;can&nbsp;be&nbsp;complex&nbsp;at&nbsp;first.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;would&nbsp;like&nbsp;to&nbsp;share&nbsp;my&nbsp;settings&nbsp;and&nbsp;if&nbsp;possible&nbsp;listen&nbsp;(read&nbsp;actually)&nbsp;your&nbsp;comments&nbsp;and&nbsp;suggestions.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;My&nbsp;goals&nbsp;of&nbsp;using&nbsp;squid:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;-&nbsp;Transparent&nbsp;authentication&nbsp;of&nbsp;my&nbsp;AD&nbsp;users&nbsp;(2012R2)&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;-&nbsp;Internet&nbsp;access&nbsp;rules&nbsp;based&nbsp;on&nbsp;users&nbsp;belonging&nbsp;to&nbsp;AD&nbsp;groups.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;-&nbsp;Non-authenticated&nbsp;clients&nbsp;(Win&nbsp;PCs)&nbsp;cannot&nbsp;navigate&nbsp;through&nbsp;the&nbsp;proxy.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;-&nbsp;That&nbsp;the&nbsp;clients&nbsp;(Win&nbsp;PCs)&nbsp;not&nbsp;belonging&nbsp;to&nbsp;an&nbsp;AD&nbsp;group&nbsp;allowed&nbsp;in&nbsp;squid,&nbsp;cannot&nbsp;navigate&nbsp;through&nbsp;the&nbsp;proxy.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;My&nbsp;test&nbsp;scenario:&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0)&quot;&gt;-&nbsp;A&nbsp;VM&nbsp;CentOS&nbsp;7&nbsp;Core&nbsp;over&nbsp;VirtualBox&nbsp;5.2,&nbsp;1&nbsp;NIC.&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0)&quot;&gt;-&nbsp;My&nbsp;VM&nbsp;is&nbsp;attached&nbsp;to&nbsp;my&nbsp;domain&nbsp;W2012R2&nbsp;(following&nbsp;this&nbsp;post &lt;a&nbsp;href=&quot;https://www.rootusers.com/how-to-join-centos-linux-to-an-active-directory-domain/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://www.rootusers.com/how-to-join-centos-linux-to-an-active-directory-domain/&lt;/a&gt;)&nbsp;to&nbsp;achieve&nbsp;kerberos&nbsp;authentication&nbsp;transparent&nbsp;to&nbsp;the&nbsp;user.&nbsp;SElinux&nbsp;disabled.&nbsp;Owner&nbsp;permissions&nbsp;to&nbsp;user&nbsp;squid&nbsp;in&nbsp;all&nbsp;folders/files&nbsp;involved.&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(0,0,0)&quot;&gt;-&nbsp;squid&nbsp;3.5.20&nbsp;installed&nbsp;and&nbsp;working&nbsp;great&nbsp;with&nbsp;kerberos,&nbsp;NTLM&nbsp;and&nbsp;basic&nbsp;authentication.&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;squid.conf&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;###&nbsp;negotiate&nbsp;kerberos&nbsp;&amp;&nbsp;ntlm&nbsp;authentication&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/sbin/negotiate_wrapper&nbsp;--ntlm&nbsp;/usr/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--kerberos&nbsp;/usr/lib64/squid/negotiate_kerberos_auth&nbsp;-r&nbsp;-i&nbsp;-s&nbsp;GSS_C_NO_NAME &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;auth_param&nbsp;negotiate&nbsp;children&nbsp;10 &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;on&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;###&nbsp;standard&nbsp;allowed&nbsp;ports&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443 &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;#&nbsp;http &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;#&nbsp;ftp &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;#&nbsp;https &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;#&nbsp;gopher &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;#&nbsp;wais &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;#&nbsp;unregistered&nbsp;ports &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;#&nbsp;http-mgmt &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;#&nbsp;gss-http &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;#&nbsp;filemaker &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;#&nbsp;multiling&nbsp;http &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;###&nbsp;destination&nbsp;domains&nbsp;to&nbsp;be&nbsp;blocked&nbsp;in&nbsp;a&nbsp;HTTP&nbsp;access&nbsp;control&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;LS_malicius&nbsp;dstdomain&nbsp;-i&nbsp;&quot;/etc/squid/DBL/malicius/malicius.txt&quot;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;LS_remotecontrol&nbsp;dstdomain&nbsp;-i&nbsp;&quot;/etc/squid/DBL/remotecontrol/remotecontrol.txt&quot;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;###&nbsp;LDAP&nbsp;group&nbsp;membership&nbsp;sources&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;#&nbsp;WEB_ACCESS_1&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;external_acl_type&nbsp;AD_WEB_ACCESS_1&nbsp;%LOGIN&nbsp;/usr/lib64/squid/ext_ldap_group_acl&nbsp;-P&nbsp;-R&nbsp;-b&nbsp;OU=USERS,DC=netgol,DC=local&nbsp;-D&nbsp;ldap&nbsp;-W&nbsp;&quot;/etc/squid/ldap_pass.txt&quot;&nbsp;-f&nbsp;(&amp;(sAMAccountName=%u)(memberOf=cn=WEB_ACCESS_1,OU=INTERNET,OU=PERMISOS,OU=NETGOL,DC=netgol,DC=local))&nbsp;-h&nbsp;s-dc1.netgol.local&nbsp;-p&nbsp;3268&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;WEB_ACCESS_1&nbsp;external&nbsp;AD_WEB_ACCESS_1&nbsp;web-access-1&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;#&nbsp;WEB_ACCESS_2&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;external_acl_type&nbsp;AD_WEB_ACCESS_2&nbsp;%LOGIN&nbsp;/usr/lib64/squid/ext_ldap_group_acl&nbsp;-P&nbsp;-R&nbsp;-b&nbsp;OU=USERS,DC=netgol,DC=local&nbsp;-D&nbsp;ldap&nbsp;-W&nbsp;&quot;/etc/squid/ldap_pass.txt&quot;&nbsp;-f&nbsp;(&amp;(sAMAccountName=%u)(memberOf=cn=WEB_ACCESS_2,OU=INTERNET,OU=PERMISOS,OU=NETGOL,DC=netgol,DC=local))&nbsp;-h&nbsp;s-dc1.netgol.local&nbsp;-p&nbsp;3268&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;WEB_ACCESS_2&nbsp;external&nbsp;AD_WEB_ACCESS_2&nbsp;web-access-2&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;#&nbsp;WEB_ACCESS_3&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;external_acl_type&nbsp;AD_WEB_ACCESS_3&nbsp;%LOGIN&nbsp;/usr/lib64/squid/ext_ldap_group_acl&nbsp;-P&nbsp;-R&nbsp;-b&nbsp;OU=USERS,DC=netgol,DC=local&nbsp;-D&nbsp;ldap&nbsp;-W&nbsp;&quot;/etc/squid/ldap_pass.txt&quot;&nbsp;-f&nbsp;(&amp;(sAMAccountName=%u)(memberOf=cn=WEB_ACCESS_3,OU=INTERNET,OU=PERMISOS,OU=NETGOL,DC=netgol,DC=local))&nbsp;-h&nbsp;s-dc1.netgol.local&nbsp;-p&nbsp;3268&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;WEB_ACCESS_3&nbsp;external&nbsp;AD_WEB_ACCESS_3&nbsp;web-access-3&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;###&nbsp;HTTP&nbsp;access&nbsp;control&nbsp;policies&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;deny&nbsp;!Safe_ports &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;deny&nbsp;manager&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;deny&nbsp;WEB_ACCESS_1&nbsp;LS_malicius&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;deny&nbsp;WEB_ACCESS_2&nbsp;LS_malicius&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;deny&nbsp;WEB_ACCESS_3&nbsp;LS_malicius&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;deny&nbsp;WEB_ACCESS_1&nbsp;LS_remotecontrol&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;deny&nbsp;WEB_ACCESS_2&nbsp;LS_remotecontrol&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;allow&nbsp;WEB_ACCESS_1&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;allow&nbsp;WEB_ACCESS_2&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;allow&nbsp;WEB_ACCESS_3&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;allow&nbsp;localhost&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_access&nbsp;deny&nbsp;all&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;###&nbsp;personalization&nbsp;###&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_port&nbsp;8080 &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;coredump_dir&nbsp;/var/spool/squid &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;refresh_pattern&nbsp;^ftp:&nbsp;1440&nbsp;20%&nbsp;10080 &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;refresh_pattern&nbsp;^gopher:&nbsp;1440&nbsp;0%&nbsp;1440 &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;0 &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;refresh_pattern&nbsp;. &nbsp;0&nbsp;20%&nbsp;4320 &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;quick_abort_min&nbsp;0&nbsp;KB &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;quick_abort_max&nbsp;0&nbsp;KB &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;read_timeout&nbsp;5&nbsp;minutes &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;request_timeout&nbsp;3&nbsp;minutes &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;half_closed_clients&nbsp;off &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;shutdown_lifetime&nbsp;15&nbsp;seconds &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;log_icp_queries&nbsp;off &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;dns_v4_first&nbsp;on &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;ipcache_size&nbsp;2048 &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;ipcache_low&nbsp;90 &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;fqdncache_size&nbsp;4096 &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;forwarded_for&nbsp;off &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;cache_mgr&nbsp;&lt;a&nbsp;href=&quot;mailto:system@netgol.net&quot;&gt;system@netgol.net&lt;/a&gt; &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;visible_hostname&nbsp;proxy.netgol.local &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;httpd_suppress_version_string&nbsp;on &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;uri_whitespace&nbsp;strip&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;logfile_rotate&nbsp;7&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;debug_options&nbsp;rotate=7&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Any&nbsp;suggestion&nbsp;or&nbsp;comment&nbsp;will&nbsp;be&nbsp;very&nbsp;useful&nbsp;to&nbsp;me&nbsp;and&nbsp;I&nbsp;thank&nbsp;you&nbsp;in&nbsp;advance.&lt;/div&gt;&lt;div&gt;Best&nbsp;regards&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Gabriel&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
