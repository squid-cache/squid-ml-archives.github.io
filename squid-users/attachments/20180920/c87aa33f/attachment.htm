<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thank&nbsp;you!&lt;br&gt;&lt;br&gt;I&nbsp;reverted&nbsp;back&nbsp;to:&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;&lt;/span&gt;&lt;br&gt;And&nbsp;then&nbsp;based&nbsp;on&nbsp;that&nbsp;first&nbsp;link&nbsp;you&nbsp;sent&nbsp;me&nbsp;I&nbsp;rebuilt&nbsp;my&nbsp;Squid&nbsp;instance&nbsp;from &lt;a&nbsp;href=&quot;https://github.com/measurement-factory/squid/tree/SQUID-360-peering-for-SslBump&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;https://github.com/measurement-factory/squid/tree/SQUID-360-peering-for-SslBump&lt;/a&gt;&lt;br&gt;&lt;br&gt;Then&nbsp;tested&nbsp;and&nbsp;I&nbsp;think&nbsp;it&#39;s&nbsp;working&nbsp;now?&lt;br&gt;&lt;br&gt;From&nbsp;my&nbsp;access&nbsp;log:&lt;br&gt;#&nbsp;testing&nbsp;https&lt;br&gt;#&nbsp;first&nbsp;request&lt;br&gt;&lt;div&gt;1537477894.828 &nbsp; &nbsp;310&nbsp;172.27.0.3&nbsp;NONE/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://foo.com:443&quot;&gt;foo.com:443&lt;/a&gt;&nbsp;-&nbsp;FIRSTUP_PARENT/&lt;a&nbsp;href=&quot;http://64.58.117.175&quot;&gt;64.58.117.175&lt;/a&gt;&nbsp;-&lt;br&gt;&lt;/div&gt;&lt;div&gt;1537477895.645 &nbsp; &nbsp;797&nbsp;172.27.0.3&nbsp;TCP_MISS/200&nbsp;32374&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://foo.com/js/bootstrap.min.js&quot;&gt;https://foo.com/js/bootstrap.min.js&lt;/a&gt;&nbsp;-&nbsp;FIRSTUP_PARENT/&lt;a&nbsp;href=&quot;http://64.58.117.175&quot;&gt;64.58.117.175&lt;/a&gt;&nbsp;application/javascript&lt;br&gt;#&nbsp;second&nbsp;request&lt;/div&gt;&lt;div&gt;1537477899.009 &nbsp; &nbsp;336&nbsp;172.27.0.3&nbsp;NONE/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://foo.com:443&quot;&gt;foo.com:443&lt;/a&gt;&nbsp;-&nbsp;FIRSTUP_PARENT/&lt;a&nbsp;href=&quot;http://64.58.117.175&quot;&gt;64.58.117.175&lt;/a&gt;&nbsp;-&lt;/div&gt;&lt;div&gt;1537477899.019 &nbsp; &nbsp; &nbsp;0&nbsp;172.27.0.3&nbsp;TCP_MEM_HIT/200&nbsp;32384&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://foo.com/js/bootstrap.min.js&quot;&gt;https://foo.com/js/bootstrap.min.js&lt;/a&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;application/javascript&lt;br&gt;&lt;br&gt;#&nbsp;testing&nbsp;http&lt;br&gt;#&nbsp;first&nbsp;request&lt;br&gt;&lt;/div&gt;&lt;div&gt;1537477956.088 &nbsp; 1051&nbsp;172.27.0.3&nbsp;TCP_MISS/200&nbsp;28203&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://websites.web.com/&quot;&gt;http://websites.web.com/&lt;/a&gt;&nbsp;-&nbsp;FIRSTUP_PARENT/&lt;a&nbsp;href=&quot;http://64.58.117.175&quot;&gt;64.58.117.175&lt;/a&gt;&nbsp;text/html&lt;br&gt;#&nbsp;second&nbsp;request&lt;br&gt;&lt;/div&gt;&lt;div&gt;1537477957.888 &nbsp; &nbsp; &nbsp;2&nbsp;172.27.0.3&nbsp;TCP_MEM_HIT/200&nbsp;28198&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://websites.web.com/&quot;&gt;http://websites.web.com/&lt;/a&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&gt;&lt;br&gt;Should&nbsp;I&nbsp;change&nbsp;anything&nbsp;else&nbsp;for&nbsp;more&nbsp;improvement?&nbsp;Should&nbsp;I&nbsp;build&nbsp;from&nbsp;the&nbsp;master&nbsp;or&nbsp;a&nbsp;more&nbsp;recent&nbsp;branch&nbsp;of  &lt;a&nbsp;href=&quot;https://github.com/measurement-factory/squid/tree/SQUID-360-peering-for-SslBump&quot;&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;https://github.com/measurement-factory&lt;/a&gt;?&lt;br&gt;&lt;br&gt;Thanks&nbsp;again!&lt;br&gt;B.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Thu,&nbsp;Sep&nbsp;20,&nbsp;2018&nbsp;at&nbsp;12:47&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;09/20/2018&nbsp;12:36&nbsp;PM,&nbsp;Brett&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;currently&nbsp;have&nbsp;squid&nbsp;setup&nbsp;to&nbsp;use&nbsp;a&nbsp;self-signed&nbsp;certificate&nbsp;for&nbsp;MITM&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;cache&nbsp;HTTPS&nbsp;requests.&nbsp;This&nbsp;works.&nbsp;[...]&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Is&nbsp;there&nbsp;a&nbsp;way&nbsp;I&nbsp;can&nbsp;configure&nbsp;squid&nbsp;so&nbsp;I&nbsp;can&nbsp;specify&lt;br&gt;<br>
&gt;&nbsp;it&nbsp;as&nbsp;a&nbsp;proxy&nbsp;for&nbsp;an&nbsp;https&nbsp;request&nbsp;and&nbsp;then&nbsp;have&nbsp;it&nbsp;act&nbsp;as&nbsp;a&nbsp;cache&nbsp;or&lt;br&gt;<br>
&gt;&nbsp;forward&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;proxy&nbsp;(that&nbsp;supports&nbsp;CONNECT)?&lt;br&gt;<br>
&lt;br&gt;<br>
AFAICT,&nbsp;you&nbsp;are&nbsp;asking&nbsp;about&nbsp;the&nbsp;missing&nbsp;&quot;SslBump&nbsp;with&nbsp;cache_peer&quot;&lt;br&gt;<br>
feature,&nbsp;which&nbsp;was&nbsp;covered&nbsp;in&nbsp;several&nbsp;recent&nbsp;threads,&nbsp;including&nbsp;this&nbsp;email:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/pipermail/squid-users/2018-July/018653.html&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/pipermail/squid-users/2018-July/018653.html&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;configuration&nbsp;bumps&nbsp;everything&nbsp;at&nbsp;step2.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;If&nbsp;I&nbsp;change&nbsp;the&nbsp;ssl_bump&nbsp;directives&nbsp;above&nbsp;to&nbsp;the&nbsp;following:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;stare&nbsp;step2&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;step3&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;(misleading!)&nbsp;configuration&nbsp;should&nbsp;splice&nbsp;everything&nbsp;at&nbsp;step1.&nbsp;In&lt;br&gt;<br>
other&nbsp;words,&nbsp;it&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;this&nbsp;(clear)&nbsp;configuration:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
or&nbsp;a&nbsp;disabled&nbsp;SslBump.&nbsp;According&nbsp;to&nbsp;your&nbsp;tests,&nbsp;that&nbsp;is&nbsp;exactly&nbsp;what&lt;br&gt;<br>
happens&nbsp;(and&nbsp;the&nbsp;lack&nbsp;of&nbsp;non-trivial&nbsp;SslBump&nbsp;involvement&nbsp;probably&lt;br&gt;<br>
explains&nbsp;why&nbsp;peering&nbsp;works&nbsp;in&nbsp;this&nbsp;corner&nbsp;case).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;need&nbsp;more&nbsp;information&nbsp;about&nbsp;the&nbsp;equivalence&nbsp;of&nbsp;the&nbsp;last&nbsp;two&lt;br&gt;<br>
configurations,&nbsp;please&nbsp;consider&nbsp;studying&nbsp;the&nbsp;following&nbsp;wiki&nbsp;page&nbsp;and&nbsp;a&lt;br&gt;<br>
related&nbsp;recent&nbsp;email&nbsp;thread:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/SslPeekAndSplice&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/Features/SslPeekAndSplice&lt;/a&gt;&lt;br&gt;<br>
*&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/pipermail/squid-users/2018-September/019162.html&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/pipermail/squid-users/2018-September/019162.html&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
