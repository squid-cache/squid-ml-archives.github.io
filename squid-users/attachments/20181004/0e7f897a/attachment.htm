<tt>
&lt;html&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14pt;&nbsp;color:&nbsp;#000000&quot;&gt;&lt;div&gt;Hi,&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;using&nbsp;external_acl_type&nbsp;to&nbsp;handle&nbsp;web&nbsp;traffic&nbsp;based&nbsp;on&nbsp;authenticated&nbsp;user&nbsp;and&nbsp;destination.&nbsp;&nbsp;I'm&nbsp;also&nbsp;passing&nbsp;the&nbsp;referer&nbsp;to&nbsp;the&nbsp;external&nbsp;acl.&nbsp;&nbsp;&nbsp;I&nbsp;know&nbsp;referer&nbsp;isn't&nbsp;to&nbsp;be&nbsp;relied&nbsp;on,&nbsp;but&nbsp;right&nbsp;off&nbsp;the&nbsp;bat&nbsp;I&nbsp;see&nbsp;two&nbsp;ACL&nbsp;queries&nbsp;for&nbsp;a&nbsp;single&nbsp;URL.&nbsp;&nbsp;One&nbsp;has&nbsp;a&nbsp;referrer&nbsp;and&nbsp;the&nbsp;other&nbsp;doesn't.&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;Here's&nbsp;the&nbsp;acl&nbsp;line&nbsp;from&nbsp;my&nbsp;squid.conf:&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;external_acl_type&nbsp;custom_acl_db&nbsp;cache=0&nbsp;children-max=5&nbsp;%ACL&nbsp;%DATA&nbsp;%ul&nbsp;%SRC&nbsp;%&gt;rd&nbsp;%{Referer}&gt;h&nbsp;(acl&nbsp;script&nbsp;name)&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;Here's&nbsp;the&nbsp;HTML&nbsp;from&nbsp;a&nbsp;very&nbsp;simple&nbsp;page&nbsp;I'm&nbsp;accessing:&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;pre&nbsp;id=&quot;line1&quot;&gt;&lt;span&nbsp;class=&quot;error&quot;&nbsp;title=&quot;Start&nbsp;tag&nbsp;seen&nbsp;without&nbsp;seeing&nbsp;a&nbsp;doctype&nbsp;first.&nbsp;Expected&nbsp;“&lt;!DOCTYPE&nbsp;html&gt;”.&quot;&gt;&lt;&lt;span&nbsp;class=&quot;start-tag&quot;&gt;HTML&lt;/span&gt;&gt;&lt;/span&gt;&lt;span&gt;<br>
&lt;span&nbsp;id=&quot;line2&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;&lt;span&nbsp;class=&quot;start-tag&quot;&gt;HEAD&lt;/span&gt;&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;error&quot;&nbsp;title=&quot;Stray&nbsp;end&nbsp;tag&nbsp;“head”.&quot;&gt;&lt;/&lt;span&nbsp;class=&quot;end-tag&quot;&gt;HEAD&lt;/span&gt;&gt;&lt;/span&gt;&lt;span&gt;<br>
&lt;span&nbsp;id=&quot;line3&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;class=&quot;error&quot;&nbsp;title=&quot;An&nbsp;“body”&nbsp;start&nbsp;tag&nbsp;seen&nbsp;but&nbsp;an&nbsp;element&nbsp;of&nbsp;the&nbsp;same&nbsp;type&nbsp;was&nbsp;already&nbsp;open.&quot;&gt;&lt;&lt;span&nbsp;class=&quot;start-tag&quot;&gt;BODY&lt;/span&gt;&gt;&lt;/span&gt;&lt;span&gt;<br>
&lt;span&nbsp;id=&quot;line4&quot;&gt;&lt;/span&gt;<br>
&lt;span&nbsp;id=&quot;line5&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;&lt;span&nbsp;class=&quot;start-tag&quot;&gt;IMG&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;attribute-name&quot;&gt;SRC&lt;/span&gt;=&quot;&lt;a&nbsp;class=&quot;attribute-value&quot;&nbsp;href=&quot;view-source:http://upload.wikimedia.org/wikipedia/en/thumb/5/53/Snoopy_Peanuts.png/200px-Snoopy_Peanuts.png&quot;&nbsp;data-mce-href=&quot;view-source:http://upload.wikimedia.org/wikipedia/en/thumb/5/53/Snoopy_Peanuts.png/200px-Snoopy_Peanuts.png&quot;&gt;http://domain1.com/image1.png&lt;/a&gt;&quot;&gt;&lt;/span&gt;&lt;span&gt;<br>
&lt;span&nbsp;id=&quot;line6&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;&lt;span&nbsp;class=&quot;start-tag&quot;&gt;BR&lt;/span&gt;&gt;&lt;/span&gt;&lt;span&gt;<br>
&lt;span&nbsp;id=&quot;line7&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;&lt;span&nbsp;class=&quot;start-tag&quot;&gt;IMG&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;attribute-name&quot;&gt;SRC&lt;/span&gt;=&quot;&lt;a&nbsp;class=&quot;attribute-value&quot;&nbsp;href=&quot;view-source:http://static.rgscdn.com/images/xl/702021.jpg&quot;&nbsp;data-mce-href=&quot;view-source:http://static.rgscdn.com/images/xl/702021.jpg&quot;&gt;http://domain2.com/image2.jpg&lt;/a&gt;&quot;&gt;&lt;/span&gt;&lt;span&gt;<br>
&lt;span&nbsp;id=&quot;line8&quot;&gt;&lt;/span&gt;<br>
&lt;span&nbsp;id=&quot;line9&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;/&lt;span&nbsp;class=&quot;end-tag&quot;&gt;BODY&lt;/span&gt;&gt;&lt;/span&gt;&lt;span&gt;<br>
&lt;span&nbsp;id=&quot;line10&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;/&lt;span&nbsp;class=&quot;end-tag&quot;&gt;HTML&lt;/span&gt;&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;access&nbsp;that&nbsp;page&nbsp;through&nbsp;squid,&nbsp;I&nbsp;see&nbsp;one&nbsp;image's&nbsp;URL&nbsp;once,&nbsp;with&nbsp;no&nbsp;referrer,&nbsp;and&nbsp;the&nbsp;other&nbsp;one&nbsp;two&nbsp;times&nbsp;-&nbsp;once&nbsp;with&nbsp;a&nbsp;referrer&nbsp;and&nbsp;once&nbsp;without:&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&nbsp;CustomAclDB&nbsp;-&nbsp;kevin&nbsp;172.18.127.4&nbsp;domain2.com&nbsp;&lt;a&nbsp;href=&quot;http://(web&quot;&gt;http://server_hosting_test_page&lt;/a&gt;/test/&nbsp;&lt;br&gt;&lt;br&gt;&nbsp;CustomAclDB&nbsp;-&nbsp;kevin&nbsp;172.18.127.4&nbsp;domain1.com&nbsp;-&nbsp;&lt;br&gt;&lt;br&gt;&nbsp;CustomAclDB&nbsp;-&nbsp;kevin&nbsp;172.18.127.4&nbsp;domain2.com&nbsp;-&nbsp;&lt;br&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;Why&nbsp;the&nbsp;inconsistency?&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;data-mce-bogus=&quot;1&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
