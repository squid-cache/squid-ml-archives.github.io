<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hello&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;have&nbsp;this&nbsp;simplified&nbsp;ACL&nbsp;in&nbsp;squid.conf&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;denyit&nbsp;src&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;deny_info&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://192.168.1.1/blocked.html&quot;&gt;http://192.168.1.1/blocked.html&lt;/a&gt;&nbsp;denyit&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;deny&nbsp;denyit&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;purpose&nbsp;is&nbsp;to&nbsp;block&nbsp;everything&nbsp;and&nbsp;redirect&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://192.168.1.1/blocked.html&quot;&gt;http://192.168.1.1/blocked.html&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;works&nbsp;fine&nbsp;with&nbsp;http&nbsp;(non-secure)&nbsp;CONNECT&nbsp;request&nbsp;...&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;curl&nbsp;-ix&nbsp;192.168.1.1:8080&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://google.com&quot;&gt;http://google.com&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;HTTP/1.1&nbsp;302&nbsp;Found&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Server:&nbsp;squid/4.3&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Mime-Version:&nbsp;1.0&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Date:&nbsp;Tue,&nbsp;16&nbsp;Oct&nbsp;2018&nbsp;11:02:05&nbsp;GMT&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Content-Type:&nbsp;text/html;charset=utf-8&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Content-Length:&nbsp;0&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Location:&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://192.168.1.1/blocked.html&quot;&gt;http://192.168.1.1/blocked.html&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;X-Squid-Error:&nbsp;403&nbsp;Access&nbsp;Denied&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;X-Cache:&nbsp;MISS&nbsp;from&nbsp;somehost&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;X-Cache-Lookup:&nbsp;NONE&nbsp;from&nbsp;somehost:8080&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Connection:&nbsp;keep-alive&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Â ...&nbsp;but&nbsp;gives&nbsp;certificate&nbsp;error&nbsp;with&nbsp;https&nbsp;CONNECT&nbsp;request.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;curl&nbsp;-ix&nbsp;192.168.1.1:8080&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://google.com&quot;&gt;https://google.com&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;HTTP/1.1&nbsp;200&nbsp;Connection&nbsp;established&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;curl:&nbsp;(60)&nbsp;SSL&nbsp;certificate&nbsp;problem:&nbsp;self&nbsp;signed&nbsp;certificate&nbsp;in<br>
&nbsp;&nbsp;&nbsp;&nbsp;certificate&nbsp;chain&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;More&nbsp;details&nbsp;here:&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://curl.haxx.se/docs/sslcerts.html&quot;&gt;https://curl.haxx.se/docs/sslcerts.html&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;curl&nbsp;failed&nbsp;to&nbsp;verify&nbsp;the&nbsp;legitimacy&nbsp;of&nbsp;the&nbsp;server&nbsp;and&nbsp;therefore<br>
&nbsp;&nbsp;&nbsp;&nbsp;could&nbsp;not&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;establish&nbsp;a&nbsp;secure&nbsp;connection&nbsp;to&nbsp;it.&nbsp;To&nbsp;learn&nbsp;more&nbsp;about&nbsp;this<br>
&nbsp;&nbsp;&nbsp;&nbsp;situation&nbsp;and&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;how&nbsp;to&nbsp;fix&nbsp;it,&nbsp;please&nbsp;visit&nbsp;the&nbsp;web&nbsp;page&nbsp;mentioned&nbsp;above.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;believe&nbsp;this&nbsp;is&nbsp;because&nbsp;squid&nbsp;first&nbsp;gives&nbsp;200&nbsp;status&nbsp;and&nbsp;hence<br>
&nbsp;&nbsp;&nbsp;&nbsp;browser&nbsp;thinks&nbsp;connection&nbsp;is&nbsp;established&nbsp;expects&nbsp;Google's<br>
&nbsp;&nbsp;&nbsp;&nbsp;certificate.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Can&nbsp;squid&nbsp;not&nbsp;return&nbsp;with&nbsp;302/307&nbsp;on&nbsp;CONNECT&nbsp;HTTPs&nbsp;requests&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;deny_info?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Like&nbsp;instead&nbsp;of&nbsp;HTTP/1.1&nbsp;200&nbsp;Connection&nbsp;established&nbsp;-&nbsp;it&nbsp;returns:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;HTTP/1.1&nbsp;307&nbsp;Redirect&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Location:&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://192.168.1.1/blocked.html&quot;&gt;http://192.168.1.1/blocked.html&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;(...)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;7231&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://tools.ietf.org/html/rfc7231#section-4.3.6&quot;&gt;https://tools.ietf.org/html/rfc7231#section-4.3.6&lt;/a&gt;&nbsp;states<br>
&nbsp;&nbsp;&nbsp;&nbsp;that:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;newpage&quot;&gt;<br>
Any&nbsp;response&nbsp;other&nbsp;than&nbsp;a&nbsp;successful&nbsp;response<br>
&nbsp;&nbsp;&nbsp;indicates&nbsp;that&nbsp;the&nbsp;tunnel&nbsp;has&nbsp;not&nbsp;yet&nbsp;been&nbsp;formed&nbsp;and&nbsp;that&nbsp;the<br>
&nbsp;&nbsp;&nbsp;connection&nbsp;remains&nbsp;governed&nbsp;by&nbsp;HTTP.&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;means&nbsp;HTTP/1.1&nbsp;307&nbsp;Redirect&nbsp;should&nbsp;make&nbsp;browser&nbsp;treat<br>
&nbsp;&nbsp;&nbsp;&nbsp;connection&nbsp;as&nbsp;HTTP&nbsp;and&nbsp;hopefully&nbsp;also&nbsp;follow&nbsp;Location.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Any&nbsp;idea?&nbsp;Or&nbsp;any&nbsp;other&nbsp;workaround&nbsp;(except&nbsp;importing&nbsp;squid<br>
&nbsp;&nbsp;&nbsp;&nbsp;certificate)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks&nbsp;and&nbsp;regards,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Amish&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
