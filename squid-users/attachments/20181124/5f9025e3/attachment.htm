<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;No&nbsp;doubt,&nbsp;the&nbsp;connections&nbsp;were&nbsp;really&nbsp;being&nbsp;closed&nbsp;by&nbsp;the&nbsp;proxy<br>
&nbsp;&nbsp;&nbsp;&nbsp;itself,&nbsp;LIKE&nbsp;it&nbsp;was&nbsp;finished&nbsp;sending&nbsp;the&nbsp;request.&nbsp;It&nbsp;was&nbsp;like&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;loop,&nbsp;so&nbsp;it&nbsp;was&nbsp;infinite&nbsp;connections&nbsp;one&nbsp;right&nbsp;after&nbsp;another,&nbsp;but<br>
&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;in&nbsp;parallel..&nbsp;the&nbsp;fin-packets&nbsp;and&nbsp;everything&nbsp;else&nbsp;were&nbsp;&quot;in<br>
&nbsp;&nbsp;&nbsp;&nbsp;order&quot;&nbsp;judgjing&nbsp;by&nbsp;their&nbsp;SEQ&nbsp;values&nbsp;too.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;were&nbsp;other&nbsp;refresh_patterns&nbsp;but&nbsp;none&nbsp;matching&nbsp;it.&nbsp;I&nbsp;didn't<br>
&nbsp;&nbsp;&nbsp;&nbsp;enable&nbsp;debug&nbsp;options&nbsp;but&nbsp;I&nbsp;can&nbsp;try&nbsp;to&nbsp;reproduce&nbsp;it..&nbsp;anyway&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;.conf&nbsp;was&nbsp;like&nbsp;that&nbsp;for&nbsp;years&nbsp;and&nbsp;this&nbsp;was&nbsp;the&nbsp;first&nbsp;time&nbsp;a&nbsp;&quot;loop&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;like&nbsp;this&nbsp;occurred.&nbsp;I&nbsp;upgraded&nbsp;from&nbsp;3.5.27&nbsp;to&nbsp;3.5.28&nbsp;but&nbsp;I&nbsp;think<br>
&nbsp;&nbsp;&nbsp;&nbsp;nothing&nbsp;about&nbsp;this&nbsp;was&nbsp;modified&nbsp;recently,&nbsp;right..?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;know&nbsp;most&nbsp;refresh_pattern&nbsp;options&nbsp;were&nbsp;being&nbsp;ignored/wrong,&nbsp;that's<br>
&nbsp;&nbsp;&nbsp;&nbsp;why&nbsp;I've&nbsp;disabled&nbsp;it&nbsp;altogether,&nbsp;and&nbsp;right&nbsp;after&nbsp;it,&nbsp;the&nbsp;proxy<br>
&nbsp;&nbsp;&nbsp;&nbsp;replied&nbsp;to&nbsp;the&nbsp;client&nbsp;with&nbsp;a&nbsp;TCP_REFRESH_&lt;b&gt;MODIFIED&nbsp;&lt;/b&gt;instead&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;TCP_HIT&nbsp;and&nbsp;the&nbsp;loop&nbsp;was&nbsp;gone.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;remaining&nbsp;options&nbsp;are:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;refresh_pattern&nbsp;.&nbsp;0&nbsp;80%&nbsp;1440&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;reload_into_ims&nbsp;off&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;quick_abort_min&nbsp;0&nbsp;KB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;quick_abort_max&nbsp;0&nbsp;KB&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;quick_abort_pct&nbsp;95&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;no&nbsp;range_offset_limits&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;look&nbsp;how&nbsp;tiny&nbsp;(427&nbsp;bytes)&nbsp;&lt;b&gt;all&nbsp;&lt;/b&gt;the&nbsp;responses&nbsp;were..&nbsp;and&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;HIT&nbsp;for&nbsp;a&nbsp;range&nbsp;request&nbsp;is&nbsp;almost&nbsp;a&nbsp;miracle&nbsp;here..&nbsp;lol&nbsp;(RockStore)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1542994021.243     &nbsp;1&nbsp;10.15.3.137&nbsp;TCP_HIT/206&nbsp;427&nbsp;GET<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&quot;&gt;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;HIER_NONE/-&nbsp;application/x-gzip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1542994021.326     &nbsp;1&nbsp;10.15.3.137&nbsp;TCP_HIT/206&nbsp;427&nbsp;GET<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&quot;&gt;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;HIER_NONE/-&nbsp;application/x-gzip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1542994021.399     &nbsp;2&nbsp;10.15.3.137&nbsp;TCP_HIT/206&nbsp;427&nbsp;GET<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&quot;&gt;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;HIER_NONE/-&nbsp;application/x-gzip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1542994021.514     &nbsp;1&nbsp;10.15.3.137&nbsp;TCP_HIT/206&nbsp;427&nbsp;GET<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&quot;&gt;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;HIER_NONE/-&nbsp;application/x-gzip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1542994021.614     &nbsp;1&nbsp;10.15.3.137&nbsp;TCP_HIT/206&nbsp;427&nbsp;GET<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&quot;&gt;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;HIER_NONE/-&nbsp;application/x-gzip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1542994021.718     &nbsp;1&nbsp;10.15.3.137&nbsp;TCP_HIT/206&nbsp;427&nbsp;GET<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&quot;&gt;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;HIER_NONE/-&nbsp;application/x-gzip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1542994021.824     &nbsp;1&nbsp;10.15.3.137&nbsp;TCP_HIT/206&nbsp;427&nbsp;GET<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&quot;&gt;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;HIER_NONE/-&nbsp;application/x-gzip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1542994021.966     &nbsp;1&nbsp;10.15.3.137&nbsp;TCP_HIT/206&nbsp;427&nbsp;GET<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&quot;&gt;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;HIER_NONE/-&nbsp;application/x-gzip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1542994022.124     &nbsp;1&nbsp;10.15.3.137&nbsp;TCP_HIT/206&nbsp;427&nbsp;GET<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&quot;&gt;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;HIER_NONE/-&nbsp;application/x-gzip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1542994036.811 &nbsp;14390&nbsp;10.15.3.137&nbsp;TCP_REFRESH_MODIFIED/206&nbsp;26733678<br>
&nbsp;&nbsp;&nbsp;&nbsp;GET<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&quot;&gt;http://archive.canonical.com/pool/partner/a/adobe-flashplugin/adobe-flashplugin_20181120.1.orig.tar.gz&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;HIER_DIRECT/91.189.92.150&nbsp;application/x-gzip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-signature&quot;&nbsp;cols=&quot;72&quot;&gt;--&nbsp;<br>
Atenciosamente,<br>
<br>
Heiler&nbsp;Bensimon&nbsp;Bemerguy&nbsp;-&nbsp;CINBESA<br>
Analista&nbsp;de&nbsp;Redes,&nbsp;Wi-Fi,<br>
Virtualização&nbsp;e&nbsp;Serviços&nbsp;Internet<br>
(55)&nbsp;91&nbsp;98151-4894&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;Em&nbsp;24/11/2018&nbsp;03:33,&nbsp;Amos&nbsp;Jeffries<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;escreveu:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:69ff84e0-9dac-c536-a928-431f5a181d5c@treenet.co.nz&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;24/11/18&nbsp;6:28&nbsp;am,&nbsp;Heiler&nbsp;Bemerguy&nbsp;wrote:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Hum,&nbsp;disabling&nbsp;that&nbsp;refresh_pattern&nbsp;and&nbsp;-k&nbsp;reconfigure&nbsp;seems&nbsp;to&nbsp;have<br>
fixed&nbsp;it..&nbsp;but..&nbsp;why?<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;<br>
Something&nbsp;else&nbsp;is&nbsp;going&nbsp;on&nbsp;which&nbsp;is&nbsp;not&nbsp;visible&nbsp;in&nbsp;the&nbsp;details&nbsp;you&nbsp;have<br>
shown.<br>
<br>
&nbsp;-&nbsp;is&nbsp;the&nbsp;TCP&nbsp;connection&nbsp;containing&nbsp;a&nbsp;message&nbsp;pipeline?<br>
&nbsp;if&nbsp;so&nbsp;the&nbsp;data&nbsp;and&nbsp;FIN&nbsp;may&nbsp;be&nbsp;related&nbsp;to&nbsp;a&nbsp;previous&nbsp;response&nbsp;message&nbsp;in<br>
that&nbsp;pipeline.<br>
<br>
&nbsp;-&nbsp;are&nbsp;other&nbsp;refresh&nbsp;patterns&nbsp;being&nbsp;used&nbsp;(probably&nbsp;yes)&nbsp;?<br>
&nbsp;&nbsp;-&nbsp;what&nbsp;are&nbsp;they?&nbsp;(before&nbsp;and&nbsp;after&nbsp;the&nbsp;change)<br>
<br>
&nbsp;-&nbsp;what&nbsp;did&nbsp;your&nbsp;cache.log&nbsp;have&nbsp;to&nbsp;say&nbsp;at&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;connection<br>
termination?&nbsp;(may&nbsp;need&nbsp;debug&nbsp;level&nbsp;2&nbsp;or&nbsp;5&nbsp;enabled)<br>
<br>
<br>
Also,&nbsp;you&nbsp;were&nbsp;using&nbsp;override-*&nbsp;and&nbsp;ignore-*&nbsp;settings&nbsp;in&nbsp;that<br>
refresh_pattern&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary&nbsp;for&nbsp;the&nbsp;Debian/Ubuntu&nbsp;servers.<br>
<br>
&nbsp;At&nbsp;best&nbsp;they&nbsp;will&nbsp;be&nbsp;doing&nbsp;nothing&nbsp;to&nbsp;these&nbsp;responses&nbsp;(ie<br>
ignore-no-store,&nbsp;ignore-private&nbsp;do&nbsp;nothing&nbsp;to&nbsp;Debian/Ubuntu&nbsp;responses).<br>
<br>
&nbsp;Some&nbsp;will&nbsp;be&nbsp;causing&nbsp;*worse*&nbsp;caching&nbsp;service&nbsp;from&nbsp;the&nbsp;proxy.<br>
override-lastmod&nbsp;with&nbsp;your&nbsp;small&nbsp;[84&nbsp;day]&nbsp;expiry&nbsp;vastly&nbsp;reduces&nbsp;the<br>
_years_&nbsp;these&nbsp;objects&nbsp;can&nbsp;actually&nbsp;be&nbsp;cached&nbsp;for,&nbsp;and&nbsp;prevents&nbsp;IMS<br>
revalidation&nbsp;being&nbsp;used&nbsp;to&nbsp;determine&nbsp;changes&nbsp;properly&nbsp;and&nbsp;store<br>
un-changed&nbsp;things&nbsp;longer.&nbsp;NP:&nbsp;Debian/Ubuntu&nbsp;official&nbsp;repositories&nbsp;do<br>
fully&nbsp;support&nbsp;IMS&nbsp;revalidation.<br>
<br>
<br>
Amos<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>
<br>

</tt>
