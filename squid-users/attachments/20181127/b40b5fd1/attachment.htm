<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;folks,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;First&nbsp;off,&nbsp;I&#39;ll&nbsp;make&nbsp;the&nbsp;requisite&nbsp;disclaimer&nbsp;that&nbsp;I&#39;m&nbsp;a&nbsp;squid&nbsp;newbie.&nbsp;I&#39;ve&nbsp;been&nbsp;banging&nbsp;my&nbsp;head&nbsp;against&nbsp;this&nbsp;problem&nbsp;for&nbsp;nearly&nbsp;a&nbsp;week--trial&nbsp;and&nbsp;error,&nbsp;google&nbsp;searches,&nbsp;FAQ&nbsp;reviews,&nbsp;etc.&nbsp;Like&nbsp;Obi-Wan&nbsp;Kenobi,&nbsp;you&nbsp;guys&nbsp;are&nbsp;my&nbsp;last&nbsp;resort!&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;deployment&nbsp;in&nbsp;AWS&nbsp;in&nbsp;where&nbsp;a&nbsp;VPC&nbsp;has&nbsp;a&nbsp;transparent&nbsp;proxy&nbsp;deployed,&nbsp;which&nbsp;forwards&nbsp;80/443&nbsp;requests&nbsp;to&nbsp;a&nbsp;parent&nbsp;proxy&nbsp;in&nbsp;another&nbsp;VPC,&nbsp;which&nbsp;I&nbsp;then&nbsp;need&nbsp;to&nbsp;forward&nbsp;to&nbsp;another&nbsp;parent&nbsp;proxy&nbsp;(SaaS&nbsp;provider).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Essentially:&lt;/div&gt;&lt;div&gt;[[Client&nbsp;PC]]&nbsp;--&gt;&nbsp;[[Squid&nbsp;Proxy&nbsp;(10.52.0.20)]]&nbsp;--&gt;&nbsp;[[Parent&nbsp;Squid&nbsp;Proxy&nbsp;(10.52.0.168)]]&nbsp;--&gt;&nbsp;[[Parent&nbsp;SaaS&nbsp;Proxy]]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;being&nbsp;done&nbsp;to&nbsp;centralize&nbsp;proxy&nbsp;functions&nbsp;and&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;public&nbsp;IPs&nbsp;that&nbsp;the&nbsp;parent&nbsp;SaaS&nbsp;needs&nbsp;to&nbsp;whitelist.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;getting&nbsp;&quot;Access&nbsp;Denied&quot;&nbsp;messages&nbsp;and&nbsp;a&nbsp;review&nbsp;of&nbsp;Squid&nbsp;Parent&nbsp;proxy&nbsp;access.log shows&nbsp;the&nbsp;following&nbsp;common&nbsp;errors:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;HTTP:&lt;/div&gt;&lt;div&gt;&lt;div&gt;2018/11/27&nbsp;16:22:54&nbsp;kid1|&nbsp;WARNING:&nbsp;Forwarding&nbsp;loop&nbsp;detected&nbsp;for:&lt;/div&gt;&lt;div&gt;GET&nbsp;/&nbsp;HTTP/1.1&lt;/div&gt;&lt;div&gt;Accept:&nbsp;text/html,&nbsp;application/xhtml+xml,&nbsp;image/jxr,&nbsp;*/*&lt;/div&gt;&lt;div&gt;Accept-Language:&nbsp;en-US&lt;/div&gt;&lt;div&gt;User-Agent:&nbsp;Mozilla/5.0&nbsp;(Windows&nbsp;NT&nbsp;10.0;&nbsp;WOW64;&nbsp;Trident/7.0;&nbsp;rv:11.0)&nbsp;like&nbsp;Gecko&lt;/div&gt;&lt;div&gt;Accept-Encoding:&nbsp;gzip,&nbsp;deflate&lt;/div&gt;&lt;div&gt;Cookie:&nbsp;B=8nra62ldvb83a&amp;b=3&amp;s=ik&lt;/div&gt;&lt;div&gt;Via:&nbsp;1.1&nbsp;squid&nbsp;(squid/3.5.27)&lt;/div&gt;&lt;div&gt;X-Forwarded-For:&nbsp;10.184.0.26&lt;/div&gt;&lt;div&gt;Cache-Control:&nbsp;max-age=259200&lt;/div&gt;&lt;div&gt;Connection:&nbsp;keep-alive&lt;/div&gt;&lt;div&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://www.yahoo.com&quot;&gt;www.yahoo.com&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;HTTPS:&lt;/div&gt;&lt;div&gt;2018/11/27&nbsp;16:21:51&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detected&nbsp;on&nbsp;local=&lt;a&nbsp;href=&quot;http://10.52.0.168:8443&quot;&gt;10.52.0.168:8443&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://10.52.0.20:45520&quot;&gt;10.52.0.20:45520&lt;/a&gt;&nbsp;FD&nbsp;15&nbsp;flags=33&nbsp;(intercepted&nbsp;port&nbsp;does&nbsp;not&nbsp;match&nbsp;443)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;2018/11/27&nbsp;16:21:51&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;on&nbsp;URL:&nbsp;&lt;a&nbsp;href=&quot;http://13.82.28.61:443&quot;&gt;13.82.28.61:443&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;are&nbsp;the&nbsp;various&nbsp;squid.conf&nbsp;files&nbsp;and&nbsp;iptables&nbsp;configurations:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[[Transparent&nbsp;Proxy]]:&lt;/div&gt;&lt;div&gt;visible_hostname&nbsp;squid&lt;/div&gt;&lt;div&gt;http_port&nbsp;3129&nbsp;intercept&lt;/div&gt;&lt;div&gt;https_port&nbsp;3130&nbsp;cert=/etc/squid/ssl/squid.pem&nbsp;ssl-bump&nbsp;intercept&lt;/div&gt;&lt;div&gt;acl&nbsp;HTTP_PORT&nbsp;port&nbsp;80&lt;/div&gt;&lt;div&gt;acl&nbsp;HTTPS_PORT&nbsp;port&nbsp;443&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;splice&lt;/div&gt;&lt;div&gt;dns_v4_first&nbsp;on&lt;/div&gt;&lt;div&gt;#cache_peer&nbsp;&lt;a&nbsp;href=&quot;http://proxy.threatpulse.net&quot;&gt;proxy.threatpulse.net&lt;/a&gt;&nbsp;parent&nbsp;8080&nbsp;0&nbsp;name=symantec_http&nbsp;no-query&nbsp;proxy-only&nbsp;default&lt;/div&gt;&lt;div&gt;cache_peer&nbsp;10.52.0.168&nbsp;parent&nbsp;8443&nbsp;0&nbsp;name=symantec_http&nbsp;no-query&nbsp;proxy-only&nbsp;default&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;symantec_http&nbsp;allow&nbsp;HTTP_PORT&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;symantec_http&nbsp;allow&nbsp;HTTPS_PORT&lt;/div&gt;&lt;div&gt;never_direct&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Chain&nbsp;PREROUTING&nbsp;(policy&nbsp;ACCEPT&nbsp;32&nbsp;packets,&nbsp;1704&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;/div&gt;&lt;div&gt; &nbsp; 30 &nbsp;1560&nbsp;REDIRECT &nbsp; tcp &nbsp;-- &nbsp;* &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:80&nbsp;redir&nbsp;ports&nbsp;3129&lt;/div&gt;&lt;div&gt; &nbsp; 89 &nbsp;4628&nbsp;REDIRECT &nbsp; tcp &nbsp;-- &nbsp;* &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:443&nbsp;redir&nbsp;ports&nbsp;3130&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;INPUT&nbsp;(policy&nbsp;ACCEPT&nbsp;131&nbsp;packets,&nbsp;6852&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;OUTPUT&nbsp;(policy&nbsp;ACCEPT&nbsp;660&nbsp;packets,&nbsp;58073&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;POSTROUTING&nbsp;(policy&nbsp;ACCEPT&nbsp;680&nbsp;packets,&nbsp;59113&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;[[Squid&nbsp;Parent&nbsp;Proxy]]:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;visible_hostname&nbsp;squid&lt;/div&gt;&lt;div&gt;http_port&nbsp;3129&nbsp;intercept&lt;/div&gt;&lt;div&gt;https_port&nbsp;3130&nbsp;cert=/etc/squid/ssl/squid.pem&nbsp;ssl-bump&nbsp;intercept&lt;/div&gt;&lt;div&gt;http_port&nbsp;3031&nbsp;cert=/etc/squid/ssl/squid.pem&nbsp;ssl-bump&nbsp;intercept&lt;/div&gt;&lt;div&gt;acl&nbsp;HTTP_PORT&nbsp;port&nbsp;80&lt;/div&gt;&lt;div&gt;acl&nbsp;HTTPS_PORT&nbsp;port&nbsp;443&lt;/div&gt;&lt;div&gt;acl&nbsp;FORWARD_PORT&nbsp;port&nbsp;8443&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;splice&lt;/div&gt;&lt;div&gt;cache_peer&nbsp;&lt;a&nbsp;href=&quot;http://proxy.threatpulse.net&quot;&gt;proxy.threatpulse.net&lt;/a&gt;&nbsp;parent&nbsp;8080&nbsp;0&nbsp;name=symantec_http&nbsp;no-query&nbsp;proxy-only&nbsp;default&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;symantec_http&nbsp;allow&nbsp;HTTP_PORT&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;symantec_http&nbsp;allow&nbsp;HTTPS_PORT&lt;/div&gt;&lt;div&gt;cache_peer_access&nbsp;symantec_http&nbsp;allow&nbsp;FORWARD_PORT&lt;/div&gt;&lt;div&gt;never_direct&nbsp;allow&nbsp;all&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Chain&nbsp;PREROUTING&nbsp;(policy&nbsp;ACCEPT&nbsp;0&nbsp;packets,&nbsp;0&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;0 &nbsp; &nbsp; 0&nbsp;REDIRECT &nbsp; tcp &nbsp;-- &nbsp;* &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:80&nbsp;redir&nbsp;ports&nbsp;3129&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;0 &nbsp; &nbsp; 0&nbsp;REDIRECT &nbsp; tcp &nbsp;-- &nbsp;* &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:443&nbsp;redir&nbsp;ports&nbsp;3130&lt;/div&gt;&lt;div&gt; &nbsp; 35 &nbsp;2100&nbsp;REDIRECT &nbsp; tcp &nbsp;-- &nbsp;* &nbsp; &nbsp; &nbsp;* &nbsp; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:8443&nbsp;redir&nbsp;ports&nbsp;3031&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;INPUT&nbsp;(policy&nbsp;ACCEPT&nbsp;35&nbsp;packets,&nbsp;2100&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;OUTPUT&nbsp;(policy&nbsp;ACCEPT&nbsp;2&nbsp;packets,&nbsp;121&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Chain&nbsp;POSTROUTING&nbsp;(policy&nbsp;ACCEPT&nbsp;2&nbsp;packets,&nbsp;121&nbsp;bytes)&lt;/div&gt;&lt;div&gt; pkts&nbsp;bytes&nbsp;target &nbsp; &nbsp; prot&nbsp;opt&nbsp;in &nbsp; &nbsp; out &nbsp; &nbsp; source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;---&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;thoughts&nbsp;or&nbsp;suggestions&nbsp;are&nbsp;greatly&nbsp;appreciated.&nbsp;Thanks&nbsp;for&nbsp;your&nbsp;time!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-Phillip&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
