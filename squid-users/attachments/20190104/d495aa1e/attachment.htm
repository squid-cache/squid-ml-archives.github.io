<tt>
&lt;!DOCTYPE&nbsp;html&gt;&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;/&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;data-html-editor-font-wrapper=&quot;true&quot;&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;13px;&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;font-size:&nbsp;13px&quot;&gt;&nbsp;&lt;br&gt;Hi&nbsp;all,&lt;br&gt;&lt;br&gt;i&nbsp;am&nbsp;trying&nbsp;to&nbsp;solve&nbsp;the&nbsp;problem,&nbsp;that&nbsp;SQUID&nbsp;is&nbsp;caching&nbsp;all&nbsp;the&nbsp;big&nbsp;files&nbsp;(for&nbsp;example&nbsp;1GB)&nbsp;before&nbsp;sending&nbsp;them&nbsp;to&nbsp;the&nbsp;client,&nbsp;but&nbsp;the&nbsp;connected&nbsp;ICAP&nbsp;virus&nbsp;scanner&nbsp;is&nbsp;configured&nbsp;with&nbsp;max_file_size&nbsp;2MB&nbsp;and&nbsp;scan_timeout&nbsp;5&nbsp;seconds.&nbsp;So&nbsp;all&nbsp;bigger&nbsp;files,&nbsp;or&nbsp;longer&nbsp;scanning&nbsp;times,&nbsp;should&nbsp;result&nbsp;in&nbsp;&quot;clean&quot;&nbsp;state&nbsp;from&nbsp;the&nbsp;icap&nbsp;virus&nbsp;scanner.&lt;br&gt;&lt;br&gt;I&nbsp;am&nbsp;running&nbsp;antivirus&nbsp;FSIGK&nbsp;(F-Secure&nbsp;Internet&nbsp;GateKeeper)&nbsp;as&nbsp;an&nbsp;ICAP&nbsp;daemon&nbsp;connected&nbsp;to&nbsp;Squid&nbsp;with&nbsp;this&nbsp;configuration:&lt;br&gt;&lt;br&gt;#ICAP&lt;br&gt;icap_enable&nbsp;on&lt;br&gt;acl&nbsp;domains_dont_icapscan&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid/ka/domains_dont_icapscan.acl&quot;&lt;br&gt;acl&nbsp;audio&nbsp;rep_mime_type&nbsp;-i&nbsp;^(audio\/x-mpegurl|audio\/mpeg|audio\/ogg|audio\/aac|audio/mp3)$&lt;br&gt;&lt;br&gt;icap_service&nbsp;service_req&nbsp;reqmod_precache&nbsp;bypass=1&nbsp;icap://127.0.0.1:1344/request&lt;br&gt;adaptation_access&nbsp;service_req&nbsp;allow&nbsp;!domains_dont_icapscan&lt;br&gt;icap_service&nbsp;service_resp&nbsp;respmod_precache&nbsp;bypass=1&nbsp;icap://127.0.0.1:1344/response&lt;br&gt;adaptation_access&nbsp;service_resp&nbsp;allow&nbsp;!domains_dont_icapscan&nbsp;!audio&lt;br&gt;&lt;br&gt;Detecting&nbsp;viruses&nbsp;is&nbsp;working,&nbsp;but&nbsp;downloading&nbsp;large&nbsp;files&nbsp;is&nbsp;a&nbsp;huge&nbsp;problem.&nbsp;Squid&nbsp;is&nbsp;downloading&nbsp;them&nbsp;completely&nbsp;first&nbsp;into&nbsp;the&nbsp;servers&nbsp;memory&nbsp;and&nbsp;caching&nbsp;them,&nbsp;before&nbsp;sending&nbsp;them&nbsp;to&nbsp;the&nbsp;client.&nbsp;Its&nbsp;not&nbsp;stop&nbsp;scanning&nbsp;&amp;&nbsp;caching&nbsp;after&nbsp;2MB/5Seconds.&nbsp;When&nbsp;downloading&nbsp;big&nbsp;files&nbsp;(f.e.&nbsp;1gb)&nbsp;the&nbsp;browser&nbsp;just&nbsp;does&nbsp;nothing&nbsp;but&nbsp;waiting&nbsp;a&nbsp;long&nbsp;time,&nbsp;because&nbsp;squid&nbsp;is&nbsp;downloading&nbsp;and&nbsp;caching&nbsp;1gb&nbsp;before&nbsp;forward&nbsp;to&nbsp;client.&lt;br&gt;&lt;br&gt;I&nbsp;tried&nbsp;change&nbsp;respmod_precache&nbsp;to&nbsp;respmod_postcache&nbsp;but&nbsp;it&nbsp;seems&nbsp;not&nbsp;to&nbsp;be&nbsp;implemented&nbsp;yet,&nbsp;with&nbsp;respmod_postcache&nbsp;fsigk&nbsp;icap&nbsp;log&nbsp;is&nbsp;empty&nbsp;,&nbsp;no&nbsp;virus&nbsp;detection&nbsp;works&nbsp;anymore.&lt;br&gt;I&nbsp;have&nbsp;a&nbsp;test-virus-file&nbsp;with&nbsp;100MB&nbsp;(&lt;a&nbsp;rel=&quot;external&nbsp;nofollow&nbsp;noopener&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&nbsp;tabindex=&quot;-1&quot;&nbsp;href=&quot;https://schroeffu.ch/100mbrandomvirus_begin.txt&quot;&gt;https://schroeffu.ch/100mbrandomvirus_begin.txt&lt;/a&gt;&nbsp;eicar+randomcontent)&nbsp;and&nbsp;the&nbsp;virus&nbsp;is&nbsp;detected&nbsp;by&nbsp;fsigk&nbsp;with&nbsp;settings&nbsp;max_scan_size=104400136&nbsp;/&nbsp;scan_timeout=9000&nbsp;,&nbsp;change&nbsp;them&nbsp;to&nbsp;max_scan_size=2147483&nbsp;(2mb)&nbsp;and&nbsp;scan_timeout=5&nbsp;(5Seconds)&nbsp;the&nbsp;virus&nbsp;is&nbsp;correctly&nbsp;not&nbsp;detected&nbsp;anymore,&nbsp;but,&nbsp;squid&nbsp;still&nbsp;does&nbsp;cache&nbsp;the&nbsp;100mb&nbsp;before&nbsp;sending&nbsp;to&nbsp;the&nbsp;client.&lt;br&gt;&lt;br&gt;How&nbsp;can&nbsp;I&nbsp;configure&nbsp;the&nbsp;ICAP&nbsp;Service&nbsp;to&nbsp;truly&nbsp;let&nbsp;bigger&nbsp;files/longer&nbsp;scan&nbsp;times&nbsp;through&nbsp;the&nbsp;icap&nbsp;service&nbsp;marked&nbsp;as&nbsp;&quot;clean&quot;?&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;any&nbsp;help!&lt;br&gt;Schroeffu&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;<br>

</tt>
