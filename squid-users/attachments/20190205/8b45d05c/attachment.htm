<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&gt;<br>
<br>
<br>
<br>
<br>
<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;Dear&nbsp;Amos,&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;time&nbsp;and&nbsp;response.&nbsp;I&nbsp;have&nbsp;changed&nbsp;the&nbsp;configuration&nbsp;to&nbsp;the&nbsp;below.&nbsp;I&nbsp;believe&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;is&nbsp;not&nbsp;using&nbsp;SSL/TLS.&nbsp;I&nbsp;do&nbsp;not&nbsp;see&nbsp;the&nbsp;Hello&nbsp;error&nbsp;message&nbsp;any&nbsp;longer&nbsp;(&nbsp;I&nbsp;hope). &nbsp;I&nbsp;have&nbsp;not&nbsp;used&nbsp;your&nbsp;proposed&nbsp;localnet&nbsp;as&nbsp;I&nbsp;just&nbsp;saw&nbsp;your&nbsp;email,&nbsp;at&nbsp;the&nbsp;time&nbsp;being,&nbsp;the&nbsp;ACL&nbsp;is&nbsp;quite&nbsp;open&nbsp;as&nbsp;I&nbsp;am&nbsp;still&nbsp;troubleshooting,&nbsp;will&nbsp;tighten&nbsp;it&nbsp;when&nbsp;I&nbsp;am&nbsp;comfortable&nbsp;with&nbsp;a&nbsp;final&nbsp;config.&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;-&nbsp;for&nbsp;the&nbsp;&#39;never&nbsp;direct&#39;,&nbsp;are&nbsp;you&nbsp;suggesting&nbsp;I&nbsp;use&nbsp;&#39;never&nbsp;direct&nbsp;deny&nbsp;localnet&#39;?&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;by&nbsp;the&nbsp;way,&nbsp;my&nbsp;final&nbsp;goal&nbsp;is&nbsp;to&nbsp;enable&nbsp;https&nbsp;traffic&nbsp;through,&nbsp;not&nbsp;really&nbsp;intercept&nbsp;it,&nbsp;by&nbsp;trial&nbsp;and&nbsp;error&nbsp;and&nbsp;reading&nbsp;the&nbsp;mailing&nbsp;list,&nbsp;that&nbsp;config&nbsp;below&nbsp;is&nbsp;what&nbsp;seems&nbsp;to&nbsp;be&nbsp;working&nbsp;for&nbsp;me&nbsp;right&nbsp;now,&nbsp;can&nbsp;not&nbsp;confirm&nbsp;totally&nbsp;as&nbsp;parent&nbsp;proxy&nbsp;is&nbsp;not&nbsp;under&nbsp;my&nbsp;control,&nbsp;nor&nbsp;is&nbsp;the&nbsp;appliance,&nbsp;however&nbsp;from&nbsp;the&nbsp;access.log&nbsp;and&nbsp;system&nbsp;message&nbsp;logs,&nbsp;things&nbsp;look&nbsp;better&nbsp;than&nbsp;earlier. &nbsp;what&nbsp;is&nbsp;the&nbsp;best&nbsp;resource&nbsp;to&nbsp;understand&nbsp;the&nbsp;peek&nbsp;and&nbsp;splice,&nbsp;any&nbsp;good&nbsp;places&nbsp;other&nbsp;than&nbsp;squid&nbsp;cache&nbsp;main&nbsp;url?&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;I&nbsp;did&nbsp;get&nbsp;a&nbsp;couple&nbsp;of&nbsp;new&nbsp;errors,&nbsp;have&nbsp;not&nbsp;worked&nbsp;on&nbsp;them,&nbsp;I&nbsp;might&nbsp;have&nbsp;some&nbsp;clues.&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt; &nbsp;1- &lt;span&nbsp;style=&quot;font-family:Arial,Helvetica,sans-serif;font-size:small;color:rgb(34,34,34)&quot;&gt;squid[192090]:&nbsp;SECURITY&nbsp;ALERT:&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detected&nbsp;on&nbsp;local=&lt;/span&gt;&lt;a&nbsp;href=&quot;http://52.138.216.83:443/&quot;&nbsp;target=&quot;_blank&quot;&nbsp;style=&quot;font-family:Arial,Helvetica,sans-serif;font-size:small&quot;&gt;52.138.216.83:443&lt;/a&gt;&lt;span&nbsp;style=&quot;font-family:Arial,Helvetica,sans-serif;font-size:small;color:rgb(34,34,34)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:Arial,Helvetica,sans-serif;font-size:small;color:rgb(34,34,34)&quot;&gt;remote=192&lt;/span&gt;&lt;a&nbsp;href=&quot;http://10.8.103.4:1384/&quot;&nbsp;target=&quot;_blank&quot;&nbsp;style=&quot;font-family:Arial,Helvetica,sans-serif;font-size:small&quot;&gt;.168.3.4:1384&lt;/a&gt;&lt;span&nbsp;style=&quot;font-family:Arial,Helvetica,sans-serif;font-size:small;color:rgb(34,34,34)&quot;&gt; &lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:Arial,Helvetica,sans-serif;font-size:small;color:rgb(34,34,34)&quot;&gt;FD&nbsp;50&nbsp;flags=33&nbsp;(local&nbsp;IP&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;domain&nbsp;IP)&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;line-height:normal&quot;&gt;&lt;font&nbsp;color=&quot;#454545&quot;&nbsp;face=&quot;Helvetica&nbsp;Neue&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12px&quot;&gt; &nbsp; &nbsp; &nbsp; I&nbsp;believe&nbsp;this&nbsp;is&nbsp;covered&nbsp;in&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery&quot;&gt;https://wiki.squid-cache.org/KnowledgeBase/HostHeaderForgery&lt;/a&gt;&lt;/span&gt;&lt;/font&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt; &nbsp; 2- &lt;span&nbsp;style=&quot;font-family:Arial,Helvetica,sans-serif;font-size:small;color:rgb(34,34,34)&quot;&gt;temporary&nbsp;disabling&nbsp;(Unauthorized)&nbsp;digest&nbsp;from &lt;/span&gt;192.168.4.22&lt;/p&gt; &nbsp; &nbsp; &nbsp; &nbsp;wondering&nbsp;if&nbsp; I&nbsp;should&nbsp;add&nbsp;&#39;always_direct&nbsp;deny&nbsp;all&#39;&nbsp; and&nbsp;&#39;&nbsp;nonhierarchical_direct&nbsp;off&#39;?&lt;br&gt;&lt;br&gt;&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;####&nbsp;&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp;&lt;/span&gt;Anonymous&nbsp;access&nbsp;to&nbsp;parent&nbsp;proxy&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;#forwarded_for&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp;&lt;/span&gt;delete&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;#request_header_access&nbsp;Surrogate-Capability&nbsp;deny&nbsp;all&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p2&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69);min-height:14px&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p2&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69);min-height:14px&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;dns_v4_first&nbsp;on&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;cache_peer&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp;&lt;/span&gt;192.168.4.22&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp;&lt;/span&gt;parent&nbsp;9090&nbsp;0&nbsp;no-query&nbsp;#sslcapath=/etc/pki/ca-trust/source/anchors/  &lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;acl&nbsp;local-network&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://azcompany.com&quot;&gt;azcompany.com&lt;/a&gt; &nbsp; #&nbsp;tighten&nbsp;after&nbsp;finalizng&nbsp;troubleshooting,&nbsp;maybe&nbsp;replace&nbsp;with&nbsp;localnet&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;http_access&nbsp;allow&nbsp;all&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;never_direct&nbsp;deny&nbsp;local-network &nbsp; &nbsp;#&nbsp;revisit&nbsp;not&nbsp;using&nbsp;DNS&nbsp;for&nbsp;resolution&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;never_direct&nbsp;allow&nbsp;all &nbsp;  &lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;http_port&nbsp;8080&nbsp;intercept&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;#&nbsp;should&nbsp;I&nbsp;really&nbsp;use&nbsp;intercept&nbsp;in&nbsp;here?&nbsp;can&nbsp;I&nbsp;get&nbsp;away&nbsp;without&nbsp;it&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;https_port&nbsp;8090&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp;&lt;/span&gt;cert=/etc/squid/ssl_certs/bccaz01CA.pem&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp;&lt;/span&gt;dynamic_cert_mem_cache_size=16MB&nbsp;#connection-auth=off&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;http_port&nbsp;8100&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp; &nbsp;&lt;/span&gt;#forward&nbsp;port&nbsp;not&nbsp;used,&nbsp;only&nbsp;for&nbsp;troubleshooting.&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p2&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69);min-height:14px&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;sslcrtd_program&nbsp;/usr/lib64/squid/security_file_certgen&nbsp;-s&nbsp;/var/spool/squid/ssl_db&nbsp;-M&nbsp;4MB&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p2&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69);min-height:14px&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;acl&nbsp;azure_sites&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp;&lt;/span&gt;dstdom_regex&nbsp;&lt;a&nbsp;href=&quot;http://microsoft.com&quot;&gt;microsoft.com&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://azure.com&quot;&gt;azure.com&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://azureedge.net&quot;&gt;azureedge.net&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://microsoftazurestack.com&quot;&gt;microsoftazurestack.com&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://trafficmanager.net&quot;&gt;trafficmanager.net&lt;/a&gt;&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;http://wdcp.microsoft.com&quot;&gt;wdcp.microsoft.com&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://wdcpalt.microsoft.com&quot;&gt;wdcpalt.microsoft.com&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://updates.microsoft.com&quot;&gt;updates.microsoft.com&lt;/a&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;acl&nbsp;azure_sites2&nbsp;dstdom_regex&nbsp;&lt;a&nbsp;href=&quot;http://download.microsoft.com&quot;&gt;download.microsoft.com&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://msdl.microsoft.com&quot;&gt;msdl.microsoft.com&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://crl.microsoft.com&quot;&gt;crl.microsoft.com&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;http://secure.aadcdn.microsoftonline-p.com&quot;&gt;secure.aadcdn.microsoftonline-p.com&lt;/a&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;ssl_bump&nbsp;splice&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp;&lt;/span&gt;azure_sites&nbsp;azure_sites2&nbsp;#Avoid&nbsp;bumping&nbsp;Microsoft/Azure&nbsp;related&nbsp;sites&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p2&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69);min-height:14px&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;sslproxy_cert_error&nbsp;allow&nbsp;azure_sites&nbsp;azure_sites2 &nbsp; &nbsp; #&nbsp;is&nbsp;there&nbsp;a&nbsp;better&nbsp;way&nbsp;to&nbsp;handle&nbsp;these&nbsp;and&nbsp;log&nbsp;them?&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p2&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69);min-height:14px&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;color:rgb(69,69,69)&quot;&gt;debug_options&lt;span&nbsp;class=&quot;gmail-Apple-converted-space&quot;&gt; &nbsp;&lt;/span&gt;ALL,9&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Tue,&nbsp;5&nbsp;Feb&nbsp;2019&nbsp;at&nbsp;09:25,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;[&nbsp;Rules&nbsp;horribly&nbsp;mangled&nbsp;by&nbsp;sending&nbsp;a&nbsp;web&nbsp;page&nbsp;to&nbsp;a&nbsp;plain-text&nbsp;mailing&lt;br&gt;<br>
list.&nbsp;I&nbsp;have&nbsp;fixed&nbsp;some&nbsp;where&nbsp;I&nbsp;replied,&nbsp;but&nbsp;not&nbsp;all.&nbsp;]&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;5/02/19&nbsp;4:07&nbsp;am,&nbsp;Walid&nbsp;A.&nbsp;Shaari&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hello,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;a&nbsp;squid&nbsp;proxy,&nbsp;trying&nbsp;to&nbsp;configure&nbsp;it&nbsp;to&nbsp;enforce&nbsp;traffic&nbsp;from&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;private&nbsp;cloud&nbsp;appliance&nbsp;(Azure&nbsp;Stack)&nbsp;to&nbsp;go&nbsp;over&nbsp;to&nbsp;the&nbsp;corporate&nbsp;proxy.&lt;br&gt;<br>
&gt;&nbsp;traffic&nbsp;is&nbsp;mostly&nbsp;https,&nbsp;I&nbsp;see&nbsp;the&nbsp;below&nbsp;errors,&nbsp;note&lt;br&gt;<br>
&gt;&nbsp;that ParentProxy-22&nbsp;is&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;listening&nbsp;on&nbsp;port&nbsp;9090.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt; &nbsp;also,&lt;br&gt;<br>
&gt;&nbsp;why&nbsp;in&nbsp;the&nbsp;access&nbsp;logs&nbsp;I&nbsp;have&nbsp;some&nbsp;entries&nbsp;not&nbsp;going&nbsp;to&nbsp;parent&nbsp;proxy &lt;br&gt;<br>
&gt;&nbsp; (e.g. 1549282865.527&nbsp;13&nbsp;192.168.3.10&nbsp;NONE/200&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;CONNECT &lt;a&nbsp;href=&quot;http://52.138.216.83:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;52.138.216.83:443&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://52.138.216.83:443/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://52.138.216.83:443/&lt;/a&gt;&gt; -&nbsp;HIER_NONE/-&nbsp;-)&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Some&nbsp;transactions&nbsp;do&nbsp;not&nbsp;need&nbsp;server&nbsp;contact.&nbsp;The&nbsp;above&nbsp;&quot;CONNECT&quot;&nbsp;with&lt;br&gt;<br>
raw-IP:port,&nbsp;&quot;NONE&quot;&nbsp;status&nbsp;type,&nbsp;&quot;NONE&quot;&nbsp;peer&nbsp;type&nbsp;and&nbsp;0&nbsp;byte&nbsp;size&nbsp;is&lt;br&gt;<br>
what&nbsp;gets&nbsp;logged&nbsp;for&nbsp;the&nbsp;SSL-Bump&nbsp;step-1&nbsp;interaction&nbsp;when&nbsp;only&nbsp;a&nbsp;TCP&nbsp;SYN&lt;br&gt;<br>
packet&nbsp;has&nbsp;actually&nbsp;happened.&lt;br&gt;<br>
&lt;br&gt;<br>
NP:&nbsp;Each&nbsp;step&nbsp;of&nbsp;SSL-Bump&nbsp;process&nbsp;has&nbsp;a&nbsp;separate&nbsp;log&nbsp;entry&nbsp;with&lt;br&gt;<br>
incrementally&nbsp;more&nbsp;data&nbsp;up&nbsp;to&nbsp;the&nbsp;one&nbsp;with&nbsp;a&nbsp;&#39;final&#39;&nbsp;result&nbsp;which&lt;br&gt;<br>
instead&nbsp;logs&nbsp;the&nbsp;decrypted&nbsp;transactions&nbsp;or&nbsp;the&nbsp;error.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;###&nbsp;error&nbsp;logs&nbsp;###Feb&nbsp;4&nbsp;15:26:38&nbsp;azproxy&nbsp;squid[192272]:&nbsp;TCP&nbsp;connection&lt;br&gt;<br>
&gt;&nbsp;to&nbsp;ParentProxy-22/9090&nbsp;failed &lt;br&gt;<br>
&gt;&nbsp;Feb&nbsp;4&nbsp;15:26:38&nbsp;azproxy&nbsp;squid[192272]:&nbsp;Error&nbsp;parsing&nbsp;SSL&nbsp;Server&nbsp;Hello&lt;br&gt;<br>
&gt;&nbsp;Message&nbsp;on&nbsp;FD&nbsp;20 &lt;br&gt;<br>
&gt;&nbsp;Feb&nbsp;4&nbsp;15:26:38&nbsp;azproxy&nbsp;squid[192272]:&nbsp;ERROR:&nbsp;negotiating&nbsp;TLS&nbsp;on&nbsp;FD&nbsp;20:&lt;br&gt;<br>
&gt;&nbsp;error:140770FC:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:unknown&nbsp;protocol&lt;br&gt;<br>
&gt;&nbsp;(1/-1/0)&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;OpenSSL&nbsp;library&nbsp;on&nbsp;your&nbsp;proxy&nbsp;machine&nbsp;does&nbsp;not&nbsp;understand&nbsp;the&lt;br&gt;<br>
protocol&nbsp;that&nbsp;it&nbsp;is&nbsp;receiving&nbsp;in&nbsp;the&nbsp;supposedly&nbsp;TLS&nbsp;/&nbsp;HTTPS&nbsp;traffic.&lt;br&gt;<br>
&lt;br&gt;<br>
Usually&nbsp;seeing&nbsp;this&nbsp;on&nbsp;peer&nbsp;connections&nbsp;means&nbsp;the&nbsp;peer&nbsp;is&nbsp;*not*&nbsp;a&nbsp;TLS&lt;br&gt;<br>
explicit&nbsp;proxy,&nbsp;nor&nbsp;HTTPS&nbsp;/&nbsp;TLS&nbsp;origin&nbsp;server.&nbsp;Such&nbsp;things&nbsp;respond&nbsp;in&lt;br&gt;<br>
their&nbsp;actual&nbsp;protocol&nbsp;with&nbsp;an&nbsp;error&nbsp;-&gt;&nbsp;OpenSSL&nbsp;displays&nbsp;that&nbsp;message.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
...&gt;&lt;br&gt;<br>
&gt;&nbsp;cache_peer&nbsp;ParentProxy-22&nbsp;parent&nbsp;9090&nbsp;0&nbsp;no-query&lt;br&gt;<br>
&gt;&nbsp;sslcapath=/etc/pki/ca-trust/source/anchors/&lt;br&gt;<br>
&lt;br&gt;<br>
Two&nbsp;things&nbsp;of&nbsp;note:&lt;br&gt;<br>
&lt;br&gt;<br>
1)&nbsp;as&nbsp;above,&nbsp;does&nbsp;this&nbsp;peer&nbsp;*actually*&nbsp;support&nbsp;TLS&nbsp;connections&nbsp;on&nbsp;its&lt;br&gt;<br>
port&nbsp;9090?&lt;br&gt;<br>
 Native&nbsp;TLS&nbsp;connections,&nbsp;not&nbsp;HTTP&nbsp;Upgrade&nbsp;or&nbsp;anything&nbsp;like&nbsp;that.&lt;br&gt;<br>
&lt;br&gt;<br>
2)&nbsp;That&nbsp;sslcapath=&nbsp;is&nbsp;providing&nbsp;an&nbsp;entire&nbsp;set&nbsp;of&nbsp;CA&#39;s.&nbsp;Any&nbsp;given&nbsp;server&lt;br&gt;<br>
typically&nbsp;has&nbsp;one&nbsp;certificate,&nbsp;signed&nbsp;by&nbsp;one&nbsp;CA.&nbsp;So&nbsp;it&nbsp;is&nbsp;rare&nbsp;that&nbsp;you&lt;br&gt;<br>
would&nbsp;need&nbsp;an&nbsp;entire&nbsp;set&nbsp;of&nbsp;CA&#39;s&nbsp;to&nbsp;be&nbsp;trusted&nbsp;by&nbsp;this&nbsp;proxy.&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;better&nbsp;security&nbsp;you&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;load&nbsp;the&nbsp;specific&nbsp;CA&nbsp;that&nbsp;peer&lt;br&gt;<br>
uses&nbsp;with&nbsp;sslcafile=&nbsp;instead&nbsp;of&nbsp;the&nbsp;whole&nbsp;path.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;local-network&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://azcompany.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;azcompany.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;everything&nbsp;src &lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;10.0.0.0/8&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;everything&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
These&nbsp;are&nbsp;very&nbsp;deceptive.&lt;br&gt;<br>
&lt;br&gt;<br>
 *&nbsp;&quot;everything&quot;&nbsp;is&nbsp;actually&nbsp;a&nbsp;small&nbsp;sub-set&nbsp;of&nbsp;&#39;things&#39;.&lt;br&gt;<br>
&lt;br&gt;<br>
 *&nbsp;&quot;local-network&quot;&nbsp;is&nbsp;not&nbsp;necessarily&nbsp;local.&nbsp;Any&nbsp;IP&nbsp;address&nbsp;with&lt;br&gt;<br>
reverse-DNS&nbsp;configured&nbsp;to&nbsp;claim&nbsp;its&nbsp;name&nbsp;is&nbsp;within&nbsp;*.&lt;a&nbsp;href=&quot;http://azcompany.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;azcompany.com&lt;/a&gt;&nbsp;will&lt;br&gt;<br>
match&nbsp;this&nbsp;ACL&nbsp;regardless&nbsp;of&nbsp;where&nbsp;in&nbsp;the&nbsp;world&nbsp;it&nbsp;actually&nbsp;is.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;default&nbsp;squid.conf&nbsp;defines&nbsp;an&nbsp;ACL&nbsp;&quot;localnet&quot;&nbsp;(Local&nbsp;Network)&nbsp;for&nbsp;the&lt;br&gt;<br>
permitted&nbsp;clients&nbsp;subnet.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;ACL&nbsp;called&nbsp;&quot;all&quot;&nbsp;is&nbsp;provided&nbsp;to&nbsp;match&nbsp;every&nbsp;transaction&nbsp;with&nbsp;a&lt;br&gt;<br>
client&nbsp;IP.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;never_direct&nbsp;deny&nbsp;local-network&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Fine,&nbsp;but&nbsp;why&nbsp;are&nbsp;you&nbsp;waiting&nbsp;until&nbsp;a&nbsp;place&nbsp;(never_direct)&nbsp;where&nbsp;Squid&lt;br&gt;<br>
is&nbsp;unable&nbsp;to&nbsp;wait&nbsp;for&nbsp;results&nbsp;of&nbsp;reverse-DNS&nbsp;lookup?&lt;br&gt;<br>
 That&nbsp;will&nbsp;result&nbsp;in&nbsp;unpredictable&nbsp;non-match&nbsp;occuring&nbsp;whenever&nbsp;DNS&nbsp;TTL&lt;br&gt;<br>
is&nbsp;encountered.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;never_direct&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;8080&nbsp;intercept&lt;br&gt;<br>
&gt;&nbsp;https_port&nbsp;8090&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on&lt;br&gt;<br>
&gt;&nbsp;cert=/etc/squid/ssl_certs/azproxyCA.pem&nbsp;dynamic_cert_mem_cache_size=16MB&lt;br&gt;<br>
&gt;&nbsp;#connection-auth=off&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;8100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #forward&nbsp;port&nbsp;not&nbsp;used.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;sslcrtd_program&nbsp;/usr/lib64/squid/security_file_certgen&nbsp;-s&lt;br&gt;<br>
&gt;&nbsp;/var/spool/squid/ssl_db&nbsp;-M&nbsp;4MB&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;tls_outgoing_options&nbsp;/etc/pki/ca-trust/source/anchors/ca.crt&lt;br&gt;<br>
&lt;br&gt;<br>
Squid&nbsp;should&nbsp;be&nbsp;telling&nbsp;you&nbsp;on&nbsp;startup&nbsp;that&nbsp;there&nbsp;is&nbsp;no&nbsp;valid&nbsp;option&lt;br&gt;<br>
named&nbsp;&quot;/etc/pki/ca-trust/source/anchors/ca.crt&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
 tls_outgoing_options&nbsp;directive&nbsp;takes&nbsp;a&nbsp;set&nbsp;of&nbsp;k=v&nbsp;pairs&nbsp;setting&nbsp;the&lt;br&gt;<br>
options&nbsp;just&nbsp;like&nbsp;http(s)_port&nbsp;and&nbsp;cache_peer.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH&lt;br&gt;<br>
Amos&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
