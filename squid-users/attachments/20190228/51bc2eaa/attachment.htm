<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;When&nbsp;testing&nbsp;like&nbsp;so:&nbsp;openssl&nbsp;s_client&nbsp;-connect&nbsp;&lt;a&nbsp;href=&quot;http://google.com:443&quot;&gt;google.com:443&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;get&nbsp;tls1.2&nbsp;back&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Via&nbsp;mobile&nbsp;chrome&nbsp;browser&nbsp;(android)&nbsp;and&nbsp;the&nbsp;proxy&nbsp;I&nbsp;get&nbsp;tls1.3&lt;br&gt;&lt;/div&gt;&lt;div&gt;Truly&nbsp;don&#39;t&nbsp;understand&nbsp;:)&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-----&nbsp;Some&nbsp;output&nbsp;-----&lt;/div&gt;&lt;div&gt;Service&nbsp;Name:&nbsp;squid&lt;br&gt;This&nbsp;binary&nbsp;uses&nbsp;OpenSSL&nbsp;1.1.1 &nbsp;11&nbsp;Sep&nbsp;2018.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;dpkg&nbsp;--list&nbsp;|grep&nbsp;ssl&lt;br&gt;ii &nbsp;libgnutls-openssl27:amd64            &nbsp;3.6.4-2ubuntu1.1                 &nbsp;amd64       &nbsp;GNU&nbsp;TLS&nbsp;library&nbsp;-&nbsp;OpenSSL&nbsp;wrapper&lt;br&gt;ii &nbsp;libio-socket-ssl-perl                &nbsp;2.060-3                          &nbsp;all         &nbsp;Perl&nbsp;module&nbsp;implementing&nbsp;object&nbsp;oriented&nbsp;interface&nbsp;to&nbsp;SSL&nbsp;sockets&lt;br&gt;ii &nbsp;libnet-smtp-ssl-perl                 &nbsp;1.04-1                           &nbsp;all         &nbsp;Perl&nbsp;module&nbsp;providing&nbsp;SSL&nbsp;support&nbsp;to&nbsp;Net::SMTP&lt;br&gt;ii &nbsp;libnet-ssleay-perl                   &nbsp;1.85-2ubuntu2                    &nbsp;amd64       &nbsp;Perl&nbsp;module&nbsp;for&nbsp;Secure&nbsp;Sockets&nbsp;Layer&nbsp;(SSL)&lt;br&gt;ii &nbsp;libssl-dev:amd64                     &nbsp;1.1.1-1ubuntu2.1                 &nbsp;amd64       &nbsp;Secure&nbsp;Sockets&nbsp;Layer&nbsp;toolkit&nbsp;-&nbsp;development&nbsp;files&lt;br&gt;ii &nbsp;libssl1.0.0:amd64                    &nbsp;1.0.2n-1ubuntu6.2                &nbsp;amd64       &nbsp;Secure&nbsp;Sockets&nbsp;Layer&nbsp;toolkit&nbsp;-&nbsp;shared&nbsp;libraries&lt;br&gt;ii &nbsp;libssl1.1:amd64                      &nbsp;1.1.1-1ubuntu2.1                 &nbsp;amd64       &nbsp;Secure&nbsp;Sockets&nbsp;Layer&nbsp;toolkit&nbsp;-&nbsp;shared&nbsp;libraries&lt;br&gt;ii &nbsp;libxmlsec1-openssl:amd64             &nbsp;1.2.26-3                         &nbsp;amd64       &nbsp;Openssl&nbsp;engine&nbsp;for&nbsp;the&nbsp;XML&nbsp;security&nbsp;library&lt;br&gt;ii &nbsp;libzstd1:amd64                       &nbsp;1.3.5+dfsg-1ubuntu1              &nbsp;amd64       &nbsp;fast&nbsp;lossless&nbsp;compression&nbsp;algorithm&lt;br&gt;ii &nbsp;openssl                              &nbsp;1.1.1-1ubuntu2.1                 &nbsp;amd64       &nbsp;Secure&nbsp;Sockets&nbsp;Layer&nbsp;toolkit&nbsp;-&nbsp;cryptographic&nbsp;utility&lt;br&gt;ii &nbsp;perl-openssl-defaults:amd64          &nbsp;3build1                          &nbsp;amd64       &nbsp;version&nbsp;compatibility&nbsp;baseline&nbsp;for&nbsp;Perl&nbsp;OpenSSL&nbsp;packages&lt;br&gt;ii &nbsp;python3-openssl                      &nbsp;18.0.0-1                         &nbsp;all         &nbsp;Python&nbsp;3&nbsp;wrapper&nbsp;around&nbsp;the&nbsp;OpenSSL&nbsp;library&lt;br&gt;rc &nbsp;ssl-cert                             &nbsp;1.0.39                           &nbsp;all         &nbsp;simple&nbsp;debconf&nbsp;wrapper&nbsp;for&nbsp;OpenSSL&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Thu,&nbsp;Feb&nbsp;28,&nbsp;2019&nbsp;at&nbsp;1:13&nbsp;AM&nbsp;Stilyan&nbsp;Georgiev&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:stilyangeorgiev@gmail.com&quot;&gt;stilyangeorgiev@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;the&nbsp;input&nbsp;Alex.&lt;/div&gt;&lt;div&gt;I&nbsp;had&nbsp;many,&nbsp;many&nbsp;issues&nbsp;compiling&nbsp;openssl&nbsp;without&nbsp;tls1.3.&nbsp;At&nbsp;first&nbsp;i&nbsp;tried&nbsp;doing&nbsp;it&nbsp;side&nbsp;by&nbsp;side&nbsp;with&nbsp;version&nbsp;I&nbsp;had&nbsp;in&nbsp;OS&nbsp;but&nbsp;failed&nbsp;miserably,&nbsp;with&nbsp;squid&nbsp;continuing&nbsp;to&nbsp;use&nbsp;the&nbsp;OS&nbsp;package.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Eventually&nbsp;I&nbsp;release&nbsp;upgraded&nbsp;the&nbsp;OS&nbsp;and&nbsp;now&nbsp;have&nbsp;the&nbsp;1.1.1-1&nbsp;package&nbsp;from&nbsp;repo,&nbsp;rebuilt&nbsp;it&nbsp;with&nbsp;no-tls1_3&nbsp;in&nbsp;CONFARGS&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;to&nbsp;my&nbsp;amazement&nbsp;squid&nbsp;continues&nbsp;serving&nbsp;tls1.3&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;suggestions&nbsp;on&nbsp;to&nbsp;how&nbsp;to&nbsp;allow&nbsp;tls1.1&nbsp;and&nbsp;tls1.2&nbsp;only&nbsp;are&nbsp;very&nbsp;welcome.&nbsp;Maybe&nbsp;tls_outgoing_options&nbsp;cipher=&nbsp;...&nbsp;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance&nbsp;for&nbsp;helping&nbsp;out!&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Tue,&nbsp;Feb&nbsp;26,&nbsp;2019&nbsp;at&nbsp;9:10&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;2/26/19&nbsp;4:55&nbsp;AM,&nbsp;Stilyan&nbsp;Georgiev&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Squid&nbsp;4.5&nbsp;with&nbsp;openssl&nbsp;support&nbsp;here.&lt;br&gt;<br>
&gt;&nbsp;SSL&nbsp;bumping&nbsp;can&#39;t&nbsp;obtain&nbsp;SNI&nbsp;/&nbsp;cert&nbsp;domain&nbsp;to&nbsp;perform&nbsp;filtering&nbsp;when&lt;br&gt;<br>
&gt;&nbsp;tls1.3&nbsp;is&nbsp;used.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;want&nbsp;to&nbsp;disable&nbsp;support&nbsp;for&nbsp;tls1.3&nbsp;in&nbsp;config&nbsp;but&nbsp;don&#39;t&nbsp;find&nbsp;way&nbsp;to&nbsp;do&lt;br&gt;<br>
&gt;&nbsp;so.&nbsp;There&#39;s&nbsp;the&nbsp;outdated&nbsp;sslproxy_options&nbsp;config&nbsp;directive&nbsp;which&nbsp;doesn&#39;t&lt;br&gt;<br>
&gt;&nbsp;appear&nbsp;to&nbsp;be&nbsp;supported&nbsp;in&nbsp;4.5&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;goal&nbsp;is&nbsp;-&nbsp;allow&nbsp;everything&nbsp;,&nbsp;besides&nbsp;tls1.3&lt;br&gt;<br>
&lt;br&gt;<br>
Good&nbsp;question!&lt;br&gt;<br>
&lt;br&gt;<br>
TLS&nbsp;v1.3&nbsp;clients&nbsp;that&nbsp;use&nbsp;&quot;Middlebox&nbsp;Compatibility&nbsp;Mode&quot;,&nbsp;including&lt;br&gt;<br>
OpenSSL&nbsp;s_client&nbsp;and&nbsp;popular&nbsp;browsers,&nbsp;pretend&nbsp;to&nbsp;be&nbsp;TLS&nbsp;v1.2&nbsp;clients&lt;br&gt;<br>
that&nbsp;attempt&nbsp;to&nbsp;restore&nbsp;a&nbsp;non-existent&nbsp;TLS&nbsp;session.&nbsp;Squid&nbsp;probably&nbsp;does&lt;br&gt;<br>
not&nbsp;have&nbsp;ACLs&nbsp;that&nbsp;can&nbsp;detect&nbsp;those&nbsp;lies.&nbsp;However,&nbsp;if&nbsp;you&nbsp;think&nbsp;you&nbsp;can&lt;br&gt;<br>
detect&nbsp;them,&nbsp;you&nbsp;can&nbsp;pass&nbsp;TLS&nbsp;Hello&nbsp;to&nbsp;your&nbsp;external&nbsp;ACL&nbsp;via&nbsp;the&lt;br&gt;<br>
%&gt;handshake&nbsp;logformat&nbsp;code.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;are&nbsp;asking&nbsp;whether&nbsp;Squid&nbsp;can&nbsp;downgrade&nbsp;TLS&nbsp;v1.3&nbsp;to&nbsp;TLS&nbsp;v1.2,&nbsp;then&lt;br&gt;<br>
I&nbsp;suspect&nbsp;the&nbsp;answer&nbsp;is&nbsp;&quot;yes,&nbsp;but&nbsp;only&nbsp;if&nbsp;you&nbsp;bump&nbsp;the&nbsp;client&nbsp;connection&lt;br&gt;<br>
first&quot;:&nbsp;A&nbsp;peeking&nbsp;Squid&nbsp;cannot&nbsp;negotiate&nbsp;a&nbsp;different&nbsp;TLS&nbsp;version&nbsp;with&lt;br&gt;<br>
the&nbsp;client.&nbsp;If&nbsp;TLS&nbsp;downgrade&nbsp;is&nbsp;what&nbsp;you&nbsp;want,&nbsp;you&nbsp;can&nbsp;probably&nbsp;use&nbsp;an&lt;br&gt;<br>
OpenSSL&nbsp;version&nbsp;that&nbsp;does&nbsp;not&nbsp;support&nbsp;TLS&nbsp;v1.3.&nbsp;There&nbsp;may&nbsp;also&nbsp;be&nbsp;an&lt;br&gt;<br>
OpenSSL&nbsp;v1.1.1&nbsp;configuration&nbsp;option&nbsp;to&nbsp;turn&nbsp;TLS&nbsp;v1.3&nbsp;support&nbsp;off,&nbsp;but&nbsp;I&lt;br&gt;<br>
have&nbsp;not&nbsp;research&nbsp;that.&lt;br&gt;<br>
&lt;br&gt;<br>
Finally,&nbsp;there&nbsp;may&nbsp;be&nbsp;a&nbsp;bug&nbsp;in&nbsp;earlier&nbsp;versions&nbsp;of&nbsp;Squid&nbsp;that&nbsp;breaks&lt;br&gt;<br>
peeking&nbsp;at&nbsp;TLS&nbsp;v1.3&nbsp;servers&nbsp;during&nbsp;step2.&nbsp;Staring&nbsp;works.&nbsp;We&nbsp;have&nbsp;not&lt;br&gt;<br>
tested&nbsp;Squid&nbsp;v4.5&nbsp;though.&nbsp;Please&nbsp;note&nbsp;that&nbsp;peeking&nbsp;at&nbsp;TLS&nbsp;v1.3&nbsp;servers&lt;br&gt;<br>
is&nbsp;largely&nbsp;pointless&nbsp;because&nbsp;useful&nbsp;information&nbsp;in&nbsp;TLS&nbsp;v1.3&nbsp;Server&nbsp;Hello&lt;br&gt;<br>
is&nbsp;encrypted.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail-m_1445198318667670190gmail_signature&quot;&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;Yours&nbsp;Sincerely,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;&lt;/font&gt; &lt;/div&gt;&lt;div&gt;&lt;strong&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;Stilyan&nbsp;Georgiev&lt;/font&gt;&lt;/strong&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;Yours&nbsp;Sincerely,&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;&lt;/font&gt; &lt;/div&gt;&lt;div&gt;&lt;strong&gt;&lt;font&nbsp;face=&quot;tahoma,sans-serif&quot;&gt;Stilyan&nbsp;Georgiev&lt;/font&gt;&lt;/strong&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;/div&gt;<br>

</tt>
