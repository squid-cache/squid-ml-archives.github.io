<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&nbsp;/&gt;&lt;/head&gt;&lt;body&nbsp;style='font-size:&nbsp;10pt;&nbsp;font-family:&nbsp;Verdana,Geneva,sans-serif'&gt;<br>
&lt;p&gt;Good&nbsp;morning&nbsp;Alex,&lt;/p&gt;<br>
&lt;p&gt;&lt;br&nbsp;/&gt;&lt;/p&gt;<br>
&lt;p&gt;Thank&nbsp;you&nbsp;so&nbsp;much&nbsp;for&nbsp;your&nbsp;time.&nbsp;Your&nbsp;interpretations&nbsp;I&nbsp;would&nbsp;say&nbsp;are&nbsp;almost&nbsp;exact.&nbsp;I&nbsp;say&nbsp;almost,&nbsp;because&nbsp;I&nbsp;wanted&nbsp;to&nbsp;be&nbsp;a&nbsp;reverse&nbsp;proxy&nbsp;of&nbsp;multiple&nbsp;sites.&nbsp;Not&nbsp;just&nbsp;for&nbsp;the&nbsp;sites&nbsp;you&nbsp;host&nbsp;or&nbsp;similar...&nbsp;And&nbsp;yes&nbsp;I&nbsp;wanted,&nbsp;let's&nbsp;say&nbsp;if&nbsp;all&nbsp;is&nbsp;OK&nbsp;&quot;block&quot;&nbsp;the&nbsp;request&nbsp;by&nbsp;giving&nbsp;a&nbsp;301&nbsp;to&nbsp;directly&nbsp;the&nbsp;site.&nbsp;Yes&nbsp;I&nbsp;know&nbsp;I&nbsp;won't&nbsp;traverse&nbsp;the&nbsp;proxy&nbsp;any&nbsp;more&nbsp;after&nbsp;that&nbsp;BUT&nbsp;I&nbsp;will&nbsp;only&nbsp;go&nbsp;direct&nbsp;if&nbsp;content&nbsp;is&nbsp;clean.&nbsp;If&nbsp;it&nbsp;is&nbsp;not&nbsp;I&nbsp;will&nbsp;receive&nbsp;an&nbsp;error&nbsp;response&nbsp;from&nbsp;the&nbsp;ICAP&nbsp;so&nbsp;all&nbsp;is&nbsp;fine&nbsp;then...&lt;/p&gt;<br>
&lt;p&gt;&lt;br&nbsp;/&gt;&lt;/p&gt;<br>
&lt;p&gt;I'll&nbsp;deeply&nbsp;check&nbsp;your&nbsp;comments&nbsp;and&nbsp;will&nbsp;tell&nbsp;here&nbsp;something&nbsp;:)&lt;/p&gt;<br>
&lt;p&gt;&lt;br&nbsp;/&gt;&lt;/p&gt;<br>
&lt;p&gt;Thank&nbsp;you&nbsp;so&nbsp;much!&lt;/p&gt;<br>
&lt;div&gt;---&lt;br&nbsp;/&gt;<br>
&lt;div&nbsp;class=&quot;firmasarenet&quot;&nbsp;style=&quot;clear:&nbsp;both;&nbsp;text-align:&nbsp;left;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;imgsarenet&quot;&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;10px&nbsp;0;&quot;&gt;&lt;img&nbsp;src=&quot;https://www.sarenet.es/estaticos/LogoSarenetEmails.png?newlogo&quot;&nbsp;alt=&quot;sarenet&quot;&nbsp;/&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;titulosarenet&quot;&nbsp;style=&quot;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-weight:&nbsp;bold;&nbsp;font-size:&nbsp;14px;&nbsp;color:&nbsp;#333333;&quot;&gt;&lt;strong&gt;Egoitz&nbsp;Aurrekoetxea&lt;/strong&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;dptosarenet&quot;&nbsp;style=&quot;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-weight:&nbsp;normal;&nbsp;font-size:&nbsp;12px;&nbsp;color:&nbsp;#333333;&quot;&gt;Dpto.&nbsp;de&nbsp;sistemas&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;textosarenet&quot;&nbsp;style=&quot;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-weight:&nbsp;normal;&nbsp;font-size:&nbsp;12px;&nbsp;color:&nbsp;#333333;&quot;&gt;944&nbsp;209&nbsp;470&lt;br&nbsp;/&gt;Parque&nbsp;Tecnol&oacute;gico.&nbsp;Edificio&nbsp;103&lt;br&nbsp;/&gt;48170&nbsp;Zamudio&nbsp;(Bizkaia)&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;lnksarenet&quot;&nbsp;style=&quot;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-weight:&nbsp;normal;&nbsp;font-size:&nbsp;12px;&nbsp;color:&nbsp;#007ac4;&nbsp;line-height:&nbsp;1.2;&quot;&gt;&lt;a&nbsp;id=&quot;mailto&quot;&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;color:&nbsp;#007ac4;&nbsp;text-decoration:&nbsp;underline;&quot;&nbsp;href=&quot;mailto:egoitz@sarenet.es&quot;&gt;&lt;label&nbsp;id=&quot;label_email&quot;&gt;egoitz@sarenet.es&lt;/label&gt;&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;lnksarenet&quot;&nbsp;style=&quot;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-weight:&nbsp;normal;&nbsp;font-size:&nbsp;12px;&nbsp;color:&nbsp;#007ac4;&nbsp;line-height:&nbsp;1.2;&quot;&gt;&lt;a&nbsp;style=&quot;font-size:&nbsp;12px;&nbsp;color:&nbsp;#007ac4;&nbsp;text-decoration:&nbsp;underline;&quot;&nbsp;href=&quot;http://www.sarenet.es&quot;&gt;www.sarenet.es&lt;/a&gt;&lt;/div&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;div&nbsp;class=&quot;imprimirsarenet&quot;&nbsp;style=&quot;font-family:&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-weight:&nbsp;normal;&nbsp;font-size:&nbsp;10px;&nbsp;color:&nbsp;#a0c361;&quot;&gt;Antes&nbsp;de&nbsp;imprimir&nbsp;este&nbsp;correo&nbsp;electr&oacute;nico&nbsp;piense&nbsp;si&nbsp;es&nbsp;necesario&nbsp;hacerlo.&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;p&gt;&lt;br&nbsp;/&gt;&lt;/p&gt;<br>
&lt;p&gt;El&nbsp;2019-03-05&nbsp;08:13,&nbsp;Alex&nbsp;Rousskov&nbsp;escribi&oacute;:&lt;/p&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;&lt;!--&nbsp;html&nbsp;ignored&nbsp;--&gt;&lt;!--&nbsp;head&nbsp;ignored&nbsp;--&gt;&lt;!--&nbsp;meta&nbsp;ignored&nbsp;--&gt;<br>
&lt;div&nbsp;class=&quot;pre&quot;&nbsp;style=&quot;margin:&nbsp;0;&nbsp;padding:&nbsp;0;&nbsp;font-family:&nbsp;monospace&quot;&gt;On&nbsp;3/4/19&nbsp;11:20&nbsp;AM,&nbsp;Egoitz&nbsp;Aurrekoetxea&nbsp;wrote:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;Clients,&nbsp;will&nbsp;ask&nbsp;:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;a&nbsp;href=&quot;https://oooeeee.eeee.ttt.thesquidserver.org/&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;https://oooeeee.eeee.ttt.thesquidserver.org/&lt;/a&gt;&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;So&nbsp;the&nbsp;answer&nbsp;[to&nbsp;the&nbsp;second&nbsp;question]&nbsp;I&nbsp;assume&nbsp;should&nbsp;be&nbsp;yes.&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;If&nbsp;I&nbsp;am&nbsp;interpreting&nbsp;your&nbsp;answers&nbsp;correctly,&nbsp;then&nbsp;your&nbsp;setup&nbsp;looks&nbsp;like&lt;br&nbsp;/&gt;&nbsp;a&nbsp;reverse&nbsp;proxy&nbsp;to&nbsp;me.&nbsp;In&nbsp;that&nbsp;case,&nbsp;you&nbsp;do&nbsp;not&nbsp;need&nbsp;SslBump&nbsp;and&lt;br&nbsp;/&gt;&nbsp;interception.&nbsp;You&nbsp;do&nbsp;need&nbsp;an&nbsp;web&nbsp;server&nbsp;certificate&nbsp;for&nbsp;the&lt;br&nbsp;/&gt;&nbsp;oooeeee.eeee.ttt.thesquidserver.org&nbsp;domain,&nbsp;issued&nbsp;by&nbsp;a&nbsp;well-trusted&nbsp;CA.&lt;br&nbsp;/&gt;&nbsp;Do&nbsp;you&nbsp;already&nbsp;have&nbsp;that?&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;I&nbsp;have&nbsp;DNAT&nbsp;rules,&nbsp;for&nbsp;being&nbsp;able&nbsp;to&lt;br&nbsp;/&gt;&nbsp;redirect&nbsp;tcp/80&nbsp;and&nbsp;tcp/443&nbsp;to&nbsp;squid's&nbsp;port&nbsp;silently.&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;Please&nbsp;note&nbsp;that&nbsp;your&nbsp;current&nbsp;Squid&nbsp;configuration&nbsp;is&nbsp;not&nbsp;a&nbsp;reverse&nbsp;proxy&lt;br&nbsp;/&gt;&nbsp;configuration.&nbsp;It&nbsp;is&nbsp;an&nbsp;interception&nbsp;configuration.&nbsp;It&nbsp;also&nbsp;lacks&lt;br&nbsp;/&gt;&nbsp;https_port&nbsp;for&nbsp;handling&nbsp;port&nbsp;443&nbsp;traffic.&nbsp;There&nbsp;are&nbsp;probably&nbsp;some&lt;br&nbsp;/&gt;&nbsp;documents&nbsp;on&nbsp;Squid&nbsp;wiki&nbsp;(and/or&nbsp;elsewhere)&nbsp;explaining&nbsp;how&nbsp;to&nbsp;configure&lt;br&nbsp;/&gt;&nbsp;Squid&nbsp;to&nbsp;become&nbsp;a&nbsp;reverse&nbsp;proxy.&nbsp;Follow&nbsp;them.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;I&nbsp;wanted&nbsp;to&nbsp;setup&nbsp;a&nbsp;proxy&nbsp;machine&nbsp;which&nbsp;I&nbsp;wanted&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;receive&lt;br&nbsp;/&gt;&nbsp;url&nbsp;like&nbsp;:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;-&nbsp;&lt;a&nbsp;href=&quot;http://www.iou.net.theproxy.com/hj.php?ui=9&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;www.iou.net.theproxy.com/hj.php?ui=9&lt;/a&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;If&nbsp;this&nbsp;site&nbsp;returns&nbsp;clean&nbsp;content&nbsp;(scanned&nbsp;by&nbsp;Icap&nbsp;server)&nbsp;the&nbsp;url&lt;br&nbsp;/&gt;&nbsp;redirector&nbsp;should&nbsp;return&nbsp;:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;-&nbsp;&lt;a&nbsp;href=&quot;http://www.iou.net/hj.php?ui=9&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;www.iou.net/hj.php?ui=9&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://www.iou.net/hj.php?ui=9&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://www.iou.net/hj.php?ui=9&lt;/a&gt;&gt;&nbsp;(the&nbsp;real&lt;br&nbsp;/&gt;&nbsp;url)&nbsp;as&nbsp;URL.&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;OK.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;-&nbsp;Is&nbsp;it&nbsp;possible&nbsp;with&nbsp;Squid&nbsp;to&nbsp;achieve&nbsp;my&nbsp;goal?.&nbsp;With&nbsp;Squid,&nbsp;a&lt;br&nbsp;/&gt;&nbsp;redirector,&nbsp;and&nbsp;a&nbsp;Icap&nbsp;daemon&nbsp;which&nbsp;performs&nbsp;virus&nbsp;scanning...&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;A&nbsp;redirector&nbsp;seems&nbsp;out&nbsp;of&nbsp;scope&nbsp;here&nbsp;--&nbsp;it&nbsp;works&nbsp;on&nbsp;requests&nbsp;while&nbsp;you&lt;br&nbsp;/&gt;&nbsp;want&nbsp;to&nbsp;rewrite&nbsp;(scanned&nbsp;by&nbsp;ICAP)&nbsp;responses.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;It&nbsp;is&nbsp;probably&nbsp;possible&nbsp;to&nbsp;use&nbsp;deny_info&nbsp;to&nbsp;respond&nbsp;with&nbsp;a&nbsp;redirect&lt;br&nbsp;/&gt;&nbsp;message.&nbsp;To&nbsp;trigger&nbsp;a&nbsp;deny_info&nbsp;action,&nbsp;you&nbsp;would&nbsp;have&nbsp;to&nbsp;configure&nbsp;your&lt;br&nbsp;/&gt;&nbsp;Squid&nbsp;to&nbsp;block&nbsp;virus-free&nbsp;responses,&nbsp;which&nbsp;is&nbsp;rather&nbsp;strange!&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;-&nbsp;For&nbsp;plain&nbsp;http&nbsp;the&nbsp;config&nbsp;and&nbsp;the&nbsp;URL&nbsp;seem&nbsp;to&nbsp;be&nbsp;working&nbsp;BUT&nbsp;the&nbsp;virus&lt;br&nbsp;/&gt;&nbsp;are&nbsp;not&nbsp;being&nbsp;scanned.&nbsp;Could&nbsp;the&nbsp;config&nbsp;be&nbsp;adjusted&nbsp;for&nbsp;that?.&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;I&nbsp;would&nbsp;start&nbsp;by&nbsp;removing&nbsp;the&nbsp;redirector,&nbsp;&quot;intercept&quot;,&nbsp;SslBump,&nbsp;and&lt;br&nbsp;/&gt;&nbsp;disabling&nbsp;ICAP.&nbsp;Configure&nbsp;your&nbsp;Squid&nbsp;as&nbsp;a&nbsp;reverse&nbsp;proxy&nbsp;without&nbsp;any&lt;br&nbsp;/&gt;&nbsp;virus&nbsp;scanning.&nbsp;Then&nbsp;add&nbsp;ICAP.&nbsp;Get&nbsp;the&nbsp;virus&nbsp;scanning&nbsp;working&nbsp;without&lt;br&nbsp;/&gt;&nbsp;any&nbsp;URL&nbsp;manipulation.&nbsp;Once&nbsp;that&nbsp;is&nbsp;done,&nbsp;you&nbsp;can&nbsp;adjust&nbsp;Squid&nbsp;to&nbsp;block&lt;br&nbsp;/&gt;&nbsp;virus-free&nbsp;responses&nbsp;(via&nbsp;http_reply_access)&nbsp;and&nbsp;trigger&nbsp;a&nbsp;deny_info&lt;br&nbsp;/&gt;&nbsp;response&nbsp;containing&nbsp;an&nbsp;HTTP&nbsp;redirect.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;Please&nbsp;note&nbsp;that&nbsp;once&nbsp;the&nbsp;browser&nbsp;gets&nbsp;a&nbsp;redirect&nbsp;to&nbsp;another&nbsp;site,&nbsp;that&lt;br&nbsp;/&gt;&nbsp;browser&nbsp;is&nbsp;not&nbsp;going&nbsp;to&nbsp;revisit&nbsp;your&nbsp;reverse&nbsp;proxy&nbsp;for&nbsp;any&nbsp;content&lt;br&nbsp;/&gt;&nbsp;related&nbsp;to&nbsp;that&nbsp;other&nbsp;site&nbsp;--&nbsp;all&nbsp;requests&nbsp;for&nbsp;that&nbsp;other&nbsp;site&nbsp;will&nbsp;go&lt;br&nbsp;/&gt;&nbsp;from&nbsp;the&nbsp;browser&nbsp;to&nbsp;that&nbsp;other&nbsp;site.&nbsp;Your&nbsp;proxy&nbsp;will&nbsp;not&nbsp;be&nbsp;in&nbsp;the&nbsp;loop&lt;br&nbsp;/&gt;&nbsp;anymore.&nbsp;If&nbsp;that&nbsp;is&nbsp;not&nbsp;what&nbsp;you&nbsp;want,&nbsp;then&nbsp;you&nbsp;cannot&nbsp;use&nbsp;redirects&nbsp;at&lt;br&nbsp;/&gt;&nbsp;all&nbsp;--&nbsp;you&nbsp;would&nbsp;have&nbsp;to&nbsp;accelerate&nbsp;that&nbsp;other&nbsp;site&nbsp;for&nbsp;all&nbsp;requests&lt;br&nbsp;/&gt;&nbsp;instead&nbsp;and&nbsp;make&nbsp;sure&nbsp;that&nbsp;other&nbsp;site&nbsp;does&nbsp;not&nbsp;contain&nbsp;absolute&nbsp;URLs&lt;br&nbsp;/&gt;&nbsp;pointing&nbsp;the&nbsp;browser&nbsp;away&nbsp;from&nbsp;your&nbsp;reverse&nbsp;proxy.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;Disclaimer:&nbsp;I&nbsp;have&nbsp;not&nbsp;tested&nbsp;the&nbsp;above&nbsp;ideas&nbsp;and,&nbsp;again,&nbsp;I&nbsp;may&nbsp;be&lt;br&nbsp;/&gt;&nbsp;misinterpreting&nbsp;what&nbsp;you&nbsp;really&nbsp;want&nbsp;to&nbsp;achieve.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;Alex.&lt;br&nbsp;/&gt;&nbsp;_______________________________________________&lt;br&nbsp;/&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&nbsp;/&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;&lt;/html&gt;<br>

</tt>
