<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&nbsp;/&gt;&lt;/head&gt;&lt;body&nbsp;style='font-size:&nbsp;10pt;&nbsp;font-family:&nbsp;Verdana,Geneva,sans-serif'&gt;<br>
&lt;p&gt;Hi!,&lt;/p&gt;<br>
&lt;p&gt;&lt;br&nbsp;/&gt;&lt;/p&gt;<br>
&lt;p&gt;Thank&nbsp;you&nbsp;so&nbsp;much&nbsp;for&nbsp;all&nbsp;your&nbsp;effort.&nbsp;We&nbsp;have&nbsp;finally&nbsp;got&nbsp;it&nbsp;done&nbsp;by&nbsp;using&nbsp;a&nbsp;mixed&nbsp;solution.&nbsp;A&nbsp;script&nbsp;plus&nbsp;the&nbsp;Squid&nbsp;actual&nbsp;configured&nbsp;mode&nbsp;:)&lt;/p&gt;<br>
&lt;p&gt;&lt;br&nbsp;/&gt;&lt;/p&gt;<br>
&lt;p&gt;I&nbsp;wanted&nbsp;to&nbsp;thank&nbsp;really&nbsp;all&nbsp;your&nbsp;time&nbsp;because&nbsp;it&nbsp;has&nbsp;been&nbsp;like&nbsp;gold&nbsp;for&nbsp;me&nbsp;:)&nbsp;:)&lt;/p&gt;<br>
&lt;p&gt;&lt;br&nbsp;/&gt;&lt;/p&gt;<br>
&lt;p&gt;Bye&nbsp;mates!&lt;/p&gt;<br>
&lt;p&gt;&lt;br&nbsp;/&gt;&lt;/p&gt;<br>
&lt;p&gt;El&nbsp;2019-03-05&nbsp;18:48,&nbsp;Alex&nbsp;Rousskov&nbsp;escribi&oacute;:&lt;/p&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;&lt;!--&nbsp;html&nbsp;ignored&nbsp;--&gt;&lt;!--&nbsp;head&nbsp;ignored&nbsp;--&gt;&lt;!--&nbsp;meta&nbsp;ignored&nbsp;--&gt;<br>
&lt;div&nbsp;class=&quot;pre&quot;&nbsp;style=&quot;margin:&nbsp;0;&nbsp;padding:&nbsp;0;&nbsp;font-family:&nbsp;monospace&quot;&gt;On&nbsp;3/5/19&nbsp;9:59&nbsp;AM,&nbsp;Egoitz&nbsp;Aurrekoetxea&nbsp;wrote:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;El&nbsp;2019-03-05&nbsp;17:45,&nbsp;Alex&nbsp;Rousskov&nbsp;escribi&oacute;:<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;On&nbsp;3/5/19&nbsp;1:57&nbsp;AM,&nbsp;Egoitz&nbsp;Aurrekoetxea&nbsp;wrote:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;I&nbsp;have&nbsp;Squid&nbsp;configured&nbsp;with&nbsp;the&nbsp;virus&nbsp;scanning&nbsp;software&nbsp;using&nbsp;ICAP&nbsp;and&lt;br&nbsp;/&gt;&nbsp;working.&nbsp;But,&nbsp;when&nbsp;I&nbsp;do&nbsp;:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;acl&nbsp;matchear_todo&nbsp;url_regex&nbsp;[-i]&nbsp;^.*$&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;FYI:&nbsp;&quot;[-i]&quot;&nbsp;is&nbsp;documentation&nbsp;syntax&nbsp;that&nbsp;means&nbsp;an&nbsp;optional&nbsp;flag&nbsp;called&lt;br&nbsp;/&gt;&nbsp;&quot;-i&quot;.&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;use&nbsp;that&nbsp;&quot;-i&quot;&nbsp;flag,&nbsp;then&nbsp;type&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;acl&nbsp;matchear_todo&nbsp;url_regex&nbsp;-i&nbsp;^.*$&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;...&nbsp;but&nbsp;keep&nbsp;in&nbsp;mind&nbsp;that&nbsp;&quot;-i&quot;&nbsp;makes&nbsp;no&nbsp;sense&nbsp;when&nbsp;you&nbsp;regular&lt;br&nbsp;/&gt;&nbsp;expression&nbsp;does&nbsp;not&nbsp;contain&nbsp;small&nbsp;or&nbsp;capital&nbsp;characters.&nbsp;Adding&nbsp;&quot;-i&quot;&lt;br&nbsp;/&gt;&nbsp;would&nbsp;not&nbsp;change&nbsp;what&nbsp;URLs&nbsp;such&nbsp;a&nbsp;regular&nbsp;expression&nbsp;would&nbsp;match.&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&nbsp;&nbsp;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;I&nbsp;see...&nbsp;I&nbsp;though&nbsp;it&nbsp;was&nbsp;for&nbsp;matching&nbsp;case&nbsp;insensitively...&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;You&nbsp;thought&nbsp;correctly.&nbsp;The&nbsp;-i&nbsp;flag&nbsp;enables&nbsp;case&nbsp;insensitive&nbsp;matches&lt;br&nbsp;/&gt;&nbsp;indeed,&nbsp;but&nbsp;you&nbsp;are&nbsp;specifying&nbsp;that&nbsp;flag&nbsp;incorrectly&nbsp;(extra&nbsp;square&lt;br&nbsp;/&gt;&nbsp;brackets),&nbsp;and&nbsp;it&nbsp;makes&nbsp;no&nbsp;sense&nbsp;to&nbsp;specify&nbsp;it&nbsp;at&nbsp;all&nbsp;for&nbsp;your&nbsp;specific&lt;br&nbsp;/&gt;&nbsp;regular&nbsp;expression!&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;http_reply_access&nbsp;deny&nbsp;matchear_todo&lt;br&nbsp;/&gt;&nbsp;deny_info&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://172.16.8.61/redirigir.php?url=%s&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://172.16.8.61/redirigir.php?url=%s&lt;/a&gt;&nbsp;matchear_todo&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;Why&nbsp;are&nbsp;you&nbsp;blocking&nbsp;based&nbsp;on&nbsp;URL&nbsp;instead&nbsp;of&nbsp;blocking&nbsp;based&nbsp;on&nbsp;the&nbsp;ICAP&lt;br&nbsp;/&gt;&nbsp;scan&nbsp;result?&nbsp;In&nbsp;your&nbsp;earlier&nbsp;specifications,&nbsp;you&nbsp;wanted&nbsp;to&lt;br&nbsp;/&gt;&nbsp;block/redirect&nbsp;only&nbsp;those&nbsp;transactions&nbsp;that&nbsp;were&nbsp;certified&nbsp;virus-free&nbsp;by&lt;br&nbsp;/&gt;&nbsp;your&nbsp;ICAP&nbsp;client.&nbsp;The&nbsp;above&nbsp;matchear_todo&nbsp;ACL&nbsp;does&nbsp;not&nbsp;do&nbsp;that.&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&nbsp;&nbsp;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;*That&nbsp;was&nbsp;an&nbsp;attempt&nbsp;of&nbsp;achieving&nbsp;my&nbsp;goal.&nbsp;Redirect&nbsp;requests&nbsp;to&nbsp;a&nbsp;php&lt;br&nbsp;/&gt;&nbsp;which&nbsp;does&nbsp;the&nbsp;request&nbsp;to&nbsp;a&nbsp;&quot;next&nbsp;Squid&quot;&nbsp;and&nbsp;then&nbsp;return&nbsp;one&nbsp;thing&nbsp;or&lt;br&nbsp;/&gt;&nbsp;another....*&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;Sounds&nbsp;like&nbsp;you&nbsp;are&nbsp;asking&nbsp;about&nbsp;one&nbsp;thing&nbsp;and&nbsp;then&nbsp;testing/discussing&lt;br&nbsp;/&gt;&nbsp;another.&nbsp;Doing&nbsp;so&nbsp;makes&nbsp;helping&nbsp;you&nbsp;more&nbsp;difficult.&nbsp;Focus&nbsp;on&nbsp;making&nbsp;the&lt;br&nbsp;/&gt;&nbsp;simplest&nbsp;use&nbsp;case&nbsp;working&nbsp;first.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;be&nbsp;done&nbsp;from&nbsp;Squid&nbsp;side?&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;Probably&nbsp;(as&nbsp;long&nbsp;as&nbsp;your&nbsp;ICAP&nbsp;service&nbsp;can&nbsp;signal&nbsp;clean/dirty&nbsp;status&nbsp;in&lt;br&nbsp;/&gt;&nbsp;a&nbsp;way&nbsp;Squid&nbsp;ACLs&nbsp;can&nbsp;detect).&nbsp;Since&nbsp;you&nbsp;appear&nbsp;to&nbsp;change&nbsp;the&lt;br&nbsp;/&gt;&nbsp;problem/goal,&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;what&nbsp;the&nbsp;answer&nbsp;to&nbsp;this&nbsp;question&nbsp;is.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;Or&nbsp;does&nbsp;the&nbsp;own&nbsp;ICAP&nbsp;implementation&nbsp;directly&nbsp;return&nbsp;a&nbsp;3xx&nbsp;answer?&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;That&nbsp;works&nbsp;as&nbsp;well.&nbsp;In&nbsp;that&nbsp;case,&nbsp;you&nbsp;do&nbsp;not&nbsp;need&nbsp;deny_info&nbsp;tricks.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;Your&nbsp;ACL&nbsp;says&nbsp;nothing&nbsp;about&nbsp;&quot;clean&quot;.&nbsp;It&nbsp;says&nbsp;&quot;always&quot;.&nbsp;How&nbsp;does&nbsp;your&lt;br&nbsp;/&gt;&nbsp;ICAP&nbsp;service&nbsp;mark&nbsp;&quot;clean&quot;&nbsp;(or&nbsp;&quot;dirty&quot;)&nbsp;HTTP&nbsp;responses?&nbsp;Your&nbsp;ACL&nbsp;needs&nbsp;to&lt;br&nbsp;/&gt;&nbsp;match&nbsp;that&nbsp;marking&nbsp;(or&nbsp;the&nbsp;absence&nbsp;of&nbsp;that&nbsp;marking).&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&nbsp;&nbsp;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;Could&nbsp;you&nbsp;give&nbsp;me&nbsp;a&nbsp;clue&nbsp;of&nbsp;how&nbsp;could&nbsp;I&nbsp;do&nbsp;it?&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;I&nbsp;cannot&nbsp;because&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;what&nbsp;your&nbsp;ICAP&nbsp;service&nbsp;is&nbsp;capable&nbsp;of&nbsp;(and&lt;br&nbsp;/&gt;&nbsp;do&nbsp;not&nbsp;have&nbsp;the&nbsp;time&nbsp;to&nbsp;research&nbsp;that).&nbsp;For&nbsp;example,&nbsp;if&nbsp;your&nbsp;ICAP&lt;br&nbsp;/&gt;&nbsp;service&nbsp;can&nbsp;add&nbsp;an&nbsp;HTTP&nbsp;header&nbsp;to&nbsp;dirty&nbsp;HTTP&nbsp;responses,&nbsp;then&nbsp;you&nbsp;can&nbsp;use&lt;br&nbsp;/&gt;&nbsp;the&nbsp;corresponding&nbsp;Squid&nbsp;ACL&nbsp;to&nbsp;detect&nbsp;the&nbsp;presence&nbsp;of&nbsp;that&nbsp;header&nbsp;in&nbsp;the&lt;br&nbsp;/&gt;&nbsp;adapted&nbsp;response.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;Alex.&lt;br&nbsp;/&gt;&nbsp;&nbsp;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;El&nbsp;2019-03-05&nbsp;08:13,&nbsp;Alex&nbsp;Rousskov&nbsp;escribi&oacute;:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;On&nbsp;3/4/19&nbsp;11:20&nbsp;AM,&nbsp;Egoitz&nbsp;Aurrekoetxea&nbsp;wrote:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;Clients,&nbsp;will&nbsp;ask&nbsp;:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;a&nbsp;href=&quot;https://oooeeee.eeee.ttt.thesquidserver.org/&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;https://oooeeee.eeee.ttt.thesquidserver.org/&lt;/a&gt;&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;So&nbsp;the&nbsp;answer&nbsp;[to&nbsp;the&nbsp;second&nbsp;question]&nbsp;I&nbsp;assume&nbsp;should&nbsp;be&nbsp;yes.&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;If&nbsp;I&nbsp;am&nbsp;interpreting&nbsp;your&nbsp;answers&nbsp;correctly,&nbsp;then&nbsp;your&nbsp;setup&nbsp;looks&nbsp;like&lt;br&nbsp;/&gt;&nbsp;a&nbsp;reverse&nbsp;proxy&nbsp;to&nbsp;me.&nbsp;In&nbsp;that&nbsp;case,&nbsp;you&nbsp;do&nbsp;not&nbsp;need&nbsp;SslBump&nbsp;and&lt;br&nbsp;/&gt;&nbsp;interception.&nbsp;You&nbsp;do&nbsp;need&nbsp;an&nbsp;web&nbsp;server&nbsp;certificate&nbsp;for&nbsp;the&lt;br&nbsp;/&gt;&nbsp;oooeeee.eeee.ttt.thesquidserver.org&nbsp;domain,&nbsp;issued&nbsp;by&nbsp;a&nbsp;well-trusted&nbsp;CA.&lt;br&nbsp;/&gt;&nbsp;Do&nbsp;you&nbsp;already&nbsp;have&nbsp;that?&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;I&nbsp;have&nbsp;DNAT&nbsp;rules,&nbsp;for&nbsp;being&nbsp;able&nbsp;to&lt;br&nbsp;/&gt;&nbsp;redirect&nbsp;tcp/80&nbsp;and&nbsp;tcp/443&nbsp;to&nbsp;squid's&nbsp;port&nbsp;silently.&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;Please&nbsp;note&nbsp;that&nbsp;your&nbsp;current&nbsp;Squid&nbsp;configuration&nbsp;is&nbsp;not&nbsp;a&nbsp;reverse&nbsp;proxy&lt;br&nbsp;/&gt;&nbsp;configuration.&nbsp;It&nbsp;is&nbsp;an&nbsp;interception&nbsp;configuration.&nbsp;It&nbsp;also&nbsp;lacks&lt;br&nbsp;/&gt;&nbsp;https_port&nbsp;for&nbsp;handling&nbsp;port&nbsp;443&nbsp;traffic.&nbsp;There&nbsp;are&nbsp;probably&nbsp;some&lt;br&nbsp;/&gt;&nbsp;documents&nbsp;on&nbsp;Squid&nbsp;wiki&nbsp;(and/or&nbsp;elsewhere)&nbsp;explaining&nbsp;how&nbsp;to&nbsp;configure&lt;br&nbsp;/&gt;&nbsp;Squid&nbsp;to&nbsp;become&nbsp;a&nbsp;reverse&nbsp;proxy.&nbsp;Follow&nbsp;them.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;I&nbsp;wanted&nbsp;to&nbsp;setup&nbsp;a&nbsp;proxy&nbsp;machine&nbsp;which&nbsp;I&nbsp;wanted&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;receive&lt;br&nbsp;/&gt;&nbsp;url&nbsp;like&nbsp;:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;-&nbsp;&lt;a&nbsp;href=&quot;http://www.iou.net.theproxy.com/hj.php?ui=9&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;www.iou.net.theproxy.com/hj.php?ui=9&lt;/a&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://www.iou.net.theproxy.com/hj.php?ui=9&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://www.iou.net.theproxy.com/hj.php?ui=9&lt;/a&gt;&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://www.iou.net.theproxy.com/hj.php?ui=9&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://www.iou.net.theproxy.com/hj.php?ui=9&lt;/a&gt;&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;If&nbsp;this&nbsp;site&nbsp;returns&nbsp;clean&nbsp;content&nbsp;(scanned&nbsp;by&nbsp;Icap&nbsp;server)&nbsp;the&nbsp;url&lt;br&nbsp;/&gt;&nbsp;redirector&nbsp;should&nbsp;return&nbsp;:&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;-&nbsp;&lt;a&nbsp;href=&quot;http://www.iou.net/hj.php?ui=9&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;www.iou.net/hj.php?ui=9&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://www.iou.net/hj.php?ui=9&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://www.iou.net/hj.php?ui=9&lt;/a&gt;&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://www.iou.net/hj.php?ui=9&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://www.iou.net/hj.php?ui=9&lt;/a&gt;&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://www.iou.net/hj.php?ui=9&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://www.iou.net/hj.php?ui=9&lt;/a&gt;&gt;&nbsp;(the&nbsp;real&lt;br&nbsp;/&gt;&nbsp;url)&nbsp;as&nbsp;URL.&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;OK.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;-&nbsp;Is&nbsp;it&nbsp;possible&nbsp;with&nbsp;Squid&nbsp;to&nbsp;achieve&nbsp;my&nbsp;goal?.&nbsp;With&nbsp;Squid,&nbsp;a&lt;br&nbsp;/&gt;&nbsp;redirector,&nbsp;and&nbsp;a&nbsp;Icap&nbsp;daemon&nbsp;which&nbsp;performs&nbsp;virus&nbsp;scanning...&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;A&nbsp;redirector&nbsp;seems&nbsp;out&nbsp;of&nbsp;scope&nbsp;here&nbsp;--&nbsp;it&nbsp;works&nbsp;on&nbsp;requests&nbsp;while&nbsp;you&lt;br&nbsp;/&gt;&nbsp;want&nbsp;to&nbsp;rewrite&nbsp;(scanned&nbsp;by&nbsp;ICAP)&nbsp;responses.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;It&nbsp;is&nbsp;probably&nbsp;possible&nbsp;to&nbsp;use&nbsp;deny_info&nbsp;to&nbsp;respond&nbsp;with&nbsp;a&nbsp;redirect&lt;br&nbsp;/&gt;&nbsp;message.&nbsp;To&nbsp;trigger&nbsp;a&nbsp;deny_info&nbsp;action,&nbsp;you&nbsp;would&nbsp;have&nbsp;to&nbsp;configure&nbsp;your&lt;br&nbsp;/&gt;&nbsp;Squid&nbsp;to&nbsp;block&nbsp;virus-free&nbsp;responses,&nbsp;which&nbsp;is&nbsp;rather&nbsp;strange!&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding:&nbsp;0&nbsp;0.4em;&nbsp;border-left:&nbsp;#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin:&nbsp;0&quot;&gt;-&nbsp;For&nbsp;plain&nbsp;http&nbsp;the&nbsp;config&nbsp;and&nbsp;the&nbsp;URL&nbsp;seem&nbsp;to&nbsp;be&nbsp;working&nbsp;BUT&nbsp;the&lt;br&nbsp;/&gt;&nbsp;virus&lt;br&nbsp;/&gt;&nbsp;are&nbsp;not&nbsp;being&nbsp;scanned.&nbsp;Could&nbsp;the&nbsp;config&nbsp;be&nbsp;adjusted&nbsp;for&nbsp;that?.&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;I&nbsp;would&nbsp;start&nbsp;by&nbsp;removing&nbsp;the&nbsp;redirector,&nbsp;&quot;intercept&quot;,&nbsp;SslBump,&nbsp;and&lt;br&nbsp;/&gt;&nbsp;disabling&nbsp;ICAP.&nbsp;Configure&nbsp;your&nbsp;Squid&nbsp;as&nbsp;a&nbsp;reverse&nbsp;proxy&nbsp;without&nbsp;any&lt;br&nbsp;/&gt;&nbsp;virus&nbsp;scanning.&nbsp;Then&nbsp;add&nbsp;ICAP.&nbsp;Get&nbsp;the&nbsp;virus&nbsp;scanning&nbsp;working&nbsp;without&lt;br&nbsp;/&gt;&nbsp;any&nbsp;URL&nbsp;manipulation.&nbsp;Once&nbsp;that&nbsp;is&nbsp;done,&nbsp;you&nbsp;can&nbsp;adjust&nbsp;Squid&nbsp;to&nbsp;block&lt;br&nbsp;/&gt;&nbsp;virus-free&nbsp;responses&nbsp;(via&nbsp;http_reply_access)&nbsp;and&nbsp;trigger&nbsp;a&nbsp;deny_info&lt;br&nbsp;/&gt;&nbsp;response&nbsp;containing&nbsp;an&nbsp;HTTP&nbsp;redirect.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;Please&nbsp;note&nbsp;that&nbsp;once&nbsp;the&nbsp;browser&nbsp;gets&nbsp;a&nbsp;redirect&nbsp;to&nbsp;another&nbsp;site,&nbsp;that&lt;br&nbsp;/&gt;&nbsp;browser&nbsp;is&nbsp;not&nbsp;going&nbsp;to&nbsp;revisit&nbsp;your&nbsp;reverse&nbsp;proxy&nbsp;for&nbsp;any&nbsp;content&lt;br&nbsp;/&gt;&nbsp;related&nbsp;to&nbsp;that&nbsp;other&nbsp;site&nbsp;--&nbsp;all&nbsp;requests&nbsp;for&nbsp;that&nbsp;other&nbsp;site&nbsp;will&nbsp;go&lt;br&nbsp;/&gt;&nbsp;from&nbsp;the&nbsp;browser&nbsp;to&nbsp;that&nbsp;other&nbsp;site.&nbsp;Your&nbsp;proxy&nbsp;will&nbsp;not&nbsp;be&nbsp;in&nbsp;the&nbsp;loop&lt;br&nbsp;/&gt;&nbsp;anymore.&nbsp;If&nbsp;that&nbsp;is&nbsp;not&nbsp;what&nbsp;you&nbsp;want,&nbsp;then&nbsp;you&nbsp;cannot&nbsp;use&nbsp;redirects&nbsp;at&lt;br&nbsp;/&gt;&nbsp;all&nbsp;--&nbsp;you&nbsp;would&nbsp;have&nbsp;to&nbsp;accelerate&nbsp;that&nbsp;other&nbsp;site&nbsp;for&nbsp;all&nbsp;requests&lt;br&nbsp;/&gt;&nbsp;instead&nbsp;and&nbsp;make&nbsp;sure&nbsp;that&nbsp;other&nbsp;site&nbsp;does&nbsp;not&nbsp;contain&nbsp;absolute&nbsp;URLs&lt;br&nbsp;/&gt;&nbsp;pointing&nbsp;the&nbsp;browser&nbsp;away&nbsp;from&nbsp;your&nbsp;reverse&nbsp;proxy.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;Disclaimer:&nbsp;I&nbsp;have&nbsp;not&nbsp;tested&nbsp;the&nbsp;above&nbsp;ideas&nbsp;and,&nbsp;again,&nbsp;I&nbsp;may&nbsp;be&lt;br&nbsp;/&gt;&nbsp;misinterpreting&nbsp;what&nbsp;you&nbsp;really&nbsp;want&nbsp;to&nbsp;achieve.&lt;br&nbsp;/&gt;&nbsp;&lt;br&nbsp;/&gt;&nbsp;Alex.&lt;br&nbsp;/&gt;&nbsp;_______________________________________________&lt;br&nbsp;/&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&nbsp;/&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&gt;&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;_______________________________________________&lt;br&nbsp;/&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&nbsp;/&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;&nbsp;_______________________________________________&lt;br&nbsp;/&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&nbsp;/&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&gt;&lt;br&nbsp;/&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noopener&nbsp;noreferrer&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;&lt;/html&gt;<br>

</tt>
