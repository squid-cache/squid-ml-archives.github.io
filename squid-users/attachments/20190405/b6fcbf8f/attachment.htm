<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;the&nbsp;setup&nbsp;is&nbsp;exactly&nbsp;what&nbsp;you&nbsp;suggested&nbsp;but&nbsp;still&nbsp;the&nbsp;ERROR&nbsp;shows&nbsp;up.&lt;/div&gt;&lt;div&gt;Here&nbsp;the&nbsp;startup&nbsp;sequence&nbsp;about&nbsp;context&nbsp;creation:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;Initializing&nbsp;https://&nbsp;proxy&nbsp;context&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(38)&nbsp;SBuf:&nbsp;SBuf950&nbsp;created&nbsp;from&nbsp;id&nbsp;SBuf110&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;Tokenizer.cc(174)&nbsp;skip:&nbsp;skipping&nbsp;char&nbsp;&#39;1&#39;&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,5|&nbsp;Tokenizer.cc(25)&nbsp;consume:&nbsp;consuming&nbsp;1&nbsp;bytes&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(497)&nbsp;consume:&nbsp;SBuf950&nbsp;consume&nbsp;1&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(38)&nbsp;SBuf:&nbsp;SBuf951&nbsp;created&nbsp;from&nbsp;id&nbsp;SBuf950&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(70)&nbsp;~SBuf:&nbsp;SBuf951&nbsp;destructed&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;Tokenizer.cc(174)&nbsp;skip:&nbsp;skipping&nbsp;char&nbsp;&#39;.&#39;&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,5|&nbsp;Tokenizer.cc(25)&nbsp;consume:&nbsp;consuming&nbsp;1&nbsp;bytes&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(497)&nbsp;consume:&nbsp;SBuf950&nbsp;consume&nbsp;1&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(38)&nbsp;SBuf:&nbsp;SBuf952&nbsp;created&nbsp;from&nbsp;id&nbsp;SBuf950&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(70)&nbsp;~SBuf:&nbsp;SBuf952&nbsp;destructed&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(38)&nbsp;SBuf:&nbsp;SBuf953&nbsp;created&nbsp;from&nbsp;id&nbsp;SBuf950&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,5|&nbsp;Tokenizer.cc(25)&nbsp;consume:&nbsp;consuming&nbsp;1&nbsp;bytes&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(497)&nbsp;consume:&nbsp;SBuf950&nbsp;consume&nbsp;1&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(38)&nbsp;SBuf:&nbsp;SBuf954&nbsp;created&nbsp;from&nbsp;id&nbsp;SBuf950&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(70)&nbsp;~SBuf:&nbsp;SBuf954&nbsp;destructed&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(70)&nbsp;~SBuf:&nbsp;SBuf953&nbsp;destructed&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.050|&nbsp;24,8|&nbsp;SBuf.cc(70)&nbsp;~SBuf:&nbsp;SBuf950&nbsp;destructed&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.051|&nbsp;83,9|&nbsp;support.cc(586)&nbsp;InitClientContext:&nbsp;Setting&nbsp;certificate&nbsp;verification&nbsp;callback.&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.051|&nbsp;83,8|&nbsp;PeerOptions.cc(647)&nbsp;updateContextCa:&nbsp;Setting&nbsp;CA&nbsp;certificate&nbsp;locations.&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.051|&nbsp;83,8|&nbsp;PeerOptions.cc(630)&nbsp;loadSystemTrustedCa:&nbsp;Setting&nbsp;default&nbsp;system&nbsp;Trusted&nbsp;CA.&nbsp;ctx=0x55dcadedcd20&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.052|&nbsp;24,8|&nbsp;SBuf.cc(30)&nbsp;SBuf:&nbsp;SBuf955&nbsp;created&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.052|&nbsp;24,7|&nbsp;SBuf.cc(85)&nbsp;assign:&nbsp;assigning&nbsp;SBuf955&nbsp;from&nbsp;SBuf118&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.052|&nbsp;24,8|&nbsp;SBuf.cc(38)&nbsp;SBuf:&nbsp;SBuf956&nbsp;created&nbsp;from&nbsp;id&nbsp;SBuf955&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.053|&nbsp;24,8|&nbsp;SBuf.cc(70)&nbsp;~SBuf:&nbsp;SBuf956&nbsp;destructed&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.053|&nbsp;24,8|&nbsp;SBuf.cc(70)&nbsp;~SBuf:&nbsp;SBuf955&nbsp;destructed&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.053|&nbsp;Initializing&nbsp;http_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3128&quot;&gt;0.0.0.0:3128&lt;/a&gt;&nbsp;TLS&nbsp;contexts&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.053|&nbsp;Using&nbsp;certificate&nbsp;in&nbsp;/etc/squid/squidCA.pem&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.053|&nbsp;24,7|&nbsp;SBuf.cc(160)&nbsp;rawSpace:&nbsp;reserving&nbsp;1&nbsp;for&nbsp;SBuf217&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.053|&nbsp;24,7|&nbsp;SBuf.cc(167)&nbsp;rawSpace:&nbsp;SBuf217&nbsp;not&nbsp;growing&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.053|&nbsp;24,7|&nbsp;SBuf.cc(160)&nbsp;rawSpace:&nbsp;reserving&nbsp;1&nbsp;for&nbsp;SBuf217&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.053|&nbsp;24,8|&nbsp;SBuf.cc(886)&nbsp;cow:&nbsp;SBuf217&nbsp;new&nbsp;size:23&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.053|&nbsp;24,8|&nbsp;SBuf.cc(857)&nbsp;reAlloc:&nbsp;SBuf217&nbsp;new&nbsp;size:&nbsp;23&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,9|&nbsp;MemBlob.cc(56)&nbsp;MemBlob:&nbsp;constructed,&nbsp;this=0x55dcadedd7c0&nbsp;id=blob1225&nbsp;reserveSize=23&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,8|&nbsp;MemBlob.cc(101)&nbsp;memAlloc:&nbsp;blob1225&nbsp;memAlloc:&nbsp;requested=23,&nbsp;received=40&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,7|&nbsp;SBuf.cc(865)&nbsp;reAlloc:&nbsp;SBuf217&nbsp;new&nbsp;store&nbsp;capacity:&nbsp;40&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;83,3|&nbsp;KeyData.cc(105)&nbsp;loadX509ChainFromFile:&nbsp;Using&nbsp;certificate&nbsp;chain&nbsp;in&nbsp;/etc/squid/squidCA.pem&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;83,3|&nbsp;KeyData.cc(123)&nbsp;loadX509ChainFromFile:&nbsp;Adding&nbsp;issuer&nbsp;CA:&nbsp;/CN=nobody&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;Using&nbsp;key&nbsp;in&nbsp;/etc/squid/squidCA.pem&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,7|&nbsp;SBuf.cc(160)&nbsp;rawSpace:&nbsp;reserving&nbsp;1&nbsp;for&nbsp;SBuf218&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,8|&nbsp;SBuf.cc(886)&nbsp;cow:&nbsp;SBuf218&nbsp;new&nbsp;size:23&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,8|&nbsp;SBuf.cc(857)&nbsp;reAlloc:&nbsp;SBuf218&nbsp;new&nbsp;size:&nbsp;23&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,9|&nbsp;MemBlob.cc(56)&nbsp;MemBlob:&nbsp;constructed,&nbsp;this=0x55dcadef07f0&nbsp;id=blob1226&nbsp;reserveSize=23&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,8|&nbsp;MemBlob.cc(101)&nbsp;memAlloc:&nbsp;blob1226&nbsp;memAlloc:&nbsp;requested=23,&nbsp;received=40&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,9|&nbsp;MemBlob.cc(82)&nbsp;~MemBlob:&nbsp;destructed,&nbsp;this=0x55dcaddf6c30&nbsp;id=blob554&nbsp;capacity=40&nbsp;size=23&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,7|&nbsp;SBuf.cc(865)&nbsp;reAlloc:&nbsp;SBuf218&nbsp;new&nbsp;store&nbsp;capacity:&nbsp;40&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;83,8|&nbsp;PeerOptions.cc(647)&nbsp;updateContextCa:&nbsp;Setting&nbsp;CA&nbsp;certificate&nbsp;locations.&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;83,9|&nbsp;ServerOptions.cc(444)&nbsp;updateContextClientCa:&nbsp;Not&nbsp;requiring&nbsp;any&nbsp;client&nbsp;certificates&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,8|&nbsp;SBuf.cc(30)&nbsp;SBuf:&nbsp;SBuf957&nbsp;created&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,7|&nbsp;SBuf.cc(85)&nbsp;assign:&nbsp;assigning&nbsp;SBuf957&nbsp;from&nbsp;SBuf118&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,8|&nbsp;SBuf.cc(38)&nbsp;SBuf:&nbsp;SBuf958&nbsp;created&nbsp;from&nbsp;id&nbsp;SBuf957&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,8|&nbsp;SBuf.cc(70)&nbsp;~SBuf:&nbsp;SBuf958&nbsp;destructed&lt;/div&gt;&lt;div&gt;2019/04/05&nbsp;06:29:48.054|&nbsp;24,8|&nbsp;SBuf.cc(70)&nbsp;~SBuf:&nbsp;SBuf957&nbsp;destructed&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;want&nbsp;I&nbsp;can&nbsp;attach&nbsp;all&nbsp;the&nbsp;cache&nbsp;log&nbsp;with&nbsp;startup&nbsp;and&nbsp;one&nbsp;request&nbsp;with&nbsp;error&lt;/div&gt;&lt;div&gt;Thanks&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Fri,&nbsp;5&nbsp;Apr&nbsp;2019&nbsp;at&nbsp;06:23,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;5/04/19&nbsp;12:37&nbsp;am,&nbsp;Davide&nbsp;Belloni&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&nbsp;this&nbsp;is&nbsp;the&nbsp;certificate&nbsp;that&nbsp;I&#39;m&nbsp;using&nbsp;at&nbsp;the&nbsp;moment:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
AFAICS&nbsp;the&nbsp;pieces&nbsp;Squid-4&nbsp;needs&nbsp;for&nbsp;your&nbsp;config&nbsp;and&nbsp;checks&nbsp;for&nbsp;are&nbsp;all&lt;br&gt;<br>
there.&lt;br&gt;<br>
&lt;br&gt;<br>
Are&nbsp;the&nbsp;pieces&nbsp;correctly&nbsp;ordered&nbsp;in&nbsp;the&nbsp;.pem&nbsp;file?&nbsp;key&nbsp;first,&nbsp;then&nbsp;CA&nbsp;cert.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Thu,&nbsp;4&nbsp;Apr&nbsp;2019&nbsp;at&nbsp;12:57,&nbsp;Davide&nbsp;Belloni&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Hi,&nbsp;thanks&nbsp;very&nbsp;much&nbsp;for&nbsp;all&nbsp;the&nbsp;advices!&lt;br&gt;<br>
&gt; &nbsp; &nbsp; About&nbsp;the&nbsp;action&nbsp;to&nbsp;generate&nbsp;the&nbsp;certificate&nbsp;I&#39;ve&nbsp;followed&nbsp;the&nbsp;squid&lt;br&gt;<br>
&gt; &nbsp; &nbsp; wiki,&nbsp;that&nbsp;doesn&#39;t&nbsp;modify&nbsp;(if&nbsp;I&nbsp;remember&nbsp;correctly)&nbsp;openssl&nbsp;conf&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; create&nbsp;it&nbsp;.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Do&nbsp;you&nbsp;have&nbsp;some&nbsp;link&nbsp;to&nbsp;a&nbsp;good&nbsp;howto&nbsp;about&nbsp;that?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Ah,&nbsp;we&nbsp;have&nbsp;several&nbsp;how-to&#39;s&nbsp;in&nbsp;the&nbsp;wiki.&nbsp;The&nbsp;SSL-Bump&nbsp;documentation&nbsp;has&lt;br&gt;<br>
an&nbsp;example.&nbsp;The&nbsp;ConfigExamples&nbsp;section&nbsp;has&nbsp;one&nbsp;for&nbsp;self-signed&nbsp;root&nbsp;CA&lt;br&gt;<br>
like&nbsp;yours,&nbsp;one&nbsp;for&nbsp;intermediate&nbsp;CA&nbsp;signing&nbsp;cert,&nbsp;and&nbsp;one&nbsp;for&nbsp;a&nbsp;wildcard&lt;br&gt;<br>
domain&nbsp;cert.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;one&nbsp;most&nbsp;relevant&nbsp;to&nbsp;what&nbsp;you&nbsp;have&nbsp;is:&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit#Features.2FDynamicSslCert.Create_Self-Signed_Root_CA_Certificate&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/ConfigExamples/Intercept/SslBumpExplicit#Features.2FDynamicSslCert.Create_Self-Signed_Root_CA_Certificate&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;this&nbsp;already&nbsp;matches&nbsp;what&nbsp;you&nbsp;are&nbsp;doing,&nbsp;and&nbsp;the&nbsp;PEM&nbsp;file&nbsp;content&nbsp;is&lt;br&gt;<br>
correct,&nbsp;and&nbsp;that&nbsp;context&nbsp;creation&nbsp;ERROR&nbsp;still&nbsp;shows&nbsp;up.&nbsp;Then&nbsp;your&nbsp;next&lt;br&gt;<br>
step&nbsp;would&nbsp;be&nbsp;to&nbsp;start&nbsp;Squid&nbsp;with&nbsp;the&nbsp;-X&nbsp;command&nbsp;line&nbsp;option&nbsp;and&nbsp;see&nbsp;if&lt;br&gt;<br>
anything&nbsp;more&nbsp;specific&nbsp;about&nbsp;it&nbsp;shows&nbsp;up.&lt;br&gt;<br>
 (This&nbsp;will&nbsp;produce&nbsp;a&nbsp;huge&nbsp;amount&nbsp;of&nbsp;debug&nbsp;info,&nbsp;but&nbsp;you&nbsp;only&nbsp;need&nbsp;the&lt;br&gt;<br>
startup&nbsp;sequence&nbsp;where&nbsp;the&nbsp;ERROR&nbsp;shows&nbsp;up.&nbsp;It&nbsp;should&nbsp;not&nbsp;be&nbsp;necessary&nbsp;to&lt;br&gt;<br>
send&nbsp;traffic&nbsp;until&nbsp;the&nbsp;context&nbsp;is&nbsp;working.)&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;Davide&nbsp;Belloni&lt;div&gt;&lt;a&nbsp;href=&quot;http://about.me/davidebelloni&quot;&nbsp;target=&quot;_blank&quot;&gt;http://about.me/davidebelloni&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://www.linkedin.com/in/davidebelloni&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.linkedin.com/in/davidebelloni&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
