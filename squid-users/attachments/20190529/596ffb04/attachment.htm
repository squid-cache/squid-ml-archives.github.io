<tt>
&lt;!DOCTYPE&nbsp;html&gt;&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;/&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;data-html-editor-font-wrapper=&quot;true&quot;&nbsp;style=&quot;font-family:&nbsp;arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;13px;&quot;&gt;Hi&nbsp;Hernan&nbsp;Saltiel,&lt;br&gt;&lt;br&gt;I&nbsp;can&nbsp;tell&nbsp;you&nbsp;my&nbsp;working&nbsp;NTLM&nbsp;auth&nbsp;configuration&nbsp;for&nbsp;Squid&nbsp;4.6&nbsp;(will&nbsp;work&nbsp;for&nbsp;4.7&nbsp;too).&nbsp;My&nbsp;documentation&nbsp;is&nbsp;an&nbsp;ansible&nbsp;playbook&nbsp;created&nbsp;by&nbsp;myself&nbsp;for&nbsp;the&nbsp;need&nbsp;of&nbsp;our&nbsp;company,&nbsp;so&nbsp;I&nbsp;don't&nbsp;remember&nbsp;from&nbsp;where&nbsp;I&nbsp;got&nbsp;all&nbsp;the&nbsp;information&nbsp;for&nbsp;a&nbsp;working&nbsp;configuration.&nbsp;Whenever&nbsp;I&nbsp;have&nbsp;to&nbsp;re-install&nbsp;one&nbsp;of&nbsp;our&nbsp;17+&nbsp;proxies,&nbsp;I&nbsp;just&nbsp;run&nbsp;the&nbsp;playbook&nbsp;once&nbsp;on&nbsp;a&nbsp;provisioned&nbsp;server&nbsp;:#)&lt;br&gt;&lt;br&gt;IMHO:&nbsp;Kerberos&nbsp;is&nbsp;better&nbsp;than&nbsp;NTLM,&nbsp;because&nbsp;Kerberos&nbsp;is&nbsp;a&nbsp;standard&nbsp;protocol&nbsp;while&nbsp;NTLM&nbsp;is&nbsp;Windows&nbsp;only.&nbsp;But&nbsp;my&nbsp;config&nbsp;below&nbsp;is&nbsp;for&nbsp;the&nbsp;moment&nbsp;also&nbsp;NTLM&nbsp;only.&nbsp;NTLM&nbsp;is&nbsp;easier&nbsp;to&nbsp;setup&nbsp;while&nbsp;KRB5&nbsp;takes&nbsp;a&nbsp;little&nbsp;time&nbsp;to&nbsp;understand&nbsp;the&nbsp;keytab&nbsp;file&nbsp;generation&nbsp;things.&lt;br&gt;About&nbsp;the&nbsp;wrapper&nbsp;in&nbsp;Squid:&nbsp;The&nbsp;names&nbsp;of&nbsp;this&nbsp;wrapper_files&nbsp;may&nbsp;changed&nbsp;and&nbsp;they&nbsp;are&nbsp;sometimes&nbsp;on&nbsp;other&nbsp;places.&nbsp;In&nbsp;my&nbsp;case&nbsp;the&nbsp;NTLM&nbsp;wrapper&nbsp;for&nbsp;Squid4&nbsp;is&nbsp;/usr/lib/squid/ext_ldap_group_acl.&lt;br&gt;&lt;br&gt;About&nbsp;NTLM&nbsp;and&nbsp;[mydomain]\[user01]@[MYPC]&nbsp;failed&nbsp;due&nbsp;to&nbsp;[Reading&nbsp;winbind&nbsp;reply&nbsp;failed!]:&nbsp;You&nbsp;should&nbsp;test&nbsp;if&nbsp;NTLM&nbsp;auth&nbsp;with&nbsp;winbind&nbsp;is&nbsp;working&nbsp;on&nbsp;your&nbsp;server&nbsp;before&nbsp;run&nbsp;ntlm&nbsp;auth&nbsp;in&nbsp;squid,&nbsp;with:&nbsp;wbinfo&nbsp;-g&nbsp;or&nbsp;wbinfo&nbsp;-u&nbsp;on&nbsp;the&nbsp;command&nbsp;line&nbsp;which&nbsp;must&nbsp;give&nbsp;you&nbsp;as&nbsp;an&nbsp;answer&nbsp;the&nbsp;users&nbsp;or&nbsp;groups&nbsp;from&nbsp;your&nbsp;AD&nbsp;(winbind&nbsp;&gt;&nbsp;smb.conf).&nbsp;There&nbsp;is&nbsp;also&nbsp;somewhere&nbsp;a&nbsp;wrapper-file&nbsp;to&nbsp;check&nbsp;wbinfo&nbsp;with&nbsp;squid&nbsp;wrapper&nbsp;too,&nbsp;but&nbsp;i&nbsp;dont&nbsp;remember&nbsp;which&nbsp;it&nbsp;is.&lt;br&gt;&lt;br&gt;So&nbsp;below&nbsp;is&nbsp;a&nbsp;working&nbsp;configuration&nbsp;(for&nbsp;me)&nbsp;on&nbsp;Ubuntu&nbsp;18.04&nbsp;server&nbsp;with&nbsp;squid&nbsp;4.6&nbsp;compiled&nbsp;from&nbsp;debian&nbsp;testing&nbsp;source&nbsp;(with&nbsp;ssl&nbsp;bump).&nbsp;&lt;br&gt;&lt;br&gt;-&nbsp;name:&nbsp;Install&nbsp;AD&nbsp;WinBind&nbsp;Authentification&nbsp;Packages&lt;br&gt;&nbsp;apt:&lt;br&gt;&nbsp;state:&nbsp;present&lt;br&gt;&nbsp;name:&lt;br&gt;&nbsp;-&nbsp;samba&lt;br&gt;&nbsp;-&nbsp;winbind&lt;br&gt;&nbsp;notify:&nbsp;restart&nbsp;winbind&nbsp;smbd&lt;br&gt;&nbsp;when:&nbsp;activedirectory_winbind_authentification&nbsp;==&nbsp;True&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&nbsp;-&nbsp;name:&nbsp;Upload&nbsp;smb.conf&nbsp;for&nbsp;WinBind&lt;br&gt;&nbsp;template:&lt;br&gt;&nbsp;src:&nbsp;smb.conf.j2&lt;br&gt;&nbsp;dest:&nbsp;/etc/samba/smb.conf&lt;br&gt;&nbsp;notify:&nbsp;restart&nbsp;winbind&nbsp;smbd&lt;br&gt;&nbsp;when:&nbsp;activedirectory_winbind_authentification&nbsp;==&nbsp;True&lt;br&gt;&lt;br&gt;################################################################&lt;br&gt;#/etc/samba/smb.conf&lt;br&gt;################################################################&lt;br&gt;#=======================&nbsp;Global&nbsp;Settings&nbsp;=======================&lt;br&gt;&lt;br&gt;[global]&lt;br&gt;netbios&nbsp;name&nbsp;=&nbsp;proxy01xx&lt;br&gt;workgroup&nbsp;=&nbsp;DOM-COMPANY&lt;br&gt;realm&nbsp;=&nbsp;companydomain.DE&lt;br&gt;server&nbsp;string&nbsp;=&lt;br&gt;security&nbsp;=&nbsp;ADS&lt;br&gt;encrypt&nbsp;passwords&nbsp;=&nbsp;true&lt;br&gt;log&nbsp;level&nbsp;=&nbsp;3&lt;br&gt;log&nbsp;file&nbsp;=&nbsp;/var/log/samba/%m&lt;br&gt;wins&nbsp;support&nbsp;=&nbsp;no&lt;br&gt;preferred&nbsp;master&nbsp;=&nbsp;no&lt;br&gt;domain&nbsp;master&nbsp;=&nbsp;no&lt;br&gt;local&nbsp;master&nbsp;=&nbsp;no&lt;br&gt;template&nbsp;shell&nbsp;=&nbsp;/bin/false&lt;br&gt;template&nbsp;homedir&nbsp;=&nbsp;/home/%D/%U&lt;br&gt;winbind&nbsp;uid&nbsp;=&nbsp;10000-20000&lt;br&gt;winbind&nbsp;gid&nbsp;=&nbsp;10000-20000&lt;br&gt;idmap&nbsp;config&nbsp;*&nbsp;:&nbsp;backend&nbsp;=&nbsp;tdb&lt;br&gt;idmap&nbsp;config&nbsp;*&nbsp;:&nbsp;range&nbsp;=&nbsp;3000-7999&lt;br&gt;idmap&nbsp;config&nbsp;DOM-COMPANY:backend&nbsp;=&nbsp;rid&lt;br&gt;idmap&nbsp;config&nbsp;DOM-COMPANY:schema_mode&nbsp;=&nbsp;rfc2307&lt;br&gt;idmap&nbsp;config&nbsp;DOM-COMPANY:range&nbsp;=&nbsp;8000-80000&lt;br&gt;enhanced&nbsp;browsing&nbsp;=&nbsp;no&lt;br&gt;winbind&nbsp;use&nbsp;default&nbsp;domain&nbsp;=&nbsp;yes&lt;br&gt;winbind&nbsp;enum&nbsp;users&nbsp;=&nbsp;no&lt;br&gt;winbind&nbsp;enum&nbsp;groups&nbsp;=&nbsp;no&lt;br&gt;idmap&nbsp;cache&nbsp;time&nbsp;=&nbsp;604800&lt;br&gt;idmap&nbsp;negative&nbsp;cache&nbsp;time&nbsp;=&nbsp;20&lt;br&gt;winbind&nbsp;cache&nbsp;time&nbsp;=&nbsp;600&lt;br&gt;&lt;br&gt;password&nbsp;server&nbsp;=&nbsp;192.168.xx.xx&nbsp;172.16.x.x&nbsp;172.16.x.x&nbsp;172.16.x.x&lt;br&gt;load&nbsp;printers&nbsp;=&nbsp;no&lt;br&gt;printing&nbsp;=&nbsp;bsd&lt;br&gt;printcap&nbsp;name&nbsp;=&nbsp;/dev/null&lt;br&gt;disable&nbsp;spoolss&nbsp;=&nbsp;yes&lt;br&gt;################################################################&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;-&nbsp;name:&nbsp;Add&nbsp;&quot;winbind&quot;&nbsp;to&nbsp;/etc/nsswitch.conf&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;passwd&nbsp;line&lt;br&gt;&nbsp;replace:&lt;br&gt;&nbsp;backup:&nbsp;yes&lt;br&gt;&nbsp;dest:&nbsp;/etc/nsswitch.conf&lt;br&gt;&nbsp;regexp:&nbsp;'^(group(?!.*\bwinbind\b).*)$'&lt;br&gt;&nbsp;replace:&nbsp;'\1&nbsp;winbind'&lt;br&gt;&nbsp;notify:&nbsp;restart&nbsp;winbind&nbsp;smbd&lt;br&gt;&nbsp;when:&nbsp;activedirectory_winbind_authentification&nbsp;==&nbsp;True&lt;br&gt;&nbsp;tags:&nbsp;nsswitch&lt;br&gt;&lt;br&gt;################################################################&lt;br&gt;#&nbsp;/etc/nsswitch.conf&lt;br&gt;#&lt;br&gt;#&nbsp;Example&nbsp;configuration&nbsp;of&nbsp;GNU&nbsp;Name&nbsp;Service&nbsp;Switch&nbsp;functionality.&lt;br&gt;#&nbsp;If&nbsp;you&nbsp;have&nbsp;the&nbsp;`glibc-doc-reference'&nbsp;and&nbsp;`info'&nbsp;packages&nbsp;installed,&nbsp;try:&lt;br&gt;#&nbsp;`info&nbsp;libc&nbsp;&quot;Name&nbsp;Service&nbsp;Switch&quot;'&nbsp;for&nbsp;information&nbsp;about&nbsp;this&nbsp;file.&lt;br&gt;&lt;br&gt;passwd:&nbsp;compat&nbsp;systemd&nbsp;winbind&lt;br&gt;group:&nbsp;compat&nbsp;systemd&nbsp;winbind&lt;br&gt;shadow:&nbsp;compat&lt;br&gt;gshadow:&nbsp;files&lt;br&gt;&lt;br&gt;hosts:&nbsp;files&nbsp;dns&lt;br&gt;networks:&nbsp;files&lt;br&gt;&lt;br&gt;protocols:&nbsp;db&nbsp;files&lt;br&gt;services:&nbsp;db&nbsp;files&lt;br&gt;ethers:&nbsp;db&nbsp;files&lt;br&gt;rpc:&nbsp;db&nbsp;files&lt;br&gt;&lt;br&gt;netgroup:&nbsp;nis&lt;br&gt;################################################################&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;-&nbsp;name:&nbsp;adding&nbsp;existing&nbsp;user&nbsp;&quot;proxy&quot;&nbsp;to&nbsp;group&nbsp;&quot;winbindd_priv&quot;,&nbsp;via&nbsp;https://www.linuxquestions.org/questions/linux-server-73/prompts-password-for-squid-using-ntlm-673036/#post4977410&lt;br&gt;&nbsp;user:&lt;br&gt;&nbsp;name:&nbsp;proxy&lt;br&gt;&nbsp;groups:&nbsp;winbindd_priv&lt;br&gt;&nbsp;append:&nbsp;yes&lt;br&gt;&nbsp;notify:&nbsp;restart&nbsp;squid&lt;br&gt;&nbsp;when:&nbsp;activedirectory_winbind_authentification&nbsp;==&nbsp;True&lt;br&gt;&lt;br&gt;################################################################&lt;br&gt;#/etc/group&nbsp;&lt;br&gt;################################################################&lt;br&gt;#(...)&lt;br&gt;winbindd_priv:x:116:proxy&lt;br&gt;#(...)&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;#This&nbsp;is&nbsp;the&nbsp;only&nbsp;step&nbsp;I&nbsp;don't&nbsp;have&nbsp;yet&nbsp;in&nbsp;my&nbsp;ansible&nbsp;playbook&nbsp;automated,&nbsp;but&nbsp;its&nbsp;required&nbsp;once&nbsp;after&nbsp;installing&nbsp;winbind&nbsp;for&nbsp;sure:&lt;br&gt;#Winbind&nbsp;join&nbsp;the&nbsp;server&nbsp;into&nbsp;the&nbsp;domain:&nbsp;&lt;br&gt;net&nbsp;ads&nbsp;join&nbsp;-U&nbsp;administrator&lt;br&gt;#test&nbsp;if&nbsp;winbind&nbsp;works:&lt;br&gt;wbinfo&nbsp;-g&lt;br&gt;wbinfo&nbsp;-u&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;-&nbsp;name:&nbsp;Upload&nbsp;squid.conf&lt;br&gt;&nbsp;template:&lt;br&gt;&nbsp;src:&nbsp;&quot;{{&nbsp;item&nbsp;}}.j2&quot;&lt;br&gt;&nbsp;dest:&nbsp;/etc/squid/{{&nbsp;item&nbsp;}}&lt;br&gt;&nbsp;owner:&nbsp;proxy&lt;br&gt;&nbsp;group:&nbsp;proxy&lt;br&gt;&nbsp;backup:&nbsp;yes&lt;br&gt;&nbsp;with_items:&lt;br&gt;&nbsp;-&nbsp;squid.conf&lt;br&gt;&nbsp;notify:&nbsp;restart&nbsp;squid&lt;br&gt;&nbsp;tags:&nbsp;squidconfonly&lt;br&gt;&lt;br&gt;&lt;br&gt;################################################################&lt;br&gt;#/etc/squid.conf&nbsp;&lt;br&gt;#relevant&nbsp;content&nbsp;for&nbsp;NTLM&nbsp;auth&lt;br&gt;################################################################&lt;br&gt;#########################################################&nbsp;NTLM&nbsp;#########################################################&lt;br&gt;#&nbsp;NTLM&nbsp;authentication,&nbsp;caching&nbsp;not&nbsp;neccessary,&nbsp;because&nbsp;the&nbsp;connection&nbsp;will&nbsp;be&nbsp;authenticated&nbsp;against&nbsp;the&nbsp;token&lt;br&gt;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--use-cached-creds&nbsp;--offline-logon&lt;br&gt;auth_param&nbsp;ntlm&nbsp;realm&nbsp;Proxy-Anmeldung&nbsp;NTLM:&nbsp;Bitte&nbsp;Domaene\Benutzername&nbsp;und&nbsp;Windows-Kennwort&nbsp;eingeben.&lt;br&gt;auth_param&nbsp;ntlm&nbsp;children&nbsp;50&lt;br&gt;&lt;br&gt;#Allow&nbsp;fetch&nbsp;intermediate&nbsp;certs&nbsp;before&nbsp;required&nbsp;authentication&nbsp;(required&nbsp;when&nbsp;SSL&nbsp;Bump&nbsp;+&nbsp;proxy_auth&nbsp;REQUIRED)&lt;br&gt;acl&nbsp;fetched_certificate&nbsp;transaction_initiator&nbsp;certificate-fetching&lt;br&gt;cache&nbsp;allow&nbsp;fetched_certificate&lt;br&gt;cache&nbsp;deny&nbsp;all&lt;br&gt;http_access&nbsp;allow&nbsp;fetched_certificate&lt;br&gt;&lt;br&gt;#########################################################&nbsp;Allow&nbsp;based&nbsp;on&nbsp;group&nbsp;membership&nbsp;#########################################################&lt;br&gt;#&nbsp;Authentication&nbsp;required,&nbsp;otherwise&nbsp;Login&nbsp;Pop-Up&lt;br&gt;acl&nbsp;Authenticated_Users&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;http_access&nbsp;deny&nbsp;!Authenticated_Users&lt;br&gt;&lt;br&gt;#&nbsp;Define&nbsp;external&nbsp;acl&lt;br&gt;external_acl_type&nbsp;ldap_group&nbsp;ipv4&nbsp;ttl=3600&nbsp;negative_ttl=1800&nbsp;children-max=150&nbsp;children-startup=10&nbsp;%LOGIN&nbsp;/usr/lib/squid/ext_ldap_group_acl&nbsp;-K&nbsp;-S&nbsp;-R&nbsp;\&lt;br&gt;-b&nbsp;&quot;DC=companydomain,DC=de&quot;&nbsp;\&lt;br&gt;-D&nbsp;&quot;CN=anLDAPuserwithREADaccess,OU=Sonstige,DC=companydomain,DC=de&quot;&nbsp;\&lt;br&gt;-w&nbsp;PASSWORDHERE&nbsp;\&lt;br&gt;-f&nbsp;&quot;(&amp;(objectclass=user)(sAMAccountName=%v)(memberof=CN=%a,CN=Users,DC=companydomain,DC=de))&quot;&nbsp;\&lt;br&gt;-h&nbsp;192.168.xx.xx&nbsp;172.16.xx.xx&nbsp;172.16.xx.xx&nbsp;172.16.xx.xx&lt;br&gt;&lt;br&gt;##&nbsp;Get&nbsp;group&nbsp;&quot;InternetAccess3&quot;&nbsp;from&nbsp;AD/LDAP&nbsp;and&nbsp;use&nbsp;this&nbsp;group&nbsp;in&nbsp;squid.conf&nbsp;as&nbsp;&quot;ldap_InternetAccess3&quot;&lt;br&gt;acl&nbsp;ldap_InternetAccess3&nbsp;external&nbsp;ldap_group&nbsp;InternetAccess3&lt;br&gt;&lt;br&gt;acl&nbsp;FTP_ports&nbsp;port&nbsp;21&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;8443&lt;br&gt;acl&nbsp;SSH_ports&nbsp;port&nbsp;22&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;#FTP&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;22&nbsp;#&nbsp;SSH&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;#&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;#&nbsp;https&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;#&nbsp;gopher&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;#&nbsp;wais&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;#&nbsp;http-mgmt&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;#&nbsp;gss-http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;#&nbsp;filemaker&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;8443&nbsp;#&nbsp;Plesk&lt;br&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&nbsp;!SSH_ports&nbsp;!FTP_ports&lt;br&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;ldap_InternetAccess3&nbsp;!FTP_ports&nbsp;!SSH_ports&nbsp;!streaming&nbsp;!badfileending&lt;br&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;acl&nbsp;localdom&nbsp;dstdomain&nbsp;.ourcompany.de&nbsp;ourcompanydomain2.com&lt;br&gt;acl&nbsp;NOCACHE&nbsp;dstdomain&nbsp;ourcompany.de&lt;br&gt;no_cache&nbsp;allow&nbsp;NOCACHE&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;################################################################&lt;br&gt;&lt;br&gt;&lt;br&gt;Hope&nbsp;it&nbsp;helps.&nbsp;&lt;br&gt;Good&nbsp;luck&lt;br&gt;Schroeffu&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;27.&nbsp;Mai&nbsp;2019&nbsp;16:16,&nbsp;&quot;Hernan&nbsp;Saltiel&quot;&nbsp;&lt;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;tabindex=&quot;-1&quot;&nbsp;href=&quot;mailto:hsaltiel@gmail.com?to=%22Hernan%20Saltiel%22%20&lt;hsaltiel@gmail.com&gt;&quot;&gt;hsaltiel@gmail.com&lt;/a&gt;&gt;&nbsp;schrieb:&lt;br&gt;&nbsp;&lt;blockquote&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&nbsp;&lt;div&gt;Hi&nbsp;all,&lt;/div&gt;&nbsp;&lt;div&gt;I'm&nbsp;trying&nbsp;to&nbsp;install&nbsp;a&nbsp;brand&nbsp;new&nbsp;Squid&nbsp;4.7&nbsp;on&nbsp;an&nbsp;Arch&nbsp;GNU/Linux&nbsp;(Kernel&nbsp;5.0.7),&nbsp;authorizing&nbsp;its&nbsp;users&nbsp;against&nbsp;Active&nbsp;Directory,&nbsp;based&nbsp;on&nbsp;a&nbsp;Windows&nbsp;2008&nbsp;R2&nbsp;Domain.&lt;/div&gt;&nbsp;&lt;div&gt;I&nbsp;configured&nbsp;samba4&nbsp;on&nbsp;the&nbsp;Arch&nbsp;machine,&nbsp;and&nbsp;it&nbsp;looks&nbsp;working&nbsp;well.&nbsp;wbinfo&nbsp;commands&nbsp;get&nbsp;executed&nbsp;and&nbsp;with&nbsp;correct&nbsp;output.&lt;/div&gt;&nbsp;&lt;div&gt;But&nbsp;when&nbsp;using&nbsp;the&nbsp;Squid,&nbsp;I&nbsp;get&nbsp;all&nbsp;the&nbsp;time&nbsp;messages&nbsp;like:&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Set&nbsp;Current&nbsp;Directory&nbsp;to&nbsp;/var/spool/squid&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Starting&nbsp;Squid&nbsp;Cache&nbsp;version&nbsp;4.7&nbsp;for&nbsp;x86_64-pc-linux-gnu...&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Service&nbsp;Name:&nbsp;squid&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Process&nbsp;ID&nbsp;7584&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Process&nbsp;Roles:&nbsp;worker&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;With&nbsp;1024&nbsp;file&nbsp;descriptors&nbsp;available&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Initializing&nbsp;IP&nbsp;Cache...&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;DNS&nbsp;Socket&nbsp;created&nbsp;at&nbsp;[::],&nbsp;FD&nbsp;7&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;DNS&nbsp;Socket&nbsp;created&nbsp;at&nbsp;0.0.0.0,&nbsp;FD&nbsp;10&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Adding&nbsp;domain&nbsp;ciabernal.local&nbsp;from&nbsp;/etc/resolv.conf&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Adding&nbsp;domain&nbsp;ciabernal.local&nbsp;from&nbsp;/etc/resolv.conf&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Adding&nbsp;nameserver&nbsp;192.168.32.5&nbsp;from&nbsp;/etc/resolv.conf&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;0/10&nbsp;'negotiate_wrapper'&nbsp;processes&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;helperStatefulOpenServers:&nbsp;No&nbsp;'negotiate_wrapper'&nbsp;processes&nbsp;needed.&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;0/10&nbsp;'ntlm_auth'&nbsp;processes&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;helperStatefulOpenServers:&nbsp;No&nbsp;'ntlm_auth'&nbsp;processes&nbsp;needed.&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;0/10&nbsp;'basic_ldap_auth'&nbsp;processes&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;No&nbsp;'basic_ldap_auth'&nbsp;processes&nbsp;needed.&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;0/5&nbsp;'ext_ldap_group_acl'&nbsp;processes&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;No&nbsp;'ext_ldap_group_acl'&nbsp;processes&nbsp;needed.&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Logfile:&nbsp;opening&nbsp;log&nbsp;/var/log/squid/access.log&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;WARNING:&nbsp;log&nbsp;name&nbsp;now&nbsp;starts&nbsp;with&nbsp;a&nbsp;module&nbsp;name.&nbsp;Use&nbsp;'stdio:/var/log/squid/access.log'&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Local&nbsp;cache&nbsp;digest&nbsp;enabled;&nbsp;rebuild/rewrite&nbsp;every&nbsp;3600/3600&nbsp;sec&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Store&nbsp;logging&nbsp;disabled&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Swap&nbsp;maxSize&nbsp;0&nbsp;+&nbsp;262144&nbsp;KB,&nbsp;estimated&nbsp;20164&nbsp;objects&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Target&nbsp;number&nbsp;of&nbsp;buckets:&nbsp;1008&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Using&nbsp;8192&nbsp;Store&nbsp;buckets&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Max&nbsp;Mem&nbsp;size:&nbsp;262144&nbsp;KB&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Max&nbsp;Swap&nbsp;size:&nbsp;0&nbsp;KB&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Using&nbsp;Least&nbsp;Load&nbsp;store&nbsp;dir&nbsp;selection&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Set&nbsp;Current&nbsp;Directory&nbsp;to&nbsp;/var/spool/squid&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Finished&nbsp;loading&nbsp;MIME&nbsp;types&nbsp;and&nbsp;icons.&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;HTCP&nbsp;Disabled.&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Squid&nbsp;plugin&nbsp;modules&nbsp;loaded:&nbsp;0&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;2019/05/27&nbsp;04:08:12&nbsp;kid1|&nbsp;Accepting&nbsp;HTTP&nbsp;Socket&nbsp;connections&nbsp;at&nbsp;local=[::]:3128&nbsp;remote=[::]&nbsp;FD&nbsp;12&nbsp;flags=9&lt;br&gt;2019/05/27&nbsp;04:08:13&nbsp;kid1|&nbsp;storeLateRelease:&nbsp;released&nbsp;0&nbsp;objects&lt;br&gt;2019/05/27&nbsp;04:08:22&nbsp;kid1|&nbsp;Starting&nbsp;new&nbsp;negotiateauthenticator&nbsp;helpers...&lt;br&gt;2019/05/27&nbsp;04:08:22&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;1/10&nbsp;'negotiate_wrapper'&nbsp;processes&lt;br&gt;negotiate_kerberos_auth.cc(489):&nbsp;pid=7586&nbsp;:2019/05/27&nbsp;04:08:22|&nbsp;negotiate_kerberos_auth:&nbsp;INFO:&nbsp;Starting&nbsp;version&nbsp;3.1.0sq&lt;br&gt;negotiate_kerberos_auth.cc(548):&nbsp;pid=7586&nbsp;:2019/05/27&nbsp;04:08:22|&nbsp;negotiate_kerberos_auth:&nbsp;INFO:&nbsp;Setting&nbsp;keytab&nbsp;to&nbsp;FILE:/etc/krb5.keytab&lt;br&gt;negotiate_kerberos_auth.cc(572):&nbsp;pid=7586&nbsp;:2019/05/27&nbsp;04:08:22|&nbsp;negotiate_kerberos_auth:&nbsp;INFO:&nbsp;Changed&nbsp;keytab&nbsp;to&nbsp;MEMORY:negotiate_kerberos_auth_7586&lt;br&gt;directory_create_or_exist_strict:&nbsp;invalid&nbsp;ownership&nbsp;on&nbsp;directory&nbsp;/var/cache/samba/msg.lock&lt;br&gt;cmdline_messaging_context:&nbsp;Unable&nbsp;to&nbsp;initialize&nbsp;messaging&nbsp;context.&lt;br&gt;lp_load_ex:&nbsp;refreshing&nbsp;parameters&lt;br&gt;Initialising&nbsp;global&nbsp;parameters&lt;br&gt;rlimit_max:&nbsp;increasing&nbsp;rlimit_max&nbsp;(1024)&nbsp;to&nbsp;minimum&nbsp;Windows&nbsp;limit&nbsp;(16384)&lt;br&gt;Processing&nbsp;section&nbsp;&quot;[Global]&quot;&lt;br&gt;GENSEC&nbsp;backend&nbsp;'gssapi_spnego'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'gssapi_krb5'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'gssapi_krb5_sasl'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'spnego'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'schannel'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'naclrpc_as_system'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'sasl-EXTERNAL'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'ntlmssp'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'ntlmssp_resume_ccache'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'http_basic'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'http_ntlm'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'http_negotiate'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'krb5'&nbsp;registered&lt;br&gt;GENSEC&nbsp;backend&nbsp;'fake_gssapi_krb5'&nbsp;registered&lt;br&gt;Got&nbsp;NTLMSSP&nbsp;neg_flags=0xe2088297&lt;br&gt;Got&nbsp;user=[user01]&nbsp;domain=[mydomain]&nbsp;workstation=[MYPC]&nbsp;len1=24&nbsp;len2=304&lt;br&gt;Login&nbsp;for&nbsp;user&nbsp;[mydomain]\[user01]@[MYPC]&nbsp;failed&nbsp;due&nbsp;to&nbsp;[Reading&nbsp;winbind&nbsp;reply&nbsp;failed!]&lt;br&gt;GENSEC&nbsp;login&nbsp;failed:&nbsp;NT_STATUS_UNSUCCESSFUL&lt;br&gt;2019/05/27&nbsp;04:08:22&nbsp;kid1|&nbsp;ERROR:&nbsp;Negotiate&nbsp;Authentication&nbsp;validating&nbsp;user.&nbsp;Result:&nbsp;{result=BH,&nbsp;notes={message:&nbsp;NT_STATUS_UNSUCCESSFUL&nbsp;NT_STATUS_UNSUCCESSFUL;&nbsp;}}&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;Some&nbsp;questions&nbsp;I&nbsp;have:&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;1)&nbsp;About&nbsp;the&nbsp;message:&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;directory_create_or_exist_strict:&nbsp;invalid&nbsp;ownership&nbsp;on&nbsp;directory&nbsp;/var/cache/samba/msg.lock&lt;br&gt;cmdline_messaging_context:&nbsp;Unable&nbsp;to&nbsp;initialize&nbsp;messaging&nbsp;context.&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;Checking&nbsp;the&nbsp;permissions,&nbsp;it&nbsp;has&nbsp;755,&nbsp;so&nbsp;I&nbsp;really&nbsp;do&nbsp;not&nbsp;understand&nbsp;why&nbsp;itÂ´s&nbsp;showing&nbsp;this.&nbsp;Don't&nbsp;know&nbsp;if&nbsp;there&nbsp;is&nbsp;some&nbsp;ownership&nbsp;rule&nbsp;or&nbsp;something&nbsp;like&nbsp;this...&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;2)&nbsp;About&nbsp;the&nbsp;message:&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;Login&nbsp;for&nbsp;user&nbsp;[mydomain]\[user01]@[MYPC]&nbsp;failed&nbsp;due&nbsp;to&nbsp;[Reading&nbsp;winbind&nbsp;reply&nbsp;failed!]&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;I&nbsp;tried&nbsp;debugging&nbsp;Samba,&nbsp;but&nbsp;see&nbsp;no&nbsp;message&nbsp;indicating&nbsp;something&nbsp;here.&nbsp;Any&nbsp;help&nbsp;would&nbsp;be&nbsp;really&nbsp;appreciated.&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;3)&nbsp;Is&nbsp;there&nbsp;any&nbsp;example&nbsp;configuration&nbsp;for&nbsp;Squid&nbsp;4&nbsp;+&nbsp;Samba&nbsp;4&nbsp;+&nbsp;Active&nbsp;Directory?&nbsp;Sorry&nbsp;for&nbsp;this,&nbsp;but&nbsp;I&nbsp;see&nbsp;tons&nbsp;of&nbsp;information&nbsp;about&nbsp;Active&nbsp;Directory&nbsp;for&nbsp;Samba&nbsp;4&nbsp;and&nbsp;Squid3,&nbsp;but&nbsp;not&nbsp;much&nbsp;about&nbsp;the&nbsp;configuration&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;have.&lt;/div&gt;&nbsp;&lt;div&gt;I&nbsp;see&nbsp;several&nbsp;differences,&nbsp;for&nbsp;instance:&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;1)&nbsp;Use&nbsp;of&nbsp;&quot;negotiate_wrapper&quot;.&lt;/div&gt;&nbsp;&lt;div&gt;2)&nbsp;Several&nbsp;aspects&nbsp;of&nbsp;files&nbsp;located&nbsp;on&nbsp;/var/lib/squid,&nbsp;where&nbsp;I&nbsp;do&nbsp;not&nbsp;see&nbsp;the&nbsp;equivalence&nbsp;between&nbsp;them&nbsp;and&nbsp;the&nbsp;ones&nbsp;listed&nbsp;for&nbsp;Squid3,&nbsp;and&nbsp;visible&nbsp;on&nbsp;tons&nbsp;of&nbsp;documentation.&lt;/div&gt;&nbsp;&lt;div&gt;3)&nbsp;Some&nbsp;docs&nbsp;say&nbsp;NTLM&nbsp;is&nbsp;deprecated,&nbsp;some&nbsp;are&nbsp;still&nbsp;showing&nbsp;ntlm_auth&nbsp;on&nbsp;config&nbsp;files.&nbsp;This&nbsp;is&nbsp;why&nbsp;I&nbsp;really&nbsp;need&nbsp;to&nbsp;see&nbsp;if&nbsp;there&nbsp;is&nbsp;any&nbsp;example&nbsp;for&nbsp;this&nbsp;config...&lt;/div&gt;&nbsp;&lt;div&gt;&lt;/div&gt;&nbsp;&lt;div&gt;Thanks&nbsp;a&nbsp;lot&nbsp;in&nbsp;advance&nbsp;for&nbsp;your&nbsp;time&nbsp;and&nbsp;attention,&nbsp;and&nbsp;best&nbsp;regards.&lt;/div&gt;&nbsp;&lt;div&gt;&nbsp;&lt;br&gt;--&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;HeCSa&lt;/div&gt;&nbsp;&lt;/div&gt;&nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&nbsp;&lt;br&gt;&lt;br&gt;&lt;signature&gt;&lt;/signature&gt;&nbsp;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;<br>

</tt>
