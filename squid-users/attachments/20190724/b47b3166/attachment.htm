<tt>
&lt;html&gt;&lt;body&gt;&lt;div&gt;Good&nbsp;morning&nbsp;(CEST).&lt;/div&gt;&lt;div&gt;Solved&nbsp;for&nbsp;NTLM.&lt;/div&gt;&lt;div&gt;I&nbsp;added&nbsp;the&nbsp;squid&nbsp;user&nbsp;to&nbsp;the&nbsp;group&nbsp;winbindd_priv&nbsp;as&nbsp;described&nbsp;in&nbsp;&quot;man&nbsp;ntml_auth&quot;.&nbsp;Well,&nbsp;I&nbsp;just&nbsp;overlooked&nbsp;it.&lt;/div&gt;&lt;div&gt;Thanks&nbsp;all&nbsp;for&nbsp;reading/thinking/help.&lt;/div&gt;&lt;div&gt;Zbynek&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;aside&gt;<br>
----------&nbsp;Původní&nbsp;e-mail&nbsp;----------&lt;br&gt;<br>
Od:&nbsp;zby@post.cz&lt;br&gt;<br>
Komu:&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;squid3@treenet.co.nz&gt;&lt;br&gt;<br>
Datum:&nbsp;23.&nbsp;7.&nbsp;2019&nbsp;18:24:13&lt;br&gt;<br>
Předmět:&nbsp;Re:&nbsp;[squid-users]&nbsp;squid&nbsp;4&nbsp;fails&nbsp;to&nbsp;authenticate&nbsp;using&nbsp;NTLM<br>
&lt;/aside&gt;&lt;br&gt;&lt;blockquote&nbsp;data-email=&quot;zby@post.cz&quot;&gt;&lt;div&gt;I&nbsp;found&nbsp;one&nbsp;more&nbsp;thing&nbsp;in&nbsp;the&nbsp;cache.log:&lt;/div&gt;&lt;div&gt;Got&nbsp;user=[user1]&nbsp;domain=[DOM1]&nbsp;workstation=[machine1]&nbsp;len1=24&nbsp;len2=334&lt;br&gt;Login&nbsp;for&nbsp;user&nbsp;[DOM1\[user1]@[machine1&nbsp;failed&nbsp;due&nbsp;to&nbsp;[Reading&nbsp;winbind&nbsp;reply&nbsp;failed!]&lt;br&gt;ntlmssp_server_auth_send:&nbsp;Checking&nbsp;NTLMSSP&nbsp;password&nbsp;for&nbsp;DOM1\user1&nbsp;failed:&nbsp;NT_STATUS_UNSUCCESSFUL&lt;br&gt;gensec_update_done:&nbsp;ntlmssp[0x55713e452900]:&nbsp;NT_STATUS_UNSUCCESSFUL&lt;br&gt;GENSEC&nbsp;login&nbsp;failed:&nbsp;NT_STATUS_UNSUCCESSFUL&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Why&nbsp;failed?&lt;/div&gt;&lt;div&gt;/var/lib/samba:&lt;br&gt;&lt;/div&gt;&lt;div&gt;drwxr-x---&nbsp;&nbsp;2&nbsp;root&nbsp;winbindd_priv&nbsp;&nbsp;&nbsp;4096&nbsp;Jul&nbsp;23&nbsp;18:09&nbsp;winbindd_privileged&lt;/div&gt;&lt;div&gt;/var/run/samba:&lt;/div&gt;&lt;div&gt;drwxr-xr-x&nbsp;2&nbsp;root&nbsp;root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;60&nbsp;Jul&nbsp;23&nbsp;18:09&nbsp;winbindd&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;I&nbsp;chmod&nbsp;to&nbsp;anything&nbsp;else&nbsp;than&nbsp;expected&nbsp;winbindd&nbsp;fails&nbsp;to&nbsp;start&nbsp;complaining&nbsp;about&nbsp;an&nbsp;unexpected&nbsp;dir&nbsp;mode.&lt;/div&gt;&lt;div&gt;The&nbsp;dir&nbsp;modes&nbsp;remain&nbsp;the&nbsp;same&nbsp;as&nbsp;&quot;defined&quot;&nbsp;in&nbsp;the&nbsp;debian&nbsp;package.&lt;/div&gt;&lt;div&gt;ntlm_auth&nbsp;--username=user1&nbsp;run&nbsp;as&nbsp;a&nbsp;regular&nbsp;user&nbsp;results&nbsp;in:&nbsp;&quot;NT_STATUS_OK:&nbsp;The&nbsp;operation&nbsp;completed&nbsp;successfully.&nbsp;(0x0)&quot;&lt;/div&gt;&lt;div&gt;It&nbsp;should&nbsp;fail&nbsp;if&nbsp;not&nbsp;allowed&nbsp;to&nbsp;read&nbsp;from&nbsp;winbind,&nbsp;I&nbsp;suppose.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks.&lt;/div&gt;&lt;div&gt;Zb&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;aside&gt;<br>
----------&nbsp;Původní&nbsp;e-mail&nbsp;----------&lt;br&gt;<br>
Od:&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;squid3@treenet.co.nz&gt;&lt;br&gt;<br>
Komu:&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
Datum:&nbsp;23.&nbsp;7.&nbsp;2019&nbsp;11:03:37&lt;br&gt;<br>
Předmět:&nbsp;Re:&nbsp;[squid-users]&nbsp;squid&nbsp;4&nbsp;fails&nbsp;to&nbsp;authenticate&nbsp;using&nbsp;NTLM<br>
&lt;/aside&gt;&lt;br&gt;&lt;blockquote&nbsp;data-email=&quot;squid3@treenet.co.nz&quot;&gt;On&nbsp;23/07/19&nbsp;7:53&nbsp;am,&nbsp;zby&nbsp;wrote:&lt;br&gt;&gt;&nbsp;My&nbsp;problem:&nbsp;&nbsp;my&nbsp;browser&nbsp;keeps&nbsp;on&nbsp;prompting&nbsp;for&nbsp;authentication.&lt;br&gt;&gt;&nbsp;Facts:&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;Debian&nbsp;10&nbsp;x86_64&lt;br&gt;&gt;&nbsp;squid-4.6&nbsp;+&nbsp;samba-4.9&lt;br&gt;&gt;&nbsp;joined&nbsp;AD&nbsp;using&nbsp;&quot;net&nbsp;ads&nbsp;join&nbsp;-U&nbsp;...&quot;.&nbsp;OK.&lt;br&gt;&gt;&nbsp;wbinfo&nbsp;-t&nbsp;:&nbsp;OK&lt;br&gt;&gt;&nbsp;wbinfo&nbsp;-P&nbsp;or&nbsp;-p&nbsp;:&nbsp;OK&lt;br&gt;&gt;&nbsp;wbinfo&nbsp;-i&nbsp;userXYZ&nbsp;:&nbsp;returns&nbsp;data&nbsp;(OK)&lt;br&gt;&gt;&nbsp;wbinfo&nbsp;-g&nbsp;(well,&nbsp;fails&nbsp;to&nbsp;&quot;deliver&quot;,&nbsp;too&nbsp;many&nbsp;users?)&lt;br&gt;&gt;&nbsp;smbclient&nbsp;-U&nbsp;userXYZ&nbsp;//host/share&nbsp;:&nbsp;works,&nbsp;logs&nbsp;me&nbsp;in&lt;br&gt;&lt;br&gt;This&nbsp;is&nbsp;irrelevant&nbsp;to&nbsp;Squid.&nbsp;It&nbsp;only&nbsp;tells&nbsp;that&nbsp;the&nbsp;user&nbsp;account&nbsp;has&lt;br&gt;filesystem&nbsp;access&nbsp;privileges.&nbsp;Nothing&nbsp;about&nbsp;web&nbsp;access&nbsp;privileges,&nbsp;or&lt;br&gt;whether&nbsp;the&nbsp;*Squid*&nbsp;user&nbsp;account&nbsp;has&nbsp;access&nbsp;to&nbsp;authenticate&nbsp;user&nbsp;logins.&lt;br&gt;&lt;br&gt;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;wbinfo&nbsp;-a&nbsp;domain\\user%pass:&lt;br&gt;&gt;&nbsp;plaintext&nbsp;password&nbsp;authentication&nbsp;succeeded&lt;br&gt;&lt;br&gt;&nbsp;&quot;plaintext&quot;&nbsp;means&nbsp;Basic&nbsp;authentication.&lt;br&gt;&lt;br&gt;&gt;&nbsp;challenge/response&nbsp;password&nbsp;authentication&nbsp;failed&lt;br&gt;&gt;&nbsp;&lt;br&gt;&lt;br&gt;Challenge/Response&nbsp;could&nbsp;mean&nbsp;anything&nbsp;auth&nbsp;related.&lt;br&gt;&lt;br&gt;&lt;br&gt;&gt;&nbsp;sqadmin@host13:~$&nbsp;ntlm_auth&nbsp;--helper-protocol=squid-2.5-ntlmssp&lt;br&gt;&gt;&nbsp;--domain=ad001&lt;br&gt;&gt;&nbsp;userw01&nbsp;Passwd001&lt;br&gt;&gt;&nbsp;SPNEGO&nbsp;request&nbsp;[userw01&nbsp;Passwd001]&nbsp;invalid&nbsp;prefix&lt;br&gt;&gt;&nbsp;BH&nbsp;SPNEGO&nbsp;request&nbsp;invalid&nbsp;prefix&lt;br&gt;&gt;&nbsp;&lt;br&gt;&lt;br&gt;&quot;userw01&nbsp;Passwd001&quot;&nbsp;is&nbsp;not&nbsp;a&nbsp;SPNEGO&nbsp;token.&lt;br&gt;&lt;br&gt;see&lt;br&gt;&lt;https://wiki.squid-cache.org/Features/AddonHelpers#Negotiate_and_NTLM_Scheme&gt;&lt;br&gt;&lt;br&gt;Pass&nbsp;the&nbsp;helper&nbsp;the&nbsp;&quot;KK&quot;&nbsp;request&nbsp;command&nbsp;and&nbsp;the&nbsp;token&nbsp;you&nbsp;see&nbsp;in&nbsp;the&lt;br&gt;HTTP&nbsp;headers.&nbsp;For&nbsp;example:&lt;br&gt;&lt;br&gt;KK&nbsp;TlRMTVNTUAADAAAAGAAYAIwAAABOAU4BpAAAAAoACgBYAAAAEAAQAGIAAAAa...&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;Amos&lt;br&gt;_______________________________________________&lt;br&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;squid-users@lists.squid-cache.org&lt;br&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;br&gt;&lt;/blockquote&gt;_______________________________________________&lt;br&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;squid-users@lists.squid-cache.org&lt;br&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;br&gt;&lt;/blockquote&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
