<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Fri,&nbsp;Aug&nbsp;9,&nbsp;2019&nbsp;at&nbsp;2:37&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;8/9/19&nbsp;1:37&nbsp;PM,&nbsp;Tom&nbsp;Karches&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Fri,&nbsp;Aug&nbsp;9,&nbsp;2019&nbsp;at&nbsp;11:38&nbsp;AM&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Ok,&nbsp;here&nbsp;is&nbsp;the&nbsp;info&nbsp;from&nbsp;the&nbsp;real&nbsp;trace.&nbsp;First&nbsp;time&nbsp;with&nbsp;#dns_v4_first&lt;br&gt;<br>
&gt;&nbsp;on &nbsp;commented&nbsp;out,&nbsp;2nd&nbsp;time&nbsp;&quot;dns_v4_&nbsp;first&nbsp;on&quot;&nbsp;is&nbsp;active.&nbsp;Difference&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;with&nbsp;no&nbsp;&quot;dns_v4_first&nbsp;on&quot;&nbsp;directive,&nbsp;I&nbsp;get&nbsp;a&nbsp;RR_CONNECT_FAIL&nbsp;111.&nbsp;When&lt;br&gt;<br>
&gt;&nbsp;active,&nbsp;I&nbsp;get&nbsp;a&nbsp;RR_CONNECT_FAIL&nbsp;101.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
BTW,&nbsp;it&nbsp;may&nbsp;be&nbsp;easier&nbsp;for&nbsp;you&nbsp;to&nbsp;read&nbsp;--trace--ascii&nbsp;output.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;didn&#39;t&nbsp;see&nbsp;anything&nbsp;additional&nbsp;using&nbsp;the&nbsp;ascii&nbsp;option,&nbsp;though&nbsp;it&nbsp;is&nbsp;easier&nbsp;to&nbsp;read&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
Both&nbsp;are&nbsp;ERR_CONNECT_FAIL&nbsp;errors&nbsp;(&quot;connection&nbsp;reset&nbsp;by&nbsp;peer&quot;&nbsp;and&lt;br&gt;<br>
&quot;connection&nbsp;refused&quot;).&nbsp;Your&nbsp;Squid&nbsp;cannot&nbsp;connect&nbsp;to&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&lt;br&gt;<br>
connect&nbsp;in&nbsp;order&nbsp;to&nbsp;establish&nbsp;a&nbsp;TCP&nbsp;tunnel.&nbsp;It&nbsp;could&nbsp;be&nbsp;a&nbsp;Squid&lt;br&gt;<br>
misconfiguration,&nbsp;a&nbsp;routing&nbsp;problem,&nbsp;insufficient&nbsp;capabilities,&nbsp;and&nbsp;many&lt;br&gt;<br>
other&nbsp;things.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;suggest&nbsp;checking&nbsp;cache.log&nbsp;for&nbsp;WARNINGs&nbsp;and&nbsp;ERRORs.&nbsp;After&nbsp;arriving&nbsp;at&lt;br&gt;<br>
a&nbsp;clean&nbsp;cache.log,&nbsp;I&nbsp;would&nbsp;use&nbsp;a&nbsp;packet&nbsp;capture&nbsp;(or&nbsp;similar)&nbsp;to&nbsp;see&lt;br&gt;<br>
where&nbsp;Squid&nbsp;is&nbsp;trying&nbsp;to&nbsp;connect&nbsp;(and&nbsp;which&nbsp;local&nbsp;address&nbsp;it&nbsp;is&lt;br&gt;<br>
connecting&nbsp;from).&nbsp;That&nbsp;information&nbsp;may&nbsp;be&nbsp;enough&nbsp;to&nbsp;figure&nbsp;out&nbsp;why&nbsp;Squid&lt;br&gt;<br>
cannot&nbsp;connect&nbsp;successfully.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;what&nbsp;I&nbsp;am&nbsp;seeing&nbsp;from&nbsp;cache.log&nbsp;when&nbsp;I&nbsp;attempt&nbsp;the&nbsp;proxy&nbsp;:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:18px;line-height:normal;font-family:Menlo;color:rgb(0,0,0)&quot;&gt;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;font-variant-ligatures:no-common-ligatures&quot;&gt;2019/08/09&nbsp;16:19:08.127&nbsp;kid1|&nbsp;33,2|&nbsp;client_side.cc(817)&nbsp;swanSong:&nbsp;local=&lt;a&nbsp;href=&quot;http://127.0.0.1:3128&quot;&gt;127.0.0.1:3128&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://127.0.0.1:33428&quot;&gt;127.0.0.1:33428&lt;/a&gt;&nbsp;flags=1&lt;/span&gt;&lt;/p&gt;<br>
&lt;/div&gt;&lt;span&nbsp;style=&quot;font-variant-ligatures:no-common-ligatures;color:rgb(0,0,0);font-family:Menlo;font-size:18px&quot;&gt;2019/08/09&nbsp;16:19:10.051&nbsp;kid1|&nbsp;33,2|&nbsp;client_side.cc(817)&nbsp;swanSong:&nbsp;local=&lt;a&nbsp;href=&quot;http://152.7.114.135:3128&quot;&gt;152.7.114.135:3128&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://10.50.54.21:43198&quot;&gt;10.50.54.21:43198&lt;/a&gt;&nbsp;flags=1&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Right&nbsp;now&nbsp;my&nbsp;debug&nbsp;is&nbsp;set&nbsp;to &lt;span&nbsp;style=&quot;font-variant-ligatures:no-common-ligatures;color:rgb(0,0,0);font-family:Menlo;font-size:16px&quot;&gt;ALL,1&nbsp;33,2.&nbsp;Is&nbsp;there&nbsp;a&nbsp;better&nbsp;set&nbsp;of&nbsp;options&nbsp;to&nbsp;provide&nbsp;me&nbsp;more&nbsp;visibility&nbsp;of&nbsp;what&nbsp;might&nbsp;be&nbsp;wrong?&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-variant-ligatures:no-common-ligatures;color:rgb(0,0,0);font-family:Menlo;font-size:16px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
<br>
&lt;div&gt;Here&nbsp;is&nbsp;our&nbsp;config&nbsp;file,&nbsp;in&nbsp;case&nbsp;that&nbsp;helps.&nbsp;If&nbsp;it&#39;s&nbsp;something&nbsp;obvious&nbsp;I&#39;m&nbsp;not&nbsp;seeing.&nbsp;We&nbsp;have&nbsp;some&nbsp;whitelists,&nbsp;but&nbsp;I&nbsp;am&nbsp;running&nbsp;with&nbsp;those&nbsp;turned&nbsp;off&nbsp;until&nbsp;this&nbsp;is&nbsp;working&nbsp;so&nbsp;I&nbsp;won&#39;t&nbsp;include&nbsp;them&nbsp;here.&nbsp;Thanks&nbsp;for&nbsp;the&nbsp;help.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Tom&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;#&nbsp;squid&nbsp;config&nbsp;file&nbsp;-&nbsp;2019-08-09&lt;br&gt;#&nbsp;Timeouts&lt;br&gt;connect_timeout&nbsp;2&nbsp;minutes&nbsp; #&nbsp;For&nbsp;CDWG&nbsp;Vendor&lt;br&gt;debug_options&nbsp;ALL,1&nbsp;33,2&lt;br&gt;&lt;br&gt;dns_v4_first&nbsp;on&lt;br&gt;&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;1443&nbsp; &nbsp; &nbsp;#&nbsp;&lt;a&nbsp;href=&quot;http://b2b-test.apple.com:1443&quot;&gt;b2b-test.apple.com:1443&lt;/a&gt;&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;3079&nbsp; &nbsp; &nbsp;#&nbsp;&lt;a&nbsp;href=&quot;http://bci.stapleslink.com&quot;&gt;bci.stapleslink.com&lt;/a&gt;&nbsp;special&nbsp;port&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;4443&nbsp; &nbsp; &nbsp;#&nbsp;&lt;a&nbsp;href=&quot;http://pascal.apple.com:4443&quot;&gt;pascal.apple.com:4443&lt;/a&gt;&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;993&nbsp; &nbsp; &nbsp; #&nbsp;IMAP&nbsp;from&nbsp;Stat&nbsp;application&nbsp;to&nbsp;Gmail&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;22&nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;Allow&nbsp;SSH&nbsp;and&nbsp;SFTP&nbsp;to&nbsp;proxy/connect&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;8443&nbsp; &nbsp; &nbsp;#&nbsp;redhat&nbsp;cap&nbsp;port&lt;br&gt;&lt;br&gt;&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;ftp&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;https&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;gopher&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;wais&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp; #&nbsp;unregistered&nbsp;ports&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;http-mgmt&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;gss-http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;filemaker&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;5228&nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;google&nbsp;services&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1935&nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;cam&nbsp;steamer&nbsp;port&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;8443&nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;redhat&nbsp;cap&nbsp;port&lt;br&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;&lt;br&gt;#&lt;br&gt;#&nbsp;Recommended&nbsp;minimum&nbsp;Access&nbsp;Permission&nbsp;configuration:&lt;br&gt;#&lt;br&gt;#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;br&gt;http_access&nbsp;allow&nbsp;manager&nbsp;localhost&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;&lt;br&gt;#&nbsp;Deny&nbsp;requests&nbsp;to&nbsp;certain&nbsp;unsafe&nbsp;ports&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;&lt;br&gt;#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;br&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;&lt;br&gt;#&nbsp;We&nbsp;strongly&nbsp;recommend&nbsp;the&nbsp;following&nbsp;be&nbsp;uncommented&nbsp;to&nbsp;protect&nbsp;innocent&lt;br&gt;#&nbsp;web&nbsp;applications&nbsp;running&nbsp;on&nbsp;the&nbsp;proxy&nbsp;server&nbsp;who&nbsp;think&nbsp;the&nbsp;only&lt;br&gt;#&nbsp;one&nbsp;who&nbsp;can&nbsp;access&nbsp;services&nbsp;on&nbsp;&quot;localhost&quot;&nbsp;is&nbsp;a&nbsp;local&nbsp;user&lt;br&gt;#http_access&nbsp;deny&nbsp;to_localhost&lt;br&gt;&lt;br&gt;#&lt;br&gt;#&nbsp;INSERT&nbsp;YOUR&nbsp;OWN&nbsp;RULE(S)&nbsp;HERE&nbsp;TO&nbsp;ALLOW&nbsp;ACCESS&nbsp;FROM&nbsp;YOUR&nbsp;CLIENTS&lt;br&gt;#&lt;br&gt;&lt;br&gt;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;br&gt;#&nbsp;Adapt&nbsp;localnet&nbsp;in&nbsp;the&nbsp;ACL&nbsp;section&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&lt;br&gt;#&nbsp;from&nbsp;where&nbsp;browsing&nbsp;should&nbsp;be&nbsp;allowed&lt;br&gt;http_access&nbsp;allow&nbsp;localnet&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;&lt;br&gt;#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;icp_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;br&gt;http_port&nbsp;3128&lt;br&gt;&lt;br&gt;#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.&lt;br&gt;#cache_dir&nbsp;ufs&nbsp;/var/spool/squid&nbsp;2048&nbsp;16&nbsp;256&lt;br&gt;&lt;br&gt;#&nbsp;Default&nbsp;configuration&nbsp;value&nbsp;for&nbsp;cache_mem&lt;br&gt;#cache_mem&nbsp;256&nbsp;MB&lt;br&gt;cache&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir&lt;br&gt;coredump_dir&nbsp;/var/spool/squid&lt;br&gt;&lt;br&gt;#&nbsp;Add&nbsp;any&nbsp;of&nbsp;your&nbsp;own&nbsp;refresh_pattern&nbsp;entries&nbsp;above&nbsp;these.&lt;br&gt;refresh_pattern&nbsp;^ftp:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1440&nbsp; &nbsp; 20%&nbsp; &nbsp; &nbsp;10080&lt;br&gt;refresh_pattern&nbsp;^gopher:&nbsp; &nbsp; &nbsp; &nbsp; 1440&nbsp; &nbsp; 0%&nbsp; &nbsp; &nbsp; 1440&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp; &nbsp; &nbsp;0%&nbsp; &nbsp; &nbsp; 0&lt;br&gt;refresh_pattern&nbsp;.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp;20%&nbsp; &nbsp; &nbsp;4320&lt;br&gt;&lt;br&gt;max_filedescriptors&nbsp;65000&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;Thomas&nbsp;Karches&lt;br&gt;NCSU&nbsp;OIT&nbsp;CSI&nbsp;- Systems&nbsp;Specialist&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;M.E&nbsp;Student&nbsp;-&nbsp;Technology&nbsp;Education&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;Hillsborough&nbsp;319&nbsp;/&nbsp;919.515.5508&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
