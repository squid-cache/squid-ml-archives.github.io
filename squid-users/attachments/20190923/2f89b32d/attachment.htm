<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;am&nbsp;enabling&nbsp;proxy&nbsp;protocol&nbsp;on&nbsp;our&nbsp;FortiADC&nbsp;load&nbsp;balancer&nbsp;so&nbsp;that&nbsp;the&nbsp;source&nbsp;IP&nbsp;of&nbsp;the&nbsp;proxy&nbsp;request&nbsp;can&nbsp;be&nbsp;logged.&nbsp;In&nbsp;the&nbsp;current&nbsp;configuration,&nbsp;the&nbsp;address&nbsp;that&nbsp;is&nbsp;logged&nbsp;belongs&nbsp;to&nbsp;the&nbsp;NAT&nbsp;pool&nbsp;used&nbsp;by&nbsp;the&nbsp;load&nbsp;balancer.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;added&nbsp;these&nbsp;config&nbsp;settings&nbsp;to&nbsp;configure&nbsp;the&nbsp;proxy_protocol_access.&nbsp;The&nbsp;fortiadc&nbsp;ACL&nbsp;is&nbsp;the&nbsp;IP&nbsp;range&nbsp;of&nbsp;the&nbsp;NAT&nbsp;pool&nbsp;:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;fortiadc&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://10.50.54.0/24&quot;&gt;10.50.54.0/24&lt;/a&gt;&lt;/div&gt;proxy_protocol_access&nbsp;allow&nbsp;fortiadc&lt;br&gt;&lt;br&gt;proxy_protocol_access&nbsp;allow&nbsp;localnet&lt;br&gt;follow_x_forwarded_for&nbsp;allow&nbsp;localhost&lt;br&gt;follow_x_forwarded_for&nbsp;allow&nbsp;localnet&lt;br&gt;acl_uses_indirect_client&nbsp;on&lt;br&gt;delay_pool_uses_indirect_client&nbsp;on&lt;br&gt;log_uses_indirect_client&nbsp;on&lt;br&gt;tproxy_uses_indirect_client&nbsp;off&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;updated&nbsp;my&nbsp;http_port&nbsp;line&nbsp;as&nbsp;such&nbsp;:&lt;/div&gt;&lt;div&gt;http_port&nbsp;3128&nbsp;require-proxy-header &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;now&nbsp;getting&nbsp;the&nbsp;error&nbsp;:&lt;/div&gt;&lt;div&gt;2019/09/23&nbsp;16:03:15&nbsp;kid1|&nbsp;PROXY&nbsp;protocol&nbsp;error:&nbsp;invalid&nbsp;header&nbsp;from&nbsp;local=&lt;a&nbsp;href=&quot;http://152.7.114.135:3128&quot;&gt;152.7.114.135:3128&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://10.50.54.65:5028&quot;&gt;10.50.54.65:5028&lt;/a&gt;&nbsp;FD&nbsp;12&nbsp;flags=1&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;suggestion&nbsp;was&nbsp;to&nbsp;move&nbsp;to&nbsp;Squid&nbsp;4&nbsp;as&nbsp;noted&nbsp;here&nbsp;:&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;http://squid-web-proxy-cache.1019090.n4.nabble.com/error-in-parsing-Proxy-protocol-version-2-by-Squid-proxy-protocol-td4686763.html&quot;&gt;http://squid-web-proxy-cache.1019090.n4.nabble.com/error-in-parsing-Proxy-protocol-version-2-by-Squid-proxy-protocol-td4686763.html&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;was&nbsp;back&nbsp;in&nbsp;Oct&nbsp;2018.&nbsp;Has&nbsp;anything&nbsp;changed&nbsp;since&nbsp;then?&nbsp;Do&nbsp;I&nbsp;need&nbsp;to&nbsp;upgrade&nbsp;to&nbsp;Squid&nbsp;4?&nbsp;Currently&nbsp;running&nbsp;3.5.20.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Tom&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;m_-8491318436078300576m_-5795144844555559958gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;Thomas&nbsp;Karches&lt;br&gt;NCSU&nbsp;OIT&nbsp;CSI&nbsp;- Systems&nbsp;Specialist&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;M.E&nbsp;Student&nbsp;-&nbsp;Technology&nbsp;Education&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;Hillsborough&nbsp;319&nbsp;/&nbsp;919.515.5508&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
