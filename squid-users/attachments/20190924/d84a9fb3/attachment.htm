<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Alex,&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Our&nbsp;current&nbsp;production&nbsp;configuration&nbsp;is&nbsp;squid&nbsp;3.123&nbsp;with&nbsp;LVS&nbsp;load&nbsp;balancing.&nbsp;The&nbsp;desired&nbsp;production&nbsp;configuration&nbsp;is&nbsp;3.5.20&nbsp;with&nbsp;a&nbsp;FortiADC&nbsp;load&nbsp;balancer.&nbsp;I&nbsp;am&nbsp;working&nbsp;with&nbsp;networking&nbsp;staff&nbsp;on&nbsp;the&nbsp;configuration.&nbsp;If&nbsp;I&nbsp;directly&nbsp;connect&nbsp;to&nbsp;the&nbsp;actual&nbsp;proxy&nbsp;server&nbsp;behind&nbsp;the&nbsp;load&nbsp;balancer,&nbsp;I&nbsp;get&nbsp;:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;2019/09/24&nbsp;11:31:46&nbsp;kid1|&nbsp;PROXY&nbsp;protocol&nbsp;error:&nbsp;invalid&nbsp;header&nbsp;from&nbsp;local=&lt;a&nbsp;href=&quot;http://152.7.114.8:3128&quot;&gt;152.7.114.8:3128&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://152.7.148.47:65220&quot;&gt;152.7.148.47:65220&lt;/a&gt;&nbsp;FD&nbsp;16&nbsp;flags=1&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Relevant&nbsp;squid.conf&nbsp;on&nbsp;the&nbsp;server&nbsp;looks&nbsp;like&nbsp;this&nbsp;:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;acl&nbsp;fortiadc&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://10.50.54.0/24&quot;&gt;10.50.54.0/24&lt;/a&gt;&lt;br&gt;acl&nbsp;fortiadc&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://152.7.148.0/24&quot;&gt;152.7.148.0/24&lt;/a&gt;&nbsp;&lt;----temporary&nbsp;for&nbsp;testing&nbsp;by&nbsp;going&nbsp;directly&nbsp;to&nbsp;the&nbsp;proxy&nbsp;server&nbsp;and&nbsp;not&nbsp;the&nbsp;load&nbsp;balancer&lt;br&gt;proxy_protocol_access&nbsp;allow&nbsp;fortiadc&lt;br&gt;&lt;br&gt;proxy_protocol_access&nbsp;allow&nbsp;localnet&lt;br&gt;follow_x_forwarded_for&nbsp;allow&nbsp;localhost&lt;br&gt;follow_x_forwarded_for&nbsp;allow&nbsp;localnet&lt;br&gt;acl_uses_indirect_client&nbsp;on&lt;br&gt;delay_pool_uses_indirect_client&nbsp;on&lt;br&gt;log_uses_indirect_client&nbsp;on&lt;br&gt;tproxy_uses_indirect_client&nbsp;off&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;http_port&nbsp;3128&nbsp;require-proxy-header&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;tried&nbsp;adding&nbsp;the&nbsp;following...it&nbsp;appears&nbsp;to&nbsp;make&nbsp;no&nbsp;difference.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1:3128&quot;&gt;127.0.0.1:3128&lt;/a&gt;&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;So,&nbsp;you&nbsp;are&nbsp;saying&nbsp;that&nbsp;v4&nbsp;does&nbsp;not&nbsp;contain&nbsp;changes&nbsp;to&nbsp;fix&nbsp;the&nbsp;&quot;PROXY&nbsp;protocol&nbsp;error&quot;&nbsp;and&nbsp;my&nbsp;only&nbsp;option&nbsp;at&nbsp;this&nbsp;point&nbsp;is&nbsp;v5&nbsp;code?&nbsp;(or&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;LVS&nbsp;with&nbsp;3.5.20)&nbsp;Just&nbsp;trying&nbsp;to&nbsp;understand&nbsp;my&nbsp;options.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Tom&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Mon,&nbsp;Sep&nbsp;23,&nbsp;2019&nbsp;at&nbsp;4:47&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;9/23/19&nbsp;4:14&nbsp;PM,&nbsp;Tom&nbsp;Karches&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;suggestion&nbsp;was&nbsp;to&nbsp;move&nbsp;to&nbsp;Squid&nbsp;4&nbsp;as&nbsp;noted&nbsp;here&nbsp;:&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://squid-web-proxy-cache.1019090.n4.nabble.com/error-in-parsing-Proxy-protocol-version-2-by-Squid-proxy-protocol-td4686763.html&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://squid-web-proxy-cache.1019090.n4.nabble.com/error-in-parsing-Proxy-protocol-version-2-by-Squid-proxy-protocol-td4686763.html&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;This&nbsp;was&nbsp;back&nbsp;in&nbsp;Oct&nbsp;2018.&nbsp;Has&nbsp;anything&nbsp;changed&nbsp;since&nbsp;then?&lt;br&gt;<br>
&lt;br&gt;<br>
Yes,&nbsp;the&nbsp;changes&nbsp;I&nbsp;mentioned&nbsp;then&nbsp;have&nbsp;been&nbsp;accepted:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &lt;a&nbsp;href=&quot;https://github.com/squid-cache/squid/pull/342&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/squid-cache/squid/pull/342&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;above&nbsp;pull&nbsp;request&nbsp;contained&nbsp;lots&nbsp;of&nbsp;PROXY&nbsp;protocol&nbsp;fixes&nbsp;and&lt;br&gt;<br>
several&nbsp;important&nbsp;improvements.&nbsp;Those&nbsp;changes&nbsp;are&nbsp;not&nbsp;in&nbsp;v4,&nbsp;but&nbsp;master&lt;br&gt;<br>
(future&nbsp;v5)&nbsp;code&nbsp;is&nbsp;available&nbsp;and&nbsp;works&nbsp;well&nbsp;for&nbsp;some.&nbsp;YMMV.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;do&nbsp;not&nbsp;recall&nbsp;any&nbsp;fixes&nbsp;going&nbsp;back&nbsp;into&nbsp;v3,&nbsp;but&nbsp;I&nbsp;did&nbsp;not&nbsp;check.&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;Thomas&nbsp;Karches&lt;br&gt;NCSU&nbsp;OIT&nbsp;CSI&nbsp;- Systems&nbsp;Specialist&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;M.E&nbsp;Student&nbsp;-&nbsp;Technology&nbsp;Education&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;size=&quot;1&quot;&nbsp;face=&quot;arial,&nbsp;helvetica,&nbsp;sans-serif&quot;&gt;Hillsborough&nbsp;319&nbsp;/&nbsp;919.515.5508&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
