<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&lt;!--&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;--&gt;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;style=&quot;font-size:10pt;color:#000000;font-family:Consolas,Courier,monospace;&quot;&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;div&gt;<br>
&lt;hr&nbsp;tabindex=&quot;-1&quot;&nbsp;style=&quot;display:inline-block;&nbsp;width:98%&quot;&gt;<br>
&lt;div&nbsp;id=&quot;x_divRplyFwdMsg&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;style=&quot;font-size:11pt&quot;&gt;&lt;b&gt;De&nbsp;:&lt;/b&gt;&nbsp;squid-users&nbsp;&lt;squid-users-bounces@lists.squid-cache.org&gt;&nbsp;de&nbsp;la&nbsp;part&nbsp;de&nbsp;Antony&nbsp;Stone&nbsp;&lt;Antony.Stone@squid.open.source.it&gt;&lt;br&gt;<br>
&lt;b&gt;Envoyé&nbsp;:&lt;/b&gt;&nbsp;mercredi&nbsp;30&nbsp;octobre&nbsp;2019&nbsp;17:39&lt;br&gt;<br>
&lt;b&gt;À&nbsp;:&lt;/b&gt;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&lt;b&gt;Objet&nbsp;:&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;Unsuccessful&nbsp;at&nbsp;using&nbsp;Squid&nbsp;v4&nbsp;with&nbsp;intercept&lt;/font&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;style=&quot;font-size:10pt;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;On&nbsp;Wednesday&nbsp;30&nbsp;October&nbsp;2019&nbsp;at&nbsp;17:11:29,&nbsp;FOUTREL&nbsp;Sébastien&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Hello,&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;use&nbsp;squid&nbsp;as&nbsp;a&nbsp;transparent&nbsp;proxy&nbsp;for&nbsp;my&nbsp;users.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&quot;Clients&quot;&nbsp;are&nbsp;behind&nbsp;a&nbsp;Debian&nbsp;&quot;Router&quot;&nbsp;which&nbsp;MASQUERADE&nbsp;them&nbsp;(as&nbsp;they&nbsp;use&lt;br&gt;<br>
&gt;&nbsp;RFC&nbsp;1918&nbsp;ips).&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;a&nbsp;Squid&nbsp;4.6&nbsp;from&nbsp;Debian&nbsp;Buster&nbsp;packages&nbsp;installed&nbsp;on&nbsp;a&nbsp;&quot;Proxy&quot;&lt;br&gt;<br>
&gt;&nbsp;server&nbsp;which&nbsp;is&nbsp;outside&nbsp;my&nbsp;network.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;read&nbsp;a&nbsp;lot&nbsp;of&nbsp;tutorials&nbsp;and&nbsp;examples&nbsp;from&nbsp;squid&nbsp;site...&lt;br&gt;<br>
&lt;br&gt;<br>
Did&nbsp;that&nbsp;include&nbsp;the&nbsp;links&nbsp;I've&nbsp;given&nbsp;below?&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;Yes&nbsp;I&nbsp;read&nbsp;almost&nbsp;all&nbsp;examples&nbsp;config&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/SquidFaq/InterceptionProxy&quot;&nbsp;id=&quot;LPlnk311048&quot;&nbsp;previewremoved=&quot;true&quot;&nbsp;style=&quot;font-family:&nbsp;Consolas,&nbsp;Courier,&nbsp;monospace,&nbsp;EmojiFont,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;13.3333px;&quot;&gt;wiki.squid-cache.org&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/SquidFaq/InterceptionProxy&quot;&nbsp;previewremoved=&quot;true&quot;&nbsp;style=&quot;font-family:&nbsp;Consolas,&nbsp;Courier,&nbsp;monospace,&nbsp;EmojiFont,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&nbsp;font-size:&nbsp;13.3333px;&quot;&gt;&lt;/a&gt;And<br>
&nbsp;I&nbsp;was&nbsp;mislead&nbsp;by&nbsp;the&nbsp;fact&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;DNAT&nbsp;config&nbsp;and&nbsp;a&nbsp;REDIRECT&nbsp;config..&nbsp;DNAT&nbsp;is&nbsp;completely&nbsp;useless&nbsp;if&nbsp;Squid&nbsp;only&nbsp;support&nbsp;to&nbsp;be&nbsp;on&nbsp;the&nbsp;router.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;Wasn't&nbsp;it&nbsp;possible&nbsp;to&nbsp;dnat&nbsp;to&nbsp;a&nbsp;different&nbsp;server&nbsp;with&nbsp;older&nbsp;versions&nbsp;(my&nbsp;memory&nbsp;is&nbsp;faulty)&nbsp;?&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;&lt;a&nbsp;href=&quot;http://tldp.org/HOWTO/TransparentProxy-6.html&quot;&nbsp;class=&quot;OWAAutoLink&quot;&nbsp;id=&quot;LPlnk953727&quot;&nbsp;previewremoved=&quot;true&quot;&gt;http://tldp.org/HOWTO/TransparentProxy-6.html&lt;/a&gt;&nbsp;for&nbsp;example.&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;I&nbsp;read&nbsp;the&nbsp;&quot;fw&nbsp;mark&nbsp;and&nbsp;route&nbsp;policy&quot;&nbsp;method&nbsp;as&nbsp;an&nbsp;alternative&nbsp;not&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;go.&nbsp;My&nbsp;mistake.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;Applied&nbsp;a&nbsp;DNAT&nbsp;to&nbsp;trafic&nbsp;coming&nbsp;from&nbsp;Clients&nbsp;thru&nbsp;Router&nbsp;to&nbsp;Proxy.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-tnat&nbsp;-A&nbsp;PREROUTING&nbsp;-i&nbsp;LAN_3500&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;DNAT&lt;br&gt;<br>
&gt;&nbsp;--to-destination&nbsp;&lt;Proxy&gt;:3129&lt;br&gt;<br>
&lt;br&gt;<br>
Have&nbsp;you&nbsp;put&nbsp;this&nbsp;rule&nbsp;onto&nbsp;the&nbsp;firewall&nbsp;you&nbsp;mention,&nbsp;or&nbsp;the&nbsp;Squid&nbsp;box&nbsp;itself?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/SquidFaq/InterceptionProxy&quot;&nbsp;id=&quot;LPlnk311048&quot;&nbsp;previewremoved=&quot;true&quot;&gt;https://wiki.squid-cache.org/SquidFaq/InterceptionProxy&lt;/a&gt;&lt;br&gt;<br>
#Requirements_and_methods_for_Interception_Caching&lt;br&gt;<br>
&lt;br&gt;<br>
states&nbsp;&quot;NAT&nbsp;configuration&nbsp;will&nbsp;only&nbsp;work&nbsp;when&nbsp;used&nbsp;*on&nbsp;the&nbsp;squid&nbsp;box*&nbsp;.&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
So,&nbsp;you&nbsp;*must*&nbsp;put&nbsp;that&nbsp;rule&nbsp;on&nbsp;the&nbsp;Squid&nbsp;machine&nbsp;itself,&nbsp;not&nbsp;on&nbsp;the&nbsp;firewall.&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;goes&nbsp;on&nbsp;to&nbsp;say&nbsp;&quot;To&nbsp;intercept&nbsp;from&nbsp;a&nbsp;gateway&nbsp;machine&nbsp;and&nbsp;direct&nbsp;traffic&nbsp;at&nbsp;a&nbsp;&lt;br&gt;<br>
separate&nbsp;squid&nbsp;box&nbsp;use&nbsp;policy&nbsp;routing.&quot;&nbsp;with&nbsp;a&nbsp;link&nbsp;to&nbsp;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute&quot;&nbsp;id=&quot;LPlnk480386&quot;&nbsp;previewremoved=&quot;true&quot;&gt;https://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;HTTP&nbsp;is&nbsp;coming&nbsp;to&nbsp;squid&nbsp;successfully&nbsp;but&nbsp;squid&nbsp;logs&nbsp;show&nbsp;a&nbsp;request&nbsp;coming&lt;br&gt;<br>
&gt;&nbsp;from&nbsp;proxy&nbsp;himself&nbsp;and&nbsp;a&nbsp;request&nbsp;coming&nbsp;from&nbsp;Router&nbsp;(as&nbsp;Clients&nbsp;are&nbsp;NATed&lt;br&gt;<br>
&gt;&nbsp;by&nbsp;Router)&lt;br&gt;<br>
&lt;br&gt;<br>
Ah,&nbsp;so&nbsp;you&nbsp;*are*&nbsp;doing&nbsp;the&nbsp;NAT&nbsp;on&nbsp;the&nbsp;router&nbsp;:)&nbsp;&nbsp;Don't&nbsp;:)&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;if&nbsp;I&nbsp;allow&nbsp;in&nbsp;squid.conf&nbsp;the&nbsp;Proxy&nbsp;IP,&nbsp;I&nbsp;end&nbsp;up&nbsp;with&nbsp;a&nbsp;Forward&nbsp;loop...&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;also&nbsp;tried&nbsp;the&nbsp;tproxy&nbsp;scenario&nbsp;with&nbsp;no&nbsp;success.&lt;br&gt;<br>
&lt;br&gt;<br>
Well,&nbsp;give&nbsp;us&nbsp;some&nbsp;details&nbsp;of&nbsp;what&nbsp;you&nbsp;tried,&nbsp;how&nbsp;you&nbsp;configured&nbsp;it,&nbsp;what&nbsp;&lt;br&gt;<br>
worked,&nbsp;and&nbsp;what&nbsp;didn't&nbsp;work,&nbsp;and&nbsp;we&nbsp;might&nbsp;be&nbsp;able&nbsp;to&nbsp;help,&nbsp;otherwise&nbsp;we&nbsp;can&nbsp;&lt;br&gt;<br>
only&nbsp;say&nbsp;&quot;well,&nbsp;tproxy&nbsp;does&nbsp;work&nbsp;if&nbsp;set&nbsp;up&nbsp;properly,&nbsp;so&nbsp;if&nbsp;yours&nbsp;doesn't&nbsp;work,&nbsp;&lt;br&gt;<br>
it&nbsp;isn't&nbsp;set&nbsp;up&nbsp;properly&quot;,&nbsp;which&nbsp;isn't&nbsp;a&nbsp;very&nbsp;helpful&nbsp;answer...&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;read&nbsp;with&nbsp;a&nbsp;new&nbsp;eye&nbsp;the&nbsp;tproxy&nbsp;page&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/ConfigExamples/FullyTransparentWithTPROXY&quot;&nbsp;class=&quot;OWAAutoLink&quot;&nbsp;id=&quot;LPlnk520447&quot;&nbsp;previewremoved=&quot;true&quot;&gt;https://wiki.squid-cache.org/ConfigExamples/FullyTransparentWithTPROXY&lt;/a&gt;&nbsp;and<br>
&nbsp;found&nbsp;that&nbsp;I&nbsp;forgot&nbsp;the&nbsp;policy&nbsp;routing&nbsp;part.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;Will&nbsp;try&nbsp;again.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;Thanks&nbsp;for&nbsp;your&nbsp;help.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;Sebastien.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;Antony.&lt;br&gt;<br>
&lt;br&gt;<br>
--&nbsp;&lt;br&gt;<br>
If&nbsp;at&nbsp;first&nbsp;you&nbsp;don't&nbsp;succeed,&nbsp;destroy&nbsp;all&nbsp;the&nbsp;evidence&nbsp;that&nbsp;you&nbsp;tried.&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Please&nbsp;reply&nbsp;to&nbsp;the&nbsp;list;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;please&nbsp;*don't*&nbsp;CC&nbsp;me.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
squid-users@lists.squid-cache.org&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;id=&quot;LPlnk101933&quot;&nbsp;previewremoved=&quot;true&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
