<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;reincluded&nbsp;the&nbsp;list&nbsp;for&nbsp;completeness and&nbsp;archiving.&lt;br&gt;&lt;br&gt;We&#39;re&nbsp;building&nbsp;a&nbsp;setup&nbsp;where&nbsp;I&nbsp;want&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;find&nbsp;domain&nbsp;fronting&nbsp;[&lt;a&nbsp;href=&quot;https://en.wikipedia.org/wiki/Domain_fronting&quot;&nbsp;target=&quot;_blank&quot;&gt;https://en.wikipedia.org/wiki/Domain_fronting&lt;/a&gt;]&nbsp;attempts&nbsp;in&nbsp;the&nbsp;logs&lt;br&gt;&lt;br&gt;used&nbsp;test&nbsp;script:&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;import&nbsp;requests&lt;br&gt;proxies&nbsp;=&nbsp;{&#39;http&#39;:&nbsp;&#39;&lt;a&nbsp;href=&quot;http://10.0.0.4:8080&quot;&gt;http://10.0.0.4:8080&lt;/a&gt;&#39;,}&lt;br&gt;headers&nbsp;=&nbsp;{&quot;Host&quot;:&quot;&lt;a&nbsp;href=&quot;http://someevilhost.appspot.com&quot;&gt;someevilhost.appspot.com&lt;/a&gt;&quot;,&quot;Orig-Host&quot;:&quot;&lt;a&nbsp;href=&quot;http://someevilhost.appspot.com&quot;&gt;someevilhost.appspot.com&lt;/a&gt;&quot;}&lt;br&gt;s&nbsp;=&nbsp;requests.Session()&lt;br&gt;s.proxies&nbsp;=&nbsp;proxies&lt;br&gt;r&nbsp;=&nbsp;s.get(&#39;&lt;a&nbsp;href=&quot;http://www.google.com/&quot;&gt;http://www.google.com/&lt;/a&gt;&#39;,headers=headers)&lt;br&gt;print(r.status_code)&lt;br&gt;print(r.text[:80])&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;my&nbsp;loglines&nbsp;keep&nbsp;showing&nbsp;&lt;a&nbsp;href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt;&nbsp;in&nbsp;the&nbsp;host&nbsp;header&nbsp;regardless&nbsp;of&nbsp;how&nbsp;I&nbsp;set&nbsp;my&nbsp;config.&nbsp;Current&nbsp;config&nbsp;(as&nbsp;added&nbsp;in&nbsp;my&nbsp;pfsense&nbsp;setup)&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;host_verify_strict&nbsp;on&lt;br&gt;strip_query_terms&nbsp;off&lt;br&gt;client_dst_passthru&nbsp;off&lt;br&gt;logformat&nbsp;combined2&nbsp;%&gt;a&nbsp;%[ui&nbsp;%[un&nbsp;[%tl]&nbsp;&quot;%rm&nbsp;%ru&nbsp;HTTP/%rv&quot;&nbsp;%&gt;Hs&nbsp;%&lt;st&nbsp;&quot;%{Referer}&gt;h&quot;&nbsp;&quot;%{User-Agent}&gt;h&quot;&nbsp;%Ss:%Sh&nbsp;&quot;%&gt;h&quot;&lt;br&gt;access_log&nbsp;tcp://&lt;a&nbsp;href=&quot;http://10.1.2.15:1025&quot;&gt;10.1.2.15:1025&lt;/a&gt;&nbsp;combined2&lt;br&gt;#access_log&nbsp;/var/squid/logs/combined2 &lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;example&nbsp;log&nbsp;line:&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;10.1.2.15&nbsp;-&nbsp;-&nbsp;[31/Oct/2019:11:42:53&nbsp;+0000]&nbsp;&quot;GET&nbsp;&lt;a&nbsp;href=&quot;http://www.google.com/&quot;&gt;http://www.google.com/&lt;/a&gt;&nbsp;HTTP/1.1&quot;&nbsp;200&nbsp;6261&nbsp;&quot;-&quot;&nbsp;&quot;python-requests/2.9.1&quot;&nbsp;TCP_MISS:HIER_DIRECT&nbsp;&quot;User-Agent:&nbsp;python-requests/2.9.1\r\nAccept:&nbsp;*/*\r\nConnection:&nbsp;keep-alive\r\nAccept-Encoding:&nbsp;gzip,&nbsp;deflate\r\nOrig-Host:&nbsp;&lt;a&nbsp;href=&quot;http://someevilhost.appspot.com&quot;&gt;someevilhost.appspot.com&lt;/a&gt;\r\nHost:&nbsp;&lt;a&nbsp;href=&quot;http://www.google.com&quot;&gt;www.google.com&lt;/a&gt;\r\n&quot; &lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;looking&nbsp;for&nbsp;a &nbsp;way&nbsp;to&nbsp;have&nbsp;Squid&nbsp;log&nbsp;the&nbsp;original&nbsp;request,&nbsp;whatever&nbsp;it&nbsp;does&nbsp;after&nbsp;that&nbsp;is&nbsp;for&nbsp;this&nbsp;particular&nbsp;test&nbsp;less&nbsp;important&nbsp;(/dev/null&nbsp;or&nbsp;out&nbsp;to&nbsp;the&nbsp;internet..&nbsp;both&nbsp;are&nbsp;OK&nbsp;for&nbsp;me&nbsp;as&nbsp;long&nbsp;as&nbsp;&#39;RFC&nbsp;compliant&#39;&nbsp;traffic&nbsp;from&nbsp;the&nbsp;webbrowser&nbsp;does&nbsp;get&nbsp;out&nbsp;and&nbsp;logged).&lt;br&gt;&lt;br&gt;regards,&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Mark&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Thu,&nbsp;Oct&nbsp;31,&nbsp;2019&nbsp;at&nbsp;12:35&nbsp;PM&nbsp;Mark&nbsp;Bergman&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:xychix2011@gmail.com&quot;&gt;xychix2011@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Ok,&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;way&nbsp;I&nbsp;can&nbsp;have&nbsp;Squid&nbsp;act&nbsp;as&nbsp;most&nbsp;corporate&nbsp;other&nbsp;proxies&nbsp;(just&nbsp;forward&nbsp;the&nbsp;request&nbsp;without&nbsp;manipulation)?&lt;br&gt;We&nbsp;are&nbsp;building&nbsp;a&nbsp;setup&nbsp;where&nbsp;we&nbsp;want&nbsp;people&nbsp;to&nbsp;recognise&nbsp;domain&nbsp;fronting&nbsp;from&nbsp;logs.&lt;br&gt;&lt;a&nbsp;href=&quot;https://en.wikipedia.org/wiki/Domain_fronting&quot;&nbsp;target=&quot;_blank&quot;&gt;https://en.wikipedia.org/wiki/Domain_fronting&lt;/a&gt;&lt;br&gt;&lt;br&gt;But&nbsp;as&nbsp;I&nbsp;understand&nbsp;now&nbsp;this&nbsp;technique&nbsp;would never&nbsp;work&nbsp;trough&nbsp;a&nbsp;Squid&nbsp;proxy&nbsp;(if&nbsp;SSL&nbsp;inspection&nbsp;is&nbsp;enabled).&nbsp;Wonder&nbsp;then&nbsp;if&nbsp;there&nbsp;never&nbsp;had&nbsp;been&nbsp;complaints&nbsp;from&nbsp;signal&nbsp;(messaging&nbsp;app)&nbsp;users&nbsp;as&nbsp;they&nbsp;relied&nbsp;on&nbsp;this&nbsp;technology&nbsp;for&nbsp;years&nbsp;:)&lt;br&gt;We&nbsp;might&nbsp;have&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;less&nbsp;RCF&nbsp;compliant&nbsp;proxy&nbsp;for&nbsp;that. &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;help&nbsp;and&nbsp;suggestions&nbsp;are&nbsp;really&nbsp;appreciated.&lt;br&gt;&lt;br&gt;Regards,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Mark&nbsp;/&nbsp;xychix&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Thu,&nbsp;Oct&nbsp;31,&nbsp;2019&nbsp;at&nbsp;10:04&nbsp;AM&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;31/10/19&nbsp;8:48&nbsp;pm,&nbsp;Mark&nbsp;Bergman&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Can&nbsp;i&nbsp;stop&nbsp;squid&nbsp;from&nbsp;&#39;repairing&#39;&nbsp;host&nbsp;headers?&lt;br&gt;<br>
&lt;br&gt;<br>
Yes.&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;context:&lt;br&gt;<br>
&lt;br&gt;<br>
RFC&nbsp;7230&nbsp;:&lt;br&gt;<br>
&lt;br&gt;<br>
&quot;If&nbsp;the&nbsp;target&nbsp;URI&nbsp;includes&nbsp;an&nbsp;authority&nbsp;component,&nbsp;then&nbsp;a&lt;br&gt;<br>
 &nbsp; client&nbsp;MUST&nbsp;send&nbsp;a&nbsp;field-value&nbsp;for&nbsp;Host&nbsp;that&nbsp;is&nbsp;identical&nbsp;to&nbsp;that&lt;br&gt;<br>
 &nbsp; authority&nbsp;component&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&quot;If&nbsp;the&nbsp;target&nbsp;URI&nbsp;includes&nbsp;an&nbsp;authority&nbsp;component,&nbsp;then&nbsp;a&lt;br&gt;<br>
 &nbsp; client&nbsp;MUST&nbsp;send&nbsp;a&nbsp;field-value&nbsp;for&nbsp;Host&nbsp;that&nbsp;is&nbsp;identical&nbsp;to&nbsp;that&lt;br&gt;<br>
 &nbsp; authority&nbsp;component&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&quot;A&nbsp;server&nbsp;MUST&nbsp;respond&nbsp;with&nbsp;a&nbsp;400&nbsp;(Bad&nbsp;Request)&nbsp;status&nbsp;code&nbsp;to&nbsp;any&lt;br&gt;<br>
 &nbsp; HTTP/1.1&nbsp;request&nbsp;message&nbsp;that&nbsp;...&nbsp;contains&nbsp;...&nbsp;a&lt;br&gt;<br>
 &nbsp; Host&nbsp;header&nbsp;field&nbsp;with&nbsp;an&nbsp;invalid&nbsp;field-value.&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
When&nbsp;the&nbsp;host_verify_strict&nbsp;directive&nbsp;is&nbsp;set&nbsp;to&nbsp;&quot;on&quot;&nbsp;then&nbsp;Squid&nbsp;will&lt;br&gt;<br>
produce&nbsp;a&nbsp;4XX&nbsp;status&nbsp;code&nbsp;to&nbsp;any&nbsp;traffic&nbsp;received&nbsp;with&nbsp;invalid&nbsp;Host&lt;br&gt;<br>
headers.&nbsp;A&nbsp;Host&nbsp;header&nbsp;that&nbsp;conflicts&nbsp;with&nbsp;info&nbsp;in&nbsp;the&nbsp;URL&nbsp;is&nbsp;always&lt;br&gt;<br>
invalid.&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
