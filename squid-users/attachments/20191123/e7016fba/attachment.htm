<tt>
Thanks&nbsp;for&nbsp;the&nbsp;response&nbsp;Amos.&nbsp;This&nbsp;is&nbsp;an&nbsp;AWS&nbsp;Fargate&nbsp;instance&nbsp;and&nbsp;I&#39;m&nbsp;not&nbsp;exactly&nbsp;sure&nbsp;how&nbsp;patching&nbsp;works&nbsp;in&nbsp;that&nbsp;space.&nbsp;I&#39;m&nbsp;rather&nbsp;new&nbsp;to&nbsp;both&nbsp;serverless&nbsp;concept&nbsp;and&nbsp;Squid.&nbsp;I&nbsp;will&nbsp;research&nbsp;this&nbsp;and&nbsp;get&nbsp;back&nbsp;to&nbsp;you.&nbsp;Thanks!&lt;br&gt;&lt;br&gt;On&nbsp;Friday,&nbsp;November&nbsp;22,&nbsp;2019,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;22/11/19&nbsp;4:05&nbsp;pm,&nbsp;Chammi&nbsp;Kumarapathirage&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;my&nbsp;logformat&nbsp;as&nbsp;follows.&lt;br&gt;<br>
&gt;&nbsp;logformat&nbsp;jsonformat&nbsp;{&quot;Client&nbsp;Hostname&quot;:&quot;%&gt;A&quot;,&quot;Source&nbsp;IP&quot;:&quot;%&gt;a&quot;,&quot;HTTP&lt;br&gt;<br>
&gt;&nbsp;Method&quot;:&quot;%rm&quot;,&quot;HTTP&nbsp;Protocol&nbsp;version&quot;:&quot;%rv&quot;,&quot;Request&lt;br&gt;<br>
&gt;&nbsp;Domain&quot;:&quot;%&gt;rd&quot;,&quot;Port&quot;:&quot;%&gt;rP&quot;,&quot;&lt;wbr&gt;User&nbsp;Agent&quot;:&quot;%{User-Agent}&gt;h&quot;,&quot;&lt;wbr&gt;Request&lt;br&gt;<br>
&gt;&nbsp;Size&quot;:&quot;%&gt;st&quot;,&quot;Reply&nbsp;Size&quot;:&quot;%&lt;st&quot;,&quot;Response&nbsp;Time(ms)&quot;:&quot;%tr&quot;,&quot;Status&lt;br&gt;<br>
&gt;&nbsp;Code&quot;:&quot;%&gt;Hs&quot;,&quot;Request&nbsp;Status&quot;:&quot;%Ss&quot;,&quot;Server&nbsp;FQDN&quot;:&quot;%&lt;A&quot;} &lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;proxy&nbsp;is&nbsp;sitting&nbsp;behind&nbsp;a&nbsp;load&nbsp;balancer&nbsp;in&nbsp;AWS&nbsp;and&nbsp;Proxy&nbsp;Protocol&nbsp;V2&lt;br&gt;<br>
&gt;&nbsp;is&nbsp;enabled&nbsp;on&nbsp;both&nbsp;the&nbsp;LB&nbsp;and&nbsp;Squid.&nbsp;Everything&nbsp;seems&nbsp;to&nbsp;work&nbsp;fine.&nbsp;I&lt;br&gt;<br>
&gt;&nbsp;can&nbsp;create&nbsp;rules&nbsp;based&nbsp;on&nbsp;source&nbsp;IP&nbsp;of&nbsp;the&nbsp;client.&nbsp;However.&nbsp;I&nbsp;want&nbsp;to&nbsp;be&lt;br&gt;<br>
&gt;&nbsp;able&nbsp;to &nbsp;create&nbsp;rules&nbsp;based&nbsp;on&nbsp;the&nbsp;hostname&nbsp;of&nbsp;the&nbsp;original&nbsp;client.&nbsp;But&lt;br&gt;<br>
&gt;&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;that&nbsp;Squid&nbsp;sees&nbsp;the&nbsp;original client&#39;s&nbsp;hostname.&nbsp;Rather&lt;br&gt;<br>
&gt;&nbsp;it&nbsp;takes&nbsp;the&nbsp;hostname&nbsp;of&nbsp;the&nbsp;LB&nbsp;as&nbsp;seen&nbsp;by&nbsp;below&nbsp;log.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;%&gt;A&nbsp;log&nbsp;code&nbsp;is&nbsp;still&nbsp;tied&nbsp;to&nbsp;old&nbsp;logging&nbsp;state&nbsp;instead&nbsp;of&nbsp;the&nbsp;IP&lt;br&gt;<br>
values&nbsp;updated&nbsp;by&nbsp;PROXY&nbsp;protocol.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;only&nbsp;way&nbsp;I&nbsp;can&nbsp;see&nbsp;to&nbsp;log&nbsp;that&nbsp;value&nbsp;without&nbsp;patching&nbsp;Squid&nbsp;is&nbsp;with&lt;br&gt;<br>
something&nbsp;complicated&nbsp;like&nbsp;an&nbsp;external_acl_type&nbsp;helper&nbsp;to&nbsp;do&nbsp;the&nbsp;lookup&lt;br&gt;<br>
and&nbsp;supply&nbsp;it&nbsp;as&nbsp;a&nbsp;tag&nbsp;or&nbsp;note&nbsp;to&nbsp;Squid.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;are&nbsp;happy&nbsp;to&nbsp;patch&nbsp;I&nbsp;can&nbsp;make&nbsp;a&nbsp;PR&nbsp;for&nbsp;you&nbsp;to&nbsp;try.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
______________________________&lt;wbr&gt;_________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/&lt;wbr&gt;listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>

</tt>
