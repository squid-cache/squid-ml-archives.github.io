<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;have&nbsp;an&nbsp;ICAP&nbsp;server&nbsp;for&nbsp;Squid&nbsp;4.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;While&nbsp;we&nbsp;can&nbsp;successfully&nbsp;scan&nbsp;our&nbsp;files&nbsp;and&nbsp;do&nbsp;content&nbsp;adaptation,&nbsp;we&nbsp;have&nbsp;been&nbsp;struggling to&nbsp;find&nbsp;a&nbsp;way&nbsp;to&nbsp;close&nbsp;the&nbsp;ICAP&nbsp;transaction&nbsp;before&nbsp;passing&nbsp;the&nbsp;whole&nbsp;body&nbsp;back&nbsp;to&nbsp;squid&nbsp;and&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;avoid&nbsp;squid&nbsp;marking&nbsp;one&nbsp;icap&nbsp;failure.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;for&nbsp;an&nbsp;ICAP&nbsp;server&nbsp;that&nbsp;does&nbsp;Virus&nbsp;scanning&nbsp;and&nbsp;if&nbsp;virus&nbsp;found,&nbsp;the&nbsp;body&nbsp;is&nbsp;not&nbsp;sent&nbsp;back.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;we&nbsp;send&nbsp;an&nbsp;ICAP&nbsp;header&nbsp;with&nbsp;500&nbsp;then&nbsp;Squid&nbsp;mark&nbsp;us&nbsp;as&nbsp;ICAP&nbsp;FAILURE,&nbsp;if&nbsp;we&nbsp;don&#39;t&nbsp;send&nbsp;anything&nbsp;then&nbsp;Squid&nbsp;keeps&nbsp;awaiting&nbsp;on&nbsp;us&nbsp;and&nbsp;then&nbsp;timeout,&nbsp;increasing&nbsp;the&nbsp;icap&nbsp;failure&nbsp;counter&nbsp;by&nbsp;one&nbsp;and&nbsp;so&nbsp;on.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;At&nbsp;some&nbsp;point&nbsp;squid&nbsp;just&nbsp;mark&nbsp;the&nbsp;server&nbsp;as&nbsp;down&nbsp;and&nbsp;stop&nbsp;sending&nbsp;transactions&nbsp;to&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;have&nbsp;been&nbsp;overcoming&nbsp;this&nbsp;by&nbsp;having&nbsp;a&nbsp;low&nbsp;OPTIONs&nbsp;TTL&nbsp;but&nbsp;that&nbsp;seems&nbsp;inefficient for&nbsp;high&nbsp;traffic&nbsp;squid&nbsp;nodes.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Does&nbsp;anyone&nbsp;know&nbsp;how&nbsp;to&nbsp;proceed&nbsp;with&nbsp;this?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;/div&gt;<br>

</tt>
