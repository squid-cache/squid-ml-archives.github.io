<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;Hi,&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;I’m&nbsp;new&nbsp;to&nbsp;this&nbsp;group.&nbsp;I&nbsp;just&nbsp;setup&nbsp;a&nbsp;squid&nbsp;ver&nbsp;4.5&nbsp;on&nbsp;my&nbsp;ubuntu&nbsp;machine.&nbsp;I&nbsp;configured&nbsp;this&nbsp;proxy&nbsp;to&nbsp;receive&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;https&nbsp;packets&nbsp;from&nbsp;another&nbsp;device&nbsp;on&nbsp;the&nbsp;same&nbsp;LAN,&nbsp;and&nbsp;modified&nbsp;the&nbsp;iptables&nbsp;to&nbsp;redirect&nbsp;the&nbsp;port&nbsp;443&nbsp;packets&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;to&nbsp;the&nbsp;squid&nbsp;proxy&nbsp;port&nbsp;3130.&nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;can&nbsp;see&nbsp;the&nbsp;client&nbsp;https&nbsp;packet&nbsp;has&nbsp;been&nbsp;received&nbsp;and&nbsp;the&nbsp;proxy&nbsp;is&nbsp;ready&nbsp;to&nbsp;do&nbsp;the&nbsp;‘bump’,&nbsp;the&nbsp;fd&nbsp;to&nbsp;the&nbsp;client&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;connection&nbsp;is&nbsp;13:&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;**&lt;/div&gt;<br>
&lt;span&nbsp;class=&quot;&quot;&gt;2019/12/07&nbsp;20:48:59.586&nbsp;kid1|&nbsp;85,4|&nbsp;&lt;a&nbsp;href=&quot;http://client_side_request.cc&quot;&nbsp;class=&quot;&quot;&gt;<br>
client_side_request.cc&lt;/a&gt;(1510)&nbsp;processRequest:&nbsp;CONNECT&nbsp;x.y.43.31:443&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.586&nbsp;kid1|&nbsp;85,5|&nbsp;&lt;a&nbsp;href=&quot;http://client_side_request.cc&quot;&nbsp;class=&quot;&quot;&gt;<br>
client_side_request.cc&lt;/a&gt;(1597)&nbsp;sslBumpStart:&nbsp;Confirming&nbsp;peek-bumped&nbsp;CONNECT&nbsp;tunnel&nbsp;on&nbsp;FD&nbsp;local=x.y..31:443&nbsp;remote=192.168.1.25:39273&nbsp;FD&nbsp;13&nbsp;flags=33&lt;/span&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;**&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/span&gt;&lt;span&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/span&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;From&nbsp;the&nbsp;debug&nbsp;I&nbsp;can&nbsp;also&nbsp;see&nbsp;the&nbsp;proxy&nbsp;&nbsp;connects&nbsp;towards&nbsp;the&nbsp;remote&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;server,&nbsp;and&nbsp;proxy&nbsp;has&nbsp;negotiated&nbsp;fine&nbsp;with&nbsp;the&nbsp;server.&nbsp;the&nbsp;proxy&nbsp;receives&nbsp;3&nbsp;certificates&nbsp;from&nbsp;the&nbsp;server,&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;and&nbsp;verification&nbsp;was&nbsp;fine&nbsp;to&nbsp;the&nbsp;server.&nbsp;But&nbsp;when&nbsp;the&nbsp;proxy&nbsp;trying&nbsp;to&nbsp;proceed&nbsp;with&nbsp;client&nbsp;negotiation,&nbsp;I&nbsp;got&nbsp;this&nbsp;error:&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;***&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;2019/12/07&nbsp;20:48:59.760&nbsp;kid1|&nbsp;33,5|&nbsp;&lt;a&nbsp;href=&quot;http://client_side.cc&quot;&nbsp;class=&quot;&quot;&gt;<br>
client_side.cc&lt;/a&gt;(2859)&nbsp;sslCrtdHandleReply:&nbsp;Certificate&nbsp;for&nbsp;x.y.43.31&nbsp;was&nbsp;successfully&nbsp;recieved&nbsp;from&nbsp;ssl_crtd&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.760&nbsp;kid1|&nbsp;33,5|&nbsp;&lt;a&nbsp;href=&quot;http://client_side.cc&quot;&nbsp;class=&quot;&quot;&gt;client_side.cc&lt;/a&gt;(3335)&nbsp;doPeekAndSpliceStep:&nbsp;PeekAndSplice&nbsp;mode,&nbsp;proceed&nbsp;with&nbsp;client&nbsp;negotiation.&nbsp;Currrent&nbsp;state:SSLv2/v3&nbsp;read&nbsp;client&nbsp;hello&nbsp;A&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.760&nbsp;kid1|&nbsp;5,5|&nbsp;&lt;a&nbsp;href=&quot;http://ModEpoll.cc&quot;&nbsp;class=&quot;&quot;&gt;ModEpoll.cc&lt;/a&gt;(117)&nbsp;SetSelect:&nbsp;FD&nbsp;13,&nbsp;type=2,&nbsp;handler=1,&nbsp;client_data=0x15beef8,&nbsp;timeout=0&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.760&nbsp;kid1|&nbsp;84,5|&nbsp;&lt;a&nbsp;href=&quot;http://helper.cc&quot;&nbsp;class=&quot;&quot;&gt;helper.cc&lt;/a&gt;(1247)&nbsp;GetFirstAvailable:&nbsp;GetFirstAvailable:&nbsp;Running&nbsp;servers&nbsp;5&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.760&nbsp;kid1|&nbsp;5,4|&nbsp;&lt;a&nbsp;href=&quot;http://AsyncCall.cc&quot;&nbsp;class=&quot;&quot;&gt;AsyncCall.cc&lt;/a&gt;(26)&nbsp;AsyncCall:&nbsp;The&nbsp;AsyncCall&nbsp;helperHandleRead&nbsp;constructed,&nbsp;this=0x1a37c50&nbsp;[call827]&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.760&nbsp;kid1|&nbsp;5,5|&nbsp;&lt;a&nbsp;href=&quot;http://Read.cc&quot;&nbsp;class=&quot;&quot;&gt;Read.cc&lt;/a&gt;(57)&nbsp;comm_read_base:&nbsp;comm_read,&nbsp;queueing&nbsp;read&nbsp;for&nbsp;local=[::]&nbsp;remote=[::]&nbsp;FD&nbsp;10&nbsp;flags=1;&nbsp;asynCall&nbsp;0x1a37c50*1&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.760&nbsp;kid1|&nbsp;5,5|&nbsp;&lt;a&nbsp;href=&quot;http://ModEpoll.cc&quot;&nbsp;class=&quot;&quot;&gt;ModEpoll.cc&lt;/a&gt;(117)&nbsp;SetSelect:&nbsp;FD&nbsp;10,&nbsp;type=1,&nbsp;handler=1,&nbsp;client_data=0x155cce8,&nbsp;timeout=0&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.760&nbsp;kid1|&nbsp;5,4|&nbsp;&lt;a&nbsp;href=&quot;http://AsyncCallQueue.cc&quot;&nbsp;class=&quot;&quot;&gt;AsyncCallQueue.cc&lt;/a&gt;(57)&nbsp;fireNext:&nbsp;leaving&nbsp;helperHandleRead(local=[::]&nbsp;remote=[::]&nbsp;FD&nbsp;10&nbsp;flags=1,&nbsp;data=0x157f9a8,&nbsp;size=3384,&nbsp;buf=0x157fbd0)&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.760&nbsp;kid1|&nbsp;83,5|&nbsp;&lt;a&nbsp;href=&quot;http://bio.cc&quot;&nbsp;class=&quot;&quot;&gt;bio.cc&lt;/a&gt;(612)&nbsp;squid_bio_ctrl:&nbsp;0x1a5e140&nbsp;6(0,&nbsp;0x1a76c00)&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.761&nbsp;kid1|&nbsp;83,5|&nbsp;&lt;a&nbsp;href=&quot;http://Session.cc&quot;&nbsp;class=&quot;&quot;&gt;Session.cc&lt;/a&gt;(347)&nbsp;get_session_cb:&nbsp;Request&nbsp;to&nbsp;search&nbsp;for&nbsp;SSL_SESSION&nbsp;of&nbsp;len:&nbsp;321019023443:419801955&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.761&nbsp;kid1|&nbsp;54,5|&nbsp;&lt;a&nbsp;href=&quot;http://MemMap.cc&quot;&nbsp;class=&quot;&quot;&gt;MemMap.cc&lt;/a&gt;(156)&nbsp;openForReading:&nbsp;trying&nbsp;to&nbsp;open&nbsp;slot&nbsp;for&nbsp;key&nbsp;5310BD3C63AB0519C4F984A35A8DC1AE&nbsp;for&nbsp;reading&nbsp;in&nbsp;map&nbsp;[tls_session_cache]&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.761&nbsp;kid1|&nbsp;54,5|&nbsp;&lt;a&nbsp;href=&quot;http://MemMap.cc&quot;&nbsp;class=&quot;&quot;&gt;MemMap.cc&lt;/a&gt;(177)&nbsp;openForReadingAt:&nbsp;trying&nbsp;to&nbsp;open&nbsp;slot&nbsp;at&nbsp;18&nbsp;for&nbsp;reading&nbsp;in&nbsp;map&nbsp;[tls_session_cache]&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.761&nbsp;kid1|&nbsp;54,5|&nbsp;&lt;a&nbsp;href=&quot;http://MemMap.cc&quot;&nbsp;class=&quot;&quot;&gt;MemMap.cc&lt;/a&gt;(169)&nbsp;openForReading:&nbsp;failed&nbsp;to&nbsp;open&nbsp;slot&nbsp;for&nbsp;key&nbsp;5310BD3C63AB0519C4F984A35A8DC1AE&nbsp;for&nbsp;reading&nbsp;in&nbsp;map&nbsp;[tls_session_cache]&lt;br&nbsp;class=&quot;&quot;&gt;<br>
2019/12/07&nbsp;20:48:59.761&nbsp;kid1|&nbsp;83,5|&nbsp;&lt;a&nbsp;href=&quot;http://Session.cc&quot;&nbsp;class=&quot;&quot;&gt;Session.cc&lt;/a&gt;(362)&nbsp;get_session_cb:<br>
&lt;font&nbsp;color=&quot;#ff000a&quot;&nbsp;class=&quot;&quot;&gt;Failed&nbsp;to&nbsp;retrieve&nbsp;SSL_SESSION&nbsp;&lt;/font&gt;from&nbsp;cache&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;***&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;Here&nbsp;is&nbsp;my&nbsp;squid.conf:&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;#&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;192.168.1.0/24&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
ssl_bump&nbsp;peek&nbsp;step1&lt;br&nbsp;class=&quot;&quot;&gt;<br>
ssl_bump&nbsp;stare&nbsp;step2&lt;br&nbsp;class=&quot;&quot;&gt;<br>
ssl_bump&nbsp;bump&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;#&nbsp;http&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;#&nbsp;ftp&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;#&nbsp;https&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;#&nbsp;gopher&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;#&nbsp;wais&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;#&nbsp;http-mgmt&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;#&nbsp;gss-http&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;#&nbsp;filemaker&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;#&nbsp;multiling&nbsp;http&lt;br&nbsp;class=&quot;&quot;&gt;<br>
acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http_access&nbsp;deny&nbsp;manager&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http_access&nbsp;allow&nbsp;localnet&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http_access&nbsp;allow&nbsp;localhost&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http_access&nbsp;deny&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http_port&nbsp;3128&lt;br&nbsp;class=&quot;&quot;&gt;<br>
http_port&nbsp;3129&nbsp;intercept&lt;br&nbsp;class=&quot;&quot;&gt;<br>
https_port&nbsp;3130&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/usr/local/squid/etc/ssl_cert/myCA.pem&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;key=/usr/local/&lt;br&nbsp;class=&quot;&quot;&gt;<br>
squid/etc/ssl_cert/myCA.pem&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;br&nbsp;class=&quot;&quot;&gt;<br>
sslcrtd_program&nbsp;/usr/local/squid/libexec/security_file_certgen&nbsp;-s&nbsp;/usr/local/squid/var/logs/ssl_db&nbsp;-M&nbsp;4MB&lt;br&nbsp;class=&quot;&quot;&gt;<br>
coredump_dir&nbsp;/usr/local/squid/var/cache/squid&lt;br&nbsp;class=&quot;&quot;&gt;<br>
cache_dir&nbsp;ufs&nbsp;/usr/local/squid/var/cache/squid&nbsp;1000&nbsp;16&nbsp;256&nbsp;#&nbsp;1GB&nbsp;as&nbsp;Cache&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;##&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;I’m&nbsp;wondering&nbsp;if&nbsp;this&nbsp;problem&nbsp;is&nbsp;a&nbsp;bug,&nbsp;my&nbsp;proxy&nbsp;config&nbsp;issue,&nbsp;or&nbsp;the&nbsp;client&nbsp;does&nbsp;not&nbsp;send&nbsp;the&nbsp;correct&nbsp;TLS&nbsp;parameters.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;thanks&nbsp;for&nbsp;your&nbsp;help&nbsp;in&nbsp;advance.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;Cheers,&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;-&nbsp;George&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
