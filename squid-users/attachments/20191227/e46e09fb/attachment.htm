<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;p&gt;hi&nbsp;all,&lt;/p&gt;&lt;p&gt;ive&nbsp;been&nbsp;struggling&nbsp;with&nbsp;this&nbsp;for&nbsp;a&nbsp;few&nbsp;weeks&nbsp;and&nbsp;hopefully&nbsp;one&nbsp;of&nbsp;you&nbsp;guys&nbsp;can&nbsp;help&nbsp;me&nbsp;out&nbsp;as&nbsp;im&nbsp;struggling&nbsp;finding&nbsp;solutions&lt;/p&gt;&lt;p&gt;ive&nbsp;installed&nbsp;on&nbsp;my&nbsp;centos&nbsp;7&nbsp;vm&nbsp;machine&lt;/p&gt;&lt;p&gt;c-icap&lt;/p&gt;&lt;p&gt;c-icap&nbsp;modules&lt;/p&gt;&lt;p&gt;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;http://c-icap.sourceforge.net/download.html&quot;&gt;http://c-icap.sourceforge.net/download.html&lt;/a&gt;&lt;/p&gt;&lt;p&gt;squid&nbsp;4.9&lt;/p&gt;&lt;p&gt;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;http://www.squid-cache.org/Versions/v4/&quot;&gt;http://www.squid-cache.org/Versions/v4/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;clamav&lt;/p&gt;&lt;p&gt;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;https://hostpresto.com/community/tutorials/how-to-install-clamav-on-centos-7/&quot;&gt;https://hostpresto.com/community/tutorials/how-to-install-clamav-on-centos-7/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;squidclamav&lt;/p&gt;&lt;p&gt;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;https://sourceforge.net/projects/squidclamav/files/latest/download&quot;&gt;https://sourceforge.net/projects/squidclamav/files/latest/download&lt;/a&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;and&nbsp;i&nbsp;followed&nbsp;this&nbsp;guide&nbsp;compiling&nbsp;them&nbsp;from&nbsp;source&nbsp;with&nbsp;the&nbsp;configure&nbsp;options&nbsp;make&nbsp;and&nbsp;make&nbsp;install&nbsp;on&nbsp;all&nbsp;of&nbsp;them&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;https://wiki.squid-cache.org/ConfigExamples/ContentAdaptation/C-ICAP&quot;&gt;https://wiki.squid-cache.org/ConfigExamples/ContentAdaptation/C-ICAP&lt;/a&gt;&lt;/p&gt;&lt;p&gt;squid&nbsp;works&nbsp;as&nbsp;a&nbsp;proxy&nbsp;just&nbsp;fine,&nbsp;just&nbsp;struggling&nbsp;with&nbsp;the&nbsp;c-icap&nbsp;with&nbsp;squidclamav&nbsp;part&lt;/p&gt;&lt;p&gt;this&nbsp;is&nbsp;the&nbsp;error&nbsp;i&nbsp;get&nbsp;-&nbsp;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Sun<br>
&nbsp;Dec&nbsp;22&nbsp;21:40:44&nbsp;2019,&nbsp;1586/40797952,&nbsp;squidclamav.c(2081)&nbsp;dconnect:&nbsp;Sun&nbsp;<br>
Dec&nbsp;22&nbsp;21:40:44&nbsp;2019,&nbsp;1586/40797952,&nbsp;ERROR&nbsp;Can&#39;t&nbsp;connect&nbsp;to&nbsp;clamd&nbsp;on&nbsp;<br>
local&nbsp;socket&nbsp;/run/clamd.scan/clamd.sock.&lt;br&gt;Sun&nbsp;Dec&nbsp;22&nbsp;21:40:44&nbsp;2019,&nbsp;<br>
1586/40797952,&nbsp;squidclamav.c(787)&nbsp;squidclamav_end_of_data_handler:&nbsp;Sun&nbsp;<br>
Dec&nbsp;22&nbsp;21:40:44&nbsp;2019,&nbsp;1586/40797952,&nbsp;ERROR&nbsp;Can&#39;t&nbsp;connect&nbsp;to&nbsp;Clamd&nbsp;<br>
daemon.&lt;br&gt;Mon&nbsp;Dec&nbsp;23&nbsp;10:10:11&nbsp;2019,&nbsp;main&nbsp;proc,&nbsp;c-icap&nbsp;server&nbsp;already&nbsp;running!&lt;br&gt;Mon&nbsp;Dec&nbsp;23&nbsp;10:37:44&nbsp;2019,&nbsp;main&nbsp;proc,&nbsp;c-icap&nbsp;server&nbsp;already&nbsp;running!&lt;br&gt;[root@squid&nbsp;~]#&nbsp;ls&nbsp;/run/clamd.scan/&lt;br&gt;[root@squid&nbsp;~]#&lt;/p&gt;&lt;p&gt;but&nbsp;i&nbsp;have&nbsp;changed&nbsp;all&nbsp;my&nbsp;services&nbsp;to&nbsp;a&nbsp;/services&nbsp;directory&nbsp;and&nbsp;there&nbsp;all&nbsp;running&nbsp;-&nbsp;&lt;br&gt;&lt;/p&gt;&lt;p&gt;[root@squid&nbsp;~]#&nbsp;ls&nbsp;/services/c-icap/&lt;br&gt;c-icap.ctl&nbsp;&nbsp;c-icap.pid&lt;br&gt;[root@squid&nbsp;~]#&nbsp;ls&nbsp;/services/clamd.scan/&lt;br&gt;clamd.sock&lt;br&gt;[root@squid&nbsp;~]#&lt;/p&gt;&lt;p&gt;so&nbsp;my&nbsp;question&nbsp;is&nbsp;why&nbsp;is&nbsp;squidclamav&nbsp;still&nbsp;looking&nbsp;in&nbsp;&quot;/run/clamd.scan/clamd.sock&quot;&lt;/p&gt;&lt;p&gt;i&nbsp;have&nbsp;even&nbsp;specified&nbsp;in&nbsp;my&nbsp;&quot;/etc/squidclamav.conf&quot;&nbsp;where&nbsp;the&nbsp;clamd&nbsp;service&nbsp;is&lt;/p&gt;&lt;p&gt;#&nbsp;clamd_port&nbsp;to&nbsp;the&nbsp;corresponding&nbsp;value.&lt;br&gt;clamd_local&nbsp;/services/clamd.scan/clamd.sock&lt;br&gt;#clamd_ip&nbsp;127.0.0.1&lt;br&gt;#clamd_port&nbsp;3310&lt;/p&gt;&lt;div&gt;<br>
<br>
but&nbsp;i&nbsp;have&nbsp;resolved&nbsp;it&nbsp;by&nbsp;this&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;so&nbsp;in&nbsp;my&nbsp;squid.conf&nbsp;i&nbsp;added&nbsp;the&nbsp;c-icap&nbsp;lines&nbsp;<br>
using&nbsp;this&nbsp;site&nbsp;as&nbsp;the&nbsp;link&nbsp;i&nbsp;gave,&nbsp;gave&nbsp;a&nbsp;c-icap&nbsp;protocol&nbsp;error,&nbsp;<br>
everytime&nbsp;i&nbsp;opened&nbsp;a&nbsp;web&nbsp;page&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;p&gt;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;https://www.server-world.info/en/note?os=CentOS_7&amp;p=squid&amp;f=5&quot;&gt;https://www.server-world.info/en/note?os=CentOS_7&amp;p=squid&amp;f=5&lt;/a&gt;&nbsp;(the&nbsp;c-icap&nbsp;lines&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;guide)&lt;/p&gt;&lt;p&gt;i&nbsp;also&nbsp;did&nbsp;this&lt;/p&gt;&lt;p&gt;<br>
vi&nbsp;/etc/tmpfiles.d/c-icap.conf&lt;br&gt;<br>
d&nbsp;/run/c-icap&nbsp;<br>
0770&nbsp;root&nbsp;root<br>
<br>
&nbsp;-&lt;br&gt;<br>
&lt;br&gt;<br>
vi&nbsp;/etc/tmpfiles.d/clamd.scan.conf&lt;br&gt;<br>
d&nbsp;/run/clamd.scan&nbsp;0770&nbsp;root&nbsp;root<br>
<br>
&nbsp;-&lt;/p&gt;&lt;p&gt;i&nbsp;also&nbsp;made&nbsp;c-icap.conf&nbsp;and&nbsp;clamd.d/scan.conf,&nbsp;i&nbsp;made&nbsp;the&nbsp;user&nbsp;<br>
root&nbsp;just&nbsp;to&nbsp;make&nbsp;my&nbsp;life&nbsp;a&nbsp;lot&nbsp;easier&nbsp;not&nbsp;to&nbsp;run&nbsp;into&nbsp;any&nbsp;<br>
troubleshooting&nbsp;problems&lt;/p&gt;&lt;p&gt;and&nbsp;finally&nbsp;this&nbsp;command&nbsp;to&nbsp;re-initialise&nbsp;squidclamav&nbsp;with&nbsp;the&nbsp;c-icap&nbsp;configs&lt;/p&gt;&lt;p&gt;echo&nbsp;-n&nbsp;&quot;squidclamav:cfgreload&quot;&nbsp;&gt;&nbsp;/run/c-icap/c-icap.ctl&lt;/p&gt;&lt;p&gt;then&nbsp;when&nbsp;i&nbsp;went&nbsp;on&nbsp;the&nbsp;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;http://www.eicar.org/download/eicar_com.zip&quot;&gt;http://www.eicar.org/download/eicar_com.zip&lt;/a&gt;&lt;/p&gt;&lt;p&gt;i&nbsp;got&nbsp;a&nbsp;virus&nbsp;found&lt;/p&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
