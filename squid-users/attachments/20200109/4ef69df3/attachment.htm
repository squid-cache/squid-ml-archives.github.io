<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;thanks&nbsp;for&nbsp;this&nbsp;Amos,&nbsp;really&nbsp;appreciate&nbsp;it&nbsp;:)&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Thu,&nbsp;9&nbsp;Jan&nbsp;2020&nbsp;at&nbsp;19:00,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;9/01/20&nbsp;8:34&nbsp;pm,&nbsp;robert&nbsp;k&nbsp;Wild&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;hi&nbsp;all,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;made&nbsp;a&nbsp;script&nbsp;for&nbsp;squid&nbsp;that&nbsp;installs&nbsp;the&nbsp;following&nbsp;–&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Squid&nbsp;–&nbsp;http&nbsp;proxy&nbsp;server&lt;br&gt;<br>
&gt;&nbsp;Squid&nbsp;ssl-bump&nbsp;–&nbsp;https&nbsp;interception&nbsp;for&nbsp;squid&lt;br&gt;<br>
&gt;&nbsp;C-ICAP&nbsp;–&nbsp;icap&nbsp;server&lt;br&gt;<br>
&gt;&nbsp;clamAV&nbsp;–&nbsp;AV&nbsp;engine&nbsp;to&nbsp;detect&nbsp;trojan&nbsp;viruses&nbsp;malware&nbsp;etc&lt;br&gt;<br>
&gt;&nbsp;squidclamav&nbsp;–&nbsp;to&nbsp;make&nbsp;it&nbsp;all&nbsp;integrated&nbsp;with&nbsp;squid&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;what&nbsp;do&nbsp;you&nbsp;think?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;#!/bin/bash&lt;br&gt;<br>
&gt;&nbsp;#squid&nbsp;on&nbsp;DMZ&nbsp;host&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#first&nbsp;things&nbsp;first&nbsp;lets&nbsp;disable&nbsp;firewalld&nbsp;and&nbsp;SElinux&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;systemctl&nbsp;stop&nbsp;firewalld&lt;br&gt;<br>
&gt;&nbsp;systemctl&nbsp;disable&nbsp;firewalld&lt;br&gt;<br>
&gt;&nbsp;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;&nbsp;/etc/selinux/config&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&lt;br&gt;<br>
Why?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;#squid&nbsp;packages&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;yum&nbsp;install&nbsp;-y&nbsp;epel-release&nbsp;swaks&nbsp;sed&nbsp;tar&nbsp;zip&nbsp;unzip&nbsp;curl&nbsp;telnet&nbsp;openssl&lt;br&gt;<br>
&gt;&nbsp;openssl-devel&nbsp;bzip2-devel&nbsp;libarchive&nbsp;libarchive-devel&nbsp;perl&lt;br&gt;<br>
&gt;&nbsp;perl-Data-Dumper&nbsp;gcc&nbsp;gcc-c++&nbsp;binutils&nbsp;autoconf&nbsp;automake&nbsp;make&nbsp;sudo&nbsp;wget&lt;br&gt;<br>
&gt;&nbsp;libxml2-devel&nbsp;libcap-devel&nbsp;libtool-ltdl-devel&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#clamAV&nbsp;packages&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;yum&nbsp;install&nbsp;-y&nbsp;clamav-server&nbsp;clamav-data&nbsp;clamav-update&nbsp;clamav-filesystem&lt;br&gt;<br>
&gt;&nbsp;clamav&nbsp;clamav-scanner-systemd&nbsp;clamav-devel&nbsp;clamav-lib&nbsp;clamav-server-systemd&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#download&nbsp;and&nbsp;compile&nbsp;from&nbsp;source&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;cd&nbsp;/tmp&lt;br&gt;<br>
&gt;&nbsp;wget&nbsp;&lt;a&nbsp;href=&quot;http://www.squid-cache.org/Versions/v4/squid-4.9.tar.gz&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.squid-cache.org/Versions/v4/squid-4.9.tar.gz&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;use&nbsp;rsync&nbsp;for&nbsp;this,&nbsp;and&nbsp;verify&nbsp;against&nbsp;the&nbsp;*.asc&nbsp;file&nbsp;signature&lt;br&gt;<br>
that&nbsp;you&nbsp;got&nbsp;the&nbsp;file&nbsp;correctly.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;wget&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://sourceforge.net/projects/c-icap/files/c-icap/0.5.x/c_icap-0.5.6.tar.gz&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://sourceforge.net/projects/c-icap/files/c-icap/0.5.x/c_icap-0.5.6.tar.gz&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;wget&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://sourceforge.net/projects/c-icap/files/c-icap-modules/0.5.x/c_icap_modules-0.5.4.tar.gz&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://sourceforge.net/projects/c-icap/files/c-icap-modules/0.5.x/c_icap_modules-0.5.4.tar.gz&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;wget&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://sourceforge.net/projects/squidclamav/files/squidclamav/7.1/squidclamav-7.1.tar.gz&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://sourceforge.net/projects/squidclamav/files/squidclamav/7.1/squidclamav-7.1.tar.gz&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;for&nbsp;f&nbsp;in&nbsp;*.tar.gz;&nbsp;do&nbsp;tar&nbsp;xf&nbsp;&quot;$f&quot;;&nbsp;done&lt;br&gt;<br>
&gt;&nbsp;cd&nbsp;/tmp/squid-4.9&lt;br&gt;<br>
&gt;&nbsp;./configure&nbsp;--with-openssl&nbsp;--enable-ssl-crtd&nbsp;--enable-icap-client&nbsp;&amp;&amp;&lt;br&gt;<br>
&gt;&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&lt;br&gt;<br>
IIRC&nbsp;this&nbsp;was&nbsp;a&nbsp;CentoOS&nbsp;machine&nbsp;right?&lt;br&gt;<br>
If&nbsp;so,&nbsp;see&nbsp;&lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/KnowledgeBase/CentOS#Compiling&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/KnowledgeBase/CentOS#Compiling&lt;/a&gt;&gt;&lt;br&gt;<br>
otherwise&nbsp;see&nbsp;the&nbsp;equivalent&nbsp;wiki&nbsp;page&nbsp;for&nbsp;your&nbsp;chosen&nbsp;OS&nbsp;compile.&lt;br&gt;<br>
&lt;br&gt;<br>
Those&nbsp;settings&nbsp;install&nbsp;Squid&nbsp;as&nbsp;a&nbsp;system&nbsp;application.&nbsp;So&nbsp;no&nbsp;need&nbsp;for&nbsp;the&lt;br&gt;<br>
/usr/local&nbsp;stuff.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;cd&nbsp;/tmp/c_icap-0.5.6&lt;br&gt;<br>
&gt;&nbsp;./configure&nbsp;&#39;CXXFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&nbsp;&#39;CFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&lt;br&gt;<br>
&gt;&nbsp;--without-bdb&nbsp;--prefix=/usr/local&nbsp;&amp;&amp;&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;cd&nbsp;/tmp/squidclamav-7.1&lt;br&gt;<br>
&gt;&nbsp;./configure&nbsp;&#39;CXXFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&nbsp;&#39;CFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&lt;br&gt;<br>
&gt;&nbsp;--with-c-icap=/usr/local&nbsp;--with-libarchive&nbsp;&amp;&amp;&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;cd&nbsp;/tmp/c_icap_modules-0.5.4&lt;br&gt;<br>
&gt;&nbsp;./configure&nbsp;&#39;CFLAGS=-O3&nbsp;-m64&nbsp;-pipe&#39;&lt;br&gt;<br>
&gt;&nbsp;&#39;CPPFLAGS=-I/usr/local/clamav/include&#39;&nbsp;&#39;LDFLAGS=-L/usr/local/lib&lt;br&gt;<br>
&gt;&nbsp;-L/usr/local/clamav/lib/&#39;&nbsp;&amp;&amp;&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#creating&nbsp;shortcuts&nbsp;and&nbsp;copying&nbsp;files&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;cp&nbsp;-f&nbsp;/usr/local/squid/etc/squid.conf&nbsp;/usr/local/squid/etc/squid.conf.orig&lt;br&gt;<br>
&gt;&nbsp;cp&nbsp;-f&nbsp;/usr/local/etc/c-icap.conf&nbsp;/usr/local/etc/c-icap.conf.orig&lt;br&gt;<br>
&gt;&nbsp;cp&nbsp;-f&nbsp;/usr/local/etc/squidclamav.conf&nbsp;/usr/local/etc/squidclamav.conf.orig&lt;br&gt;<br>
&gt;&nbsp;cp&nbsp;-f&nbsp;/usr/local/etc/clamav_mod.conf&nbsp;/usr/local/etc/clamav_mod.conf.orig&lt;br&gt;<br>
&gt;&nbsp;cp&nbsp;-f&nbsp;/usr/local/etc/virus_scan.conf&nbsp;/usr/local/etc/virus_scan.conf.orig&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/usr/local/squid/etc/squid.conf&nbsp;/etc&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/usr/local/etc/c-icap.conf&nbsp;/etc&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/usr/local/etc/squidclamav.conf&nbsp;/etc&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/usr/local/etc/clamav_mod.conf&nbsp;/etc&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/usr/local/etc/virus_scan.conf&nbsp;/etc&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;mkdir&nbsp;-p&nbsp;/usr/local/clamav/share/clamav&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/var/lib/clamav&nbsp;/usr/local/clamav/share/clamav&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#tmpfiles&nbsp;for&nbsp;run&nbsp;files&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;d&nbsp;/var/run/c-icap&nbsp;0755&nbsp;root&nbsp;root&nbsp;-&quot;&nbsp;&gt;&gt;&nbsp;/etc/tmpfiles.d/c-icap.conf&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;d&nbsp;/var/run/clamav&nbsp;0755&nbsp;root&nbsp;root&nbsp;-&quot;&nbsp;&gt;&gt;&nbsp;/etc/tmpfiles.d/clamav.conf&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#delete&nbsp;a&nbsp;few&nbsp;lines&nbsp;in&nbsp;squid&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;sed&nbsp;-i&nbsp;&#39;/http_port&nbsp;3128/d&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;<br>
&gt;&nbsp;sed&nbsp;-i&nbsp;&#39;/http_access&nbsp;deny&nbsp;all/d&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;do&nbsp;not&nbsp;remove&nbsp;that&nbsp;second&nbsp;line&nbsp;from&nbsp;yoru&nbsp;squid.conf.&nbsp;It&nbsp;will&lt;br&gt;<br>
result&nbsp;in&nbsp;unpredictable&nbsp;default&nbsp;allow/deny&nbsp;behaviour&nbsp;from&nbsp;your&nbsp;proxy.&lt;br&gt;<br>
&lt;br&gt;<br>
Instead&nbsp;I&nbsp;recommend&nbsp;(mind&nbsp;the&nbsp;wrap):&lt;br&gt;<br>
&lt;br&gt;<br>
 sed&nbsp;-i&nbsp;&#39;/#&nbsp;INSERT&nbsp;YOUR&nbsp;OWN&nbsp;RULE(S)&nbsp;HERE&nbsp;TO&nbsp;ALLOW&nbsp;ACCESS&nbsp;FROM&nbsp;YOUR&lt;br&gt;<br>
CLIENTS/include&nbsp;&quot;/etc/squid/squid.conf.d/*&quot;/&#39;&lt;br&gt;<br>
/usr/local/squid/etc/squid.conf&lt;br&gt;<br>
&lt;br&gt;<br>
Then&nbsp;you&nbsp;can&nbsp;just&nbsp;drop&nbsp;files&nbsp;into&nbsp;the&nbsp;/etc/squid/squid.conf.d/&nbsp;directory&lt;br&gt;<br>
and&nbsp;they&nbsp;will&nbsp;be&nbsp;loaded&nbsp;as&nbsp;config&nbsp;on&nbsp;next&nbsp;start&nbsp;or&nbsp;reconfigure.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH&lt;br&gt;<br>
Amos&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Regards,&nbsp;&lt;br&gt;&lt;br&gt;Robert&nbsp;K&nbsp;Wild.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
