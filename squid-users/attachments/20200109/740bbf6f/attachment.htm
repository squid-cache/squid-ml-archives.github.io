<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;p&gt;hi&nbsp;all,&lt;/p&gt;&lt;p&gt;<br>
I&nbsp;have&nbsp;made&nbsp;a&nbsp;script&nbsp;for&nbsp;squid&nbsp;that&nbsp;installs&nbsp;the&nbsp;following&nbsp;–&lt;br&gt;<br>
&lt;br&gt;<br>
Squid&nbsp;–&nbsp;http&nbsp;proxy&nbsp;server&lt;br&gt;<br>
Squid&nbsp;ssl-bump&nbsp;–&nbsp;https&nbsp;interception&nbsp;for&nbsp;squid&lt;br&gt;<br>
C-ICAP&nbsp;–&nbsp;icap&nbsp;server&lt;br&gt;<br>
clamAV&nbsp;–&nbsp;AV&nbsp;engine&nbsp;to&nbsp;detect&nbsp;trojan&nbsp;viruses&nbsp;malware&nbsp;etc&lt;br&gt;<br>
squidclamav&nbsp;–&nbsp;to&nbsp;make&nbsp;it&nbsp;all&nbsp;integrated&nbsp;with&nbsp;squid&nbsp;&lt;br&gt;&lt;/p&gt;&lt;p&gt;what&nbsp;do&nbsp;you&nbsp;think?&lt;/p&gt;&lt;p&gt;#!/bin/bash&lt;br&gt;#squid&nbsp;on&nbsp;DMZ&nbsp;host&lt;br&gt;#&lt;br&gt;#first&nbsp;things&nbsp;first&nbsp;lets&nbsp;disable&nbsp;firewalld&nbsp;and&nbsp;SElinux&lt;br&gt;#&lt;br&gt;systemctl&nbsp;stop&nbsp;firewalld&lt;br&gt;systemctl&nbsp;disable&nbsp;firewalld&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;&nbsp;/etc/selinux/config&lt;br&gt;#&lt;br&gt;#squid&nbsp;packages&lt;br&gt;#&lt;br&gt;yum<br>
&nbsp;install&nbsp;-y&nbsp;epel-release&nbsp;swaks&nbsp;sed&nbsp;tar&nbsp;zip&nbsp;unzip&nbsp;curl&nbsp;telnet&nbsp;openssl&nbsp;<br>
openssl-devel&nbsp;bzip2-devel&nbsp;libarchive&nbsp;libarchive-devel&nbsp;perl&nbsp;<br>
perl-Data-Dumper&nbsp;gcc&nbsp;gcc-c++&nbsp;binutils&nbsp;autoconf&nbsp;automake&nbsp;make&nbsp;sudo&nbsp;wget&nbsp;<br>
libxml2-devel&nbsp;libcap-devel&nbsp;libtool-ltdl-devel&lt;br&gt;#&lt;br&gt;#clamAV&nbsp;packages&lt;br&gt;#&lt;br&gt;yum<br>
&nbsp;install&nbsp;-y&nbsp;clamav-server&nbsp;clamav-data&nbsp;clamav-update&nbsp;clamav-filesystem&nbsp;<br>
clamav&nbsp;clamav-scanner-systemd&nbsp;clamav-devel&nbsp;clamav-lib&nbsp;<br>
clamav-server-systemd&lt;br&gt;#&lt;br&gt;#download&nbsp;and&nbsp;compile&nbsp;from&nbsp;source&lt;br&gt;#&lt;br&gt;cd&nbsp;/tmp&lt;br&gt;wget&nbsp;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;http://www.squid-cache.org/Versions/v4/squid-4.9.tar.gz&quot;&gt;http://www.squid-cache.org/Versions/v4/squid-4.9.tar.gz&lt;/a&gt;&lt;br&gt;wget&nbsp;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;http://sourceforge.net/projects/c-icap/files/c-icap/0.5.x/c_icap-0.5.6.tar.gz&quot;&gt;http://sourceforge.net/projects/c-icap/files/c-icap/0.5.x/c_icap-0.5.6.tar.gz&lt;/a&gt;&lt;br&gt;wget&nbsp;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;http://sourceforge.net/projects/c-icap/files/c-icap-modules/0.5.x/c_icap_modules-0.5.4.tar.gz&quot;&gt;http://sourceforge.net/projects/c-icap/files/c-icap-modules/0.5.x/c_icap_modules-0.5.4.tar.gz&lt;/a&gt;&lt;br&gt;wget&nbsp;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;https://sourceforge.net/projects/squidclamav/files/squidclamav/7.1/squidclamav-7.1.tar.gz&quot;&gt;https://sourceforge.net/projects/squidclamav/files/squidclamav/7.1/squidclamav-7.1.tar.gz&lt;/a&gt;&lt;br&gt;for&nbsp;f&nbsp;in&nbsp;*.tar.gz;&nbsp;do&nbsp;tar&nbsp;xf&nbsp;&quot;$f&quot;;&nbsp;done&lt;br&gt;cd&nbsp;/tmp/squid-4.9&lt;br&gt;./configure&nbsp;--with-openssl&nbsp;--enable-ssl-crtd&nbsp;--enable-icap-client&nbsp;&amp;&amp;&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;#&lt;br&gt;cd&nbsp;/tmp/c_icap-0.5.6&lt;br&gt;./configure<br>
&nbsp;&#39;CXXFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&nbsp;&#39;CFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&nbsp;--without-bdb&nbsp;<br>
--prefix=/usr/local&nbsp;&amp;&amp;&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;#&lt;br&gt;cd&nbsp;/tmp/squidclamav-7.1&lt;br&gt;./configure<br>
&nbsp;&#39;CXXFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&nbsp;&#39;CFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&nbsp;<br>
--with-c-icap=/usr/local&nbsp;--with-libarchive&nbsp;&amp;&amp;&nbsp;make&nbsp;&amp;&amp;&nbsp;<br>
make&nbsp;install&lt;br&gt;#&lt;br&gt;cd&nbsp;/tmp/c_icap_modules-0.5.4&lt;br&gt;./configure&nbsp;<br>
&#39;CFLAGS=-O3&nbsp;-m64&nbsp;-pipe&#39;&nbsp;&#39;CPPFLAGS=-I/usr/local/clamav/include&#39;&nbsp;<br>
&#39;LDFLAGS=-L/usr/local/lib&nbsp;-L/usr/local/clamav/lib/&#39;&nbsp;&amp;&amp;&nbsp;make&nbsp;<br>
&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;#&lt;br&gt;#creating&nbsp;shortcuts&nbsp;and&nbsp;copying&nbsp;files&lt;br&gt;#&lt;br&gt;cp&nbsp;-f&nbsp;/usr/local/squid/etc/squid.conf&nbsp;/usr/local/squid/etc/squid.conf.orig&lt;br&gt;cp&nbsp;-f&nbsp;/usr/local/etc/c-icap.conf&nbsp;/usr/local/etc/c-icap.conf.orig&lt;br&gt;cp&nbsp;-f&nbsp;/usr/local/etc/squidclamav.conf&nbsp;/usr/local/etc/squidclamav.conf.orig&lt;br&gt;cp&nbsp;-f&nbsp;/usr/local/etc/clamav_mod.conf&nbsp;/usr/local/etc/clamav_mod.conf.orig&lt;br&gt;cp&nbsp;-f&nbsp;/usr/local/etc/virus_scan.conf&nbsp;/usr/local/etc/virus_scan.conf.orig&lt;br&gt;#&lt;br&gt;ln&nbsp;-s&nbsp;/usr/local/squid/etc/squid.conf&nbsp;/etc&lt;br&gt;ln&nbsp;-s&nbsp;/usr/local/etc/c-icap.conf&nbsp;/etc&lt;br&gt;ln&nbsp;-s&nbsp;/usr/local/etc/squidclamav.conf&nbsp;/etc&lt;br&gt;ln&nbsp;-s&nbsp;/usr/local/etc/clamav_mod.conf&nbsp;/etc&lt;br&gt;ln&nbsp;-s&nbsp;/usr/local/etc/virus_scan.conf&nbsp;/etc&lt;br&gt;#&lt;br&gt;mkdir&nbsp;-p&nbsp;/usr/local/clamav/share/clamav&lt;br&gt;ln&nbsp;-s&nbsp;/var/lib/clamav&nbsp;/usr/local/clamav/share/clamav&lt;br&gt;#&lt;br&gt;#tmpfiles&nbsp;for&nbsp;run&nbsp;files&lt;br&gt;#&lt;br&gt;echo&nbsp;&quot;d&nbsp;/var/run/c-icap&nbsp;0755&nbsp;root&nbsp;root&nbsp;-&quot;&nbsp;&gt;&gt;&nbsp;/etc/tmpfiles.d/c-icap.conf&lt;br&gt;echo&nbsp;&quot;d&nbsp;/var/run/clamav&nbsp;0755&nbsp;root&nbsp;root&nbsp;-&quot;&nbsp;&gt;&gt;&nbsp;/etc/tmpfiles.d/clamav.conf&lt;br&gt;#&lt;br&gt;#delete&nbsp;a&nbsp;few&nbsp;lines&nbsp;in&nbsp;squid&lt;br&gt;#&lt;br&gt;sed&nbsp;-i&nbsp;&#39;/http_port&nbsp;3128/d&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;/http_access&nbsp;deny&nbsp;all/d&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;#&lt;br&gt;#whitelist&nbsp;in&nbsp;squid&lt;br&gt;#&lt;br&gt;sed&nbsp;-i&nbsp;&#39;50i#HTTP_HTTPS&nbsp;whitelist&nbsp;websites&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;51iacl&nbsp;whitelist&nbsp;ssl::server_name&nbsp;&quot;/usr/local/squid/etc/urlwhite.txt&quot;&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;52ihttp_access&nbsp;allow&nbsp;whitelist&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;53ihttp_access&nbsp;deny&nbsp;all&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;echo&nbsp;&quot;#Microsoft&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://bing.com&quot;&gt;bing.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://msn.com&quot;&gt;msn.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://msedge.net&quot;&gt;msedge.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://msftauth.net&quot;&gt;msftauth.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://msauth.net&quot;&gt;msauth.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://msocdn.com&quot;&gt;msocdn.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://outlook.com&quot;&gt;outlook.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://onedrive.com&quot;&gt;onedrive.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://office.net&quot;&gt;office.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://office.com&quot;&gt;office.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://office365.com&quot;&gt;office365.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://microsoft.com&quot;&gt;microsoft.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://microsoftonline.com&quot;&gt;microsoftonline.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://live.com&quot;&gt;live.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://live.net&quot;&gt;live.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://akamaized.net&quot;&gt;akamaized.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://akamaihd.net&quot;&gt;akamaihd.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://svc.ms&quot;&gt;svc.ms&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://lync.com&quot;&gt;lync.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://skype.com&quot;&gt;skype.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://gfx.ms&quot;&gt;gfx.ms&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://sharepoint.com&quot;&gt;sharepoint.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://sharepointonline.com&quot;&gt;sharepointonline.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://windowsupdate.com&quot;&gt;windowsupdate.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://windows.net&quot;&gt;windows.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://edgesuite.net&quot;&gt;edgesuite.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://a-msedge.net&quot;&gt;a-msedge.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://akamaiedge.net&quot;&gt;akamaiedge.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://sfx.ms&quot;&gt;sfx.ms&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://azureedge.net&quot;&gt;azureedge.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://trafficmanager.net&quot;&gt;trafficmanager.net&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://azure.com&quot;&gt;azure.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://s-microsoft.com&quot;&gt;s-microsoft.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://onestore.ms&quot;&gt;onestore.ms&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;#Google&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://google.com&quot;&gt;google.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://google.co.uk&quot;&gt;google.co.uk&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://googleusercontent.com&quot;&gt;googleusercontent.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://googleapis.com&quot;&gt;googleapis.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://withgoogle.com&quot;&gt;withgoogle.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://gstatic.com&quot;&gt;gstatic.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;#Adobe&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://adobedtm.com&quot;&gt;adobedtm.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://adobe.io&quot;&gt;adobe.io&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://adobe.com&quot;&gt;adobe.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://adobelogin.com&quot;&gt;adobelogin.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;#others&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://digicert.com&quot;&gt;digicert.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://pixelogicmedia.com&quot;&gt;pixelogicmedia.com&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;#&lt;br&gt;#ICAP&nbsp;in&nbsp;squid&lt;br&gt;#&lt;br&gt;echo&nbsp;&quot;#ICAP&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;echo&nbsp;&quot;icap_enable&nbsp;on&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;echo&nbsp;&quot;adaptation_uses_indirect_client&nbsp;on&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;echo&nbsp;&quot;icap_send_client_ip&nbsp;on&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;echo&nbsp;&quot;icap_send_client_username&nbsp;on&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;echo&nbsp;&quot;icap_client_username_header&nbsp;X-Authenticated-User&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;echo<br>
&nbsp;&quot;icap_service&nbsp;service_req&nbsp;reqmod_precache&nbsp;bypass=0&nbsp;<br>
icap://&lt;a&nbsp;href=&quot;http://127.0.0.1:1344/squidclamav&quot;&gt;127.0.0.1:1344/squidclamav&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;<br>
/usr/local/squid/etc/squid.conf&lt;br&gt;echo&nbsp;&quot;adaptation_access&nbsp;service_req&nbsp;allow&nbsp;all&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;echo<br>
&nbsp;&quot;icap_service&nbsp;service_resp&nbsp;respmod_precache&nbsp;bypass=0&nbsp;<br>
icap://&lt;a&nbsp;href=&quot;http://127.0.0.1:1344/squidclamav&quot;&gt;127.0.0.1:1344/squidclamav&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;<br>
/usr/local/squid/etc/squid.conf&lt;br&gt;echo&nbsp;&quot;adaptation_access&nbsp;service_resp&nbsp;allow&nbsp;all&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;#&lt;br&gt;#squid&nbsp;with&nbsp;SSL&lt;br&gt;#&lt;br&gt;mkdir&nbsp;-p&nbsp;/usr/local/squid/etc/ssl_cert&lt;br&gt;cd&nbsp;/usr/local/squid/etc/ssl_cert&lt;br&gt;adduser&nbsp;squid&lt;br&gt;chown&nbsp;squid:squid&nbsp;/usr/local/squid/etc/ssl_cert&lt;br&gt;chmod&nbsp;700&nbsp;/usr/local/squid/etc/ssl_cert&lt;br&gt;openssl&nbsp;req&nbsp;-new&nbsp;-newkey&nbsp;rsa:2048&nbsp;-sha256&nbsp;-days&nbsp;365&nbsp;-nodes&nbsp;-x509&nbsp;-extensions&nbsp;v3_ca&nbsp;-keyout&nbsp;myCA.pem&nbsp;&nbsp;-out&nbsp;myCA.pem&nbsp;-batch&lt;br&gt;#must&nbsp;import&nbsp;the&nbsp;below&nbsp;cert&nbsp;on&nbsp;hosts&nbsp;in&nbsp;trusted&nbsp;root&nbsp;cert&nbsp;ie&nbsp;the&nbsp;.der&nbsp;file&lt;br&gt;openssl&nbsp;x509&nbsp;-in&nbsp;myCA.pem&nbsp;-outform&nbsp;DER&nbsp;-out&nbsp;myCA.der&lt;br&gt;/usr/local/squid/libexec/security_file_certgen&nbsp;-c&nbsp;-s&nbsp;/var/lib/ssl_db&nbsp;-M&nbsp;4MB&lt;br&gt;chown&nbsp;squid:squid&nbsp;-R&nbsp;/var/lib/ssl_db&lt;br&gt;chmod&nbsp;-R&nbsp;777&nbsp;/usr/local/squid/var/logs&lt;br&gt;sed<br>
&nbsp;-i&nbsp;&#39;1ihttp_port&nbsp;3128&nbsp;ssl-bump&nbsp;<br>
cert=/usr/local/squid/etc/ssl_cert/myCA.pem&nbsp;<br>
generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&#39;&nbsp;<br>
/usr/local/squid/etc/squid.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;2isslcrtd_program&nbsp;<br>
/usr/local/squid/libexec/security_file_certgen&nbsp;-s&nbsp;/var/lib/ssl_db&nbsp;-M&nbsp;<br>
4MB&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;3iacl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;4issl_bump&nbsp;peek&nbsp;step1&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;5issl_bump&nbsp;bump&nbsp;all&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;#&lt;br&gt;#squidclamav&nbsp;conf&lt;br&gt;#&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%redirect&nbsp;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;http://proxy.domain.dom/cgi-bin/clwarn.cgi%#redirect&quot;&gt;http://proxy.domain.dom/cgi-bin/clwarn.cgi%#redirect&lt;/a&gt;&nbsp;&lt;a&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;nofollow&nbsp;&nbsp;noopener&quot;&nbsp;href=&quot;http://proxy.domain.dom/cgi-bin/clwarn.cgi%g&quot;&gt;http://proxy.domain.dom/cgi-bin/clwarn.cgi%g&lt;/a&gt;&#39;&nbsp;/etc/squidclamav.conf&lt;br&gt;#sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%clamd_local&nbsp;/var/run/clamav/clamd.ctl%clamd_local&nbsp;/run/clamd.scan/clamd.sock%g&#39;&nbsp;/etc/squidclamav.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%enable_libarchive&nbsp;0%enable_libarchive&nbsp;1%g&#39;&nbsp;/etc/squidclamav.conf&lt;br&gt;#&lt;br&gt;#clamav&nbsp;conf&lt;br&gt;#&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%#LocalSocket&nbsp;/run/clamd.scan/clamd.sock%LocalSocket&nbsp;/var/run/clamav/clamd.ctl%g&#39;&nbsp;/etc/clamd.d/scan.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%Example%#Example%g&#39;&nbsp;/etc/clamd.d/scan.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%User&nbsp;clamscan%User&nbsp;root%g&#39;&nbsp;/etc/clamd.d/scan.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%#StreamMaxLength&nbsp;10M%StreamMaxLength&nbsp;5M%g&#39;&nbsp;/etc/clamd.d/scan.conf&lt;br&gt;freshclam&lt;br&gt;echo&nbsp;&quot;00&nbsp;01,13&nbsp;*&nbsp;*&nbsp;*&nbsp;&nbsp;/usr/bin/freshclam&nbsp;--quiet&quot;&nbsp;&gt;&gt;&nbsp;/var/spool/cron/root&lt;br&gt;systemctl&nbsp;enable&nbsp;clamd@scan&lt;br&gt;#&lt;br&gt;#c-icap&nbsp;and&nbsp;c-icap&nbsp;modules&lt;br&gt;#&lt;br&gt;#sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%PidFile&nbsp;/var/run/c-icap/c-icap.pid%PidFile&nbsp;/run/c-icap/c-icap.pid%g&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;#sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%CommandsSocket&nbsp;/var/run/c-icap/c-icap.ctl%CommandsSocket&nbsp;/run/c-icap/c-icap.ctl%g&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%#.*User&nbsp;wwwrun%User&nbsp;root%g&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%#.*Group&nbsp;nogroup%Group&nbsp;root%g&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%#.*Service&nbsp;echo_service&nbsp;srv_echo.so%Service&nbsp;squidclamav&nbsp;squidclamav.so%g&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%DebugLevel&nbsp;1%DebugLevel&nbsp;0%g&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%StartServers&nbsp;3%StartServers&nbsp;1%g&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%MaxServers&nbsp;10%MaxServers&nbsp;20%g&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%MaxRequestsPerChild&nbsp;&nbsp;0%MaxRequestsPerChild&nbsp;&nbsp;100%g&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;520iacl&nbsp;localhost&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1/255.255.255.255&quot;&gt;127.0.0.1/255.255.255.255&lt;/a&gt;&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;521iacl&nbsp;PERMIT_REQUESTS&nbsp;type&nbsp;REQMOD&nbsp;RESPMOD&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;522iicap_access&nbsp;allow&nbsp;localhost&nbsp;PERMIT_REQUESTS&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;sed&nbsp;-i&nbsp;&#39;523iicap_access&nbsp;deny&nbsp;all&#39;&nbsp;/etc/c-icap.conf&lt;br&gt;echo&nbsp;&quot;clamav_mod.TmpDir&nbsp;/var/tmp&quot;&nbsp;&gt;&gt;&nbsp;/etc/clamav_mod.conf&lt;br&gt;echo&nbsp;&quot;clamav_mod.MaxFilesInArchive&nbsp;1000&quot;&nbsp;&gt;&gt;&nbsp;/etc/clamav_mod.conf&lt;br&gt;echo&nbsp;&quot;clamav_mod.MaxScanSize&nbsp;5M&quot;&nbsp;&gt;&gt;&nbsp;/etc/clamav_mod.conf&lt;br&gt;echo&nbsp;&quot;clamav_mod.HeuristicScanPrecedence&nbsp;on&quot;&nbsp;&gt;&gt;&nbsp;/etc/clamav_mod.conf&lt;br&gt;echo&nbsp;&quot;clamav_mod.OLE2BlockMacros&nbsp;on&quot;&nbsp;&gt;&gt;&nbsp;/etc/clamav_mod.conf&lt;br&gt;echo&nbsp;&quot;virus_scan.ScanFileTypes&nbsp;TEXT&nbsp;DATA&nbsp;EXECUTABLE&nbsp;ARCHIVE&nbsp;DOCUMENT&quot;&nbsp;&gt;&gt;&nbsp;/etc/virus_scan.conf&lt;br&gt;echo&nbsp;&quot;virus_scan.SendPercentData&nbsp;5&quot;&nbsp;&gt;&gt;&nbsp;/etc/virus_scan.conf&lt;br&gt;echo&nbsp;&quot;virus_scan.PassOnError&nbsp;on&quot;&nbsp;&gt;&gt;&nbsp;/etc/virus_scan.conf&lt;br&gt;echo&nbsp;&quot;virus_scan.MaxObjectSize&nbsp;&nbsp;5M&quot;&nbsp;&gt;&gt;&nbsp;/etc/virus_scan.conf&lt;br&gt;echo&nbsp;&quot;virus_scan.DefaultEngine&nbsp;clamav&quot;&nbsp;&gt;&gt;&nbsp;/etc/virus_scan.conf&lt;br&gt;echo&nbsp;&quot;Include&nbsp;clamav_mod.conf&quot;&nbsp;&gt;&gt;&nbsp;/etc/virus_scan.conf&lt;br&gt;echo&nbsp;&quot;Include&nbsp;virus_scan.conf&quot;&nbsp;&gt;&gt;&nbsp;/etc/c-icap.conf&lt;br&gt;#&lt;br&gt;#make&nbsp;c-icap&nbsp;service&lt;br&gt;#&lt;br&gt;echo&nbsp;&quot;[Unit]&quot;&nbsp;&gt;&gt;&nbsp;/usr/lib/systemd/system/c-icap.service&lt;br&gt;echo&nbsp;&quot;Description=c-icap&nbsp;service&quot;&nbsp;&gt;&gt;&nbsp;/usr/lib/systemd/system/c-icap.service&lt;br&gt;echo&nbsp;&quot;After=network.target&quot;&nbsp;&gt;&gt;&nbsp;/usr/lib/systemd/system/c-icap.service&lt;br&gt;echo&nbsp;&quot;[Service]&quot;&nbsp;&gt;&gt;&nbsp;/usr/lib/systemd/system/c-icap.service&lt;br&gt;echo&nbsp;&quot;Type=forking&quot;&nbsp;&gt;&gt;&nbsp;/usr/lib/systemd/system/c-icap.service&lt;br&gt;echo&nbsp;&quot;PIDFile=/var/run/c-icap/c-icap.pid&quot;&nbsp;&gt;&gt;&nbsp;/usr/lib/systemd/system/c-icap.service&lt;br&gt;echo&nbsp;&quot;ExecStart=/usr/local/bin/c-icap&nbsp;-f&nbsp;/etc/c-icap.conf&quot;&nbsp;&gt;&gt;&nbsp;/usr/lib/systemd/system/c-icap.service&lt;br&gt;echo&nbsp;&quot;KillMode=process&quot;&nbsp;&gt;&gt;&nbsp;/usr/lib/systemd/system/c-icap.service&lt;br&gt;echo&nbsp;&quot;[Install]&quot;&nbsp;&gt;&gt;&nbsp;/usr/lib/systemd/system/c-icap.service&lt;br&gt;echo&nbsp;&quot;WantedBy=multi-user.target&quot;&nbsp;&gt;&gt;&nbsp;/usr/lib/systemd/system/c-icap.service&lt;br&gt;systemctl&nbsp;enable&nbsp;c-icap&lt;br&gt;reboot&lt;br&gt;&lt;/p&gt;&lt;p&gt;thanks,&lt;/p&gt;&lt;p&gt;rob&lt;/p&gt;<br>
<br>
&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Regards,&nbsp;&lt;br&gt;&lt;br&gt;Robert&nbsp;K&nbsp;Wild.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
