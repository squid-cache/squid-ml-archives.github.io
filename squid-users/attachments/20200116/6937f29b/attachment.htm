<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Alex,&nbsp;you&nbsp;are&nbsp;AWESOME!!!!!!!!!!!!!!!!!!&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Thu,&nbsp;16&nbsp;Jan&nbsp;2020&nbsp;at&nbsp;17:11,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;1/16/20&nbsp;12:05&nbsp;PM,&nbsp;robert&nbsp;k&nbsp;Wild&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;hi&nbsp;Alex,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;thanks&nbsp;for&nbsp;the&nbsp;notes&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;so&nbsp;my&nbsp;child&nbsp;proxy,&nbsp;i&nbsp;have&nbsp;added&nbsp;-&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;#forward&nbsp;clients&nbsp;IP&lt;br&gt;<br>
&gt;&nbsp;forwarded_for&nbsp;on&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
FYI:&nbsp;This&nbsp;is&nbsp;the&nbsp;default.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;and&nbsp;my&nbsp;parent&nbsp;-&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;my_other_proxy&nbsp;srcdomain&nbsp;10.110.130.80&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;identify&nbsp;your&nbsp;child&nbsp;proxy&nbsp;by&nbsp;its&nbsp;IP,&nbsp;then&nbsp;use&nbsp;src&nbsp;instead&nbsp;of&lt;br&gt;<br>
srcdomain.&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;follow_x_forwarded_for&nbsp;allow&nbsp;my_other_proxy&lt;br&gt;<br>
&gt;&nbsp;log_uses_indirect_client&nbsp;on&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;but&nbsp;in&nbsp;my&nbsp;parent&nbsp;logs,&nbsp;im&nbsp;still&nbsp;getting&nbsp;the&nbsp;ip&nbsp;of&nbsp;the&nbsp;child&nbsp;proxy?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Thu,&nbsp;16&nbsp;Jan&nbsp;2020&nbsp;at&nbsp;16:47,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; On&nbsp;1/16/20&nbsp;9:59&nbsp;AM,&nbsp;robert&nbsp;k&nbsp;Wild&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;i&nbsp;have&nbsp;two&nbsp;proxies&nbsp;(one&nbsp;sibling&nbsp;going&nbsp;to&nbsp;a&nbsp;parent)&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; FYI:&nbsp;&quot;siblings&quot;&nbsp;are&nbsp;proxies&nbsp;that&nbsp;fetch&nbsp;hits&nbsp;from&nbsp;each&nbsp;other.&nbsp;The&nbsp;proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &quot;going&nbsp;to&nbsp;the&nbsp;parent&quot;&nbsp;is&nbsp;usually&nbsp;called&nbsp;a&nbsp;&quot;child&quot;&nbsp;proxy:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp;clients&nbsp;-&gt;&nbsp;child&nbsp;-&gt;&nbsp;parent&nbsp;-&gt;&nbsp;servers&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;when&nbsp;i&nbsp;look&nbsp;at&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;access&nbsp;logs,&nbsp;it&nbsp;just&nbsp;logs&nbsp;the&nbsp;ip&lt;br&gt;<br>
&gt; &nbsp; &nbsp; address&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;of&nbsp;the&nbsp;sibling&nbsp;proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;if&nbsp;i&nbsp;add&nbsp;the&nbsp;lines&nbsp;below&nbsp;in&nbsp;my&nbsp;sibling&nbsp;proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;acl&nbsp;localhost&nbsp;src&nbsp;127.0.0.1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;acl&nbsp;my_other_proxy&nbsp;srcdomain&nbsp;.&lt;a&nbsp;href=&quot;http://proxy.example.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;proxy.example.com&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;http://proxy.example.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://proxy.example.com&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;follow_x_forwarded_for&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;follow_x_forwarded_for&nbsp;allow&nbsp;my_other_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;when&nbsp;i&nbsp;next&nbsp;look&nbsp;at&nbsp;the&nbsp;logs,&nbsp;will&nbsp;it&nbsp;show&nbsp;the&nbsp;ip&nbsp;of&nbsp;my&nbsp;clients?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; No,&nbsp;it&nbsp;will&nbsp;not&nbsp;(by&nbsp;default)&nbsp;AFAICT.&nbsp;For&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;logs&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; contain&nbsp;IP&nbsp;addresses&nbsp;of&nbsp;the&nbsp;clients,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; a)&nbsp;The&nbsp;child&nbsp;proxy&nbsp;must&nbsp;send&nbsp;the&nbsp;X-Forwarded-For&nbsp;header&nbsp;to&nbsp;the&nbsp;parent.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; b)&nbsp;The&nbsp;parent&nbsp;proxy&nbsp;must&nbsp;trust&nbsp;X-Forwarded-For&nbsp;received&nbsp;from&nbsp;the&nbsp;child&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; (as&nbsp;far&nbsp;as&nbsp;logging&nbsp;is&nbsp;concerned).&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Your&nbsp;configuration&nbsp;changes&nbsp;at&nbsp;the&nbsp;child&nbsp;proxy&nbsp;do&nbsp;neither&nbsp;(a)&nbsp;nor&nbsp;(b).&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; IIRC,&nbsp;(a)&nbsp;will&nbsp;happen&nbsp;by&nbsp;default,&nbsp;while&nbsp;(b)&nbsp;requires&lt;br&gt;<br>
&gt; &nbsp; &nbsp; follow_x_forwarded_for&nbsp;and&nbsp;log_uses_indirect_client&nbsp;rules&nbsp;at&nbsp;the&nbsp;parent&lt;br&gt;<br>
&gt; &nbsp; &nbsp; proxy.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  I&nbsp;did&nbsp;not&nbsp;review&nbsp;your&nbsp;follow_x_forwarded_for&nbsp;rules.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; The&nbsp;follow_x_forwarded_for&nbsp;rules&nbsp;at&nbsp;the&nbsp;child&nbsp;proxy&nbsp;are&nbsp;needed&nbsp;if&nbsp;and&lt;br&gt;<br>
&gt; &nbsp; &nbsp; only&nbsp;if&nbsp;you&nbsp;want&nbsp;the&nbsp;child&nbsp;proxy&nbsp;to&nbsp;trust&nbsp;the&nbsp;X-Forwarded-For&nbsp;headers&lt;br&gt;<br>
&gt; &nbsp; &nbsp; received&nbsp;by&nbsp;that&nbsp;child&nbsp;proxy&nbsp;(from&nbsp;its&nbsp;clients).&nbsp;That&nbsp;is&nbsp;only&nbsp;necessary&lt;br&gt;<br>
&gt; &nbsp; &nbsp; in&nbsp;deeper&nbsp;hierarchies:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &nbsp; &nbsp;clients&nbsp;-&gt;&nbsp;child1&nbsp;-&gt;&nbsp;child2&nbsp;-&gt;&nbsp;parent&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Regards,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Robert&nbsp;K&nbsp;Wild.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Regards,&nbsp;&lt;br&gt;&lt;br&gt;Robert&nbsp;K&nbsp;Wild.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
