<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;The&nbsp;problem&nbsp;I&nbsp;am&nbsp;seeing&nbsp;is&nbsp;the&nbsp;intercept&nbsp;port&nbsp;initiates&nbsp;HTTP&nbsp;connection&nbsp;to&nbsp;self-IP&nbsp;instead&nbsp;of&nbsp;the&nbsp;web&nbsp;server&nbsp;IP&nbsp;it&nbsp;gets&nbsp;from&nbsp;the&nbsp;DNS&nbsp;request. &lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt; Filtered Tcpdump&nbsp;screenshot @ &lt;/font&gt;&lt;a&nbsp;href=&quot;https://drive.google.com/open?id=0ByReiwdSAAY_VXBPTjF1M3dYTnBTTnhFVnRocXFveUlNSlNj&quot;&gt;https://drive.google.com/open?id=0ByReiwdSAAY_VXBPTjF1M3dYTnBTTnhFVnRocXFveUlNSlNj&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;arial,&nbsp;sans-serif&quot;&gt;Server&nbsp;IP:&nbsp;Eth0:&nbsp;IP&lt;span&nbsp;style=&quot;background-color:transparent;white-space:pre-wrap&quot;&gt;:&nbsp;&lt;a&nbsp;href=&quot;http://172.22.22.148/26&quot;&nbsp;target=&quot;_blank&quot;&gt;172.22.22.148/26&lt;/a&gt;&nbsp;(Same&nbsp;eth0&nbsp;interface&nbsp;reaches&nbsp;the&nbsp;internet&nbsp;gateway).&nbsp;&nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Configurations&nbsp;for &lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,&nbsp;sans-serif&quot;&gt;1)&nbsp;Nat&nbsp;table: &lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;Chain&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);font-weight:700;vertical-align:baseline;white-space:pre-wrap&quot;&gt;PREROUTING&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&nbsp;(policy&nbsp;ACCEPT&nbsp;23&nbsp;packets,&nbsp;1632&nbsp;bytes)&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;num&nbsp; &nbsp;pkts&nbsp;bytes&nbsp;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(102,102,234);vertical-align:baseline;white-space:pre-wrap&quot;&gt;in&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&nbsp; &nbsp; &nbsp;out&nbsp;&nbsp;&nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(223,83,32);vertical-align:baseline;white-space:pre-wrap&quot;&gt;source&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;1&nbsp; &nbsp; &nbsp; &nbsp;66&nbsp;&nbsp;3960&nbsp;REDIRECT&nbsp; &nbsp;tcp&nbsp;&nbsp;--&nbsp;&nbsp;eth0&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0/0&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:80&nbsp;/*&nbsp;Redirect&nbsp;http&nbsp;traffic&nbsp;&nbsp;eth0:80&nbsp;to&nbsp;eth0:3128&nbsp;*/&nbsp;redir&nbsp;ports&nbsp;3128&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;vertical-align:baseline&quot;&gt;Chain&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;font-weight:700;vertical-align:baseline&quot;&gt;POSTROUTING&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;vertical-align:baseline&quot;&gt;&nbsp;(policy&nbsp;ACCEPT&nbsp;0&nbsp;packets,&nbsp;0&nbsp;bytes)&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;vertical-align:baseline&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;vertical-align:baseline&quot;&gt;num&nbsp; &nbsp;pkts&nbsp;bytes&nbsp;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;color:rgb(102,102,234);vertical-align:baseline&quot;&gt;in&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;vertical-align:baseline&quot;&gt;&nbsp; &nbsp; &nbsp;out&nbsp;&nbsp;&nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;color:rgb(223,83,32);vertical-align:baseline&quot;&gt;source&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;vertical-align:baseline&quot;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;vertical-align:baseline&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;vertical-align:baseline&quot;&gt;1 &nbsp; &nbsp;13500 &nbsp;856K&nbsp;MASQUERADE &nbsp;all&nbsp;&nbsp;--&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0/0&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0/0&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0/0&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/*&nbsp;&nbsp;Allows&nbsp;NAT&nbsp;To&nbsp;happen&nbsp;*/&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,&nbsp;sans-serif&quot;&gt;2)&nbsp;Mangle&nbsp;table: &lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;Chain&nbsp;PREROUTING&nbsp;(policy&nbsp;ACCEPT&nbsp;6180&nbsp;packets,&nbsp;519K&nbsp;bytes)&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&nbsp;pkts&nbsp;bytes&nbsp;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(102,102,234);vertical-align:baseline;white-space:pre-wrap&quot;&gt;in&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&nbsp; &nbsp; &nbsp;out&nbsp;&nbsp;&nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(223,83,32);vertical-align:baseline;white-space:pre-wrap&quot;&gt;source&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&nbsp;1434 &nbsp;148K&nbsp;ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp;&nbsp;--&nbsp;&nbsp;any&nbsp;&nbsp;&nbsp;&nbsp;any&nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://172.22.22.0/24&quot;&nbsp;target=&quot;_blank&quot;&gt;172.22.22.0/24&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:http&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt; &nbsp; &nbsp;0&nbsp;&nbsp;&nbsp; &nbsp;0&nbsp;DROP&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;&nbsp;--&nbsp;&nbsp;any&nbsp;&nbsp; &nbsp;any&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tcp&nbsp;dpt:3128&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;background-color:rgb(241,239,238);font-size:11pt;font-family:Consolas,sans-serif;color:rgb(104,97,94);vertical-align:baseline;white-space:pre-wrap&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-variant-numeric:normal;font-variant-east-asian:normal;font-size:11pt;vertical-align:baseline;white-space:pre-wrap&quot;&gt;&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&gt;3)&nbsp;Squid.conf&nbsp;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;span&nbsp;id=&quot;m_-6173782671355874605gmail-m_4710091891605228470gmail-docs-internal-guid-0c346f1c-7fff-86ec-4e80-5ea862c37126&quot;&gt;&lt;p&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:Arial;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap&quot;&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://172.22.22.148:3128/&quot;&nbsp;target=&quot;_blank&quot;&gt;172.22.22.148:3128&lt;/a&gt;&nbsp;intercept&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-family:Arial;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;vertical-align:baseline;white-space:pre-wrap&quot;&gt;https_port&nbsp;&lt;a&nbsp;href=&quot;http://172.22.22.148:3129/&quot;&nbsp;target=&quot;_blank&quot;&gt;172.22.22.148:3129&lt;/a&gt;&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/etc/squid/ssl_certs/myCA.pem&nbsp;generate-host-certificates=on&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;div&gt;Complete&nbsp;squid.conf&nbsp;file @ &lt;a&nbsp;href=&quot;https://pastebin.com/gG8pYpLF&quot;&nbsp;target=&quot;_blank&quot;&gt;https://pastebin.com/gG8pYpLF&lt;/a&gt;. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Please&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;I&nbsp;am&nbsp;missing&nbsp;some&nbsp;conf&nbsp;or&nbsp;the&nbsp;next&nbsp;steps&nbsp;I&nbsp;should&nbsp;try&nbsp;to&nbsp;get&nbsp;this&nbsp;running. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;/div&gt;<br>

</tt>
