<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thank&nbsp;you&nbsp;for&nbsp;the&nbsp;suggestion!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;did&nbsp;think&nbsp;of&nbsp;allowing&nbsp;the&nbsp;domain&nbsp;name&nbsp;first&nbsp;during&nbsp;CONNECT&nbsp;phase,&nbsp;and&nbsp;then&nbsp;the&nbsp;full&nbsp;URL&nbsp;after&nbsp;connection&nbsp;established.&nbsp;However,&nbsp;other&nbsp;paths&nbsp;under&nbsp;the&nbsp;same&nbsp;site&nbsp;wont&nbsp;be&nbsp;blocked.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;i.e.&nbsp;I&nbsp;can&nbsp;ask&nbsp;Squid&nbsp;to&nbsp;let&nbsp;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;&nbsp;pass&nbsp;through&nbsp;during&nbsp;CONNECT,&nbsp;and&nbsp;then&nbsp;let&nbsp;&lt;a&nbsp;href=&quot;http://example.com/abc/logcin&quot;&gt;example.com/abc/logcin&lt;/a&gt;&nbsp;pass&nbsp;through&nbsp;afterÂ connection&nbsp;established.&nbsp;However,&nbsp;this&nbsp;will&nbsp;let&nbsp;other&nbsp;paths&nbsp;of&nbsp;&lt;a&nbsp;href=&quot;http://example.com&quot;&gt;example.com&lt;/a&gt;&nbsp;pass&nbsp;Squid&nbsp;too&nbsp;(such&nbsp;as&nbsp;&lt;a&nbsp;href=&quot;http://example.com/not_to_pass&quot;&gt;example.com/not_to_pass&lt;/a&gt;)&nbsp;because&nbsp;the&nbsp;it&nbsp;passes&nbsp;the&nbsp;ACL&nbsp;check&nbsp;during&nbsp;CONNECT&nbsp;phase.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sun,&nbsp;Mar&nbsp;22,&nbsp;2020&nbsp;at&nbsp;11:19&nbsp;AM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;3/20/20&nbsp;5:48&nbsp;PM,&nbsp;laviier&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;a&nbsp;use&nbsp;case&nbsp;that&nbsp;I&nbsp;want&nbsp;to&nbsp;access&nbsp;a&nbsp;certain&nbsp;URL&nbsp;path&nbsp;of&nbsp;a&nbsp;domain&nbsp;but&lt;br&gt;<br>
&gt;&nbsp;not&nbsp;other.&nbsp;i.e.&nbsp;I&nbsp;want&nbsp;client&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;access&nbsp;&lt;a&nbsp;href=&quot;http://example.com/abc/login&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;example.com/abc/login&lt;/a&gt;,&lt;br&gt;<br>
&gt;&nbsp;but&nbsp;not&nbsp;other&nbsp;paths.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Hence,&nbsp;I&nbsp;created&nbsp;ACL&nbsp;rule&nbsp;to&nbsp;achieve&nbsp;that,&nbsp;see&nbsp;below:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;```&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;to_domain_whitelist&nbsp;url_regex&nbsp;&quot;/squid-config/whitelist/allow.acl&quot;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;http&nbsp;port&nbsp;80&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;https&nbsp;port&nbsp;443&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;connect&nbsp;method&nbsp;CONNECT&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;all&nbsp;to_domain_whitelist&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;http_reply_access&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step3&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;```&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;However&nbsp;the&nbsp;above&nbsp;code&nbsp;does&nbsp;not&nbsp;work&nbsp;properly,&nbsp;the&nbsp;URL&nbsp;regex&nbsp;matching&lt;br&gt;<br>
&gt;&nbsp;happens&nbsp;before&nbsp;Squid&nbsp;performs&nbsp;decryption&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;only&nbsp;match&nbsp;against&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;host&nbsp;name&nbsp;instead&nbsp;of&nbsp;full&nbsp;URL&nbsp;path.&nbsp;I&nbsp;wonder&nbsp;if&nbsp;there&#39;s&nbsp;a&nbsp;way&nbsp;to&nbsp;perform&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;URL&nbsp;regex&nbsp;only&nbsp;after&nbsp;Squid&nbsp;knows&nbsp;the&nbsp;full&nbsp;url&nbsp;with&nbsp;SslBump?&nbsp;Below&nbsp;is&nbsp;a&lt;br&gt;<br>
&gt;&nbsp;briefing&nbsp;of&nbsp;the&nbsp;log.&nbsp;Thank&nbsp;you&nbsp;so&nbsp;much!!!!&lt;br&gt;<br>
&gt;&nbsp;```&lt;br&gt;<br>
&gt;&nbsp;---------&lt;br&gt;<br>
&gt;&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://example.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;example.com:443&lt;/a&gt;&nbsp;HTTP/1.1&lt;br&gt;<br>
&gt;&nbsp;Host:&nbsp;&lt;a&nbsp;href=&quot;http://example.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;example.com:443&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;User-Agent:&nbsp;curl/7.54.0&lt;br&gt;<br>
&gt;&nbsp;Proxy-Connection:&nbsp;Keep-Alive&lt;br&gt;<br>
&gt;&nbsp;X-Forwarded-For:&nbsp;xx.xxx.xx.xx&lt;br&gt;<br>
&gt;&nbsp;----------&lt;br&gt;<br>
&gt;&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;2020/03/20&nbsp;14:51:43.067|&nbsp;28,3|&nbsp;Acl.cc(158)&nbsp;matches:&nbsp;checked:&lt;br&gt;<br>
&gt;&nbsp;to_domain_whitelist&nbsp;=&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;2020/03/20&nbsp;14:51:43.071|&nbsp;85,2|&nbsp;client_side_request.cc(745)&lt;br&gt;<br>
&gt;&nbsp;clientAccessCheckDone:&nbsp;The&nbsp;request&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://example.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;example.com:443&lt;/a&gt;&nbsp;is&nbsp;DENIED;&nbsp;last&lt;br&gt;<br>
&gt;&nbsp;ACL&nbsp;checked:&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;...&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;want&nbsp;to&nbsp;make&nbsp;allow/deny&nbsp;decision&nbsp;based&nbsp;on&nbsp;individual&nbsp;request&lt;br&gt;<br>
URLs,&nbsp;your&nbsp;http_access&nbsp;rules&nbsp;must&nbsp;allow&nbsp;the&nbsp;CONNECT&nbsp;request.&nbsp;Once&nbsp;Squid&lt;br&gt;<br>
establishes&nbsp;(and&nbsp;bumps)&nbsp;the&nbsp;CONNECT&nbsp;tunnel,&nbsp;it&nbsp;will&nbsp;start&nbsp;processing&lt;br&gt;<br>
individual&nbsp;requests&nbsp;and&nbsp;apply&nbsp;http_access&nbsp;rules&nbsp;to&nbsp;each&nbsp;of&nbsp;them.&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;allow&nbsp;a&nbsp;CONNECT&nbsp;request,&nbsp;do&nbsp;not&nbsp;use&nbsp;regular&nbsp;URL&nbsp;syntax&nbsp;because&lt;br&gt;<br>
CONNECT&nbsp;requests&nbsp;use&nbsp;a&nbsp;different&nbsp;URI&nbsp;syntax.&nbsp;Sorry,&nbsp;I&nbsp;do&nbsp;not&nbsp;know&lt;br&gt;<br>
whether&nbsp;a&nbsp;url_regex&nbsp;ACL&nbsp;can&nbsp;be&nbsp;used&nbsp;for&nbsp;CONNECT&nbsp;URIs,&nbsp;but&nbsp;you&nbsp;can&nbsp;use&lt;br&gt;<br>
other&nbsp;ACLs&nbsp;if/as&nbsp;needed,&nbsp;of&nbsp;course.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;---------&lt;br&gt;<br>
&gt;&nbsp;GET&nbsp;/abc/login&nbsp;HTTP/1.1&lt;br&gt;<br>
&gt;&nbsp;Host:&nbsp;&lt;a&nbsp;href=&quot;http://example.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;example.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;User-Agent:&nbsp;curl/7.54.0&lt;br&gt;<br>
&gt;&nbsp;Accept:&nbsp;*/*&lt;br&gt;<br>
&gt;&nbsp;----------&lt;br&gt;<br>
&gt;&nbsp;....&lt;br&gt;<br>
&gt;&nbsp;```&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--&lt;br&gt;<br>
&gt;&nbsp;Sent&nbsp;from:&nbsp;&lt;a&nbsp;href=&quot;http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://squid-web-proxy-cache.1019090.n4.nabble.com/Squid-Users-f1019091.html&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
