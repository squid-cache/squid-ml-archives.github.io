<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Context&lt;/b&gt;:&lt;/div&gt;&lt;div&gt;I&nbsp;want&nbsp;to&nbsp;use&nbsp;Squid&nbsp;as&nbsp;a&nbsp;forward&nbsp;proxy,&nbsp;where&nbsp;I&nbsp;want&nbsp;to&lt;/div&gt;&lt;div&gt;1)&nbsp;send&nbsp;all&nbsp;the&nbsp;Image&nbsp;requests&nbsp;directly,&nbsp;presumably&nbsp;using&nbsp;request&nbsp;header&nbsp;&#39;accept&#39;&lt;/div&gt;&lt;div&gt;2)&nbsp;send&nbsp;all&nbsp;other&nbsp;requests&nbsp;through&nbsp;a&nbsp;cache&nbsp;peer&nbsp;Proxy&nbsp;service&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;req_header&nbsp;directive&nbsp;is&nbsp;working&nbsp;fine&nbsp;for&nbsp;HTTP&nbsp;Requests,&nbsp;but&nbsp;not&nbsp;for&nbsp;HTTPS.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;done&nbsp;the&nbsp;setup&nbsp;for&nbsp;SSL&nbsp;Bump&nbsp;in&nbsp;here&nbsp;and&nbsp;that&#39;s&nbsp;giving&nbsp;decrypted&nbsp;HTTPS&nbsp;requests&nbsp;in&nbsp;the&nbsp;access.log&nbsp;as&nbsp;well.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Issue:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;req_header&nbsp;directive&nbsp;is&nbsp;not&nbsp;working&nbsp;on&nbsp;the&nbsp;decrypted&nbsp;HTTPS&nbsp;requests.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Squid.conf&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;SSL&nbsp;Bump&nbsp;Port&lt;br&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1:3128&quot;&gt;127.0.0.1:3128&lt;/a&gt;&nbsp;ssl-bump&nbsp;cert=/usr/local/etc/cert/example.com.cert&nbsp;key=/usr/local/etc/cert/example.com.private&nbsp;generate-host-certificates=on&nbsp;version=1&nbsp;options=SINGLE_DH_USE&nbsp; &lt;br&gt;&lt;br&gt;#&nbsp;SSL&nbsp;Bump&nbsp;Config&lt;br&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;br&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;br&gt;&lt;br&gt;acl&nbsp;imageIsBlocked&nbsp;req_header&nbsp;accept&nbsp;-i&nbsp;image&lt;br&gt;&lt;br&gt;ssl_bump&nbsp;terminate&nbsp;imageIsBlocked &nbsp; &nbsp;#terminate&nbsp;is&nbsp;just&nbsp;for&nbsp;testing,&nbsp;to&nbsp;be&nbsp;replaced&nbsp;by&nbsp;splice&lt;br&gt;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Access.log&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1587011751.217&nbsp; &nbsp; 204&nbsp;127.0.0.1&nbsp;TCP_MISS/200&nbsp;393&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://dt.adsafeprotected.com/dt&quot;&gt;https://dt.adsafeprotected.com/dt&lt;/a&gt;?&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://104.244.39.20&quot;&gt;104.244.39.20&lt;/a&gt;&nbsp;image/gif&lt;br&gt;1587011751.264&nbsp; &nbsp;1050&nbsp;127.0.0.1&nbsp;NONE/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://pagead2.googlesyndication.com:443&quot;&gt;pagead2.googlesyndication.com:443&lt;/a&gt;&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://172.217.13.226&quot;&gt;172.217.13.226&lt;/a&gt;&nbsp;-&lt;br&gt;1587011751.303&nbsp; &nbsp; 787&nbsp;127.0.0.1&nbsp;NONE/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://pagead2.googlesyndication.com:443&quot;&gt;pagead2.googlesyndication.com:443&lt;/a&gt;&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://172.217.13.226&quot;&gt;172.217.13.226&lt;/a&gt;&nbsp;-&lt;br&gt;1587011752.246&nbsp; &nbsp;2846&nbsp;127.0.0.1&nbsp;NONE/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://partners.tremorhub.com:443&quot;&gt;partners.tremorhub.com:443&lt;/a&gt;&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://3.224.28.212&quot;&gt;3.224.28.212&lt;/a&gt;&nbsp;-&lt;br&gt;1587011753.348&nbsp; &nbsp;1096&nbsp;127.0.0.1&nbsp;TCP_MISS/200&nbsp;1105&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://partners.tremorhub.com/syncnoad&quot;&gt;https://partners.tremorhub.com/syncnoad&lt;/a&gt;?&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://3.224.28.212&quot;&gt;3.224.28.212&lt;/a&gt;&nbsp;text/xml&lt;br&gt;1587011754.152&nbsp; &nbsp; 799&nbsp;127.0.0.1&nbsp;TCP_MISS/200&nbsp;1124&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://partners.tremorhub.com/syncnoad&quot;&gt;https://partners.tremorhub.com/syncnoad&lt;/a&gt;?&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://3.224.28.212&quot;&gt;3.224.28.212&lt;/a&gt;&nbsp;text/xml&lt;br&gt;1587011756.091&nbsp; &nbsp;1934&nbsp;127.0.0.1&nbsp;TCP_MISS/200&nbsp;1086&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://partners.tremorhub.com/syncnoad&quot;&gt;https://partners.tremorhub.com/syncnoad&lt;/a&gt;?&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://3.224.28.212&quot;&gt;3.224.28.212&lt;/a&gt;&nbsp;text/xml&lt;br&gt;1587011760.264&nbsp; &nbsp;4169&nbsp;127.0.0.1&nbsp;TCP_MISS_ABORTED/200&nbsp;1113&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://partners.tremorhub.com/syncnoad&quot;&gt;https://partners.tremorhub.com/syncnoad&lt;/a&gt;?&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://3.224.28.212&quot;&gt;3.224.28.212&lt;/a&gt;&nbsp;text/xml&lt;br&gt;1587011760.822&nbsp; &nbsp; 367&nbsp;127.0.0.1&nbsp;TCP_MISS/200&nbsp;1185&nbsp;POST&nbsp;&lt;a&nbsp;href=&quot;https://pagead2.googlesyndication.com/pcs/activeview&quot;&gt;https://pagead2.googlesyndication.com/pcs/activeview&lt;/a&gt;?&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://172.217.13.226&quot;&gt;172.217.13.226&lt;/a&gt;&nbsp;image/gif&lt;br&gt;1587011760.862&nbsp; &nbsp; 407&nbsp;127.0.0.1&nbsp;TCP_MISS/200&nbsp;1185&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://pagead2.googlesyndication.com/pcs/activeview&quot;&gt;https://pagead2.googlesyndication.com/pcs/activeview&lt;/a&gt;?&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://172.217.13.226&quot;&gt;172.217.13.226&lt;/a&gt;&nbsp;image/gif&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;Any&nbsp;help&nbsp;would&nbsp;be&nbsp;appreciated,&nbsp;as&nbsp;I&nbsp;have&nbsp;spent&nbsp;weeks&nbsp;trying&nbsp;to&nbsp;get&nbsp;around&nbsp;the&nbsp;work&nbsp;post&nbsp;SSL&nbsp;Bumping.&lt;div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;p&nbsp;style=&quot;color:rgb(34,34,34);margin:0px;background-color:rgb(255,255,255)&quot;&gt;&lt;i&gt;&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,&nbsp;sans-serif&quot;&nbsp;size=&quot;1&quot;&gt;&lt;b&gt;Thanks&nbsp;&amp;&nbsp;Regards,&lt;/b&gt;&lt;/font&gt;&lt;/i&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;color:rgb(34,34,34);margin:0px;background-color:rgb(255,255,255)&quot;&gt;&lt;i&gt;&lt;font&nbsp;face=&quot;trebuchet&nbsp;ms,&nbsp;sans-serif&quot;&nbsp;size=&quot;1&quot;&gt;&lt;b&gt;Shubham&nbsp;Jain&lt;/b&gt;&lt;/font&gt;&lt;/i&gt;&lt;/p&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:9pt;color:rgb(31,73,125)&quot;&gt;&lt;u&gt;&lt;br&gt;&lt;/u&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;table&nbsp;width=&quot;100%&quot;&nbsp;align=&quot;left&quot;&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:12.800000190734863px;text-align:start;background-color:rgb(255,255,255);width:932px&quot;&nbsp;border=&quot;0&quot;&nbsp;cellspacing=&quot;0&quot;&nbsp;cellpadding=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&nbsp;style=&quot;min-height:72.15pt&quot;&gt;&lt;td&nbsp;width=&quot;9%&quot;&nbsp;style=&quot;margin:0px;width:91.19999694824219px;padding:0cm;min-height:72.15pt&quot;&gt;&lt;/td&gt;&lt;td&nbsp;width=&quot;90%&quot;&nbsp;style=&quot;margin:0px;width:828px;padding:0cm&nbsp;0cm&nbsp;0cm&nbsp;9.9pt;min-height:72.15pt&quot;&gt;&lt;p&nbsp;style=&quot;margin:0px&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
