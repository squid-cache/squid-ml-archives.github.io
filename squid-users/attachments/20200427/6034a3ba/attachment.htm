<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&nbsp;style=&quot;font-size:small&quot;&gt;&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;Hi,&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;We&nbsp;were&nbsp;able&nbsp;to&nbsp;set&nbsp;up&nbsp;the&nbsp;squid&nbsp;in&nbsp;a&nbsp;host&nbsp;to&nbsp;container<br>
infrastructure.&nbsp;That&nbsp;is&nbsp;saying&nbsp;the&nbsp;squid&nbsp;is&nbsp;installed&nbsp;on&nbsp;host,&nbsp;proxying&nbsp;traffic<br>
from&nbsp;the&nbsp;container&nbsp;on&nbsp;the&nbsp;same&nbsp;host.&nbsp;With&nbsp;transparent&nbsp;proxy&nbsp;including&nbsp;SSL<br>
traffic.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;Another&nbsp;feature&nbsp;we&nbsp;enabled&nbsp;is&nbsp;request_header_access&nbsp;and<br>
request_header_replace,&nbsp;to&nbsp;spoof&nbsp;and&nbsp;modify&nbsp;token&nbsp;in&nbsp;HTTP&nbsp;headers&nbsp;sending&nbsp;to<br>
target&nbsp;dstdomain.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;The&nbsp;issue&nbsp;we&nbsp;are&nbsp;having&nbsp;right&nbsp;now&nbsp;is&nbsp;the&nbsp;certificate<br>
installed&nbsp;on&nbsp;the&nbsp;container&nbsp;is&nbsp;a&nbsp;self&nbsp;signed&nbsp;cert,&nbsp;we&nbsp;were&nbsp;trying&nbsp;to&nbsp;migrate<br>
this&nbsp;cert&nbsp;to&nbsp;a&nbsp;real&nbsp;trusted&nbsp;CA&nbsp;cert,&nbsp;or&nbsp;a&nbsp;Baltimore&nbsp;root&nbsp;cert.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;The&nbsp;issues&nbsp;seems&nbsp;to&nbsp;be&nbsp;in&nbsp;the&nbsp;subject&nbsp;name&nbsp;of&nbsp;the&nbsp;cert.&nbsp;In<br>
the&nbsp;self&nbsp;signed&nbsp;cert,&nbsp;I&nbsp;simply&nbsp;leave&nbsp;everything&nbsp;blank.&nbsp;In&nbsp;the&nbsp;Baltimore&nbsp;root<br>
cert(squid.key&nbsp;and&nbsp;squid.crt&nbsp;in&nbsp;below&nbsp;squid.conf&nbsp;example,&nbsp;request&nbsp;through<br>
Microsoft&nbsp;internal&nbsp;service&nbsp;and&nbsp;it&nbsp;is&nbsp;Baltimore&nbsp;root),&nbsp;even&nbsp;if&nbsp;I&nbsp;have&nbsp;the<br>
dstdomain&nbsp;in&nbsp;squid.conf&nbsp;as&nbsp;subject&nbsp;name(&lt;a&nbsp;href=&quot;http://abc.microsoft.com&quot;&gt;abc.microsoft.com&lt;/a&gt;&nbsp;in&nbsp;below&nbsp;squid.conf<br>
example),&nbsp;I&nbsp;am&nbsp;still&nbsp;getting&nbsp;“server&nbsp;certificate&nbsp;verification&nbsp;failed”&nbsp;error&nbsp;in<br>
CURL.&nbsp;Is&nbsp;there&nbsp;anything&nbsp;I&nbsp;am&nbsp;missing&nbsp;or&nbsp;it&nbsp;simply&nbsp;doesn’t&nbsp;support?&nbsp;In&nbsp;my<br>
understanding,&nbsp;it&nbsp;should&nbsp;has&nbsp;no&nbsp;difference&nbsp;with&nbsp;squid&nbsp;as&nbsp;root&nbsp;CA&nbsp;signer&nbsp;in&nbsp;self<br>
signed&nbsp;cert?&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;P.S.&nbsp;I&nbsp;do&nbsp;notice&nbsp;that&nbsp;it&nbsp;is&nbsp;illegal&nbsp;for&nbsp;a&nbsp;trusted&nbsp;CA&nbsp;to<br>
issue&nbsp;official&nbsp;cert&nbsp;to&nbsp;squid&nbsp;because&nbsp;squid&nbsp;itself&nbsp;is&nbsp;man-in-the-middle,&nbsp;so<br>
Squid&nbsp;can&nbsp;only&nbsp;accept&nbsp;self&nbsp;signed&nbsp;cert&nbsp;and&nbsp;squid&nbsp;as&nbsp;root&nbsp;CA?&nbsp;I&nbsp;tried&nbsp;to&nbsp;search<br>
the&nbsp;email&nbsp;archive&nbsp;but&nbsp;no&nbsp;luck.&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;I&nbsp;have&nbsp;such&nbsp;a&nbsp;squid.conf&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;acl&nbsp;abc&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://abc.microsoft.com&quot;&gt;abc.microsoft.com&lt;/a&gt;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;request_header_access&nbsp;Authorization&nbsp;deny&nbsp;abc&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;request_header_replace&nbsp;Authorization&nbsp;Basic<br>
whateverYourTokeisButForBasicItHasToBeBase64Encoded&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;request_header_access&nbsp;All&nbsp;allow&nbsp;all&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;https_port&nbsp;3129&nbsp;cert=/etc/squid3/squid.crt<br>
key=/etc/squid3/squid.key&nbsp;ssl-bump&nbsp;intercept&nbsp;generate-host-certificates=on<br>
dynamic_cert_mem_cache_size=4MB&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;acl&nbsp;SSL_port&nbsp;port&nbsp;443&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;http_access&nbsp;allow&nbsp;SSL_port&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;acl&nbsp;allowed_https_sites&nbsp;ssl::server_name<br>
&quot;/etc/squid3/ssl_sites.txt&quot;&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;ssl_bump&nbsp;server-first&nbsp;all&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;always_direct&nbsp;allow&nbsp;all&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;ssl_bump&nbsp;peek&nbsp;step2&nbsp;allowed_https_sites&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;ssl_bump&nbsp;splice&nbsp;step3&nbsp;allowed_https_sites&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;Thanks,&lt;/p&gt;<br>
<br>
&lt;p&nbsp;class=&quot;MsoNormal&quot;&nbsp;style=&quot;margin:0in&nbsp;0in&nbsp;0.0001pt;font-size:11pt;font-family:Calibri,sans-serif&quot;&gt;Lei&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
