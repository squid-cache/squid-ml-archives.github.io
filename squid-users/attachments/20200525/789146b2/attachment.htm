<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hello,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;contacting&nbsp;you&nbsp;for&nbsp;some&nbsp;help.&lt;/div&gt;&lt;div&gt;I&nbsp;need&nbsp;to&nbsp;deploy&nbsp;a&nbsp;secure&nbsp;proxy&nbsp;based&nbsp;on&nbsp;Squid.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;try&nbsp;to&nbsp;use&nbsp;https_port&nbsp;combined&nbsp;with&nbsp;sslbump.&nbsp;I&nbsp;get&nbsp;an&nbsp;error&nbsp;message&nbsp;about&nbsp;a&nbsp;bungled&nbsp;line.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;reasons&nbsp;I&nbsp;want&nbsp;to&nbsp;do&nbsp;this&nbsp;:&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;secure&nbsp;connection&nbsp;between&nbsp;the&nbsp;client&nbsp;browser&nbsp;and&nbsp;the&nbsp;proxy&nbsp;server,&nbsp;so&nbsp;using&nbsp;https_port&nbsp;to&nbsp;do&nbsp;it.&nbsp;encrypted &nbsp;traffic&nbsp;<br>
<br>
&nbsp;in&nbsp;TLS&nbsp;between&nbsp;the&nbsp;client&nbsp;and&nbsp;the&nbsp;server.&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;secure&nbsp;login&nbsp;connection.&nbsp;So&nbsp;I&nbsp;need&nbsp;to&nbsp;use&nbsp;https_port&nbsp;to&nbsp;do&nbsp;this.&nbsp;Otherwise&nbsp;If&nbsp;I&nbsp;use&nbsp;http_port,&nbsp;the&nbsp;login/password&nbsp;can&nbsp;be&nbsp;read&nbsp;on&nbsp;the&nbsp;network.&lt;/div&gt;&lt;div&gt;-&nbsp;Do&nbsp;ssl&nbsp;inspection&nbsp;of&nbsp;the&nbsp;traffic&nbsp;goeing&nbsp;through&nbsp;the&nbsp;proxy&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;I&nbsp;have&nbsp;done&nbsp;with&nbsp;success&nbsp;:&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-&nbsp;https_port&nbsp;without&nbsp;sslbump &nbsp;(traffic&nbsp;between&nbsp;the&nbsp;brownser&nbsp;and&nbsp;the&nbsp;client&nbsp;is&nbsp;encrypted.&nbsp;The&nbsp;login/password&nbsp;can&#39;t&nbsp;be&nbsp;read&nbsp;on&nbsp;the&nbsp;network)&lt;/div&gt;&lt;div&gt;-&nbsp;ssl-bump&nbsp;on&nbsp;http_port.&nbsp;The&nbsp;ssl&nbsp;inspection&nbsp;is&nbsp;working &nbsp;...&nbsp;but&nbsp;the&nbsp;connexion&nbsp;between&nbsp;the&nbsp;browser&nbsp;and&nbsp;the&nbsp;proxy&nbsp;service&nbsp;is&nbsp;not&nbsp;encrypted&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;can&#39;t&nbsp;get &nbsp;&#39;https_port&nbsp;3129&nbsp;ssl-bump&#39;&nbsp;working.&lt;/div&gt;&lt;div&gt;FATAL:&nbsp;ssl-bump&nbsp;on&nbsp;https_port&nbsp;requires&nbsp;tproxy/intercept&nbsp;which&nbsp;is&nbsp;missing.&lt;/div&gt;&lt;div&gt;FATAL:&nbsp;Bungled&nbsp;squid.conf&nbsp;line&nbsp;49:&nbsp;https_port&nbsp;3129&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;tls-cert=/etc/squid/squid-cert.pem&nbsp;options=SINGLE_DH_USE,SINGLE_ECDH_USE&nbsp;tls-dh=/etc/squid/dhparam.pem&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;there&nbsp;something &nbsp;I&nbsp;have&nbsp;misunderstood&nbsp;?&nbsp;Or&nbsp;doing&nbsp;wrong&nbsp;?&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;generated&nbsp;the&nbsp;certificate&nbsp;and&nbsp;CA&nbsp;with&nbsp;openssl&nbsp;:&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;openssl&nbsp;req&nbsp;-new&nbsp;-newkey&nbsp;rsa:2048&nbsp;-days&nbsp;365&nbsp;-nodes&nbsp;-x509&nbsp;-keyout&nbsp;squid-cert.pem&nbsp;-out&nbsp;squid-cert.pem&lt;/div&gt;&lt;div&gt;*&nbsp;openssl&nbsp;x509&nbsp;-in&nbsp;squid-cert.pem&nbsp;-outform&nbsp;DER&nbsp;-out&nbsp;squid-CA-browser.der&lt;/div&gt;&lt;div&gt;*&nbsp;openssl&nbsp;dhparam&nbsp;-outform&nbsp;PEM&nbsp;-out&nbsp;dhparam.pem&nbsp;2048&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Squid&nbsp;version&nbsp;:&nbsp;4.4&nbsp;from&nbsp;EPEL&nbsp;on&nbsp;centos&nbsp;8&nbsp;with &nbsp;&#39;--enable-ssl&#39;&nbsp;&#39;--enable-ssl-crtd&#39;&nbsp;&#39;--with-openssl&#39;&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Squid&nbsp;configuration&nbsp;as&nbsp;follow&nbsp;:&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
===============================================================<br>
<br>
&lt;/div&gt;&lt;div&gt;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib64/squid/basic_ncsa_auth&nbsp;/etc/squid/htpasswd&lt;br&gt;auth_param&nbsp;basic&nbsp;children&nbsp;10&lt;br&gt;auth_param&nbsp;basic&nbsp;realm&nbsp;Squid&nbsp;proxy-caching&nbsp;web&nbsp;server&lt;br&gt;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;2&nbsp;hours&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;localnet&nbsp;src&nbsp;0.0.0.1-0.255.255.255&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/24&quot;&gt;192.168.0.0/24&lt;/a&gt;&lt;br&gt;&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;&lt;br&gt;#squid&nbsp;mgmt&nbsp;interface&nbsp;access&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;&lt;br&gt;acl&nbsp;auth_users&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;http_access&nbsp;allow&nbsp;auth_users&lt;br&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;localnet&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;&lt;br&gt;#squid&nbsp;mgmt&nbsp;interface&nbsp;access&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;&lt;br&gt;#http_access&nbsp;deny&nbsp;to_localhost&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;##Many&nbsp;Tests&nbsp;here&nbsp;:&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#http_port&nbsp;3128&nbsp;ssl-bump&nbsp;cert=/etc/squid/squid-cert.pem&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&lt;/div&gt;&lt;div&gt;<br>
#http_port&nbsp;3128&nbsp;ssl-bump&nbsp;tls-cert=/etc/squid/squid-cert.pem&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#http_port&nbsp;3128&nbsp;ssl-bump&nbsp;cert=/etc/squid/squid-cert.pem&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS&nbsp;options=NO_TLSv1,NO_SSLv3,SINGLE_DH_USE,SINGLE_ECDH_USE&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#https_port&nbsp;3129&nbsp;cert=/etc/squid/squid-cert.pem&lt;/div&gt;&lt;div&gt;<br>
#https_port&nbsp;3129&nbsp;tls-cert=/etc/squid/squid-cert.pem&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;https_port&nbsp;3129&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;tls-cert=/etc/squid/squid-cert.pem&nbsp;options=SINGLE_DH_USE,SINGLE_ECDH_USE&nbsp;tls-dh=/etc/squid/dhparam.pem&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;sslcrtd_program&nbsp;/usr/lib64/squid/security_file_certgen&lt;br&gt;&lt;br&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;tls_outgoing_options&nbsp;min-version=1.0&nbsp;cipher=HIGH:MEDIUM:!RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS&lt;br&gt;&lt;br&gt;#LOGS&nbsp;:&nbsp;deux&nbsp;options.&nbsp;Envoie&nbsp;des&nbsp;logs&nbsp;directe&lt;br&gt;access_log&nbsp;daemon:/var/log/squid/access.log&nbsp;squid&lt;br&gt;#access_log&nbsp;tcp://[ip]:[port]&nbsp;squid&lt;br&gt;access_log&nbsp;syslog:&lt;a&nbsp;href=&quot;http://local0.info&quot;&gt;local0.info&lt;/a&gt;&nbsp;squid&lt;br&gt;cache_log&nbsp;/var/log/squid/cache.log&nbsp;rotate=10&lt;br&gt;&lt;br&gt;#Cache&lt;br&gt;cache_mem&nbsp;512&nbsp;MB&lt;br&gt;cache_dir&nbsp;ufs&nbsp;/var/spool/squid&nbsp;10000&nbsp;16&nbsp;256&lt;br&gt;coredump_dir&nbsp;/var/spool/squid&lt;/div&gt;&lt;div&gt;===============================================================&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;in&nbsp;advance&nbsp;!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
