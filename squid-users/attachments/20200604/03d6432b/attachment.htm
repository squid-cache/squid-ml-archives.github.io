<tt>
&lt;div&nbsp;id=&quot;__MailbirdStyleContent&quot;&nbsp;style=&quot;font-size:&nbsp;10pt;font-family:&nbsp;Arial;color:&nbsp;#000000&quot;&gt;Hi&nbsp;all,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I'm&nbsp;new&nbsp;to&nbsp;this&nbsp;mailing&nbsp;list,&nbsp;and&nbsp;I&nbsp;would&nbsp;start&nbsp;off&nbsp;with&nbsp;saying&nbsp;that&nbsp;I&nbsp;really&nbsp;love&nbsp;the&nbsp;Squid&nbsp;product.&lt;/div&gt;&lt;div&gt;I&nbsp;use&nbsp;it&nbsp;to&nbsp;intercept&nbsp;HTTP&nbsp;and&nbsp;HTTPS&nbsp;traffic&nbsp;in&nbsp;my&nbsp;network,&nbsp;and&nbsp;based&nbsp;on&nbsp;several&nbsp;ACLs&nbsp;forward&nbsp;it&nbsp;to&nbsp;different&nbsp;peer&nbsp;proxies.&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;where&nbsp;the&nbsp;DNS&nbsp;load&nbsp;balancing&nbsp;trickery&nbsp;becomes&nbsp;a&nbsp;hassle&nbsp;for&nbsp;HTTPS&nbsp;connections;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;do&nbsp;is&nbsp;if&nbsp;the&nbsp;request&nbsp;hostname&nbsp;matches&nbsp;an&nbsp;ACL&nbsp;(dstdomain&nbsp;or&nbsp;ssl::server_name),&nbsp;only&nbsp;do&nbsp;a&nbsp;splice&nbsp;for&nbsp;all&nbsp;ssl_bump&nbsp;steps.&nbsp;Otherwise&nbsp;do&nbsp;a&nbsp;peek&nbsp;for&nbsp;step1&nbsp;and&nbsp;a&nbsp;splice&nbsp;afterwards.&lt;/div&gt;&lt;div&gt;My&nbsp;thinking&nbsp;is&nbsp;that&nbsp;this&nbsp;would&nbsp;be&nbsp;a&nbsp;nice&nbsp;workaround&nbsp;for&nbsp;the&nbsp;Office365&nbsp;headache&nbsp;of&nbsp;TTLs&nbsp;of&nbsp;5&nbsp;seconds&nbsp;on&nbsp;the&nbsp;outlook.office365.com&nbsp;hostname.&lt;/div&gt;&lt;div&gt;However,&nbsp;this&nbsp;doesn't&nbsp;seem&nbsp;to&nbsp;work;&nbsp;I&nbsp;can't&nbsp;seem&nbsp;to&nbsp;trigger&nbsp;the&nbsp;&quot;only&nbsp;splice&quot;&nbsp;using&nbsp;any&nbsp;of&nbsp;the&nbsp;ACLs,&nbsp;and&nbsp;I&nbsp;keep&nbsp;getting&nbsp;the&nbsp;&quot;Host&nbsp;header&nbsp;forgery&quot;&nbsp;errors.&nbsp;(which&nbsp;on&nbsp;my&nbsp;Squid&nbsp;4.11&nbsp;version&nbsp;don't&nbsp;seem&nbsp;to&nbsp;be&nbsp;server,&nbsp;regardless&nbsp;of&nbsp;what&nbsp;I'm&nbsp;reading&nbsp;in&nbsp;various&nbsp;locations)&lt;/div&gt;&lt;div&gt;The&nbsp;only&nbsp;way&nbsp;I'm&nbsp;able&nbsp;to&nbsp;work&nbsp;around&nbsp;this&nbsp;for&nbsp;now&nbsp;is&nbsp;to&nbsp;create&nbsp;an&nbsp;ACL&nbsp;for&nbsp;all&nbsp;the&nbsp;possible&nbsp;IP's,&nbsp;and&nbsp;only&nbsp;splice&nbsp;for&nbsp;these&nbsp;(Blegh).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;there&nbsp;any&nbsp;way&nbsp;to&nbsp;achieve&nbsp;what&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;have?&nbsp;(without&nbsp;having&nbsp;to&nbsp;build&nbsp;a&nbsp;version&nbsp;of&nbsp;squid&nbsp;with&nbsp;the&nbsp;host&nbsp;forgery&nbsp;detection&nbsp;turned&nbsp;off...?&nbsp;:))&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;relevant&nbsp;portion&nbsp;of&nbsp;my&nbsp;configuration&nbsp;is&nbsp;as&nbsp;follows.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;-snip-&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;10pt&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;acl&nbsp;local&nbsp;dst&nbsp;192.168.0.0/16&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;acl&nbsp;microsoft&nbsp;dstdomain&nbsp;.microsoft.com&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;acl&nbsp;microsoft&nbsp;dstdomain&nbsp;.teams.microsoft.com&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;acl&nbsp;microsoft&nbsp;dstdomain&nbsp;.office365.com&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;acl&nbsp;microsoft&nbsp;dstdomain&nbsp;.office.com&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;acl&nbsp;microsoft&nbsp;dstdomain&nbsp;.office.net&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;acl&nbsp;microsoft&nbsp;dstdomain&nbsp;.outlook.com&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;http_port&nbsp;3128&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;http_port&nbsp;3129&nbsp;intercept&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;https_port&nbsp;3130&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/etc/certificates/SquidCA.pem&nbsp;key=/etc/certificates/SquidCA.pem&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;13.3333px&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;sslcrtd_program&nbsp;/usr/lib/squid/security_file_certgen&nbsp;-s&nbsp;/var/lib/ssl_db&nbsp;-M&nbsp;16MB&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;13.3333px&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;sslcrtd_children&nbsp;8&nbsp;startup=1&nbsp;idle=1&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;ssl_bump&nbsp;peek&nbsp;&nbsp;&nbsp;step1&nbsp;!microsoft&nbsp;!local&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;ssl_bump&nbsp;splice&nbsp;step2&nbsp;!microsoft&nbsp;!local&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;ssl_bump&nbsp;splice&nbsp;step3&nbsp;!microsoft&nbsp;!local&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Courier&nbsp;New&quot;&gt;-snip-&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Best&nbsp;Regards,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;J.&nbsp;Dierkse&lt;/div&gt;&lt;/div&gt;
</tt>
