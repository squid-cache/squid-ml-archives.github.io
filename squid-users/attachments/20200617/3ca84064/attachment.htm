<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi&nbsp;Alex,&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Could&nbsp;you&nbsp;please&nbsp;share&nbsp;with&nbsp;me&nbsp;a&nbsp;rough&nbsp;sketch&nbsp;example&nbsp;for&nbsp;the&nbsp;below&nbsp;statement.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&quot;but&nbsp;I&nbsp;suspect&nbsp;that&nbsp;a&nbsp;clever&lt;br&gt;<br>
combination&nbsp;of&nbsp;annotate_transaction&nbsp;and&nbsp;&quot;note&quot;&nbsp;ACLs&nbsp;in&nbsp;cache_peer_access&lt;br&gt;<br>
rules&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;force&nbsp;a&nbsp;particular&nbsp;cache&nbsp;peer&nbsp;selection&nbsp;order.&quot;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Mon,&nbsp;Jun&nbsp;15,&nbsp;2020&nbsp;at&nbsp;7:14&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;6/15/20&nbsp;3:26&nbsp;AM,&nbsp;Prem&nbsp;Chand&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;stopped&nbsp;the&nbsp;peerA(purposefully) &nbsp;and&nbsp;noticed&nbsp;that&nbsp;requests&nbsp;are&nbsp;failing&lt;br&gt;<br>
&gt;&nbsp;for&nbsp;the&nbsp;time&nbsp;slots&nbsp;that&nbsp;are&nbsp;going&nbsp;through&nbsp;peerA.&nbsp;I&nbsp;used&lt;br&gt;<br>
&gt;&nbsp;&quot;connect-fail-limit&quot;&nbsp;in&nbsp;cache_peer &nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;working.&nbsp;Is&nbsp;there&nbsp;any&lt;br&gt;<br>
&gt;&nbsp;way&nbsp;we&nbsp;can&nbsp;address&nbsp;this&nbsp;issue&nbsp;using&nbsp;the&nbsp;same&nbsp;solution&nbsp;considering&nbsp;how&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;handle&nbsp;the&nbsp;requests&nbsp;if&nbsp;any&nbsp;of&nbsp;the&nbsp;parent &nbsp;peer&nbsp;goes&nbsp;down?&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;not&nbsp;sure,&nbsp;but&nbsp;I&nbsp;think&nbsp;it&nbsp;should&nbsp;be&nbsp;possible&nbsp;to&nbsp;always&nbsp;give&nbsp;Squid&lt;br&gt;<br>
three&nbsp;peers&nbsp;to&nbsp;use,&nbsp;in&nbsp;the&nbsp;right&nbsp;order.&nbsp;There&nbsp;is&nbsp;no&nbsp;peer&nbsp;selection&lt;br&gt;<br>
algorithm&nbsp;that&nbsp;will&nbsp;do&nbsp;that&nbsp;automatically,&nbsp;but&nbsp;I&nbsp;suspect&nbsp;that&nbsp;a&nbsp;clever&lt;br&gt;<br>
combination&nbsp;of&nbsp;annotate_transaction&nbsp;and&nbsp;&quot;note&quot;&nbsp;ACLs&nbsp;in&nbsp;cache_peer_access&lt;br&gt;<br>
rules&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;force&nbsp;a&nbsp;particular&nbsp;cache&nbsp;peer&nbsp;selection&nbsp;order.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/LoadBalance#Go_through_a_peer&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/Features/LoadBalance#Go_through_a_peer&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;trick&nbsp;is&nbsp;to&nbsp;place&nbsp;one&nbsp;&quot;best&quot;&nbsp;peer&nbsp;into&nbsp;the&nbsp;first&nbsp;group&nbsp;(your&nbsp;rules&lt;br&gt;<br>
already&nbsp;do&nbsp;that!),&nbsp;but&nbsp;then&nbsp;stop&nbsp;banning&nbsp;peers&nbsp;so&nbsp;that&nbsp;the&nbsp;other&nbsp;two&lt;br&gt;<br>
peers&nbsp;are&nbsp;added&nbsp;to&nbsp;the&nbsp;&quot;All&nbsp;Alive&nbsp;Parents&quot;&nbsp;group&nbsp;(your&nbsp;rules&nbsp;currently&lt;br&gt;<br>
deny&nbsp;those&nbsp;two&nbsp;peers&nbsp;from&nbsp;being&nbsp;considered).&nbsp;It&nbsp;may&nbsp;be&nbsp;possible&nbsp;to&nbsp;stop&lt;br&gt;<br>
banning&nbsp;peers&nbsp;while&nbsp;the&nbsp;peer&nbsp;selection&nbsp;code&nbsp;is&nbsp;running&nbsp;its&nbsp;second&nbsp;pass&lt;br&gt;<br>
by&nbsp;changing&nbsp;request&nbsp;annotation.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;am&nbsp;sorry&nbsp;that&nbsp;I&nbsp;do&nbsp;not&nbsp;have&nbsp;enough&nbsp;time&nbsp;to&nbsp;sketch&nbsp;an&nbsp;example.&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Fri,&nbsp;Jun&nbsp;12,&nbsp;2020&nbsp;at&nbsp;6:47&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; On&nbsp;6/11/20&nbsp;11:52&nbsp;PM,&nbsp;Prem&nbsp;Chand&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;It&#39;s&nbsp;working&nbsp;as&nbsp;expected.&nbsp;I&nbsp;tried&nbsp;to&nbsp;allow&nbsp;only&nbsp;specific&nbsp;domains&lt;br&gt;<br>
&gt; &nbsp; &nbsp; during&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;the&nbsp;time&nbsp;by&nbsp;adding&nbsp;below&nbsp;acl&nbsp;but&nbsp;I&#39;m&nbsp;getting&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;503&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;acl&nbsp;usePeerB&nbsp;time&nbsp;00:30-00:59&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;acl&nbsp;usePeerB&nbsp;time&nbsp;02:00-02:29&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;acl&nbsp;alloweddomains&nbsp;dstdomain&nbsp;&lt;a&nbsp;href=&quot;http://google.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;google.com&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://google.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://google.com&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://facebook.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;facebook.com&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://facebook.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://facebook.com&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;cache_peer_access&nbsp;peerA&nbsp;allow&nbsp;usePeerA&nbsp;allowedomains&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;cache_peer_access&nbsp;peerB&nbsp;allow&nbsp;usePeerB&nbsp;allowedomains&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;cache_peer_access&nbsp;peerC&nbsp;allow&nbsp;!usePeerA&nbsp;!userPeerB&nbsp;alloweddomains&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Assuming&nbsp;there&nbsp;are&nbsp;no&nbsp;other&nbsp;cache&nbsp;peers,&nbsp;the&nbsp;above&nbsp;rules&nbsp;leave&nbsp;no&lt;br&gt;<br>
&gt; &nbsp; &nbsp; forwarding&nbsp;path&nbsp;for&nbsp;a&nbsp;request&nbsp;to&nbsp;a&nbsp;banned&nbsp;domain.&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;ban&lt;br&gt;<br>
&gt; &nbsp; &nbsp; such&nbsp;requests,&nbsp;http_access&nbsp;instead&nbsp;of&nbsp;cache_peer_access.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; HTH,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;On&nbsp;Thu,&nbsp;Jun&nbsp;11,&nbsp;2020&nbsp;at&nbsp;4:54&nbsp;AM&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; On&nbsp;6/10/20&nbsp;12:20&nbsp;PM,&nbsp;Antony&nbsp;Stone&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&nbsp;On&nbsp;Wednesday&nbsp;10&nbsp;June&nbsp;2020&nbsp;at&nbsp;18:11:03,&nbsp;Prem&nbsp;Chand&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&nbsp;Hi&nbsp;Alex,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&nbsp;Thanks&nbsp;for&nbsp;responding&nbsp;to&nbsp;my&nbsp;issue &nbsp;.&nbsp;I&nbsp;didn&#39;t&nbsp;get&nbsp;how&nbsp;the&nbsp;math&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; was&nbsp;done(why&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&nbsp;it&#39;s&nbsp;multiplied&nbsp;by&nbsp;2)&nbsp;to&nbsp;get&nbsp;16&nbsp;slots&nbsp;if&nbsp;possible&nbsp;could&nbsp;you&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; please&nbsp;elaborate&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&nbsp;with&nbsp;an&nbsp;example.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&nbsp;I&nbsp;believe&nbsp;what&nbsp;Alex&nbsp;meant&nbsp;was:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&nbsp;You&nbsp;want&nbsp;30&nbsp;minute&nbsp;timeslots&nbsp;for&nbsp;each&nbsp;of&nbsp;3&nbsp;peers,&nbsp;which&nbsp;is&nbsp;48&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; half-hour&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&nbsp;timeslots&nbsp;throughout&nbsp;the&nbsp;day.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&nbsp;However,&nbsp;you&nbsp;only&nbsp;need&nbsp;to&nbsp;define&nbsp;48/3&nbsp;of&nbsp;these&nbsp;for&nbsp;peer&nbsp;A,&nbsp;and&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; 48/3&nbsp;of&nbsp;them&nbsp;for&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&nbsp;peer&nbsp;B,&nbsp;and&nbsp;then&nbsp;let&nbsp;peer&nbsp;C&nbsp;deal&nbsp;with&nbsp;anything&nbsp;not&nbsp;already&lt;br&gt;<br>
&gt; &nbsp; &nbsp; handled&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; (so&nbsp;it&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&nbsp;doesn&#39;t&nbsp;need&nbsp;its&nbsp;own&nbsp;definitions).&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&nbsp;48/3&nbsp;=&nbsp;16,&nbsp;therefore&nbsp;you&nbsp;define&nbsp;16&nbsp;half-hour&nbsp;periods&nbsp;when&lt;br&gt;<br>
&gt; &nbsp; &nbsp; you&nbsp;want&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; peer&nbsp;A&nbsp;to&nbsp;do&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&nbsp;the&nbsp;work,&nbsp;16&nbsp;half-hour&nbsp;periods&nbsp;for&nbsp;peer&nbsp;B,&nbsp;and&nbsp;then&nbsp;just&nbsp;say&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &quot;peer&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; C,&nbsp;handle&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&nbsp;anything&nbsp;left&nbsp;over&quot;.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; Thank&nbsp;you,&nbsp;Antony!&nbsp;Here&nbsp;is&nbsp;an&nbsp;untested&nbsp;sketch:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;acl&nbsp;usePeerA&nbsp;time&nbsp;00:00-00:29&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;acl&nbsp;usePeerA&nbsp;time&nbsp;01:30-01:59&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;...&nbsp;a&nbsp;total&nbsp;of&nbsp;16&nbsp;ORed&nbsp;lines&nbsp;for&nbsp;the&nbsp;first&nbsp;peer&nbsp;...&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;...&nbsp;each&nbsp;line&nbsp;matches&nbsp;a&nbsp;unique&nbsp;30&nbsp;minute&nbsp;period&nbsp;...&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;acl&nbsp;usePeerB&nbsp;time&nbsp;00:30-00:59&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;acl&nbsp;usePeerB&nbsp;time&nbsp;02:00-02:29&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;...&nbsp;a&nbsp;total&nbsp;of&nbsp;16&nbsp;ORed&nbsp;lines&nbsp;for&nbsp;the&nbsp;second&nbsp;peer&nbsp;...&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;...&nbsp;each&nbsp;line&nbsp;matches&nbsp;a&nbsp;unique&nbsp;30&nbsp;minute&nbsp;period&nbsp;...&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;#&nbsp;and&nbsp;now&nbsp;match&nbsp;peer&nbsp;to&nbsp;its&nbsp;time&nbsp;slots&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;cache_peer_access&nbsp;peerA&nbsp;allow&nbsp;usePeerA&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;cache_peer_access&nbsp;peerB&nbsp;allow&nbsp;usePeerB&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp;  &nbsp;cache_peer_access&nbsp;peerC&nbsp;allow&nbsp;!usePeerA&nbsp;!userPeerB&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; The&nbsp;above&nbsp;may&nbsp;need&nbsp;further&nbsp;adjustments&nbsp;and&nbsp;polishing.&nbsp;For&lt;br&gt;<br>
&gt; &nbsp; &nbsp; example,&nbsp;I&nbsp;am&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; not&nbsp;sure&nbsp;how&nbsp;Squid&nbsp;will&nbsp;round&nbsp;these&nbsp;time&nbsp;values.&nbsp;The&nbsp;above&lt;br&gt;<br>
&gt; &nbsp; &nbsp; assumes&nbsp;that&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; 00:29&nbsp;limit&nbsp;includes&nbsp;all&nbsp;60&nbsp;seconds&nbsp;up&nbsp;to&nbsp;(but&nbsp;excluding)&lt;br&gt;<br>
&gt; &nbsp; &nbsp; 00:30:00.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; HTH,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&nbsp;On&nbsp;Wed,&nbsp;Jun&nbsp;10,&nbsp;2020&nbsp;at&nbsp;7:12&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;On&nbsp;6/10/20&nbsp;6:09&nbsp;AM,&nbsp;Prem&nbsp;Chand&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&gt;&nbsp;My&nbsp;squid&nbsp;cache&nbsp;peer&nbsp;has&nbsp;3&nbsp;parent&nbsp;IP’s&nbsp;configured.&nbsp;I&nbsp;need&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; send&nbsp;HTTPS&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&gt;&nbsp;requests&nbsp;to&nbsp;the&nbsp;first&nbsp;parent&nbsp;IP&nbsp;for&nbsp;30&nbsp;minutes&nbsp;and&nbsp;after&lt;br&gt;<br>
&gt; &nbsp; &nbsp; to&nbsp;the&nbsp;2nd&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&gt;&nbsp;parent&nbsp;IP&nbsp;for&nbsp;30&nbsp;minutes&nbsp;and&nbsp;then&nbsp;to&nbsp;3rd&nbsp;IP&nbsp;for&nbsp;30&lt;br&gt;<br>
&gt; &nbsp; &nbsp; minutes&nbsp;and&nbsp;this&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&gt;&nbsp;switching&nbsp;needs&nbsp;to&nbsp;happen&nbsp;continuously&nbsp;.Could&nbsp;you&nbsp;please&lt;br&gt;<br>
&gt; &nbsp; &nbsp; let&nbsp;us&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; know&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&gt;&nbsp;how&nbsp;I&nbsp;can&nbsp;achieve&nbsp;this?&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;If&nbsp;you&nbsp;are&nbsp;OK&nbsp;with&nbsp;hard-coded&nbsp;usage&nbsp;time&nbsp;slots&nbsp;for&nbsp;each&lt;br&gt;<br>
&gt; &nbsp; &nbsp; peer,&nbsp;then&nbsp;I&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;would&nbsp;use&nbsp;two[1]&nbsp;&quot;time&quot;&nbsp;ACLs&nbsp;and&nbsp;cache_peer_access&nbsp;rules.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Look&nbsp;for&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;&quot;aclname&nbsp;time&quot;&nbsp;in&nbsp;squid.conf.documented.&nbsp;You&nbsp;will&nbsp;have&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; generate&nbsp;a&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;list&nbsp;of&nbsp;(24*2/3=16)&nbsp;staggered&nbsp;time&nbsp;slots&nbsp;for&nbsp;each&nbsp;of&nbsp;the&nbsp;two&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; ACLs,&nbsp;but&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;it&nbsp;should&nbsp;work.&nbsp;This&nbsp;may&nbsp;be&nbsp;the&nbsp;simplest&nbsp;solution.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;[1]&nbsp;You&nbsp;need&nbsp;two&nbsp;ACLs&nbsp;for&nbsp;three&nbsp;peers&nbsp;because&nbsp;the&nbsp;third&nbsp;peer&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; should&nbsp;get&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;the&nbsp;requests&nbsp;that&nbsp;the&nbsp;first&nbsp;two&nbsp;peers&nbsp;were&nbsp;not&nbsp;allowed&nbsp;to&nbsp;get.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;----&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;With&nbsp;a&nbsp;modern&nbsp;Squid,&nbsp;you&nbsp;could&nbsp;also&nbsp;implement&nbsp;this&nbsp;using&nbsp;a&lt;br&gt;<br>
&gt; &nbsp; &nbsp; more&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; flexible&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;(and&nbsp;more&nbsp;expensive,&nbsp;on&nbsp;several&nbsp;layers!)&nbsp;architecture&nbsp;with&lt;br&gt;<br>
&gt; &nbsp; &nbsp; two&nbsp;ACLs:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;1.&nbsp;An&nbsp;external&nbsp;ACL&nbsp;that&nbsp;returns&nbsp;the&nbsp;right&nbsp;cache&nbsp;peer&nbsp;name&lt;br&gt;<br>
&gt; &nbsp; &nbsp; to&nbsp;use&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; via&nbsp;a&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;keyword=value&nbsp;annotation&nbsp;API.&nbsp;This&nbsp;always-matching&nbsp;ACL&lt;br&gt;<br>
&gt; &nbsp; &nbsp; should&nbsp;be&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;attached&nbsp;to&nbsp;http_access&nbsp;or&nbsp;a&nbsp;similar&nbsp;directive&nbsp;that&nbsp;supports&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; slow&nbsp;ACLs.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;Its&nbsp;goal&nbsp;is&nbsp;to&nbsp;annotate&nbsp;the&nbsp;request.&nbsp;You&nbsp;will&nbsp;need&nbsp;to&nbsp;write&nbsp;a&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;script/program&nbsp;that&nbsp;will&nbsp;compute&nbsp;the&nbsp;right&nbsp;annotations&lt;br&gt;<br>
&gt; &nbsp; &nbsp; based&nbsp;on&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; time&nbsp;or&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;some&nbsp;other&nbsp;factors.&nbsp;This&nbsp;is&nbsp;where&nbsp;the&nbsp;flexibility&nbsp;of&nbsp;this&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; solution&nbsp;is&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;coming&nbsp;from.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;2.&nbsp;A&nbsp;&quot;note&quot;&nbsp;ACL&nbsp;attached&nbsp;to&nbsp;cache_peer_access&nbsp;directives,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; allowing&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;access&nbsp;to&nbsp;peer&nbsp;X&nbsp;if&nbsp;the&nbsp;external&nbsp;ACL&nbsp;in&nbsp;item&nbsp;1&nbsp;returned&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;use_cache_peer_=X.&nbsp;The&nbsp;&quot;note&quot;&nbsp;ACL&nbsp;is&nbsp;a&nbsp;fast&nbsp;ACL&nbsp;and,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; hence,&nbsp;can&nbsp;be&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;reliably&nbsp;used&nbsp;with&nbsp;cache_peer_access.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;If&nbsp;you&nbsp;already&nbsp;have&nbsp;another&nbsp;external&nbsp;ACL,&nbsp;you&nbsp;may&nbsp;be&nbsp;able&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; piggyback&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;annotations&nbsp;in&nbsp;item&nbsp;1&nbsp;to&nbsp;whatever&nbsp;that&nbsp;ACL&nbsp;is&nbsp;already&nbsp;doing.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;For&nbsp;more&nbsp;information,&nbsp;search&nbsp;for&nbsp;&quot;keyword=value&quot;&nbsp;and&nbsp;&quot;acl&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; aclname&nbsp;note&quot;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;in&nbsp;your&nbsp;squid.conf.documented&nbsp;and&nbsp;see&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &lt;br&gt;<br>
&gt; &nbsp; &nbsp;  &lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/AddonHelpers#Access_Control_.28ACL&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/Features/AddonHelpers#Access_Control_.28ACL&lt;/a&gt;.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;29&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;HTH,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&gt;&gt;&nbsp;Alex.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;--&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;prem&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--&nbsp;&lt;br&gt;<br>
&gt;&nbsp;prem&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&gt;prem&lt;/div&gt;<br>

</tt>
