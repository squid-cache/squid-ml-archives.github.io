<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
Dear&nbsp;Amos,&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
**&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&quot;&gt;i&nbsp;will&nbsp;use&nbsp;each&nbsp;rock&nbsp;dir&nbsp;with&nbsp;one&nbsp;physical&nbsp;disk&nbsp;,&nbsp;i&nbsp;m&nbsp;going&nbsp;to&nbsp;set&nbsp;up&nbsp;it&nbsp;now.&nbsp;&#43;&nbsp;i&nbsp;will&nbsp;change&nbsp;to&nbsp;default&nbsp;rock&nbsp;dir&nbsp;optional&nbsp;values.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
**Please&nbsp;note&nbsp;that&nbsp;i&nbsp;m&nbsp;switching&nbsp;to&nbsp;rock,&nbsp;since&nbsp;one&nbsp;processor&nbsp;won't&nbsp;hande&nbsp;800&nbsp;Mb/s&nbsp;traffic&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
**theoratically&nbsp;would&nbsp;squid&nbsp;with&nbsp;rock&nbsp;cache&nbsp;dir&nbsp;,&nbsp;give&nbsp;me&nbsp;the&nbsp;same&nbsp;gain&nbsp;ratio&nbsp;of&nbsp;ufs&nbsp;cache&nbsp;dir&nbsp;?&nbsp;[for&nbsp;100mb/s&nbsp;ufs&nbsp;gave&nbsp;me&nbsp;70%]&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
**how&nbsp;much&nbsp;do&nbsp;u&nbsp;think&nbsp;of&nbsp;(worker&#43;RAM)&nbsp;is&nbsp;needed&nbsp;for&nbsp;800&nbsp;Mb/s&nbsp;traffic?&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
thank&nbsp;u&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;id=&quot;appendonsend&quot;&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:Calibri,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;hr&nbsp;tabindex=&quot;-1&quot;&nbsp;style=&quot;display:inline-block;&nbsp;width:98%&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divRplyFwdMsg&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;style=&quot;font-size:11pt&quot;&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;squid-users&nbsp;&lt;squid-users-bounces@lists.squid-cache.org&gt;&nbsp;on&nbsp;behalf&nbsp;of&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;squid3@treenet.co.nz&gt;&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Thursday,&nbsp;July&nbsp;2,&nbsp;2020&nbsp;1:20&nbsp;PM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;squid-users@lists.squid-cache.org&nbsp;&lt;squid-users@lists.squid-cache.org&gt;&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;rock&nbsp;issue&lt;/font&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;BodyFragment&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt&quot;&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;On&nbsp;2/07/20&nbsp;8:45&nbsp;am,&nbsp;patrick&nbsp;mkhael&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;***Please&nbsp;note&nbsp;that&nbsp;you&nbsp;have&nbsp;20&nbsp;kids&nbsp;worth&nbsp;mapping&nbsp;(10&nbsp;workers&nbsp;and&nbsp;10&lt;br&gt;<br>
&gt;&nbsp;diskers),&nbsp;but&nbsp;you&nbsp;map&nbsp;only&nbsp;the&nbsp;first&nbsp;10.â€‹{since&nbsp;i&nbsp;did&nbsp;not&nbsp;get&nbsp;the&nbsp;point&lt;br&gt;<br>
&gt;&nbsp;of&nbsp;the&nbsp;diskers&nbsp;,as&nbsp;far&nbsp;as&nbsp;i&nbsp;understood&nbsp;&nbsp;,&nbsp;it&nbsp;should&nbsp;be&nbsp;like&nbsp;&nbsp;(simple&lt;br&gt;<br>
&gt;&nbsp;example)&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&gt;workers&nbsp;2&lt;br&gt;<br>
&gt;&gt;&nbsp;cpu_affinity_map&nbsp;process_numbers=1,2,3,4&nbsp;cores=1,2,3,4&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_dir&nbsp;rock&nbsp;/mnt/sdb/1&nbsp;&nbsp;&nbsp;2048&nbsp;max-size=10000&nbsp;max-swap-rate=200&nbsp;swap-timeout=300&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_dir&nbsp;rock&nbsp;/mnt/sdb/2&nbsp;&nbsp;&nbsp;2048&nbsp;max-size=10000&nbsp;max-swap-rate=200&nbsp;swap-timeout=300&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;***Why&nbsp;do&nbsp;you&nbsp;have&nbsp;10&nbsp;rock&nbsp;caches&nbsp;of&nbsp;various&nbsp;sizes?&nbsp;[&nbsp;to&nbsp;be&nbsp;honest&nbsp;,&nbsp;i&lt;br&gt;<br>
&gt;&nbsp;saw&nbsp;in&nbsp;many&nbsp;websites&nbsp;that&nbsp;it&nbsp;should&nbsp;be&nbsp;like&nbsp;this&nbsp;from&nbsp;the&nbsp;smallest&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;bigest&nbsp;with&nbsp;diff&nbsp;size,&nbsp;i&nbsp;tought&nbsp;it&nbsp;should&nbsp;serve&nbsp;from&nbsp;small&nbsp;size&nbsp;pool&lt;br&gt;<br>
&gt;&nbsp;to&nbsp;high&nbsp;]&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;general&nbsp;yes.&nbsp;BUT&nbsp;the&nbsp;size&nbsp;ranges&nbsp;to&nbsp;use&nbsp;should&nbsp;be&nbsp;determined&nbsp;via&lt;br&gt;<br>
traffic&nbsp;analysis.&nbsp;Specifically&nbsp;measure&nbsp;and&nbsp;graph&nbsp;the&nbsp;object&nbsp;sizes&nbsp;being&lt;br&gt;<br>
handled.&nbsp;There&nbsp;will&nbsp;be&nbsp;a&nbsp;wavy&nbsp;/&nbsp;cyclic&nbsp;line&nbsp;resulting.&nbsp;The&nbsp;size&lt;br&gt;<br>
boundaries&nbsp;should&nbsp;be&nbsp;set&nbsp;to&nbsp;the&nbsp;*minimum*&nbsp;point(s)&nbsp;along&nbsp;that&nbsp;line.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;said.&nbsp;Since&nbsp;you&nbsp;are&nbsp;comparing&nbsp;the&nbsp;new&nbsp;rock&nbsp;to&nbsp;an&nbsp;old&nbsp;UFS&nbsp;setup.&nbsp;It&lt;br&gt;<br>
would&nbsp;be&nbsp;best&nbsp;to&nbsp;start&nbsp;with&nbsp;the&nbsp;rock&nbsp;being&nbsp;setup&nbsp;as&nbsp;similar&nbsp;to&nbsp;the&nbsp;UFS&lt;br&gt;<br>
as&nbsp;you&nbsp;can&nbsp;-&nbsp;number&nbsp;of&nbsp;cache_dir,&nbsp;ranges&nbsp;of&nbsp;objects&nbsp;stored&nbsp;there&nbsp;etc.&lt;br&gt;<br>
&lt;br&gt;<br>
ie.&nbsp;if&nbsp;these&nbsp;ranges&nbsp;were&nbsp;in&nbsp;the&nbsp;old&nbsp;UFS,&nbsp;then&nbsp;keep&nbsp;them&nbsp;for&nbsp;now.&nbsp;That&lt;br&gt;<br>
can&nbsp;be&nbsp;re-calculated&nbsp;after&nbsp;the&nbsp;HIT&nbsp;ratio&nbsp;drop&nbsp;is&nbsp;identified.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;*****How&nbsp;many&nbsp;independent&nbsp;disk&nbsp;spindles&nbsp;(or&nbsp;equivalent)&nbsp;do&nbsp;you&nbsp;have?&nbsp;[&nbsp;i&lt;br&gt;<br>
&gt;&nbsp;have&nbsp;one&nbsp;raid&nbsp;5&nbsp;ssd&nbsp;disks&nbsp;,&nbsp;used&nbsp;by&nbsp;the&nbsp;10&nbsp;rock&nbsp;cache&nbsp;dir]&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Ouch.&lt;br&gt;<br>
&lt;br&gt;<br>
Ideally&nbsp;you&nbsp;would&nbsp;have&nbsp;either:&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;5x&nbsp;SSD&nbsp;disks&nbsp;separately&nbsp;mounted.&nbsp;With&nbsp;one&nbsp;rock&nbsp;cache&nbsp;on&nbsp;each.&lt;br&gt;<br>
&lt;br&gt;<br>
or,&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;1x&nbsp;RAID&nbsp;10&nbsp;with&nbsp;one&nbsp;rock&nbsp;cache&nbsp;per&nbsp;disk&nbsp;pair/stripe.&nbsp;This&nbsp;requires&lt;br&gt;<br>
ability&nbsp;for&nbsp;controller&nbsp;to&nbsp;map&nbsp;a&nbsp;sub-directory&nbsp;tree&nbsp;exclusively&nbsp;onto&nbsp;one&lt;br&gt;<br>
of&nbsp;the&nbsp;sub-array&nbsp;stripes.&lt;br&gt;<br>
&lt;br&gt;<br>
or,&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;2x&nbsp;RAID&nbsp;1&nbsp;(drive&nbsp;pair&nbsp;mirroring)&nbsp;with&nbsp;one&nbsp;rock&nbsp;cache&nbsp;on&nbsp;each&nbsp;pair.&nbsp;This&lt;br&gt;<br>
is&nbsp;the&nbsp;simplest&nbsp;way&nbsp;to&nbsp;achieve&nbsp;above&nbsp;when&nbsp;sub-array&nbsp;feature&nbsp;is&nbsp;not&lt;br&gt;<br>
available&nbsp;in&nbsp;RAID&nbsp;10.&lt;br&gt;<br>
&lt;br&gt;<br>
or,&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;1x&nbsp;RAID&nbsp;10&nbsp;with&nbsp;a&nbsp;single&nbsp;rock&nbsp;cache&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;reasons;&lt;br&gt;<br>
&lt;br&gt;<br>
Squid&nbsp;I/O&nbsp;pattern&nbsp;is&nbsp;mostly&nbsp;writes&nbsp;and&nbsp;erase.&nbsp;Low&nbsp;on&nbsp;reads.&lt;br&gt;<br>
&lt;br&gt;<br>
RAID&nbsp;types&nbsp;in&nbsp;order&nbsp;of&nbsp;best-&gt;worst&nbsp;for&nbsp;that&nbsp;pattern&nbsp;are:&lt;br&gt;<br>
&nbsp;&nbsp;none,&nbsp;RAID&nbsp;1,&nbsp;RAID&nbsp;10,&nbsp;RAID&nbsp;5,&nbsp;RAID&nbsp;0&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/SquidFaq/RAID&quot;&gt;https://wiki.squid-cache.org/SquidFaq/RAID&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Normal&nbsp;SSD&nbsp;controllers&nbsp;cannot&nbsp;handle&nbsp;the&nbsp;Squid&nbsp;I/O&nbsp;pattern&nbsp;well.&nbsp;Squid&lt;br&gt;<br>
*will*&nbsp;age&nbsp;the&nbsp;disk&nbsp;much&nbsp;faster&nbsp;than&nbsp;manufacturer&nbsp;measured&nbsp;statistics&lt;br&gt;<br>
indicate.&nbsp;(True&nbsp;for&nbsp;even&nbsp;HDD,&nbsp;just&nbsp;less&nbsp;of&nbsp;a&nbsp;problem&nbsp;there).&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;means&nbsp;that&nbsp;the&nbsp;design&nbsp;needs&nbsp;to&nbsp;plan&nbsp;for&nbsp;coping&nbsp;with&nbsp;relatively&lt;br&gt;<br>
frequent&nbsp;disk&nbsp;failures.&nbsp;Loss&nbsp;of&nbsp;the&nbsp;data&nbsp;itself&nbsp;irrelevant.&nbsp;Only&nbsp;the&lt;br&gt;<br>
outage&nbsp;time&nbsp;&#43;&nbsp;reduction&nbsp;in&nbsp;HIT&nbsp;ratio&nbsp;actually&nbsp;matter&nbsp;on&nbsp;failures.&lt;br&gt;<br>
&lt;br&gt;<br>
Look&nbsp;for&nbsp;SSD&nbsp;with&nbsp;high&nbsp;write&nbsp;cycle&nbsp;measurements,&nbsp;and&nbsp;for&nbsp;RAID&nbsp;hot-swap&lt;br&gt;<br>
capability&nbsp;(even&nbsp;if&nbsp;the&nbsp;machine&nbsp;itself&nbsp;cant&nbsp;do&nbsp;that).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;***How&nbsp;did&nbsp;you&nbsp;select&nbsp;the&nbsp;swap&nbsp;rate&nbsp;limits&nbsp;and&nbsp;timeouts&nbsp;for&lt;br&gt;<br>
&gt;&nbsp;cache_dirs?[I&nbsp;took&nbsp;it&nbsp;also&nbsp;from&nbsp;online&nbsp;forum&nbsp;,&nbsp;can&nbsp;i&nbsp;leave&nbsp;it&nbsp;empty&nbsp;for&lt;br&gt;<br>
&gt;&nbsp;both]&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Alex&nbsp;may&nbsp;have&nbsp;better&nbsp;ideas&nbsp;if&nbsp;you&nbsp;can&nbsp;refer&nbsp;us&nbsp;to&nbsp;which&nbsp;tutorials&nbsp;or&lt;br&gt;<br>
documents&nbsp;you&nbsp;found&nbsp;that&nbsp;info&nbsp;in.&lt;br&gt;<br>
&lt;br&gt;<br>
Without&nbsp;specific&nbsp;details&nbsp;on&nbsp;why&nbsp;they&nbsp;were&nbsp;chosen&nbsp;I&nbsp;would&nbsp;go&nbsp;with&nbsp;one&lt;br&gt;<br>
rock&nbsp;cache&nbsp;with&nbsp;default&nbsp;values&nbsp;to&nbsp;start&nbsp;with.&nbsp;Only&nbsp;changing&nbsp;them&nbsp;if&lt;br&gt;<br>
followup&nbsp;analysis&nbsp;indicates&nbsp;some&nbsp;other&nbsp;value&nbsp;is&nbsp;better.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Amos&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
squid-users@lists.squid-cache.org&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
