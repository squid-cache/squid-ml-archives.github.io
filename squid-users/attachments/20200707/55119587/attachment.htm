<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;style=&quot;font-family:Calibri,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
Dear&nbsp;Alex,&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:Calibri,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:Calibri,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:Calibri,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;span&nbsp;style=&quot;color:rgb(50,49,48);&nbsp;font-size:14.6667px;&nbsp;background-color:rgb(255,255,255);&nbsp;display:inline!important&quot;&gt;**What&nbsp;kind&nbsp;of&nbsp;hit&nbsp;ratio&nbsp;do&nbsp;you&nbsp;get&nbsp;with&nbsp;rock&nbsp;if&nbsp;you&nbsp;do&nbsp;not&nbsp;limit&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(50,49,48);&nbsp;font-size:14.6667px;&nbsp;background-color:rgb(255,255,255);&nbsp;display:inline!important&quot;&gt;swap-rate<br>
&nbsp;and&nbsp;do&nbsp;not&nbsp;specify&nbsp;swap-timeout?&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(237,92,87);&nbsp;font-size:14.6667px;&nbsp;background-color:rgb(255,255,255);&nbsp;display:inline!important&quot;&gt;[i&nbsp;also&nbsp;removed&nbsp;the&nbsp;max&nbsp;size&nbsp;as&nbsp;recomended],&nbsp;the&nbsp;gain&nbsp;ratio&nbsp;is&nbsp;max&nbsp;13&nbsp;%.&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&quot;&gt;&lt;font&nbsp;color=&quot;#ed5c57&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&quot;&gt;&lt;font&nbsp;color=&quot;#ed5c57&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Web&nbsp;(West&nbsp;European)&quot;,&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;-apple-system,&nbsp;BlinkMacSystemFont,&nbsp;Roboto,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14.6667px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;display:&nbsp;inline&nbsp;!important;&quot;&gt;​**&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(50,&nbsp;49,&nbsp;48);&nbsp;font-family:&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Web&nbsp;(West&nbsp;European)&quot;,&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;-apple-system,&nbsp;BlinkMacSystemFont,&nbsp;Roboto,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14.6667px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;display:&nbsp;inline&nbsp;!important&quot;&gt;What<br>
&nbsp;kind&nbsp;of&nbsp;hit&nbsp;ratio&nbsp;do&nbsp;you&nbsp;get&nbsp;with&nbsp;rock&nbsp;if&nbsp;you&nbsp;use&nbsp;one&nbsp;worker,&nbsp;one&lt;/span&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(50,&nbsp;49,&nbsp;48);&nbsp;font-family:&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Web&nbsp;(West&nbsp;European)&quot;,&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;-apple-system,&nbsp;BlinkMacSystemFont,&nbsp;Roboto,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14.6667px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255)&quot;&gt;<br>
&lt;span&nbsp;style=&quot;color:&nbsp;rgb(50,&nbsp;49,&nbsp;48);&nbsp;font-family:&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Web&nbsp;(West&nbsp;European)&quot;,&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;-apple-system,&nbsp;BlinkMacSystemFont,&nbsp;Roboto,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14.6667px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;display:&nbsp;inline&nbsp;!important&quot;&gt;rock<br>
&nbsp;cache_dir,&nbsp;do&nbsp;not&nbsp;limit&nbsp;swap-rate,&nbsp;do&nbsp;not&nbsp;specify&nbsp;swap-timeout,&nbsp;and&lt;/span&gt;&lt;br&nbsp;style=&quot;color:&nbsp;rgb(50,&nbsp;49,&nbsp;48);&nbsp;font-family:&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Web&nbsp;(West&nbsp;European)&quot;,&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;-apple-system,&nbsp;BlinkMacSystemFont,&nbsp;Roboto,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14.6667px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255)&quot;&gt;<br>
&lt;span&nbsp;style=&quot;color:&nbsp;rgb(50,&nbsp;49,&nbsp;48);&nbsp;font-family:&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Web&nbsp;(West&nbsp;European)&quot;,&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;-apple-system,&nbsp;BlinkMacSystemFont,&nbsp;Roboto,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14.6667px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;display:&nbsp;inline&nbsp;!important&quot;&gt;start<br>
&nbsp;Squid&nbsp;with&nbsp;-N&nbsp;to&nbsp;disable&nbsp;SMP?&nbsp;[&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(237,&nbsp;92,&nbsp;87);&nbsp;font-family:&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Web&nbsp;(West&nbsp;European)&quot;,&nbsp;&quot;Segoe&nbsp;UI&quot;,&nbsp;-apple-system,&nbsp;BlinkMacSystemFont,&nbsp;Roboto,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;sans-serif;&nbsp;font-size:&nbsp;14.6667px;&nbsp;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;display:&nbsp;inline&nbsp;!important;&quot;&gt;as<br>
&nbsp;recomended,&nbsp;only&nbsp;one&nbsp;rock&nbsp;cache_dir&nbsp;,&nbsp;no&nbsp;limit&nbsp;swap&nbsp;and&nbsp;excuted&nbsp;with&nbsp;-N&nbsp;option,the&nbsp;gain&nbsp;ration&nbsp;is&nbsp;7%]&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;&lt;font&nbsp;color=&quot;#ed5c57&quot;&nbsp;style=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&quot;&gt;&lt;font&nbsp;color=&quot;#ed5c57&quot;&nbsp;style=&quot;&quot;&gt;additonial&nbsp;info:&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;&quot;&gt;&lt;font&nbsp;color=&quot;#ed5c57&quot;&nbsp;style=&quot;&quot;&gt;i&nbsp;have&nbsp;a&nbsp;total&nbsp;of&nbsp;24&nbsp;GB&nbsp;RAM&nbsp;which&nbsp;i&nbsp;use&nbsp;15&nbsp;GB&nbsp;of&nbsp;them&nbsp;as&nbsp;cache_mem&nbsp;and&nbsp;i&nbsp;use&nbsp;ext4&nbsp;in&nbsp;fstab.&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;&quot;&gt;&lt;font&nbsp;color=&quot;#ed5c57&quot;&nbsp;style=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;&quot;&gt;&lt;font&nbsp;color=&quot;#ed5c57&quot;&gt;thank&nbsp;u&lt;/font&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;id=&quot;appendonsend&quot;&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:Calibri,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;hr&nbsp;tabindex=&quot;-1&quot;&nbsp;style=&quot;display:inline-block;&nbsp;width:98%&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divRplyFwdMsg&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;style=&quot;font-size:11pt&quot;&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Saturday,&nbsp;July&nbsp;4,&nbsp;2020&nbsp;3:40&nbsp;AM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;patrick&nbsp;mkhael&nbsp;&lt;patrick.mkhael@hotmail.com&gt;;&nbsp;squid-users@lists.squid-cache.org&nbsp;&lt;squid-users@lists.squid-cache.org&gt;&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;rock&nbsp;issue&lt;/font&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;BodyFragment&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt&quot;&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;On&nbsp;7/3/20&nbsp;4:50&nbsp;AM,&nbsp;patrick&nbsp;mkhael&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;workers&nbsp;3&lt;br&gt;<br>
&gt;&nbsp;cpu_affinity_map&nbsp;process_numbers=1,2,3,4,5,6&nbsp;cores=1,2,3,4,5,6&lt;br&gt;<br>
&gt;&nbsp;cache_dir&nbsp;rock&nbsp;/rock1&nbsp;200000&nbsp;max-size=32000&nbsp;swap-timeout=300&nbsp;max-swap-rate=100&lt;br&gt;<br>
&gt;&nbsp;cache_dir&nbsp;rock&nbsp;/rock2&nbsp;200000&nbsp;max-size=32000&nbsp;max-swap-rate=100&nbsp;swap-timeout=300&lt;br&gt;<br>
&gt;&nbsp;cache_dir&nbsp;rock&nbsp;/rock3&nbsp;200000&nbsp;max-size=32000&nbsp;max-swap-rate=100&nbsp;swap-timeout=300&lt;br&gt;<br>
&gt;&nbsp;cache_mem&nbsp;17&nbsp;GB&lt;br&gt;<br>
&gt;&nbsp;maximum_object_size_in_memory&nbsp;25&nbsp;MB&lt;br&gt;<br>
&gt;&nbsp;maximum_object_size&nbsp;1&nbsp;GB&lt;br&gt;<br>
&gt;&nbsp;cache_miss_revalidate&nbsp;off&lt;br&gt;<br>
&gt;&nbsp;quick_abort_pct&nbsp;95&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
FYI:&nbsp;The&nbsp;combination&nbsp;of&nbsp;1GB&nbsp;maximum_object_size&nbsp;and&nbsp;much&nbsp;smaller&nbsp;size&lt;br&gt;<br>
limits&nbsp;for&nbsp;objects&nbsp;in&nbsp;memory&nbsp;and&nbsp;disk&nbsp;caches&nbsp;does&nbsp;not&nbsp;make&nbsp;sense:&nbsp;There&lt;br&gt;<br>
is&nbsp;no&nbsp;cache&nbsp;to&nbsp;store&nbsp;a,&nbsp;say,&nbsp;26MB&nbsp;object.&nbsp;If&nbsp;Squid&nbsp;lacks&nbsp;the&lt;br&gt;<br>
corresponding&nbsp;configuration&nbsp;&quot;lint&quot;&nbsp;check,&nbsp;somebody&nbsp;should&nbsp;add&nbsp;it.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;This&nbsp;config&nbsp;is&nbsp;giving&nbsp;4%&nbsp;of&nbsp;cache&nbsp;gain&nbsp;ratio,&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;in&nbsp;addition&nbsp;as&nbsp;i&nbsp;already&nbsp;mentionned&nbsp;before&nbsp;if&nbsp;i&nbsp;take&nbsp;the&nbsp;same&nbsp;above&lt;br&gt;<br>
&gt;&nbsp;config&nbsp;without&nbsp;worker&nbsp;and&nbsp;cach_dir&nbsp;with&nbsp;the&nbsp;same&nbsp;traffiic&nbsp;using&nbsp;aufs&nbsp;on&lt;br&gt;<br>
&gt;&nbsp;one&nbsp;of&nbsp;the&nbsp;disks&nbsp;,&nbsp;&nbsp;i&nbsp;have&nbsp;automatically&nbsp;i&nbsp;har&nbsp;60&nbsp;%&nbsp;cache&nbsp;ratio.&lt;br&gt;<br>
&lt;br&gt;<br>
When&nbsp;using&nbsp;AUFS,&nbsp;do&nbsp;you&nbsp;limit&nbsp;disk-cached&nbsp;object&nbsp;sizes&nbsp;to&nbsp;32KB&nbsp;like&nbsp;you&lt;br&gt;<br>
do&nbsp;with&nbsp;rock?&nbsp;If&nbsp;not,&nbsp;then&nbsp;you&nbsp;should&nbsp;remove&nbsp;the&nbsp;max-size&nbsp;limit&nbsp;from&lt;br&gt;<br>
rock&nbsp;cache_dirs.&nbsp;Modern&nbsp;rock&nbsp;cache_dirs&nbsp;are&nbsp;capable&nbsp;of&nbsp;storing&nbsp;large&lt;br&gt;<br>
objects.&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;kind&nbsp;of&nbsp;hit&nbsp;ratio&nbsp;do&nbsp;you&nbsp;get&nbsp;with&nbsp;rock&nbsp;if&nbsp;you&nbsp;do&nbsp;not&nbsp;limit&lt;br&gt;<br>
swap-rate&nbsp;and&nbsp;do&nbsp;not&nbsp;specify&nbsp;swap-timeout?&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;kind&nbsp;of&nbsp;hit&nbsp;ratio&nbsp;do&nbsp;you&nbsp;get&nbsp;with&nbsp;rock&nbsp;if&nbsp;you&nbsp;use&nbsp;one&nbsp;worker,&nbsp;one&lt;br&gt;<br>
rock&nbsp;cache_dir,&nbsp;do&nbsp;not&nbsp;limit&nbsp;swap-rate,&nbsp;do&nbsp;not&nbsp;specify&nbsp;swap-timeout,&nbsp;and&lt;br&gt;<br>
start&nbsp;Squid&nbsp;with&nbsp;-N&nbsp;to&nbsp;disable&nbsp;SMP?&lt;br&gt;<br>
&lt;br&gt;<br>
As&nbsp;you&nbsp;can&nbsp;see,&nbsp;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;understand&nbsp;whether&nbsp;the&nbsp;size&nbsp;limitation,&lt;br&gt;<br>
the&nbsp;rate&nbsp;limiting,&nbsp;or&nbsp;SMP&nbsp;problems&nbsp;explain&nbsp;the&nbsp;drop&nbsp;in&nbsp;hit&nbsp;ratio.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Shoud&nbsp;rock&nbsp;give&nbsp;me&nbsp;the&nbsp;same&nbsp;performance&nbsp;as&nbsp;aufs&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;is&nbsp;a&nbsp;difficult&nbsp;question&nbsp;to&nbsp;answer&nbsp;correctly&nbsp;(for&nbsp;me).&nbsp;The&nbsp;goal&nbsp;is&nbsp;for&lt;br&gt;<br>
rock&nbsp;performance&nbsp;to&nbsp;exceed&nbsp;that&nbsp;of&nbsp;(a)ufs,&nbsp;but&nbsp;I&nbsp;doubt&nbsp;we&nbsp;have&nbsp;reached&lt;br&gt;<br>
that&nbsp;goal&nbsp;in&nbsp;every&nbsp;environment&nbsp;that&nbsp;matters&nbsp;(including&nbsp;yours).&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;In&nbsp;a&nbsp;non-SMP&nbsp;environment,&nbsp;I&nbsp;would&nbsp;expect&nbsp;similar&nbsp;hit&nbsp;ratios&nbsp;in&nbsp;most&lt;br&gt;<br>
cases,&nbsp;but&nbsp;I&nbsp;would&nbsp;not&nbsp;be&nbsp;surprised&nbsp;if&nbsp;there&nbsp;are&nbsp;significant&nbsp;exceptions.&lt;br&gt;<br>
Rock&nbsp;is&nbsp;focused&nbsp;on&nbsp;SMP&nbsp;support,&nbsp;and&nbsp;there&nbsp;are&nbsp;complexities/costs&lt;br&gt;<br>
associated&nbsp;with&nbsp;SMP.&nbsp;Rock&nbsp;is&nbsp;getting&nbsp;better,&nbsp;but&nbsp;there&nbsp;are&nbsp;some&nbsp;known&lt;br&gt;<br>
areas&nbsp;where&nbsp;rock&nbsp;cannot&nbsp;yet&nbsp;do&nbsp;what&nbsp;ufs&nbsp;(including&nbsp;aufs)&nbsp;can.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;In&nbsp;a&nbsp;SMP&nbsp;environment,&nbsp;the&nbsp;question&nbsp;is&nbsp;mostly&nbsp;meaningless&nbsp;because&nbsp;there&lt;br&gt;<br>
is&nbsp;no&nbsp;SMP&nbsp;support&nbsp;for&nbsp;ufs-based&nbsp;caches.&nbsp;Folks&nbsp;use&nbsp;squid.conf&lt;br&gt;<br>
preprocessor&nbsp;hacks&nbsp;to&nbsp;configure&nbsp;ufs-based&nbsp;caches&nbsp;in&nbsp;SMP&nbsp;mode,&nbsp;but&nbsp;those&lt;br&gt;<br>
setups&nbsp;usually&nbsp;violate&nbsp;HTTP&nbsp;and&nbsp;may&nbsp;cause&nbsp;serious&nbsp;problems.&nbsp;YMMV.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;for&nbsp;a&nbsp;traffic&nbsp;of&nbsp;1&nbsp;Gb/s&nbsp;,&nbsp;is&nbsp;there&nbsp;a&nbsp;way&nbsp;to&nbsp;use&nbsp;aufs&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
Before&nbsp;trying&nbsp;unsupported&nbsp;combinations&nbsp;of&nbsp;aufs&nbsp;and&nbsp;SMP,&nbsp;I&nbsp;would&nbsp;try&nbsp;to&lt;br&gt;<br>
understand&nbsp;why&nbsp;your&nbsp;hit&nbsp;ratio&nbsp;is&nbsp;so&nbsp;low&nbsp;with&nbsp;rock.&nbsp;The&nbsp;questions&nbsp;above&lt;br&gt;<br>
may&nbsp;be&nbsp;a&nbsp;good&nbsp;start&nbsp;in&nbsp;that&nbsp;investigation.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;------------------------------------------------------------------------&lt;br&gt;<br>
&gt;&nbsp;*From:*&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;&lt;br&gt;<br>
&gt;&nbsp;*Sent:*&nbsp;Thursday,&nbsp;July&nbsp;2,&nbsp;2020&nbsp;4:24&nbsp;PM&lt;br&gt;<br>
&gt;&nbsp;*To:*&nbsp;patrick&nbsp;mkhael&nbsp;&lt;patrick.mkhael@hotmail.com&gt;;&lt;br&gt;<br>
&gt;&nbsp;squid-users@lists.squid-cache.org&nbsp;&lt;squid-users@lists.squid-cache.org&gt;&lt;br&gt;<br>
&gt;&nbsp;*Subject:*&nbsp;Re:&nbsp;[squid-users]&nbsp;rock&nbsp;issue&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;7/1/20&nbsp;4:45&nbsp;PM,&nbsp;patrick&nbsp;mkhael&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;***Please&nbsp;note&nbsp;that&nbsp;you&nbsp;have&nbsp;20&nbsp;kids&nbsp;worth&nbsp;mapping&nbsp;(10&nbsp;workers&nbsp;and&nbsp;10&lt;br&gt;<br>
&gt;&gt;&nbsp;diskers),&nbsp;but&nbsp;you&nbsp;map&nbsp;only&nbsp;the&nbsp;first&nbsp;10.​{since&nbsp;i&nbsp;did&nbsp;not&nbsp;get&nbsp;the&nbsp;point&lt;br&gt;<br>
&gt;&gt;&nbsp;of&nbsp;the&nbsp;diskers&nbsp;,as&nbsp;far&nbsp;as&nbsp;i&nbsp;understood&nbsp;&nbsp;,&nbsp;it&nbsp;should&nbsp;be&nbsp;like&nbsp;&nbsp;(simple&lt;br&gt;<br>
&gt;&gt;&nbsp;example)&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;workers&nbsp;2&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;cpu_affinity_map&nbsp;process_numbers=1,2,3,4&nbsp;cores=1,2,3,4&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;cache_dir&nbsp;rock&nbsp;...&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;cache_dir&nbsp;rock&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;above&nbsp;looks&nbsp;OK.&nbsp;Each&nbsp;worker&nbsp;is&nbsp;a&nbsp;kid&nbsp;process.&nbsp;Each&nbsp;rock&nbsp;cache_dir&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;a&nbsp;kid&nbsp;process&nbsp;(we&nbsp;call&nbsp;them&nbsp;diskers).&nbsp;&nbsp;If&nbsp;you&nbsp;have&nbsp;physical&nbsp;CPU&nbsp;cores&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;spare,&nbsp;give&nbsp;each&nbsp;kid&nbsp;process&nbsp;its&nbsp;own&nbsp;physical&nbsp;core.&nbsp;Otherwise,&nbsp;give&nbsp;each&lt;br&gt;<br>
&gt;&nbsp;worker&nbsp;process&nbsp;its&nbsp;own&nbsp;physical&nbsp;core&nbsp;(if&nbsp;you&nbsp;can).&nbsp;Diskers&nbsp;can&nbsp;share&lt;br&gt;<br>
&gt;&nbsp;physical&nbsp;cores&nbsp;with&nbsp;less&nbsp;harm&nbsp;because&nbsp;they&nbsp;usually&nbsp;do&nbsp;not&nbsp;consume&nbsp;much&lt;br&gt;<br>
&gt;&nbsp;CPU&nbsp;cycles.&nbsp;Squid&nbsp;wiki&nbsp;has&nbsp;more&nbsp;detailed&nbsp;information&nbsp;about&nbsp;that:&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/SmpScale#How_to_configure_SMP_Squid_for_top_performance.3F&quot;&gt;<br>
https://wiki.squid-cache.org/Features/SmpScale#How_to_configure_SMP_Squid_for_top_performance.3F&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;***Why&nbsp;do&nbsp;you&nbsp;have&nbsp;10&nbsp;rock&nbsp;caches&nbsp;of&nbsp;various&nbsp;sizes?&nbsp;[&nbsp;to&nbsp;be&nbsp;honest&nbsp;,&nbsp;i&lt;br&gt;<br>
&gt;&gt;&nbsp;saw&nbsp;in&nbsp;many&nbsp;websites&nbsp;that&nbsp;it&nbsp;should&nbsp;be&nbsp;like&nbsp;this&nbsp;from&nbsp;the&nbsp;smallest&nbsp;to&lt;br&gt;<br>
&gt;&gt;&nbsp;the&nbsp;bigest&nbsp;with&nbsp;diff&nbsp;size,&nbsp;i&nbsp;tought&nbsp;it&nbsp;should&nbsp;serve&nbsp;from&nbsp;small&nbsp;size&nbsp;pool&lt;br&gt;<br>
&gt;&gt;&nbsp;to&nbsp;high&nbsp;]&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;IMHO,&nbsp;you&nbsp;should&nbsp;stop&nbsp;reading&nbsp;those&nbsp;web&nbsp;pages&nbsp;:-).&nbsp;There&nbsp;is&nbsp;no&nbsp;general&lt;br&gt;<br>
&gt;&nbsp;need&nbsp;to&nbsp;segregate&nbsp;objects&nbsp;by&nbsp;sizes,&nbsp;especially&nbsp;when&nbsp;you&nbsp;are&nbsp;using&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;same&nbsp;slot&nbsp;size&nbsp;for&nbsp;all&nbsp;cache_dirs.&nbsp;Such&nbsp;segregation&nbsp;may&nbsp;be&nbsp;necessary&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;some&nbsp;special&nbsp;cases,&nbsp;but&nbsp;we&nbsp;have&nbsp;not&nbsp;yet&nbsp;established&nbsp;that&nbsp;your&nbsp;case&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;special.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;*****How&nbsp;many&nbsp;independent&nbsp;disk&nbsp;spindles&nbsp;(or&nbsp;equivalent)&nbsp;do&nbsp;you&nbsp;have?&nbsp;[&nbsp;i&lt;br&gt;<br>
&gt;&gt;&nbsp;have&nbsp;one&nbsp;raid&nbsp;5&nbsp;ssd&nbsp;disks&nbsp;,&nbsp;used&nbsp;by&nbsp;the&nbsp;10&nbsp;rock&nbsp;cache&nbsp;dir]&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Do&nbsp;not&nbsp;use&nbsp;RAID.&nbsp;If&nbsp;possible,&nbsp;use&nbsp;one&nbsp;rock&nbsp;cache_dir&nbsp;per&nbsp;SSD&nbsp;disk.&nbsp;The&lt;br&gt;<br>
&gt;&nbsp;only&nbsp;reason&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;possible,&nbsp;AFAICT,&nbsp;is&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;cache&lt;br&gt;<br>
&gt;&nbsp;more&nbsp;(per&nbsp;SSD&nbsp;disk)&nbsp;than&nbsp;a&nbsp;single&nbsp;Squid&nbsp;cache_dir&nbsp;can&nbsp;hold,&nbsp;but&nbsp;I&nbsp;would&lt;br&gt;<br>
&gt;&nbsp;not&nbsp;worry&nbsp;about&nbsp;overcoming&nbsp;that&nbsp;limit&nbsp;at&nbsp;the&nbsp;beginning.&nbsp;If&nbsp;you&nbsp;want&nbsp;to&lt;br&gt;<br>
&gt;&nbsp;know&nbsp;more&nbsp;about&nbsp;the&nbsp;limit,&nbsp;look&nbsp;for&nbsp;&quot;33554431&quot;&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://www.squid-cache.org/mail-archive/squid-users/201312/0034.html&quot;&gt;<br>
http://www.squid-cache.org/mail-archive/squid-users/201312/0034.html&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;***How&nbsp;did&nbsp;you&nbsp;select&nbsp;the&nbsp;swap&nbsp;rate&nbsp;limits&nbsp;and&nbsp;timeouts&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;cache_dirs?[I&nbsp;took&nbsp;it&nbsp;also&nbsp;from&nbsp;online&nbsp;forum&nbsp;,&nbsp;can&nbsp;i&nbsp;leave&nbsp;it&nbsp;empty&nbsp;for&lt;br&gt;<br>
&gt;&gt;&nbsp;both]&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;simple&nbsp;answer,&nbsp;then&nbsp;it&nbsp;is&nbsp;&quot;yes&quot;.&nbsp;Unfortunately,&nbsp;there&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;no&nbsp;simple&nbsp;correct&nbsp;answer&nbsp;to&nbsp;that&nbsp;question.&nbsp;To&nbsp;understand&nbsp;what&nbsp;is&nbsp;going&lt;br&gt;<br>
&gt;&nbsp;on&nbsp;and&nbsp;how&nbsp;to&nbsp;tune&nbsp;things,&nbsp;I&nbsp;recommend&nbsp;studying&nbsp;the&nbsp;Performance&nbsp;Tuning&lt;br&gt;<br>
&gt;&nbsp;section&nbsp;of&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/RockStore&quot;&gt;https://wiki.squid-cache.org/Features/RockStore&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;****Do&nbsp;you&nbsp;see&nbsp;any&nbsp;ERRORs&nbsp;or&nbsp;WARNINGs&nbsp;in&nbsp;cache&nbsp;log?[NO&nbsp;error&nbsp;or&nbsp;warning&lt;br&gt;<br>
&gt;&gt;&nbsp;found&nbsp;in&nbsp;cache]&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Good.&nbsp;I&nbsp;assume&nbsp;you&nbsp;do&nbsp;see&nbsp;some&nbsp;regular&nbsp;messages&nbsp;in&nbsp;cache.log.&nbsp;Keep&nbsp;an&lt;br&gt;<br>
&gt;&nbsp;eye&nbsp;for&nbsp;ERRORs&nbsp;and&nbsp;WARNINGs&nbsp;as&nbsp;you&nbsp;change&nbsp;settings.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;HTH,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
