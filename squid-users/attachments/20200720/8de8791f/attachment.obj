
acl localnet src 10.20.0.0/16           # Mozenda DC net
acl localnet src fc00::/7               # RFC 4193 local private network range
acl localnet src fe80::/10              # RFC 4291 link-local (directly plugged) machines


acl SSL_ports port 443

acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http

acl CONNECT method CONNECT


# Prevent caching
cache deny all

## Only allow access to the defined safe ports whitelist
http_access deny !Safe_ports

## Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

## Only allow cachemgr access from localhost and localnet
http_access allow localhost manager
http_access allow localnet manager
http_access deny manager

## We strongly recommend the following be uncommented to protect innocent
## web applications running on the proxy server who think the only
## one who can access services on "localhost" is a local user
http_access deny to_localhost


# Define number of worker instances
workers 4

# Sets 1:1 mapping between Squid processes and CPU cores.
cpu_affinity_map process_numbers=1,2,3,4 cores=1,2,3,4



### Define the program that will be used for authentication checks.
auth_param basic program /usr/bin/python3 /etc/squid/conf.d/basic_auth.py

# how many instances of the above program should run concurrently
auth_param basic children 10

# display some message to clients when they are asked for username, password
auth_param basic realm Please enter your proxy server username and password

# for how much time the authentication should be valid
auth_param basic credentialsttl 4 hours

# whether username, password should be case sensitive or not
auth_param basic casesensitive on


# Allow access to proxy if authenticated
acl BasicAuth proxy_auth REQUIRED
http_access allow BasicAuth
http_access allow localhost

## And finally deny all other access to this proxy
http_access deny all

## Listen on localhost on port 3128, used only for debugging
http_port localhost:3128
http_port 10.20.6.8:50505


# No cache dir should be used but set just in case
cache_dir aufs /var/cache/squid 1024 16 256

coredump_dir /var/spool/squid

## How much RAM, in MB, to use for cache? Default since squid 3.1 is 256 MB
cache_mem 256 MB

## Maximum size of individual objects to store in cache
maximum_object_size 1 MB

## Amount of data to buffer from server to client
read_ahead_gap 16 KB

## Suppress sending squid version information
httpd_suppress_version_string on

## How long to wait when shutting down squid
shutdown_lifetime 2 seconds

## Increase number of open connections/files
max_filedescriptors 262143


## Add any of your own refresh_pattern entries above these.
refresh_pattern ^ftp:           1440    20%     10080
refresh_pattern ^gopher:        1440    0%      1440
refresh_pattern -i (/cgi-bin/|\?) 0     0%      0
refresh_pattern .               0       20%     4320


# No persistent connections
client_persistent_connections off
server_persistent_connections off

# Remove identifying headers
request_header_access Via deny all
request_header_access X-Forwarded-For deny all


## Use IPv4 first
dns_v4_first on


# Include the *.conf config files from conf.d
include /etc/squid/conf.d/*.conf


########### ACLs ##############
# Defined in the file /etc/squid/conf.d/acls.conf


########### Outgoing IPs matches based on ACLs above ##############
# defined in the file /etc/squid/conf.d/outgoing.conf
