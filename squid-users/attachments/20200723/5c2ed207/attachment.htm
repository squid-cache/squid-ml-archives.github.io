<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&nbsp;everybody.&lt;br&gt;I&nbsp;have&nbsp;a&nbsp;SQUID&nbsp;4.11&nbsp;compiled&nbsp;on&nbsp;Debian&nbsp;9.8&nbsp;with&nbsp;kerberos&nbsp;integration&nbsp;authenticating&nbsp;and&nbsp;browsing&nbsp;without&nbsp;problems:&lt;br&gt;cache.log&lt;br&gt;squid_kerb_auth:&nbsp;User&nbsp;some.user&nbsp;authenticated&lt;br&gt;access.log&lt;br&gt;10.10.10.203&nbsp;TCP_TUNNEL/200&nbsp;5264&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://update.googleapis.com:443&quot;&gt;update.googleapis.com:443&lt;/a&gt;&nbsp;some.user&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://172.217.162.3&quot;&gt;172.217.162.3&lt;/a&gt;&nbsp;-&lt;br&gt;&lt;br&gt;The&nbsp;problem&nbsp;starts&nbsp;when&nbsp;I&nbsp;try&nbsp;to&nbsp;configure&nbsp;a&nbsp;HAProxy&nbsp;1.8&nbsp;load&nbsp;balancer&nbsp;to&nbsp;which&nbsp;by&nbsp;redundancy&nbsp;I&nbsp;configured&nbsp;a&nbsp;virtual&nbsp;IP&nbsp;with&nbsp;the&nbsp;keepalived&nbsp;service.&nbsp;When&nbsp;I&nbsp;point&nbsp;my&nbsp;browser&nbsp;to&nbsp;the&nbsp;DNS&nbsp;A&nbsp;record&nbsp;(balancer.mydomain.local)&nbsp;which&nbsp;in&nbsp;turn&nbsp;points&nbsp;to&nbsp;the&nbsp;keepalived&nbsp;virtual&nbsp;IP,&nbsp;the&nbsp;authentication&nbsp;stops&nbsp;working:&lt;br&gt;cache.log&lt;div&gt;no&nbsp;records&lt;br&gt;access.log&lt;br&gt;10.10.8.207&nbsp;TCP_DENIED/407&nbsp;4142&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://update.googleapis.com:443&quot;&gt;update.googleapis.com:443&lt;/a&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;the&nbsp;client&nbsp;browser&nbsp;a&nbsp;prompt&nbsp;appears&nbsp;requesting&nbsp;authentication.&lt;br&gt;&lt;br&gt;I&nbsp;find&nbsp;it&nbsp;strange&nbsp;that&nbsp;the&nbsp;IP&nbsp;registered&nbsp;by&nbsp;SQUID&nbsp;is&nbsp;10.10.8.207,&nbsp;which&nbsp;is&nbsp;the&nbsp;physical&nbsp;IP&nbsp;of&nbsp;my&nbsp;VM,&nbsp;instead&nbsp;of&nbsp;the&nbsp;virtual&nbsp;IP&nbsp;configured&nbsp;in&nbsp;HAProxy,&nbsp;which&nbsp;is&nbsp;the&nbsp;IP&nbsp;10.10.8.213.&lt;br&gt;&lt;br&gt;I&nbsp;send&nbsp;you&nbsp;all&nbsp;the&nbsp;configurations&nbsp;that&nbsp;I&nbsp;have&nbsp;made&nbsp;to&nbsp;see&nbsp;if&nbsp;you&nbsp;can&nbsp;help&nbsp;me&nbsp;to&nbsp;find&nbsp;where&nbsp;my&nbsp;configuration&nbsp;error&nbsp;is.&lt;br&gt;&lt;br&gt;keepalived.conf&lt;div&gt; &nbsp;global_defs&nbsp;{&lt;br&gt; &nbsp; &nbsp; notification_email&nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; some.user@mydomain.local&lt;br&gt; &nbsp; &nbsp; }&lt;br&gt; &nbsp; &nbsp; notification_email_from&nbsp;balancer1@mydomain.local&lt;br&gt; &nbsp; &nbsp; smtp_server&nbsp;smtp.<br>
<br>
mydomain.local<br>
<br>
&lt;br&gt; &nbsp; &nbsp; smtp_connect_timeout&nbsp;60&lt;br&gt; &nbsp;}&lt;br&gt;&lt;br&gt; &nbsp;vrrp_instance&nbsp;VI_1&nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp;state&nbsp;MASTER&lt;br&gt; &nbsp; &nbsp; &nbsp;interface&nbsp;eth0&lt;br&gt; &nbsp; &nbsp; &nbsp;virtual_router_id&nbsp;101&lt;br&gt; &nbsp; &nbsp; &nbsp;priority&nbsp;101&lt;br&gt; &nbsp; &nbsp; &nbsp;advert_int&nbsp;1&lt;br&gt; &nbsp; &nbsp; &nbsp;authentication&nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;auth_type&nbsp;PASS&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;auth_pass&nbsp;somepass123&lt;br&gt; &nbsp; &nbsp; &nbsp;}&lt;br&gt; &nbsp; &nbsp; &nbsp;virtual_ipaddress&nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.10.8.213&lt;br&gt; &nbsp; &nbsp; &nbsp;}&lt;br&gt; &nbsp;}&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;haproxy.conf&lt;/div&gt;&lt;div&gt;global&lt;br&gt;&nbsp;log&nbsp;/dev/log&nbsp;&nbsp;&nbsp;&nbsp;local0&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log&nbsp;/dev/log&nbsp;&nbsp;&nbsp;&nbsp;local1&nbsp;notice&lt;br&gt;&nbsp;chroot&nbsp;/var/lib/haproxy&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stats&nbsp;socket&nbsp;/run/haproxy/admin.sock&nbsp;mode&nbsp;660&nbsp;level&nbsp;admin&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stats&nbsp;timeout&nbsp;30s&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user&nbsp;haproxy&lt;br&gt;&nbsp;&nbsp;group&nbsp;haproxy&lt;br&gt;&nbsp;daemon&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxconn&nbsp;4000&lt;br&gt;ca-base&nbsp;/etc/ssl/certs&lt;br&gt;&nbsp;&nbsp;crt-base&nbsp;/etc/ssl/private&lt;br&gt;server=haproxy&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssl-default-bind-ciphers&nbsp;ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS&lt;br&gt;&nbsp;&nbsp;&nbsp;ssl-default-bind-options&nbsp;no-sslv3&lt;br&gt;&lt;br&gt;defaults&lt;br&gt;&nbsp;balance&nbsp;source&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log&nbsp;global&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;http&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;option&nbsp;httplog&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;option&nbsp;&nbsp;dontlognull&lt;br&gt;&nbsp;&nbsp;&nbsp;option&nbsp;http-server-close&lt;br&gt;option&nbsp;forwardfor&nbsp;except&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.0/8&quot;&gt;127.0.0.0/8&lt;/a&gt;&lt;br&gt;&nbsp;timeout&nbsp;connect&nbsp;5000&lt;br&gt;&nbsp;&nbsp;timeout&nbsp;client&nbsp;50000&lt;br&gt;&nbsp;&nbsp;timeout&nbsp;server&nbsp;50000&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errorfile&nbsp;400&nbsp;/etc/haproxy/errors/400.http&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;errorfile&nbsp;403&nbsp;/etc/haproxy/errors/403.http&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;errorfile&nbsp;408&nbsp;/etc/haproxy/errors/408.http&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;errorfile&nbsp;500&nbsp;/etc/haproxy/errors/500.http&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;errorfile&nbsp;502&nbsp;/etc/haproxy/errors/502.http&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;errorfile&nbsp;503&nbsp;/etc/haproxy/errors/503.http&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;errorfile&nbsp;504&nbsp;/etc/haproxy/errors/504.http&lt;br&gt;&lt;br&gt;###&nbsp;statistics&lt;br&gt;listen&nbsp;stats&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;bind&nbsp;&lt;a&nbsp;href=&quot;http://10.10.8.213:1936&quot;&gt;10.10.8.213:1936&lt;/a&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode&nbsp;http&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stats&nbsp;enable&lt;br&gt;&nbsp;&nbsp;stats&nbsp;hide-version&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;stats&nbsp;realm&nbsp;Haproxy\&nbsp;Statistics&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stats&nbsp;uri&nbsp;/haproxy?stats&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stats&nbsp;auth&nbsp;haproxy:somepass123&lt;br&gt;&lt;br&gt;###&nbsp;balancer&lt;br&gt;listen&nbsp;squid&lt;br&gt;&nbsp;&nbsp;bind&nbsp;&lt;a&nbsp;href=&quot;http://10.10.8.213:3128&quot;&gt;10.10.8.213:3128&lt;/a&gt;&lt;br&gt; &nbsp;&nbsp;&nbsp;mode&nbsp;http&lt;br&gt; &nbsp;&nbsp;&nbsp;option&nbsp;httplog&lt;br&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;balance&nbsp;source&lt;br&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash-type&nbsp;consistent&lt;br&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;option&nbsp;httpclose&lt;br&gt; &nbsp;&nbsp;&nbsp;&nbsp;cookie&nbsp;SERVERID&nbsp;insert&nbsp;indirect&nbsp;nocache&lt;br&gt; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;option&nbsp;forwardfor&nbsp;header&nbsp;X-Client&lt;br&gt; &nbsp;&nbsp;&nbsp;server&nbsp;proxy1&nbsp;&lt;a&nbsp;href=&quot;http://10.10.8.205:3128&quot;&gt;10.10.8.205:3128&lt;/a&gt;&nbsp;check&nbsp;inter&nbsp;2000&nbsp;rise&nbsp;2&nbsp;fall&nbsp;5&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt; &nbsp;server&nbsp;proxy2&nbsp;&lt;a&nbsp;href=&quot;http://10.10.8.206:3128&quot;&gt;10.10.8.206:3128&lt;/a&gt;&nbsp;check&nbsp;inter&nbsp;2000&nbsp;rise&nbsp;2&nbsp;fall&nbsp;5&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;squid.conf&lt;/div&gt;&lt;div&gt;#&nbsp;minimal&nbsp;configuration&nbsp;for&nbsp;testing&lt;/div&gt;&lt;div&gt;visible_hostname&nbsp;proxy1.mydomain.local&lt;br&gt;http_port&nbsp;3128&lt;br&gt;debug_options&nbsp;ALL,&nbsp;1&nbsp;33,&nbsp;2&nbsp;28,&nbsp;9&lt;br&gt;maximum_object_size&nbsp;8192&nbsp;KB&lt;br&gt;error_directory&nbsp;/opt/squid411/share/errors/es-ar&lt;br&gt;shutdown_lifetime&nbsp;0&nbsp;seconds&lt;br&gt;forwarded_for&nbsp;on&lt;br&gt;auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/local/bin/squid_kerb_auth&nbsp;-i&nbsp;-r&nbsp;-s&nbsp;GSS_C_NO_NAME&lt;br&gt;auth_param&nbsp;negotiate&nbsp;children&nbsp;300&nbsp;startup=150&nbsp;idle=10&lt;br&gt;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;on&lt;br&gt;acl&nbsp;auth&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;http_access&nbsp;allow&nbsp;auth&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&lt;br&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;squid&nbsp;-v&lt;/div&gt;&lt;div&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;4.11&lt;br&gt;Service&nbsp;Name:&nbsp;squid&lt;br&gt;&lt;br&gt;This&nbsp;binary&nbsp;uses&nbsp;OpenSSL&nbsp;1.0.2u&nbsp; 20&nbsp;Dec&nbsp;2019.&nbsp;For&nbsp;legal&nbsp;restrictions&nbsp;on&nbsp;distribution&nbsp;see&nbsp;&lt;a&nbsp;href=&quot;https://www.openssl.org/source/license.html&quot;&gt;https://www.openssl.org/source/license.html&lt;/a&gt;&lt;br&gt;&lt;br&gt;configure&nbsp;options:&nbsp; &#39;--prefix=/opt/squid411&#39;&nbsp;&#39;--includedir=/include&#39;&nbsp;&#39;--mandir=/share/man&#39;&nbsp;&#39;--infodir=/share/info&#39;&nbsp;&#39;--localstatedir=/opt/squid411/var&#39;&nbsp;&#39;--disable-maintainer-mode&#39;&nbsp;&#39;--disable-dependency-tracking&#39;&nbsp;&#39;--disable-silent-rules&#39;&nbsp;&#39;--enable-inline&#39;&nbsp;&#39;--enable-async-io&#39;&nbsp;&#39;--enable-storeio=ufs,aufs,diskd&#39;&nbsp;&#39;--enable-removal-policies=lru,heap&#39;&nbsp;&#39;--enable-delay-pools&#39;&nbsp;&#39;--enable-cache-digests&#39;&nbsp;&#39;--enable-underscores&#39;&nbsp;&#39;--enable-icap-client&#39;&nbsp;&#39;--enable-follow-x-forwarded-for&#39;&nbsp;&#39;--enable-auth&#39;&nbsp;&#39;--enable-digest-auth-helpers&#39;&nbsp;&#39;--enable-negotiate-auth-helpers&#39;&nbsp;&#39;--enable-auth-ntlm&#39;&nbsp;&#39;--enable-arp-acl&#39;&nbsp;&#39;--enable-esi--disable-translation&#39;&nbsp;&#39;--with-logdir=/var/log/squid411&#39;&nbsp;&#39;--with-pidfile=/var/run/squid411.pid&#39;&nbsp;&#39;--with-filedescriptors=65536&#39;&nbsp;&#39;--with-large-files&#39;&nbsp;&#39;--with-default-user=proxy&#39;&nbsp;&#39;--enable-linux-netfilter&#39;&nbsp;&#39;--enable-ltdl-convenience&#39;&nbsp;&#39;--with-openssl&#39;&nbsp;&#39;--enable-ssl&#39;&nbsp;&#39;--enable-ssl-crtd&#39;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;env&lt;/div&gt;&lt;div&gt;KRB5_KTNAME=/opt/squid411/etc/PROXY.keytab&lt;br&gt;KRB5RCACHETYPE=none&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/etc/krb5.conf&lt;/div&gt;&lt;div&gt;[libdefaults]&lt;br&gt; &nbsp; &nbsp;default_realm&nbsp;=&nbsp;MYDOMAIN.LOCAL&lt;br&gt; &nbsp; &nbsp;dns_lookup_kdc&nbsp;=&nbsp;yes&lt;br&gt; &nbsp; &nbsp;dns_lookup_realm&nbsp;=&nbsp;yes&nbsp;&lt;br&gt; &nbsp; &nbsp;ticket_lifetime&nbsp;=&nbsp;24h&lt;br&gt;&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;default_tgs_enctypes&nbsp;=&nbsp;aes256-cts-hmac-sha1-96&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;default_tkt_enctypes&nbsp;=&nbsp;aes256-cts-hmac-sha1-96&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;permitted_enctypes&nbsp;=&nbsp;aes256-cts-hmac-sha1-96&nbsp;rc4-hmac&nbsp;des-cbc-crc&nbsp;des-cbc-md5&lt;br&gt;&lt;br&gt;[realms]&lt;br&gt; &nbsp; &nbsp;MYDOMAIN.LOCAL&nbsp;=&nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;kdc&nbsp;=&nbsp;s-dc00.mydomain.local&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;kdc&nbsp;=&nbsp;s-dc01.mydomain.local&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;kdc&nbsp;=&nbsp;s-dc02.mydomain.local&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;admin_server&nbsp;=&nbsp;s-dc00.mydomain.local&lt;br&gt; &nbsp; &nbsp;}&lt;br&gt;&lt;br&gt;[domain_realm]&lt;br&gt; &nbsp; &nbsp;.mydomain.local&nbsp;=&nbsp;MYDOMAIN.LOCAL&lt;br&gt; &nbsp; &nbsp;mydomain.local&nbsp;=&nbsp;MYDOMAIN.LOCAL&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;msktutil&nbsp;-c&nbsp;-b&nbsp;&quot;OU=SERVIDORES&quot;&nbsp;-s&nbsp;HTTP/debian-proxy.mydomain.local&nbsp;-k&nbsp;/opt/squid411/etc/PROXY.keytab&nbsp;--computer-name&nbsp;DEBIAN-PROXY&nbsp;--upn&nbsp;HTTP/debian-proxy.mydomain.local&nbsp;--server&nbsp;s-dc00.mydomain.local&nbsp;--verbose&nbsp;--enctypes&nbsp;28&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;permissions&nbsp;for&nbsp;kaytab&nbsp;file&lt;/div&gt;&lt;div&gt;chgrp&nbsp;proxy&nbsp;/opt/squid411/etc/PROXY.keytab&lt;br&gt;chmod&nbsp;g+r&nbsp;/opt/squid411/etc/PROXY.keytab&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;klist&lt;br&gt;Ticket&nbsp;cache:&nbsp;FILE:/tmp/krb5cc_0&lt;br&gt;Default&nbsp;principal:&nbsp;some.user@MYDOMAIN.LOCAL&lt;br&gt;&lt;br&gt;Valid&nbsp;starting&nbsp; &nbsp; &nbsp; &nbsp;Expires&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Service&nbsp;principal&lt;br&gt;07/23/2020&nbsp;11:59:45&nbsp; 07/23/2020&nbsp;21:59:45&nbsp; krbtgt/MYDOMAIN.LOCAL@MYDOMAIN.LOCAL&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;renew&nbsp;until&nbsp;07/24/2020&nbsp;11:59:40&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;One&nbsp;thing&nbsp;I&nbsp;didn&#39;t&nbsp;quite&nbsp;understand&nbsp;is&nbsp;the&nbsp;procedure&nbsp;to&nbsp;authenticate&nbsp;from&nbsp;HAProxy.&nbsp;According&nbsp;to&nbsp;the&nbsp;documentation&nbsp;I&nbsp;read,&nbsp;I&nbsp;did&nbsp;the&nbsp;following:&lt;/div&gt;&lt;div&gt;&lt;br&gt;I&nbsp;created&nbsp;a&nbsp;DNS&nbsp;A&nbsp;record&nbsp;and&nbsp;its&nbsp;PTR&nbsp;in&nbsp;my&nbsp;DNS&nbsp;server&nbsp;pointing&nbsp;to&nbsp;the&nbsp;virtual&nbsp;IP&nbsp;of&nbsp;the&nbsp;keepalived&nbsp;(10.10.8.213)&nbsp;in&nbsp;the&nbsp;HAProxy. &lt;br&gt;Then&nbsp;I&nbsp;created&nbsp;a&nbsp;&quot;HTTP_inet&quot;&nbsp;user&nbsp;account&nbsp;in&nbsp;Active&nbsp;Directory.&lt;br&gt;Then&nbsp;on&nbsp;my&nbsp;domain&nbsp;controller,&nbsp;in&nbsp;a&nbsp;CMD&nbsp;with&nbsp;administrator&nbsp;permissions,&nbsp;I&nbsp;ran:&lt;br&gt;setspn&nbsp;-S&nbsp;HTTP/inet.mydomain.local&nbsp;HTTP_inet&lt;br&gt;setspn&nbsp;-S&nbsp;HTTP/inet&nbsp;HTTP_inet&nbsp;&lt;br&gt;In&nbsp;both&nbsp;cases&nbsp;the&nbsp;message&nbsp;was:&nbsp;object&nbsp;updated.&lt;br&gt;Then&nbsp;in&nbsp;my&nbsp;SQUID&nbsp;servers,&nbsp;I&nbsp;executed:&lt;br&gt;kinit&nbsp;HTTP_inet@MYDOMAIN.LOCAL&lt;br&gt;It&nbsp;asks&nbsp;for&nbsp;the&nbsp;user&#39;s&nbsp;password.&lt;br&gt;Start&nbsp;the&nbsp;ktutil&nbsp;tool&lt;br&gt;That&#39;s&nbsp;where&nbsp;I&nbsp;write:&lt;br&gt;addent&nbsp;-password&nbsp;-p&nbsp;HTTP/inet.mydomain.local&nbsp;-k&nbsp;2&nbsp;-e&nbsp;rc4-hmac&lt;/div&gt;&lt;div&gt;Ask&nbsp;the&nbsp;user&nbsp;password&lt;br&gt;addent&nbsp;-password&nbsp;-p&nbsp;HTTP/inet&nbsp;-k&nbsp;2&nbsp;-e&nbsp;rc4-hmac&lt;/div&gt;&lt;div&gt;Ask&nbsp;the&nbsp;user&nbsp;password&lt;br&gt;wkt&nbsp;/opt/squid411/etc/PROXY.keytab&lt;br&gt;quit&lt;br&gt;&lt;br&gt;list&nbsp;the&nbsp;keys&nbsp;in&nbsp;keytab:&lt;br&gt;ktutil&lt;br&gt;read_kt&nbsp;/opt/squid411/etc/PROXY.keytab&lt;br&gt; &nbsp; 1&nbsp;1&nbsp;DEBIAN-PROXY$@MYDOMAIN.LOCAL&lt;br&gt; &nbsp; 2&nbsp;1&nbsp;DEBIAN-PROXY$@MYDOMAIN.LOCAL&lt;br&gt; &nbsp; 3&nbsp;1&nbsp;DEBIAN-PROXY$@MYDOMAIN.LOCAL&lt;br&gt; &nbsp; 4&nbsp;1&nbsp;HTTP/debian-proxy.mydomain.local@MYDOMAIN.LOCAL&lt;br&gt; &nbsp; 5&nbsp;1&nbsp;HTTP/debian-proxy.mydomain.local@MYDOMAIN.LOCAL&lt;br&gt; &nbsp; 6&nbsp;1&nbsp;HTTP/debian-proxy.mydomain.local@MYDOMAIN.LOCAL&lt;br&gt; &nbsp; 7&nbsp;1&nbsp;host/DEBIAN-PROXY@MYDOMAIN.LOCAL&lt;br&gt; &nbsp; 8&nbsp;1&nbsp;host/DEBIAN-PROXY@MYDOMAIN.LOCAL&lt;br&gt; &nbsp; 9&nbsp;1&nbsp;host/DEBIAN-PROXY@MYDOMAIN.LOCAL&lt;br&gt; &nbsp;10&nbsp;1&nbsp;host/debian-proxy.mydomain.local@MYDOMAIN.LOCAL&lt;br&gt; &nbsp;11&nbsp;1&nbsp;host/debian-proxy.mydomain.local@MYDOMAIN.LOCAL&lt;br&gt; &nbsp;12&nbsp;1&nbsp;host/debian-proxy.mydomain.local@MYDOMAIN.LOCAL&lt;br&gt; &nbsp;13&nbsp;2&nbsp;HTTP/inet.mydomain.local@MYDOMAIN.LOCAL&lt;br&gt; &nbsp;14&nbsp;2&nbsp;HTTP/inet@MYDOMAIN.LOCAL&lt;br&gt;&lt;br&gt;It&#39;s&nbsp;this&nbsp;last&nbsp;part&nbsp;I&nbsp;understand&nbsp;the&nbsp;least,&nbsp;maybe&nbsp;the&nbsp;mistake&nbsp;is&nbsp;there.&nbsp;Or&nbsp;somewhere&nbsp;else.&lt;br&gt;I&nbsp;appreciate&nbsp;any&nbsp;help&nbsp;you&nbsp;can&nbsp;offer&nbsp;me.&nbsp;&lt;br&gt;&lt;br&gt;Best&nbsp;regards,&lt;br&gt;&lt;br&gt;Gabriel&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
