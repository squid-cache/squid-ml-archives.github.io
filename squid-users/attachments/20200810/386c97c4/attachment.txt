auth_param basic program /usr/lib64/squid/basic_ldap_auth -R -b "dc=my,dc=domain" -D "squid@my.domain" -W /etc/squid/ldappass.txt -f "sAMAccountName=%s" -h sv-102-dc.my.domain

acl SSL_ports port 443
acl Safe_ports port 80		# http
acl Safe_ports port 21		# ftp
acl Safe_ports port 443		# https
acl Safe_ports port 70		# gopher
acl Safe_ports port 210		# wais
acl Safe_ports port 1025-65535	# unregistered ports
acl Safe_ports port 280		# http-mgmt
acl Safe_ports port 488		# gss-http
acl Safe_ports port 591		# filemaker
acl Safe_ports port 777		# multiling http
acl CONNECT method CONNECT


acl our_networks src 10.20.0.0/16

external_acl_type wb_group children-max=50 children-startup=5 ttl=600 %LOGIN /usr/lib64/squid/ext_ldap_group_acl -R -b "dc=my,dc=domain" -D "squid@my.domain" -W /etc/squid/ldappass.txt -F "(sAMAccountName=%s)" -f "(memberof=CN=My_Group,DC=my,dc=domain)" -h sv-102-dc.my.domain

acl Autenticati proxy_auth REQUIRED
acl Abilitati proxy_auth "/etc/squid/abilitati"
acl AbilitatiYoutube proxy_auth "/etc/squid/abilitati_youtube"
acl Autorizzati external wb_group accesso_internet

acl siti_liberi dstdomain .phpunit.de .php.net .ti.ch

acl PC_biblioteca src 10.20.8.1 10.20.8.2 10.20.8.3
acl Youtube_Internet external wb_group youtube_internet
acl Solo_Youtube dstdomain .youtube.com .dailymotion.com .googlevideo.com
acl Proibiti dstdomain .facebook.com .twitter.com .sixapart.com .myspace.com .miniclip.com .miniclipcdn.com .whatsapp.com
deny_info http://%h/errori_squid/siti_proibiti.php?sito=%u Proibiti

acl Proibiti_docenti external wb_group docenti

maximum_object_size  32 MB
cache deny Solo_Youtube
cache deny siti_liberi

http_access deny !Safe_ports

http_access deny CONNECT !SSL_ports

http_access allow siti_liberi
http_access deny !our_networks
http_access deny !Proibiti_docenti Autenticati Proibiti

http_access allow Youtube_Internet Autenticati Solo_Youtube

http_access allow AbilitatiYoutube Abilitati Autenticati Solo_Youtube

http_access deny Autenticati Solo_Youtube

http_access allow Abilitati Autenticati
http_access allow Autorizzati Autenticati
http_access allow PC_biblioteca Autenticati

delay_pools 1
delay_class 1 1
delay_access 1 allow our_networks
delay_parameters 1 6553600/6553000 # 6'553'600 byte/s = 52'428'800 bit/s = 50Mbit/s

cache_mgr myadmin
cachemgr_passwd mypass all
acl managerAdmin src 10.20.18.11
http_access allow localhost manager
http_access allow managerAdmin manager
http_access deny manager

http_access allow localhost

http_access deny all

http_port 10.20.0.2:8080

coredump_dir /var/spool/squid

refresh_pattern ^ftp:		1440	20%	10080
refresh_pattern ^gopher:	1440	0%	1440
refresh_pattern -i (/cgi-bin/|\?) 0	0%	0
refresh_pattern .		0	20%	4320
