<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=Windows-1252&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
Thank&nbsp;you&nbsp;Alex&nbsp;for&nbsp;your&nbsp;patience&nbsp;and&nbsp;clarification.&nbsp;After&nbsp;reading&nbsp;your&nbsp;explanation&nbsp;and&nbsp;based&nbsp;on&nbsp;my&nbsp;limited&nbsp;understanding,&nbsp;I&nbsp;was&nbsp;able&nbsp;to&nbsp;get&nbsp;the&nbsp;following&nbsp;to&nbsp;work:<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;...&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;whitelist&nbsp;ssl::server_name&nbsp;.httpbin.org&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;...&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/div&gt;<br>
&lt;div&gt;http_access&nbsp;allow&nbsp;localnet&nbsp;CONNECT&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/div&gt;<br>
&lt;div&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;/div&gt;<br>
&lt;div&gt;ssl_bump&nbsp;terminate&nbsp;!whitelist&lt;/div&gt;<br>
&lt;div&gt;ssl_bump&nbsp;splice&nbsp;all&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;The&nbsp;above&nbsp;allows&nbsp;access&nbsp;only&nbsp;to&nbsp;httpbin.org&nbsp;and&nbsp;no&nbsp;other&nbsp;domains&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;If&nbsp;I&nbsp;understand&nbsp;correctly,&nbsp;the&nbsp;original&nbsp;issue&nbsp;is&nbsp;that&nbsp;the&nbsp;CONNECT&nbsp;has&nbsp;to&nbsp;be&nbsp;allowed&nbsp;explicitly&nbsp;and&nbsp;it&nbsp;was&nbsp;not&nbsp;(I&nbsp;just&nbsp;had&nbsp;the&nbsp;typical&nbsp;DENY&nbsp;for&nbsp;non&nbsp;SSL&nbsp;ports)&nbsp;and&nbsp;because&nbsp;of&nbsp;this,&nbsp;it&nbsp;was&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;proceed&nbsp;in&nbsp;the&nbsp;SSL&nbsp;bumping&nbsp;path.&nbsp;Is&nbsp;my&nbsp;understanding<br>
&nbsp;correct?&nbsp;Thanks&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;appendonsend&quot;&gt;&lt;/div&gt;<br>
&lt;hr&nbsp;style=&quot;display:inline-block;width:98%&quot;&nbsp;tabindex=&quot;-1&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divRplyFwdMsg&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&nbsp;style=&quot;font-size:11pt&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Tuesday,&nbsp;August&nbsp;25,&nbsp;2020&nbsp;11:24&nbsp;PM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;Mathew&nbsp;Brown&nbsp;&lt;mbrown8918@outlook.com&gt;;&nbsp;squid-users@lists.squid-cache.org&nbsp;&lt;squid-users@lists.squid-cache.org&gt;&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;Strange&nbsp;Squid&nbsp;SSL&nbsp;Interception&nbsp;Behavior&lt;/font&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;BodyFragment&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;On&nbsp;8/24/20&nbsp;9:09&nbsp;PM,&nbsp;Mathew&nbsp;Brown&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Thanks&nbsp;but&nbsp;even&nbsp;with&nbsp;the&nbsp;--no-check-certificate&nbsp;option&nbsp;and&nbsp;using&nbsp;a&nbsp;bump&lt;br&gt;<br>
&gt;&nbsp;instead&nbsp;of&nbsp;splicing,&nbsp;it&nbsp;still&nbsp;fails&nbsp;as&nbsp;shown&nbsp;above&nbsp;unless&nbsp;I&nbsp;add&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;localnet&nbsp;rule.&nbsp;The&nbsp;question&nbsp;is:&nbsp;why&nbsp;does&nbsp;the&nbsp;same&nbsp;ACL&nbsp;line:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;whitelist&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;suddenly&nbsp;work&nbsp;when&nbsp;I&nbsp;add&nbsp;an&nbsp;unrelated&nbsp;ACL&nbsp;line&nbsp;after&nbsp;it?&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;are&nbsp;misinterpreting&nbsp;the&nbsp;outcome&nbsp;of&nbsp;the&nbsp;test.&nbsp;That&nbsp;whitelist&lt;br&gt;<br>
http_access&nbsp;line&nbsp;did&nbsp;not&nbsp;work&nbsp;(well)&nbsp;for&nbsp;fake&nbsp;CONNECTs&nbsp;before&nbsp;and&nbsp;does&lt;br&gt;<br>
not&nbsp;start&nbsp;working&nbsp;(well)&nbsp;after&nbsp;another&nbsp;http_access&nbsp;rule&nbsp;is&nbsp;added.&nbsp;It&nbsp;is&lt;br&gt;<br>
the&nbsp;added&nbsp;rule&nbsp;that&nbsp;&quot;starts&nbsp;working&quot;&nbsp;instead!&lt;br&gt;<br>
&lt;br&gt;<br>
Most&nbsp;ACL-driven&nbsp;directives,&nbsp;including&nbsp;http_access,&nbsp;cannot&nbsp;be&nbsp;correctly&lt;br&gt;<br>
interpreted&nbsp;at&nbsp;single-ACL,&nbsp;single-line,&nbsp;or&nbsp;single-rule&nbsp;scope.&nbsp;You&nbsp;must&lt;br&gt;<br>
consider&nbsp;_all_&nbsp;rules&nbsp;for&nbsp;a&nbsp;given&nbsp;directive&nbsp;to&nbsp;correctly&nbsp;predict&nbsp;the&lt;br&gt;<br>
outcome&nbsp;of&nbsp;that&nbsp;directive&nbsp;evaluation.&nbsp;When&nbsp;you&nbsp;add&nbsp;a&nbsp;rule,&nbsp;the&nbsp;outcome&lt;br&gt;<br>
of&nbsp;the&nbsp;directive&nbsp;evaluation&nbsp;may&nbsp;change&nbsp;if&nbsp;the&nbsp;previous&nbsp;set&nbsp;of&nbsp;rules&nbsp;did&lt;br&gt;<br>
not&nbsp;match&nbsp;and&nbsp;the&nbsp;added&nbsp;rule&nbsp;does&nbsp;match.&nbsp;The&nbsp;latter&nbsp;is&nbsp;exactly&nbsp;what&lt;br&gt;<br>
happens&nbsp;in&nbsp;your&nbsp;&quot;add&nbsp;an&nbsp;unrelated&nbsp;ACL&quot;&nbsp;test&nbsp;case.&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;completeness&nbsp;sake:&nbsp;When&nbsp;no&nbsp;http_access&nbsp;rules&nbsp;match,&nbsp;Squid&nbsp;applies&lt;br&gt;<br>
the&nbsp;action&nbsp;(allow&nbsp;or&nbsp;deny)&nbsp;that&nbsp;is&nbsp;the&nbsp;opposite&nbsp;of&nbsp;the&nbsp;last&nbsp;configured&lt;br&gt;<br>
http_access&nbsp;rule&nbsp;action.&nbsp;If&nbsp;no&nbsp;http_access&nbsp;rules&nbsp;were&nbsp;configured&nbsp;at&nbsp;all,&lt;br&gt;<br>
Squid&nbsp;denies.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;is&nbsp;similar&nbsp;(albeit&nbsp;a&nbsp;bit&nbsp;incomplete)&nbsp;information&nbsp;in&nbsp;the&nbsp;(arguably&lt;br&gt;<br>
misplaced)&nbsp;FAQ&nbsp;section&nbsp;at&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/SquidFaq/SquidAcl#Access_Lists&quot;&gt;https://wiki.squid-cache.org/SquidFaq/SquidAcl#Access_Lists&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;From&nbsp;my&nbsp;understanding,&nbsp;Squid&nbsp;should&nbsp;perform&nbsp;the&nbsp;exact&nbsp;same&nbsp;steps&nbsp;in&nbsp;both&lt;br&gt;<br>
&gt;&nbsp;cases&nbsp;BUT&nbsp;then&nbsp;allow&nbsp;the&nbsp;connection&nbsp;because&nbsp;of&nbsp;the&nbsp;localnet&nbsp;ACL&nbsp;line&lt;br&gt;<br>
&gt;&nbsp;that&nbsp;it&nbsp;sees&nbsp;right&nbsp;before&nbsp;the&nbsp;deny&nbsp;all&nbsp;line,&nbsp;not&nbsp;because&nbsp;it&nbsp;suddenly&nbsp;was&lt;br&gt;<br>
&gt;&nbsp;able&nbsp;to&nbsp;match&nbsp;httpbin.org&nbsp;using&nbsp;a&nbsp;domain&nbsp;compare&nbsp;as&nbsp;shown&nbsp;by&nbsp;the&nbsp;debug&lt;br&gt;<br>
&gt;&nbsp;logs.&nbsp;What&nbsp;am&nbsp;I&nbsp;missing?&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;may&nbsp;also&nbsp;be&nbsp;missing&nbsp;the&nbsp;fact&nbsp;that&nbsp;http_access&nbsp;directive&nbsp;is&nbsp;applied&lt;br&gt;<br>
several&nbsp;times&nbsp;for&nbsp;one&nbsp;wget&nbsp;execution,&nbsp;once&nbsp;at&nbsp;every&nbsp;SslBump&nbsp;step.&nbsp;The&lt;br&gt;<br>
information&nbsp;available&nbsp;to&nbsp;Squid&nbsp;at&nbsp;each&nbsp;SslBump&nbsp;step&nbsp;differs.&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/SslPeekAndSplice&quot;&gt;https://wiki.squid-cache.org/Features/SslPeekAndSplice&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Domain-based&nbsp;ACL&nbsp;matches&nbsp;you&nbsp;see&nbsp;in&nbsp;the&nbsp;second&nbsp;test&nbsp;log&nbsp;probably&nbsp;do&nbsp;not&lt;br&gt;<br>
exist&nbsp;in&nbsp;the&nbsp;first&nbsp;test&nbsp;because&nbsp;Squid&nbsp;does&nbsp;not&nbsp;get&nbsp;far&nbsp;enough&nbsp;during&nbsp;the&lt;br&gt;<br>
first&nbsp;test&nbsp;--&nbsp;Squid&nbsp;denies&nbsp;the&nbsp;fake&nbsp;CONNECT&nbsp;(and&nbsp;bumps&nbsp;the&nbsp;connection)&lt;br&gt;<br>
at&nbsp;step1,&nbsp;when&nbsp;no&nbsp;domain&nbsp;information&nbsp;is&nbsp;available&nbsp;yet.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;------------------------------------------------------------------------&lt;br&gt;<br>
&gt;&nbsp;*From:*&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;&lt;br&gt;<br>
&gt;&nbsp;*Sent:*&nbsp;Tuesday,&nbsp;August&nbsp;25,&nbsp;2020&nbsp;8:41&nbsp;AM&lt;br&gt;<br>
&gt;&nbsp;*To:*&nbsp;Mathew&nbsp;Brown&nbsp;&lt;mbrown8918@outlook.com&gt;;&lt;br&gt;<br>
&gt;&nbsp;squid-users@lists.squid-cache.org&nbsp;&lt;squid-users@lists.squid-cache.org&gt;&lt;br&gt;<br>
&gt;&nbsp;*Subject:*&nbsp;Re:&nbsp;[squid-users]&nbsp;Strange&nbsp;Squid&nbsp;SSL&nbsp;Interception&nbsp;Behavior&lt;br&gt;<br>
&gt;&nbsp;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;8/24/20&nbsp;6:21&nbsp;PM,&nbsp;Mathew&nbsp;Brown&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;whitelist&nbsp;ssl::server_name&nbsp;.httpbin.org&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;whitelist_http&nbsp;ssl::server_name&nbsp;.httpbin.org&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
&gt;&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;whitelist&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;whitelist_http&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;rules&nbsp;above&nbsp;only&nbsp;allow&nbsp;CONNECT&nbsp;requests&nbsp;to&nbsp;.httpbin.org&nbsp;domains.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;During&nbsp;step1,&nbsp;when&nbsp;Squid&nbsp;intercepts&nbsp;a&nbsp;TLS&nbsp;connection&nbsp;to&nbsp;an&nbsp;IP&nbsp;address&nbsp;of&lt;br&gt;<br>
&gt;&nbsp;an&nbsp;.httpbin.org&nbsp;domain,&nbsp;Squid&nbsp;http_access&nbsp;rules&nbsp;are&nbsp;applied&nbsp;to&nbsp;a&nbsp;(fake)&lt;br&gt;<br>
&gt;&nbsp;CONNECT&nbsp;request&nbsp;to&nbsp;the&nbsp;destination&nbsp;IP&nbsp;address.&nbsp;There&nbsp;are&nbsp;no&nbsp;domain&nbsp;names&lt;br&gt;<br>
&gt;&nbsp;at&nbsp;that&nbsp;TCP-level&nbsp;bumping&nbsp;stage.&nbsp;Thus,&nbsp;you&nbsp;place&nbsp;your&nbsp;Squid&nbsp;at&nbsp;the&nbsp;mercy&lt;br&gt;<br>
&gt;&nbsp;of&nbsp;reverse&nbsp;DSN&nbsp;lookups.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;In&nbsp;my&nbsp;environment,&nbsp;reverse&nbsp;DNS&nbsp;does&nbsp;not&nbsp;work&nbsp;for&nbsp;httpbin.org&nbsp;the&nbsp;way&nbsp;you&lt;br&gt;<br>
&gt;&nbsp;may&nbsp;expect:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;$&nbsp;host&nbsp;54.236.246.173&lt;br&gt;<br>
&gt;&gt;&nbsp;173.246.236.54.in-addr.arpa&nbsp;domain&nbsp;name&nbsp;pointer&nbsp;ec2-54-236-246-173.compute-1.amazonaws.com.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;above&nbsp;AWS&nbsp;domain&nbsp;name&nbsp;does&nbsp;not&nbsp;match&nbsp;your&nbsp;whitelist&nbsp;ACLs,&nbsp;of&nbsp;course,&lt;br&gt;<br>
&gt;&nbsp;and,&nbsp;hence,&nbsp;the&nbsp;fake&nbsp;CONNECT&nbsp;request&nbsp;is&nbsp;denied.&nbsp;Denied&nbsp;requests&nbsp;are&lt;br&gt;<br>
&gt;&nbsp;bumped&nbsp;to&nbsp;deliver&nbsp;the&nbsp;error&nbsp;message.&nbsp;Bumped&nbsp;requests&nbsp;require&lt;br&gt;<br>
&gt;&nbsp;--no-check-certificate&nbsp;or&nbsp;other&nbsp;means&nbsp;of&nbsp;trusting&nbsp;Squid's&nbsp;CA&nbsp;certificate.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;If&nbsp;you&nbsp;cannot&nbsp;explicitly&nbsp;allow&nbsp;CONNECT&nbsp;requests&nbsp;to&nbsp;httpbin.org&nbsp;IP&lt;br&gt;<br>
&gt;&nbsp;addresses&nbsp;(e.g.,&nbsp;because&nbsp;they&nbsp;change&nbsp;too&nbsp;often),&nbsp;then&nbsp;consider&nbsp;allowing&lt;br&gt;<br>
&gt;&nbsp;CONNECT&nbsp;to&nbsp;safe&nbsp;ports&nbsp;at&nbsp;any&nbsp;address&nbsp;at&nbsp;step1.&nbsp;If&nbsp;you&nbsp;only&nbsp;intercept&lt;br&gt;<br>
&gt;&nbsp;connections&nbsp;to&nbsp;httpbin.org&nbsp;IPs,&nbsp;then&nbsp;you&nbsp;can&nbsp;probably&nbsp;relax&nbsp;your&nbsp;step1&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;rules&nbsp;to&nbsp;allow&nbsp;all&nbsp;CONNECTs&nbsp;(to&nbsp;safe&nbsp;addresses).&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;There&nbsp;are&nbsp;many&nbsp;similar&nbsp;questions&nbsp;about&nbsp;allowing&nbsp;CONNECT&nbsp;to&nbsp;IP&nbsp;addresses&lt;br&gt;<br>
&gt;&nbsp;on&nbsp;this&nbsp;mailing&nbsp;list.&nbsp;You&nbsp;may&nbsp;be&nbsp;able&nbsp;to&nbsp;find&nbsp;more&nbsp;detailed&nbsp;advice&nbsp;or&lt;br&gt;<br>
&gt;&nbsp;instructions&nbsp;by&nbsp;searching&nbsp;for&nbsp;those&nbsp;mailing&nbsp;list&nbsp;threads.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;HTH,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Alex.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;$&nbsp;wget&nbsp;&lt;a&nbsp;href=&quot;https://httpbin.org&quot;&gt;https://httpbin.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;--2020-08-24&nbsp;17:48:34--&nbsp;&nbsp;&lt;a&nbsp;href=&quot;https://httpbin.org/&quot;&gt;https://httpbin.org/&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Resolving&nbsp;httpbin.org&nbsp;(httpbin.org)...&nbsp;54.236.246.173,&nbsp;3.220.112.94&lt;br&gt;<br>
&gt;&gt;&nbsp;Connecting&nbsp;to&nbsp;httpbin.org&nbsp;(httpbin.org)|54.236.246.173|:443...&nbsp;connected.&lt;br&gt;<br>
&gt;&gt;&nbsp;ERROR:&nbsp;cannot&nbsp;verify&nbsp;httpbin.org's&nbsp;certificate,&nbsp;issued&nbsp;by&nbsp;‘O=Internet&lt;br&gt;<br>
&gt;&gt;&nbsp;Widgits&nbsp;Pty&nbsp;Ltd,ST=Some-State,C=AU’:&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;Self-signed&nbsp;certificate&nbsp;encountered.&lt;br&gt;<br>
&gt;&gt;&nbsp;To&nbsp;connect&nbsp;to&nbsp;httpbin.org&nbsp;insecurely,&nbsp;use&nbsp;`--no-check-certificate'.&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;$&nbsp;wget&nbsp;&lt;a&nbsp;href=&quot;https://httpbin.org&quot;&gt;https://httpbin.org&lt;/a&gt;&nbsp;--no-check-certificate&lt;br&gt;<br>
&gt;&gt;&nbsp;--2020-08-24&nbsp;17:48:40--&nbsp;&nbsp;&lt;a&nbsp;href=&quot;https://httpbin.org/&quot;&gt;https://httpbin.org/&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Resolving&nbsp;httpbin.org&nbsp;(httpbin.org)...&nbsp;3.220.112.94,&nbsp;54.236.246.173&lt;br&gt;<br>
&gt;&gt;&nbsp;Connecting&nbsp;to&nbsp;httpbin.org&nbsp;(httpbin.org)|3.220.112.94|:443...&nbsp;connected.&lt;br&gt;<br>
&gt;&gt;&nbsp;WARNING:&nbsp;cannot&nbsp;verify&nbsp;httpbin.org's&nbsp;certificate,&nbsp;issued&nbsp;by&nbsp;‘O=Internet&lt;br&gt;<br>
&gt;&gt;&nbsp;Widgits&nbsp;Pty&nbsp;Ltd,ST=Some-State,C=AU’:&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;Self-signed&nbsp;certificate&nbsp;encountered.&lt;br&gt;<br>
&gt;&gt;&nbsp;HTTP&nbsp;request&nbsp;sent,&nbsp;awaiting&nbsp;response...&nbsp;403&nbsp;Forbidden&lt;br&gt;<br>
&gt;&gt;&nbsp;2020-08-24&nbsp;17:48:40&nbsp;ERROR&nbsp;403:&nbsp;Forbidden.&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;looking&nbsp;at&nbsp;access.log&nbsp;shows:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;1598305800.974&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;192.168.123.214&nbsp;TCP_DENIED/200&nbsp;0&nbsp;CONNECT&lt;br&gt;<br>
&gt;&gt;&nbsp;54.236.246.173:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;for&nbsp;the&nbsp;first&nbsp;request&nbsp;(without&nbsp;the&nbsp;--no-check-certificate)&nbsp;and&nbsp;the&lt;br&gt;<br>
&gt;&gt;&nbsp;following&nbsp;for&nbsp;the&nbsp;2nd&nbsp;request&nbsp;(with&nbsp;the&nbsp;--no-check-certificate):&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;1598305812.292&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;192.168.123.214&nbsp;TCP_DENIED/200&nbsp;0&nbsp;CONNECT&lt;br&gt;<br>
&gt;&gt;&nbsp;54.236.246.173:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;br&gt;<br>
&gt;&gt;&nbsp;1598305812.300&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;192.168.123.214&nbsp;NONE/403&nbsp;3795&nbsp;GET&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;https://httpbin.org/&quot;&gt;https://httpbin.org/&lt;/a&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;looking&nbsp;at&nbsp;cache.log&nbsp;shows:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;#&nbsp;cat&nbsp;/var/log/squid/cache.log&nbsp;&nbsp;|&nbsp;grep&nbsp;-i&nbsp;&quot;28&quot;&nbsp;|&nbsp;grep&nbsp;-i&nbsp;httpbin&lt;br&gt;<br>
&gt;&gt;&nbsp;2020/08/24&nbsp;17:50:00.972&nbsp;kid1|&nbsp;28,7|&nbsp;ServerName.cc(32)&lt;br&gt;<br>
&gt;&gt;&nbsp;aclHostDomainCompare:&nbsp;Match:54.236.246.173&nbsp;&lt;&gt;&nbsp;&nbsp;.httpbin.org&lt;br&gt;<br>
&gt;&gt;&nbsp;2020/08/24&nbsp;17:50:00.972&nbsp;kid1|&nbsp;28,7|&nbsp;ServerName.cc(32)&lt;br&gt;<br>
&gt;&gt;&nbsp;aclHostDomainCompare:&nbsp;Match:54.236.246.173&nbsp;&lt;&gt;&nbsp;&nbsp;.httpbin.org&lt;br&gt;<br>
&gt;&gt;&nbsp;2020/08/24&nbsp;17:50:12.290&nbsp;kid1|&nbsp;28,7|&nbsp;ServerName.cc(32)&lt;br&gt;<br>
&gt;&gt;&nbsp;aclHostDomainCompare:&nbsp;Match:54.236.246.173&nbsp;&lt;&gt;&nbsp;&nbsp;.httpbin.org&lt;br&gt;<br>
&gt;&gt;&nbsp;2020/08/24&nbsp;17:50:12.290&nbsp;kid1|&nbsp;28,7|&nbsp;ServerName.cc(32)&lt;br&gt;<br>
&gt;&gt;&nbsp;aclHostDomainCompare:&nbsp;Match:54.236.246.173&nbsp;&lt;&gt;&nbsp;&nbsp;.httpbin.org&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;so&nbsp;it&nbsp;never&nbsp;matches&nbsp;on&nbsp;the&nbsp;httpbin.org&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;now,&nbsp;if&nbsp;I&nbsp;add&nbsp;the&nbsp;following&nbsp;line&nbsp;to&nbsp;my&nbsp;configuration:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;right&nbsp;before&nbsp;the:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;line&nbsp;it&nbsp;works&nbsp;and&nbsp;I&nbsp;see&nbsp;the&nbsp;following&nbsp;in&nbsp;access.log:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;1598305979.004&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;192.168.123.214&nbsp;NONE/200&nbsp;0&nbsp;CONNECT&lt;br&gt;<br>
&gt;&gt;&nbsp;54.236.246.173:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;br&gt;<br>
&gt;&gt;&nbsp;1598305980.016&nbsp;&nbsp;&nbsp;1012&nbsp;192.168.123.214&nbsp;TCP_TUNNEL/200&nbsp;15370&nbsp;CONNECT&lt;br&gt;<br>
&gt;&gt;&nbsp;httpbin.org:443&nbsp;-&nbsp;ORIGINAL_DST/54.236.246.173&nbsp;-&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;and&nbsp;I&nbsp;see&nbsp;the&nbsp;following&nbsp;in&nbsp;cache.log:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;#&nbsp;cat&nbsp;/var/log/squid/cache.log&nbsp;&nbsp;|&nbsp;grep&nbsp;-i&nbsp;&quot;28&quot;&nbsp;|&nbsp;grep&nbsp;-i&nbsp;httpbin&lt;br&gt;<br>
&gt;&gt;&nbsp;2020/08/24&nbsp;17:52:59.000&nbsp;kid1|&nbsp;28,7|&nbsp;ServerName.cc(32)&lt;br&gt;<br>
&gt;&gt;&nbsp;aclHostDomainCompare:&nbsp;Match:54.236.246.173&nbsp;&lt;&gt;&nbsp;&nbsp;.httpbin.org&lt;br&gt;<br>
&gt;&gt;&nbsp;2020/08/24&nbsp;17:52:59.000&nbsp;kid1|&nbsp;28,7|&nbsp;ServerName.cc(32)&lt;br&gt;<br>
&gt;&gt;&nbsp;aclHostDomainCompare:&nbsp;Match:54.236.246.173&nbsp;&lt;&gt;&nbsp;&nbsp;.httpbin.org&lt;br&gt;<br>
&gt;&gt;&nbsp;2020/08/24&nbsp;17:52:59.005&nbsp;kid1|&nbsp;28,3|&nbsp;RegexData.cc(43)&nbsp;match:&nbsp;checking&lt;br&gt;<br>
&gt;&gt;&nbsp;'httpbin.org:443'&lt;br&gt;<br>
&gt;&gt;&nbsp;2020/08/24&nbsp;17:52:59.005&nbsp;kid1|&nbsp;28,3|&nbsp;ServerName.cc(42)&nbsp;match:&nbsp;checking&lt;br&gt;<br>
&gt;&gt;&nbsp;'httpbin.org'&lt;br&gt;<br>
&gt;&gt;&nbsp;2020/08/24&nbsp;17:52:59.005&nbsp;kid1|&nbsp;28,7|&nbsp;ServerName.cc(32)&lt;br&gt;<br>
&gt;&gt;&nbsp;aclHostDomainCompare:&nbsp;Match:httpbin.org&nbsp;&lt;&gt;&nbsp;&nbsp;.httpbin.org&lt;br&gt;<br>
&gt;&gt;&nbsp;2020/08/24&nbsp;17:52:59.005&nbsp;kid1|&nbsp;28,3|&nbsp;ServerName.cc(47)&nbsp;match:&lt;br&gt;<br>
&gt;&gt;&nbsp;'httpbin.org'&nbsp;found&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;What's&nbsp;puzzling&nbsp;is&nbsp;why&nbsp;adding&nbsp;the&nbsp;'allow&nbsp;localnet'&nbsp;line&nbsp;changes&nbsp;the&nbsp;ACL&lt;br&gt;<br>
&gt;&gt;&nbsp;logic&nbsp;for&nbsp;.httpbin.org&nbsp;and&nbsp;why&nbsp;the&nbsp;original&nbsp;configuration&nbsp;does&nbsp;not&nbsp;work.&lt;br&gt;<br>
&gt;&gt;&nbsp;Any&nbsp;ideas?&nbsp;Thanks&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;PS.&nbsp;I&nbsp;reproduced&nbsp;the&nbsp;exact&nbsp;same&nbsp;scenario&nbsp;on&nbsp;Ubuntu&nbsp;20.04&nbsp;with&nbsp;Squid&nbsp;4.12&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&gt;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
