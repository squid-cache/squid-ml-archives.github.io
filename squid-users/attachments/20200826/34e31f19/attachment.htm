<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
Thanks&nbsp;Alex&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;id=&quot;appendonsend&quot;&gt;&lt;/div&gt;<br>
&lt;hr&nbsp;style=&quot;display:inline-block;width:98%&quot;&nbsp;tabindex=&quot;-1&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divRplyFwdMsg&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&nbsp;style=&quot;font-size:11pt&quot;&nbsp;color=&quot;#000000&quot;&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;&lt;br&gt;<br>
&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Wednesday,&nbsp;August&nbsp;26,&nbsp;2020&nbsp;11:54&nbsp;PM&lt;br&gt;<br>
&lt;b&gt;To:&lt;/b&gt;&nbsp;Mathew&nbsp;Brown&nbsp;&lt;mbrown8918@outlook.com&gt;;&nbsp;squid-users@lists.squid-cache.org&nbsp;&lt;squid-users@lists.squid-cache.org&gt;&lt;br&gt;<br>
&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;Strange&nbsp;Squid&nbsp;SSL&nbsp;Interception&nbsp;Behavior&lt;/font&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;BodyFragment&quot;&gt;&lt;font&nbsp;size=&quot;2&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;PlainText&quot;&gt;On&nbsp;8/26/20&nbsp;9:13&nbsp;AM,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;26/08/20&nbsp;11:03&nbsp;pm,&nbsp;Mathew&nbsp;Brown&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&nbsp;Thank&nbsp;you&nbsp;Alex&nbsp;+&nbsp;Amos&nbsp;:)&nbsp;You've&nbsp;really&nbsp;helped&nbsp;clarify&nbsp;things.&nbsp;I&nbsp;had&nbsp;a&lt;br&gt;<br>
&gt;&gt;&nbsp;final&nbsp;question&nbsp;regarding&nbsp;this&nbsp;setup.&nbsp;Does&nbsp;this&nbsp;configuration&nbsp;only&nbsp;look&lt;br&gt;<br>
&gt;&gt;&nbsp;at&nbsp;the&nbsp;client&nbsp;side&nbsp;part&nbsp;of&nbsp;the&nbsp;SNI&nbsp;request&nbsp;or&nbsp;also&nbsp;the&nbsp;server&lt;br&gt;<br>
&gt;&gt;&nbsp;certificate.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;whitelist&nbsp;ssl::server_name&nbsp;.httpbin.org&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;localnet&nbsp;CONNECT&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
&gt;&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;whitelist&lt;br&gt;<br>
&gt;&gt;&nbsp;ssl_bump&nbsp;terminate&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;above&nbsp;ssl_bump&nbsp;configuration&nbsp;ignores&nbsp;the&nbsp;TCP&nbsp;client&nbsp;information&lt;br&gt;<br>
(during&nbsp;step1)&nbsp;and&nbsp;looks&nbsp;at&nbsp;TLS&nbsp;client&nbsp;information&nbsp;(during&nbsp;the&nbsp;next&nbsp;step&lt;br&gt;<br>
--&nbsp;step2).&nbsp;With&nbsp;this&nbsp;configuration,&nbsp;Squid&nbsp;will&nbsp;not&nbsp;see&nbsp;the&nbsp;server&lt;br&gt;<br>
certificate&nbsp;at&nbsp;all.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&nbsp;If&nbsp;it&nbsp;only&nbsp;looks&nbsp;at&nbsp;the&nbsp;client-side,&nbsp;how&nbsp;would&nbsp;I&nbsp;tell&nbsp;it&nbsp;to&lt;br&gt;<br>
&gt;&gt;&nbsp;look&nbsp;at&nbsp;the&nbsp;server&nbsp;response&nbsp;as&nbsp;well?&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;want&nbsp;Squid&nbsp;to&nbsp;consider&nbsp;the&nbsp;server&nbsp;certificate&nbsp;as&nbsp;well&nbsp;(during&lt;br&gt;<br>
step3),&nbsp;replace&nbsp;&quot;step1&quot;&nbsp;with&nbsp;&quot;all&quot;.&nbsp;See&nbsp;ssl::server_name&nbsp;ACL&nbsp;for&nbsp;the&lt;br&gt;<br>
documentation&nbsp;of&nbsp;what&nbsp;&quot;as&nbsp;well&quot;&nbsp;really&nbsp;means&nbsp;in&nbsp;this&nbsp;context.&nbsp;Its&lt;br&gt;<br>
complicated.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;process&nbsp;is&nbsp;all&nbsp;described&nbsp;at&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/SslPeekAndSplice&quot;&gt;https://wiki.squid-cache.org/Features/SslPeekAndSplice&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Yes,&nbsp;and&nbsp;also&nbsp;see&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;ssl::server_name&nbsp;ACL.&nbsp;In&lt;br&gt;<br>
modern&nbsp;Squids,&nbsp;you&nbsp;can&nbsp;control&nbsp;what&nbsp;information&nbsp;that&nbsp;ACL&nbsp;is&nbsp;using.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
BTW,&nbsp;I&nbsp;just&nbsp;realized&nbsp;that&nbsp;my&nbsp;earlier&nbsp;statements&nbsp;about&nbsp;reverse&nbsp;DNS&lt;br&gt;<br>
lookups&nbsp;were&nbsp;misleading:&nbsp;The&nbsp;ssl::server_name&nbsp;ACL&nbsp;does&nbsp;not&nbsp;do&nbsp;any&nbsp;DNS&lt;br&gt;<br>
lookups.&nbsp;When&nbsp;given&nbsp;an&nbsp;unresolved&nbsp;IP&nbsp;address,&nbsp;that&nbsp;ACL&nbsp;will&nbsp;usually&lt;br&gt;<br>
mismatch&nbsp;.httpbin.org&nbsp;(regardless&nbsp;of&nbsp;whether&nbsp;the&nbsp;reverse&nbsp;lookup&nbsp;would&lt;br&gt;<br>
have&nbsp;returned&nbsp;a&nbsp;matching&nbsp;domain&nbsp;name).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
