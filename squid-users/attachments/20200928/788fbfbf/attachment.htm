<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;located&nbsp;the&nbsp;bug&nbsp;and&nbsp;found&nbsp;a&nbsp;another&nbsp;way&nbsp;to&nbsp;deal&nbsp;with&nbsp;it.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;The&nbsp;bug&nbsp;is&nbsp;that&nbsp;cache_peer&nbsp;https&nbsp;CONNECT&nbsp;drops&nbsp;the&nbsp;port&nbsp;number&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;If&nbsp;you&nbsp;do&nbsp;the&nbsp;compatibility&nbsp;treatment&nbsp;on&nbsp;the&nbsp;back&nbsp;of&nbsp;the&nbsp;agent&nbsp;software,&nbsp;you&nbsp;can&nbsp;solve&nbsp;this&nbsp;problem&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;However,&nbsp;it&nbsp;would&nbsp;be&nbsp;best&nbsp;if&nbsp;it&nbsp;was&nbsp;resolved&nbsp;on&nbsp;squid.&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;0x01&nbsp;wireshare&nbsp;packet&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1)&nbsp;squid cache_peer&nbsp;https&nbsp;CONNECT&nbsp;packet.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
<br>
<br>
<br>
<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;CONNECT&nbsp;d.qqq.win &nbsp;HTTP/1.1&nbsp;(bad&nbsp;format:&nbsp;without&nbsp;port)&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;0040&lt;/span&gt;&nbsp; &nbsp;d1&nbsp;d8&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;43&lt;/span&gt;&nbsp;4f&nbsp;4e&nbsp;4e&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;45&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;43&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;54&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;20&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;64&lt;/span&gt;&nbsp;2e&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;71&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;71&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;71&lt;/span&gt;&nbsp;2e&nbsp; &nbsp;..CONNECT&nbsp;d.qqq.&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;0050&lt;/span&gt;&nbsp; &nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;77&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;69&lt;/span&gt;&nbsp;6e&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;20&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;48&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;54&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;54&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;50&lt;/span&gt;&nbsp;2f&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;31&lt;/span&gt;&nbsp;2e&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;31&lt;/span&gt;&nbsp;0d&nbsp;0a&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;55&lt;/span&gt;&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;73&lt;/span&gt;&nbsp; &nbsp;win&nbsp;HTTP/1.1&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2)&nbsp;glider&nbsp;verbose&nbsp;log&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
<br>
<br>
<br>
<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;2020&lt;/span&gt;/09/28&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;17&lt;/span&gt;:19:58&nbsp;forward.go:118:&nbsp;[forwarder]&nbsp;DIRECT&nbsp;recorded&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;1&lt;/span&gt;&nbsp;failures,&nbsp;maxfailures:&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;0&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-p1&quot;&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;2020&lt;/span&gt;/09/28&nbsp;&lt;span&nbsp;class=&quot;gmail-s1&quot;&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;17&lt;/span&gt;:19:58&nbsp;server.go:98:&nbsp;[http]&nbsp;*.*.*.*:53848&nbsp;&lt;-&gt;&nbsp;d.qqq.win&nbsp;[c]&nbsp;via&nbsp;DIRECT,&nbsp;error&nbsp;in&nbsp;dial:&nbsp;dial&nbsp;tcp:&nbsp;address&nbsp;d.qqq.win:&nbsp;missing&nbsp;port&nbsp;in&nbsp;address&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;0x02&nbsp;solution&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Locate&nbsp;the&nbsp;cache_peer&nbsp;code&nbsp;in&nbsp;squid&nbsp;and&nbsp;add&nbsp;the&nbsp;missing&nbsp;port&nbsp;to&nbsp;the&nbsp;CONNETCT&nbsp;function.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;or,&nbsp;you&nbsp;can&nbsp;do&nbsp;the&nbsp;compatibility&nbsp;treatment&nbsp;on&nbsp;the&nbsp;background&nbsp;proxy&nbsp;soft&nbsp;(bad&nbsp;idea)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;openwrt&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:openwrt.jp@gmail.com&quot;&gt;openwrt.jp@gmail.com&lt;/a&gt;&gt;&nbsp;于2020年9月28日周一&nbsp;下午1:41写道：&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Yes,&nbsp;I&#39;ve&nbsp;tried&nbsp;all&nbsp;of&nbsp;these&nbsp;combinations.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;###&nbsp;0x00 &lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;cache_peer&nbsp;no&nbsp;ssl&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;ssl_bump&nbsp;allow&nbsp;all&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;br&gt;&gt;&nbsp;cache_peer 127.0.0.1&nbsp;parent 3129 0&nbsp;【no&nbsp;ssl】&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;curl &lt;/span&gt;&lt;a&nbsp;href=&quot;https://google.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://google.com&lt;/a&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt; -x&nbsp;http://admin:squid@localhost:3&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;128&nbsp;-v &nbsp;-k &nbsp; 【it&nbsp;is&nbsp;ok】&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;div&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;curl &lt;/span&gt;&lt;a&nbsp;href=&quot;https://google.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://google.com&lt;/a&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt; -x&nbsp;https://admin:squid@localhost:3&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;128&nbsp;-v &nbsp;-k &nbsp; 【Get&nbsp;502】&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;div&gt;&lt;span&gt;&lt;div&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;curl &lt;/span&gt;&lt;a&nbsp;href=&quot;https://google.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://google.com&lt;/a&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt; -x&nbsp;http://admin:squid@localhost:3&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;128&nbsp;-v &nbsp;-k &nbsp; &nbsp; 【Get&nbsp;502】&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;&nbsp;HTTP/1.1&nbsp;502&nbsp;Bad&nbsp;Gateway&lt;br&gt;&lt;&nbsp;X-Cache:&nbsp;MISS&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;http://example.com&quot;&nbsp;target=&quot;_blank&quot;&gt;example.com&lt;/a&gt;&lt;br&gt;&lt;&nbsp;Transfer-Encoding:&nbsp;chunked&lt;br&gt;&lt;&nbsp;Connection:&nbsp;keep-alive&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;log&nbsp;json:&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;<br>
<br>
<br>
<br>
<br>
<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(181,189,104);background-color:rgb(28,31,33)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;{&nbsp;&lt;/span&gt;&quot;clientip&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;127.0.0.1&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;ident&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;-&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;uname&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;admin&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;timestamp&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;2020-09-28T04:16:28+0000&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;verb&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;CONNECT&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;request&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;&lt;a&nbsp;href=&quot;http://google.com:443&quot;&nbsp;target=&quot;_blank&quot;&gt;google.com:443&lt;/a&gt;&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;httpversion&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;HTTP/1.1&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;response&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;200&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;bytes&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;0&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;referer&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;-&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;agent&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;curl/7.47.0&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;request_status&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;HIER_NONE&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;hierarchy_status&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;HIER_NONE&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;&nbsp;}&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(181,189,104);background-color:rgb(28,31,33)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;{&nbsp;&lt;/span&gt;&quot;clientip&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;127.0.0.1&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;ident&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;-&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;uname&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;admin&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;timestamp&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;2020-09-28T04:16:28+0000&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;verb&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;GET&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;request&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;&lt;a&nbsp;href=&quot;https://google.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://google.com/&lt;/a&gt;&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;httpversion&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;HTTP/1.1&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;response&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;502&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;bytes&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;117&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;referer&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;-&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;agent&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;curl/7.47.0&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;request_status&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;HIER_NONE&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;,&nbsp;&lt;/span&gt;&quot;hierarchy_status&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;:&nbsp;&lt;/span&gt;&quot;HIER_NONE&quot;&lt;span&nbsp;style=&quot;color:rgb(197,200,198)&quot;&gt;&nbsp;}&lt;/span&gt;&lt;/p&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;###&nbsp;0x01 &lt;/span&gt;&lt;/span&gt;cache_peer&nbsp;with&nbsp;ssl&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;div&gt;&gt;&nbsp;ssl_bump&nbsp;allow&nbsp;all&lt;span&gt;&lt;br&gt;&gt;&nbsp;cache_peer 127.0.0.1&nbsp;parent 3129 0 &nbsp;ssk&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;curl &lt;/span&gt;&lt;a&nbsp;href=&quot;https://google.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://google.com&lt;/a&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt; -x&nbsp;http://admin:squid@localhost:3&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;128&nbsp;-v &nbsp;-k &nbsp; 【&lt;/span&gt;Get&nbsp;502&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;】&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;div&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;curl &lt;/span&gt;&lt;a&nbsp;href=&quot;https://google.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://google.com&lt;/a&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt; -x&nbsp;https://admin:squid@localhost:3&lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;128&nbsp;-v &nbsp;-k &nbsp; 【Get&nbsp;502】&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;<br>
<br>
<br>
<br>
<br>
<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;&nbsp;HTTP/1.1&nbsp;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;503&lt;/span&gt;&nbsp;Service&nbsp;Unavailable&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;&nbsp;Server:&nbsp;squid/5.0.4&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;&nbsp;Mime-Version:&nbsp;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;1&lt;/span&gt;.0&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;&nbsp;Date:&nbsp;Mon,&nbsp;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;28&lt;/span&gt;&nbsp;Sep&nbsp;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;2020&lt;/span&gt;&nbsp;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;04&lt;/span&gt;:21:00&nbsp;GMT&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;&nbsp;Content-Type:&nbsp;text/html;&lt;span&nbsp;style=&quot;color:rgb(204,102,102)&quot;&gt;charset&lt;/span&gt;=utf-8&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;&nbsp;Content-Length:&nbsp;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;1649&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;&nbsp;X-Squid-Error:&nbsp;ERR_SECURE_CONNECT_FAIL&nbsp;&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;71&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33);min-height:14px&quot;&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;p&gt;The&nbsp;system&nbsp;returned:&lt;/p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;blockquote&nbsp;&lt;span&nbsp;style=&quot;color:rgb(204,102,102)&quot;&gt;id&lt;/span&gt;=&lt;span&nbsp;style=&quot;color:rgb(181,189,104)&quot;&gt;&quot;data&quot;&lt;/span&gt;&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;pre&gt;(&lt;span&nbsp;style=&quot;color:rgb(222,147,95)&quot;&gt;71&lt;/span&gt;)&nbsp;Protocol&nbsp;error&nbsp;(TLS&nbsp;code:&nbsp;SQUID_ERR_SSL_HANDSHAKE)&lt;/pre&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;p&gt;Handshake&nbsp;with&nbsp;SSL&nbsp;server&nbsp;failed:&nbsp;[No&nbsp;Error]&lt;/p&gt;&lt;/p&gt;<br>
&lt;p&nbsp;style=&quot;margin:0px;font-variant-numeric:normal;font-variant-east-asian:normal;font-stretch:normal;font-size:12px;line-height:normal;font-family:Menlo;color:rgb(197,200,198);background-color:rgb(28,31,33)&quot;&gt;&lt;/blockquote&gt;&lt;/p&gt;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;###&nbsp;0x02&nbsp;how&nbsp;to&nbsp;outgoing&nbsp;https&nbsp;request&nbsp;by &lt;/span&gt;&lt;/span&gt;cache_peer&nbsp;(on&nbsp;squid&nbsp;5.0.4/Chains&nbsp;proxy)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Similar&nbsp;features&nbsp;to&nbsp;Charles&nbsp;OR &lt;span&nbsp;style=&quot;color:rgb(77,81,86);font-family:arial,sans-serif;font-size:14px&quot;&gt;Fiddler.&nbsp;(&nbsp;open&nbsp;http(s)&nbsp;proxy &nbsp;on&nbsp;8080,&nbsp;then&nbsp;capture&nbsp;the&nbsp;request&nbsp;,&nbsp;outgoing&nbsp;on&nbsp;another&nbsp;http(s)/socks4/5&nbsp;proxy.)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(77,81,86);font-family:arial,sans-serif;font-size:14px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(77,81,86);font-family:arial,sans-serif;font-size:14px&quot;&gt;1. &lt;/span&gt;Fiddler&nbsp;gateway: &lt;a&nbsp;href=&quot;https://docs.telerik.com/fiddler-everywhere/user-guide/settings/gateway&quot;&nbsp;target=&quot;_blank&quot;&gt;https://docs.telerik.com/fiddler-everywhere/user-guide/settings/gateway&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;curl&nbsp;&lt;a&nbsp;href=&quot;https://google.com&quot;&nbsp;target=&quot;_blank&quot;&gt;https://google.com&lt;/a&gt;&nbsp;-x&nbsp;&lt;a&nbsp;href=&quot;http://squid:3128&quot;&nbsp;target=&quot;_blank&quot;&gt;http://squid:3128&lt;/a&gt;&nbsp;--&gt;&nbsp;outgoing(cache_peer:&nbsp;like&nbsp;Fiddler&nbsp;gateway)&nbsp;--&gt;&nbsp;&lt;a&nbsp;href=&quot;http://google.com:443&quot;&nbsp;target=&quot;_blank&quot;&gt;google.com:443&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The cache_peer&nbsp;should&nbsp;be&nbsp;ignore&nbsp;ssl VERIFY.&nbsp;!!!&nbsp;like&nbsp;other&nbsp;software.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On squid&nbsp;5.0.4,&nbsp;http&nbsp;is&nbsp;ok,&nbsp;https&nbsp;will&nbsp;get&nbsp;ERR_SECURE_CONNECT_FAIL&nbsp;error.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;于2020年9月28日周一&nbsp;上午6:48写道：&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;9/27/20&nbsp;12:07&nbsp;PM,&nbsp;sec&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;http_port 3128 ssl-bump&nbsp;...&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;curl&nbsp;&lt;a&nbsp;href=&quot;http://google.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://google.com&lt;/a&gt;&nbsp;-x&nbsp;https://admin:squid@localhost:3128&nbsp;-v &nbsp;-k&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;above&nbsp;two&nbsp;lines&nbsp;do&nbsp;not&nbsp;match&nbsp;AFAICT:&nbsp;You&nbsp;tell&nbsp;curl&nbsp;to&nbsp;use&nbsp;an&nbsp;HTTPS&lt;br&gt;<br>
proxy,&nbsp;but&nbsp;you&nbsp;tell&nbsp;Squid&nbsp;to&nbsp;expect&nbsp;plain&nbsp;HTTP&nbsp;proxy&nbsp;requests.&lt;br&gt;<br>
&lt;br&gt;<br>
Also,&nbsp;please&nbsp;note&nbsp;that&nbsp;if&nbsp;you&nbsp;fix&nbsp;the&nbsp;above&nbsp;problem&nbsp;by&nbsp;moving&nbsp;&quot;https&quot;&lt;br&gt;<br>
from&nbsp;&quot;-x&quot;&nbsp;to&nbsp;the&nbsp;origin&nbsp;server&nbsp;URL,&nbsp;then&nbsp;you&nbsp;will&nbsp;probably&nbsp;face&nbsp;another&lt;br&gt;<br>
problem:&lt;br&gt;<br>
&lt;br&gt;<br>
curl&nbsp;&lt;a&nbsp;href=&quot;https://google.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://google.com&lt;/a&gt;&nbsp;-x&nbsp;http://admin:squid@localhost:3128&nbsp;-v &nbsp;-k&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;allow&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;cache_peer 127.0.0.1&nbsp;parent 3129 0 ssl&lt;br&gt;<br>
&lt;br&gt;<br>
Squid&nbsp;does&nbsp;not&nbsp;(yet)&nbsp;support&nbsp;&quot;TLS&nbsp;inside&nbsp;TLS&quot;:&nbsp;Talking&nbsp;TLS&nbsp;with&nbsp;the&lt;br&gt;<br>
origin&nbsp;server&nbsp;through&nbsp;a&nbsp;cache_peer&nbsp;that&nbsp;also&nbsp;expects&nbsp;a&nbsp;TLS&nbsp;connection.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
