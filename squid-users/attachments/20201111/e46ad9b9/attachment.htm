<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;  &nbsp;&gt;&nbsp;I&nbsp;am&nbsp;currently&nbsp;squid-cache&nbsp;in&nbsp;hierarchy&nbsp;setup,&nbsp;with&nbsp;TLS&nbsp;enabled&nbsp;throughout.&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&gt;&nbsp;client&nbsp;--&gt;&nbsp;child&nbsp;Squid&nbsp;--&gt;&nbsp;parent&nbsp;Squid&nbsp;--&gt;&nbsp;web&nbsp;server&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&nbsp;Do&nbsp;you&nbsp;use&nbsp;SslBump&nbsp;anywhere?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt; &nbsp; &nbsp;  &nbsp;I&nbsp;am&nbsp;not&nbsp;using &nbsp;<br>
SslBump.&nbsp;Part&nbsp;of&nbsp;my&nbsp;child&nbsp;squid&nbsp;config&nbsp;looks&nbsp;like:&lt;/div&gt;&lt;div&gt; &lt;/div&gt;      &nbsp;<br>
&lt;div&gt;https_port&nbsp;3128\&lt;br&gt; accel\&lt;br&gt; no-vhost\&lt;br&gt; defaultsite=origin\&lt;br&gt; cert=/squid/certs/server/cert.pem\&lt;br&gt; key=/squid/certs/server/key.pem\&lt;br&gt; cafile=/squid/certs/server/ca.pem\&lt;br&gt; clientca=/squid/certs/server/ca.pem&lt;br&gt;&lt;br&gt;cache_peer\&lt;br&gt; &lt;a&nbsp;href=&quot;http://parentsquid.com&quot;&gt;parentsquid.com&lt;/a&gt;\&lt;br&gt; parent\&lt;br&gt; 3128\&lt;br&gt; 0\&lt;br&gt; no-query\&nbsp;&lt;br&gt; originserver\&lt;br&gt; no-digest\&lt;br&gt; no-netdb-exchange\&lt;br&gt; login=PASSTHRU\&lt;/div&gt;&lt;div&gt; tls\&lt;br&gt;&lt;/div&gt;&lt;div&gt; tls-options=NO_TICKET\&lt;br&gt; sslcert=/squid/certs/client/cert.pem\&lt;br&gt; sslkey=/squid/certs/client/key.pem\&lt;br&gt; tls-cafile=/squid/certs/client/ca.pem&lt;/div&gt;<br>
<br>
&lt;div&gt;    &nbsp;&lt;br&gt;&nbsp;<br>
<br>
&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Openssl&nbsp;version:&nbsp;1.0.2k&lt;br&gt;<br>
&gt;&nbsp;This&nbsp;setup&nbsp;is&nbsp;working&nbsp;for&nbsp;3.5.20.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;But&nbsp;when&nbsp;I&nbsp;updated&nbsp;to&nbsp;squid&nbsp;4(tried&nbsp;4.8,&nbsp;4.11&nbsp;and&nbsp;4.13),&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&nbsp;Does&nbsp;all&nbsp;of&nbsp;the&nbsp;above&nbsp;apply&nbsp;to&nbsp;both&nbsp;child&nbsp;and&nbsp;parent&nbsp;Squids?&nbsp;Or&nbsp;just&nbsp;the&lt;br&gt;<br>
&gt;&gt;&nbsp;child?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt; &nbsp; &nbsp;Following&nbsp;scenarios&nbsp;are&nbsp;working:&lt;/div&gt;&lt;div&gt;   &nbsp;client&nbsp;--&gt;&nbsp;child&nbsp;Squid&nbsp;3.5.20&nbsp;--&gt;&nbsp;parent&nbsp;Squid&nbsp;3.5.20&nbsp;--&gt;&nbsp;web&nbsp;server&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;   &nbsp;<br>
client&nbsp;--&gt;&nbsp;child&nbsp;Squid&nbsp;4&nbsp;--&gt;&nbsp;parent&nbsp;Squid&nbsp;3.5.20&nbsp;--&gt;&nbsp;web&nbsp;server&lt;/div&gt;&lt;div&gt;   &nbsp;client&nbsp;--&gt;&nbsp;Squid&nbsp;4 &nbsp;--&gt;&nbsp;web&nbsp;server<br>
<br>
<br>
<br>
<br>
<br>
&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;   &nbsp;But&nbsp;this&nbsp;scenarios&nbsp;is&nbsp;failing:&lt;/div&gt;&lt;div&gt; &nbsp;client&nbsp;--&gt;&nbsp;child&nbsp;Squid&nbsp;4&nbsp;--&gt;&nbsp;parent&nbsp;Squid&nbsp;4&nbsp;--&gt;&nbsp;web&nbsp;server<br>
<br>
&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;initial&nbsp;HTTP&nbsp;request&nbsp;goes&nbsp;through,&nbsp;but&nbsp;TLS&nbsp;renegotiation&nbsp;is&nbsp;failing&lt;br&gt;<br>
&gt;&nbsp;between&nbsp;child&nbsp;and&nbsp;parent&nbsp;squid&nbsp;for&nbsp;the&nbsp;following&nbsp;requests.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;From&nbsp;the&nbsp;logs,&nbsp;it&nbsp;looks&nbsp;like&nbsp;child&nbsp;squid&nbsp;is&nbsp;trying&nbsp;to&nbsp;initialize&nbsp;TLS&lt;br&gt;<br>
&gt;&nbsp;renegotiating&nbsp;using&nbsp;old&nbsp;TLS&nbsp;session&nbsp;ID,&nbsp;but&nbsp;parent&nbsp;squid&nbsp;is&nbsp;rejecting&lt;br&gt;<br>
&gt;&nbsp;session&nbsp;resumption.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;confirm&nbsp;this&nbsp;behavior&nbsp;using&nbsp;openssl&nbsp;s_client&nbsp;--reconnect&nbsp;option.&lt;br&gt;<br>
&gt;&nbsp; &lt;br&gt;<br>
&gt;&nbsp;I&nbsp;tried&nbsp;to&nbsp;disabled&nbsp;client&nbsp;initialed&nbsp;TLS&nbsp;renegotiating&nbsp;by&nbsp;setting&lt;br&gt;<br>
&gt;&nbsp;tls-options=NO_TICKET&nbsp;(on&nbsp;child&nbsp;squid),&nbsp;but&nbsp;it&nbsp;is&nbsp;affecting&nbsp;the&nbsp;behavior.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&nbsp;Did&nbsp;you&nbsp;mean&nbsp;to&nbsp;say&nbsp;&quot;_not_&nbsp;affecting&nbsp;the&nbsp;behavior&quot;?&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;Sorry&nbsp;for&nbsp;typo.&nbsp;Yes,&nbsp;with&nbsp;NO_TICKET&nbsp;set,&nbsp;I&nbsp;am&nbsp;encountering&nbsp;same&nbsp;issue.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Are&nbsp;there&nbsp;any&nbsp;changes&nbsp;in&nbsp;default&nbsp;TLS&nbsp;renegotiation&nbsp;behavior&nbsp;between&lt;br&gt;<br>
&gt;&nbsp;squid&nbsp;3.5&nbsp;and&nbsp;4.x?&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;is&nbsp;difficult&nbsp;for&nbsp;me&nbsp;to&nbsp;say&nbsp;for&nbsp;sure&nbsp;--&nbsp;too&nbsp;many&nbsp;changes&nbsp;in&nbsp;the&lt;br&gt;<br>
surrounding&nbsp;code,&nbsp;too&nbsp;long&nbsp;ago.&nbsp;&quot;Maybe&quot;&nbsp;is&nbsp;the&nbsp;best&nbsp;answer&nbsp;I&nbsp;can&nbsp;give.&lt;br&gt;<br>
Hopefully,&nbsp;others&nbsp;can&nbsp;be&nbsp;more&nbsp;specific.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Is&nbsp;there&nbsp;a&nbsp;way&nbsp;to&nbsp;disable&nbsp;the&nbsp;client&nbsp;(child&nbsp;squid)&nbsp;initialized&nbsp;TLS&lt;br&gt;<br>
&gt;&nbsp;renegotiation&nbsp;in&nbsp;squid&nbsp;4?&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&nbsp;OpenSSL&nbsp;v1.1&nbsp;docs&nbsp;have&nbsp;the&nbsp;following&nbsp;paragraph:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;By&nbsp;default&nbsp;OpenSSL&nbsp;will&nbsp;use&nbsp;stateless&nbsp;tickets.&nbsp;The&nbsp;SSL_OP_NO_TICKET&lt;br&gt;<br>
&gt;&nbsp;option&nbsp;will&nbsp;cause&nbsp;stateless&nbsp;tickets&nbsp;to&nbsp;not&nbsp;be&nbsp;issued.&nbsp;In&nbsp;TLSv1.2&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;below&nbsp;this&nbsp;means&nbsp;no&nbsp;ticket&nbsp;gets&nbsp;sent&nbsp;to&nbsp;the&nbsp;client&nbsp;at&nbsp;all.&nbsp;In&nbsp;TLSv1.3&lt;br&gt;<br>
&gt;&nbsp;a&nbsp;stateful&nbsp;ticket&nbsp;will&nbsp;be&nbsp;sent.&nbsp;This&nbsp;is&nbsp;a&nbsp;server-side&nbsp;option&nbsp;only.&lt;br&gt;<br>
&gt;&gt;&nbsp;The&nbsp;last&nbsp;sentence&nbsp;is&nbsp;interesting.&nbsp;However,&nbsp;OpenSSL&nbsp;v1.0&nbsp;documentation&lt;br&gt;<br>
&gt;&gt;&nbsp;does&nbsp;not&nbsp;have&nbsp;that&nbsp;last&nbsp;caveat.&nbsp;It&nbsp;has&nbsp;another&nbsp;somewhat&nbsp;vague&nbsp;or&nbsp;open&nbsp;to&lt;br&gt;<br>
&gt;&gt;&nbsp;interpretation&nbsp;statement.&nbsp;Perhaps&nbsp;OpenSSL&nbsp;behavior&nbsp;changed&nbsp;with&nbsp;v1.1.&nbsp;In&lt;br&gt;<br>
&gt;&gt;&nbsp;that&nbsp;case,&nbsp;ignore&nbsp;this&nbsp;caveat.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&gt;&nbsp;You&nbsp;can&nbsp;try&nbsp;options&nbsp;discussed&nbsp;in&nbsp;the&nbsp;SECURE&nbsp;RENEGOTIATION&nbsp;section&nbsp;of&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://www.openssl.org/docs/man1.0.2/man3/SSL_CTX_set_options.html&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;&gt;&gt;&nbsp;https://www.openssl.org/docs/man1.0.2/man3/SSL_CTX_set_options.html&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;clear&nbsp;to&nbsp;me&nbsp;whether&nbsp;they&nbsp;apply&nbsp;to&nbsp;your&nbsp;environment.&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;I&nbsp;tried&nbsp;<br>
SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION,&nbsp;<br>
SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION,&nbsp;etc&nbsp;in&lt;/div&gt;&lt;div&gt; openssl&nbsp;option.&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp;but&nbsp;it&nbsp;did&nbsp;not&nbsp;changed&nbsp;the&nbsp;behaviour.&lt;/div&gt;&lt;div&gt; &nbsp;Unfortunately,&nbsp;I&nbsp;can&#39;t&nbsp;update&nbsp;to&nbsp;OpenSSL&nbsp;v1.1&nbsp;because&nbsp;of&nbsp;OS&nbsp;dependency&nbsp;issues.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;<br>
Manoj&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
