<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;for&nbsp;the&nbsp;reply&nbsp;Amos.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Couple&nbsp;of&nbsp;quick&nbsp;points&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1&nbsp;-&nbsp;Nothing&nbsp;exists&nbsp;today&nbsp;aside&nbsp;from&nbsp;a&nbsp;little&nbsp;prototyping&nbsp;environment,&nbsp;so&nbsp;anything&nbsp;that&#39;s&nbsp;possible&nbsp;is&nbsp;still&nbsp;in&nbsp;play.&lt;/div&gt;&lt;div&gt;2&nbsp;-&nbsp;The&nbsp;CA&nbsp;issuing&nbsp;the&nbsp;client&nbsp;certificates&nbsp;and&nbsp;any&nbsp;signing&nbsp;certificates&nbsp;for&nbsp;the&nbsp;proxy&nbsp;is&nbsp;internal. &nbsp;Just&nbsp;to&nbsp;reinforce,&nbsp;the&nbsp;web&nbsp;applications&nbsp;that&nbsp;the&nbsp;clients&nbsp;intend&nbsp;to&nbsp;access&nbsp;have&nbsp;no&nbsp;knowledge of&nbsp;the&nbsp;CA&nbsp;or&nbsp;requirement&nbsp;for&nbsp;client&nbsp;certificate&nbsp;authentication.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Stating&nbsp;the&nbsp;goal&nbsp;possibly&nbsp;in&nbsp;another&nbsp;way,&nbsp;only&nbsp;clients&nbsp;that&nbsp;possess&nbsp;this&nbsp;internally&nbsp;issued&nbsp;client&nbsp;certificate&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;connect&nbsp;to&nbsp;a&nbsp;web&nbsp;application&nbsp;through&nbsp;the&nbsp;proxy. &nbsp;If&nbsp;the&nbsp;client&nbsp;does&nbsp;not&nbsp;have&nbsp;a&nbsp;certificate,&nbsp;there&nbsp;is&nbsp;no&nbsp;requirement&nbsp;around&nbsp;whether&nbsp;or&nbsp;not&nbsp;it&nbsp;can&nbsp;connect&nbsp;to&nbsp;the&nbsp;proxy&nbsp;and&nbsp;issue&nbsp;requests...the&nbsp;only&nbsp;requirement&nbsp;is&nbsp;that&nbsp;any&nbsp;requests&nbsp;to&nbsp;connect&nbsp;to&nbsp;applications&nbsp;on&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;proxy&nbsp;fail.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Fri,&nbsp;Nov&nbsp;13,&nbsp;2020&nbsp;at&nbsp;10:33&nbsp;PM&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt; From&nbsp;your&nbsp;description&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;clients&nbsp;are&nbsp;talking&nbsp;to&nbsp;Squid&nbsp;&lt;br&gt;<br>
using&nbsp;HTTP.&nbsp;Any&nbsp;authentication&nbsp;they&nbsp;send&nbsp;to&nbsp;Squid&nbsp;has&nbsp;to&nbsp;be&nbsp;using&nbsp;HTTP&nbsp;&lt;br&gt;<br>
Authentication.&nbsp;Which&nbsp;is&nbsp;validated&nbsp;by&nbsp;the&nbsp;auth_param&nbsp;helper&nbsp;and&nbsp;&lt;br&gt;<br>
proxy_auth&nbsp;ACL&nbsp;type.&lt;br&gt;<br>
 &nbsp;&lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/Authentication&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/Features/Authentication&lt;/a&gt;&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Agree,&nbsp;this&nbsp;seems&nbsp;to&nbsp;be&nbsp;a&nbsp;non-starter&nbsp;for&nbsp;the&nbsp;reasons&nbsp;you&nbsp;describe. &nbsp;We&nbsp;do&nbsp;not&nbsp;wish&nbsp;to&nbsp;use&nbsp;HTTP&nbsp;authorization&nbsp;headers&nbsp;if&nbsp;it&nbsp;can&nbsp;be&nbsp;avoided.&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;However,&nbsp;the&nbsp;way&nbsp;you&nbsp;described&nbsp;your&nbsp;requirement&nbsp;implies&nbsp;that&nbsp;the&nbsp;origin&nbsp;&lt;br&gt;<br>
does&nbsp;not&nbsp;need&nbsp;the&nbsp;credentials&nbsp;anyway.&nbsp;It&nbsp;is&nbsp;only&nbsp;the&nbsp;proxy&nbsp;which&nbsp;cares&nbsp;&lt;br&gt;<br>
about&nbsp;auth&nbsp;to&nbsp;decide&nbsp;whether&nbsp;to&nbsp;relay&nbsp;or&nbsp;block&nbsp;a&nbsp;client.&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;correct.  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;To&nbsp;me&nbsp;there&nbsp;are&nbsp;only&nbsp;a&nbsp;few&nbsp;options&nbsp;for&nbsp;introducing&nbsp;TLS&nbsp;client&nbsp;certificate&nbsp;authentication.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1&nbsp;-&nbsp;Run&nbsp;TLS&nbsp;on&nbsp;the&nbsp;proxy&nbsp;listener. &nbsp;This&nbsp;would&nbsp;use&nbsp;https_port&nbsp;directive&nbsp;and&nbsp;would&nbsp;require&nbsp;that&nbsp;we&nbsp;are&nbsp;able&nbsp;to&nbsp;configure&nbsp;the&nbsp;proxy&nbsp;to&nbsp;mandate&nbsp;client&nbsp;certificates&nbsp;before&nbsp;allowing&nbsp;the&nbsp;connection&nbsp;to&nbsp;complete. &nbsp;Clients&nbsp;with&nbsp;no/invalid&nbsp;certificates&nbsp;wouldn&#39;t&nbsp;even&nbsp;get&nbsp;to&nbsp;the&nbsp;point&nbsp;where&nbsp;they&nbsp;can&nbsp;send&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;proxy.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2&nbsp;-&nbsp;Use&nbsp;ssl-bump&nbsp;functionality&nbsp;to&nbsp;modify&nbsp;the&nbsp;TLS&nbsp;handshake&nbsp;that&nbsp;occurs&nbsp;after&nbsp;a&nbsp;CONNECT&nbsp;request&nbsp;to&nbsp;require&nbsp;a&nbsp;valid&nbsp;client&nbsp;certificate&nbsp;before&nbsp;completing&nbsp;the&nbsp;request. &nbsp;No&nbsp;idea&nbsp;if&nbsp;this&nbsp;is&nbsp;possible.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3&nbsp;-&nbsp;Use&nbsp;either&nbsp;of&nbsp;the&nbsp;above&nbsp;to&nbsp;establish&nbsp;the&nbsp;mutually&nbsp;authenticated&nbsp;TLS&nbsp;context&nbsp;and&nbsp;then&nbsp;surface&nbsp;that&nbsp;information&nbsp;through&nbsp;ICAP&nbsp;to&nbsp;offload&nbsp;the&nbsp;authorization&nbsp;decision.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;been&nbsp;able&nbsp;to&nbsp;get&nbsp;ssl-bump&nbsp;working&nbsp;to&nbsp;generate&nbsp;custom&nbsp;certs&nbsp;and&nbsp;I&nbsp;have&nbsp;Squid&nbsp;talking&nbsp;to&nbsp;c-icap.&nbsp;I&nbsp;haven&#39;t&nbsp;successfully&nbsp;got&nbsp;Squid&nbsp;to&nbsp;prompt&nbsp;the&nbsp;client&nbsp;to&nbsp;authenticate&nbsp;and&nbsp;I&nbsp;still&nbsp;have&nbsp;quite&nbsp;a&nbsp;bit&nbsp;of&nbsp;learning&nbsp;to&nbsp;do&nbsp;on&nbsp;the&nbsp;ICAP&nbsp;side.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance&nbsp;for&nbsp;any&nbsp;steers&nbsp;(including&nbsp;&#39;this&nbsp;is&nbsp;a&nbsp;terrible&nbsp;idea&#39;&nbsp;of&nbsp;course&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Lastly&nbsp;I&nbsp;haven&#39;t&nbsp;used&nbsp;gmail&nbsp;with&nbsp;a&nbsp;mailing&nbsp;list&nbsp;before. &nbsp;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;i&#39;ve&nbsp;stomping&nbsp;on&nbsp;some&nbsp;etiquette.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
