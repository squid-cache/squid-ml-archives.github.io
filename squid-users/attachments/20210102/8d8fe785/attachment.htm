<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Hi,&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Thank&nbsp;you&nbsp;Amos&nbsp;Jeffries&nbsp;and&nbsp;Antony&nbsp;Stone.&nbsp;It&nbsp;seems&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;configuration&nbsp;I&nbsp;have&nbsp;provides&nbsp;the&nbsp;functionality&nbsp;of&nbsp;filtering&nbsp;I&nbsp;am<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;looking&nbsp;for.&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;There&nbsp;is&nbsp;a&nbsp;strange&nbsp;behavior&nbsp;I&nbsp;can&nbsp;see&nbsp;when&nbsp;accessing&nbsp;some<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;legitimate&nbsp;sites&nbsp;which&nbsp;I&nbsp;see&nbsp;traces&nbsp;of&nbsp;in&nbsp;cache.log&nbsp;:&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;2021/01/02&nbsp;10:55:48&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;1/20<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'squidGuard'&nbsp;processes&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/01/02&nbsp;10:57:31&nbsp;kid1|&nbsp;ERROR:&nbsp;negotiating&nbsp;TLS&nbsp;on&nbsp;FD&nbsp;39:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error:1407743E:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:tlsv1&nbsp;alert<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inappropriate&nbsp;fallback&nbsp;(1/-1/0)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/01/02&nbsp;10:57:31&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;38:&nbsp;error:00000001:lib(0):func(0):reason(1)&nbsp;(1/-1)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/01/02&nbsp;10:57:32&nbsp;kid1|&nbsp;ERROR:&nbsp;negotiating&nbsp;TLS&nbsp;on&nbsp;FD&nbsp;38:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error:1407743E:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:tlsv1&nbsp;alert<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inappropriate&nbsp;fallback&nbsp;(1/-1/0)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/01/02&nbsp;10:57:32&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;35:&nbsp;error:00000001:lib(0):func(0):reason(1)&nbsp;(1/-1)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/01/02&nbsp;10:57:40&nbsp;kid1|&nbsp;Starting&nbsp;new&nbsp;redirector&nbsp;helpers...&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/01/02&nbsp;10:57:40&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;1/20<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'squidGuard'&nbsp;processes&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/01/02&nbsp;10:58:09&nbsp;kid1|&nbsp;ERROR:&nbsp;negotiating&nbsp;TLS&nbsp;on&nbsp;FD&nbsp;51:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error:1407743E:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:tlsv1&nbsp;alert<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inappropriate&nbsp;fallback&nbsp;(1/-1/0)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/01/02&nbsp;10:58:09&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;40:&nbsp;error:00000001:lib(0):func(0):reason(1)&nbsp;(1/-1)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/01/02&nbsp;10:58:10&nbsp;kid1|&nbsp;ERROR:&nbsp;negotiating&nbsp;TLS&nbsp;on&nbsp;FD&nbsp;51:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error:1407743E:SSL&nbsp;routines:SSL23_GET_SERVER_HELLO:tlsv1&nbsp;alert<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inappropriate&nbsp;fallback&nbsp;(1/-1/0)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/01/02&nbsp;10:58:10&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;40:&nbsp;error:00000001:lib(0):func(0):reason(1)&nbsp;(1/-1)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;I&nbsp;noticed&nbsp;other&nbsp;users&nbsp;of&nbsp;squid&nbsp;encountered&nbsp;similar&nbsp;issues&nbsp;but&nbsp;I<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;did&nbsp;not&nbsp;find&nbsp;a&nbsp;clear&nbsp;answer&nbsp;to&nbsp;the&nbsp;issue.&nbsp;Is&nbsp;there&nbsp;a&nbsp;problem&nbsp;with<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;setup&nbsp;?&nbsp;I&nbsp;am&nbsp;not&nbsp;sure&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;solve&nbsp;it&nbsp;on&nbsp;my&nbsp;own&nbsp;!&nbsp;Any<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;help&nbsp;would&nbsp;be&nbsp;appreciated.&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Best&nbsp;regards,&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;JF&nbsp;Hasson&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;Le&nbsp;31/12/2020&nbsp;à&nbsp;10:14,&nbsp;Antony&nbsp;Stone&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;écrit :&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:202012311014.45914.Antony.Stone@squid.open.source.it&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;On&nbsp;Thursday&nbsp;31&nbsp;December&nbsp;2020&nbsp;at&nbsp;10:10:11,&nbsp;jean&nbsp;francois&nbsp;hasson&nbsp;wrote:<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;If&nbsp;I&nbsp;set&nbsp;up&nbsp;on&nbsp;a&nbsp;device&nbsp;connected&nbsp;to&nbsp;the&nbsp;access&nbsp;point&nbsp;a&nbsp;proxy&nbsp;manually<br>
ie&nbsp;10.3.141.1&nbsp;on&nbsp;port&nbsp;8080,&nbsp;I&nbsp;can&nbsp;access&nbsp;the&nbsp;internet.&nbsp;If&nbsp;I&nbsp;put&nbsp;the<br>
following&nbsp;rules&nbsp;for&nbsp;iptables&nbsp;to&nbsp;use&nbsp;in&nbsp;files&nbsp;rules.v4&nbsp;:<br>
<br>
*nat<br>
-A&nbsp;PREROUTING&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;DNAT&nbsp;--to-destination<br>
10.3.141.1:3128<br>
-A&nbsp;PREROUTING&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;3128<br>
-A&nbsp;PREROUTING&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;DNAT&nbsp;--to-destination<br>
10.3.141.1:3129<br>
-A&nbsp;PREROUTING&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;3129<br>
-A&nbsp;POSTROUTING&nbsp;-s&nbsp;10.3.141.0/24&nbsp;-o&nbsp;eth0&nbsp;-j&nbsp;MASQUERADE<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;<br>
Try&nbsp;removing&nbsp;the&nbsp;DNAT&nbsp;rules&nbsp;above.&nbsp;&nbsp;You&nbsp;should&nbsp;be&nbsp;using&nbsp;REDIRECT&nbsp;for&nbsp;intercept&nbsp;<br>
mode&nbsp;to&nbsp;work&nbsp;correctly.<br>
<br>
<br>
Antony.<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
