<tt>
&lt;html&nbsp;xmlns:v=&quot;urn:schemas-microsoft-com:vml&quot;&nbsp;xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;&nbsp;xmlns:w=&quot;urn:schemas-microsoft-com:office:word&quot;&nbsp;xmlns:m=&quot;http://schemas.microsoft.com/office/2004/12/omml&quot;&nbsp;xmlns=&quot;http://www.w3.org/TR/REC-html40&quot;&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;meta&nbsp;name=Generator&nbsp;content=&quot;Microsoft&nbsp;Word&nbsp;15&nbsp;(filtered&nbsp;medium)&quot;&gt;&lt;style&gt;&lt;!--<br>
/*&nbsp;Font&nbsp;Definitions&nbsp;*/<br>
@font-face<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{font-family:&quot;Cambria&nbsp;Math&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;panose-1:2&nbsp;4&nbsp;5&nbsp;3&nbsp;5&nbsp;4&nbsp;6&nbsp;3&nbsp;2&nbsp;4;}<br>
@font-face<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{font-family:Calibri;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;panose-1:2&nbsp;15&nbsp;5&nbsp;2&nbsp;2&nbsp;2&nbsp;4&nbsp;3&nbsp;2&nbsp;4;}<br>
/*&nbsp;Style&nbsp;Definitions&nbsp;*/<br>
p.MsoNormal,&nbsp;li.MsoNormal,&nbsp;div.MsoNormal<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{margin:0in;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-size:11.0pt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&quot;Calibri&quot;,sans-serif;}<br>
a:link,&nbsp;span.MsoHyperlink<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-priority:99;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color:blue;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text-decoration:underline;}<br>
span.EmailStyle20<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-type:personal-reply;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&quot;Calibri&quot;,sans-serif;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color:windowtext;}<br>
.MsoChpDefault<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-type:export-only;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-size:10.0pt;}<br>
@page&nbsp;WordSection1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{size:8.5in&nbsp;11.0in;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin:1.0in&nbsp;1.0in&nbsp;1.0in&nbsp;1.0in;}<br>
div.WordSection1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{page:WordSection1;}<br>
--&gt;&lt;/style&gt;&lt;!--[if&nbsp;gte&nbsp;mso&nbsp;9]&gt;&lt;xml&gt;<br>
&lt;o:shapedefaults&nbsp;v:ext=&quot;edit&quot;&nbsp;spidmax=&quot;1026&quot;&nbsp;/&gt;<br>
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if&nbsp;gte&nbsp;mso&nbsp;9]&gt;&lt;xml&gt;<br>
&lt;o:shapelayout&nbsp;v:ext=&quot;edit&quot;&gt;<br>
&lt;o:idmap&nbsp;v:ext=&quot;edit&quot;&nbsp;data=&quot;1&quot;&nbsp;/&gt;<br>
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;&lt;/head&gt;&lt;body&nbsp;lang=EN-US&nbsp;link=blue&nbsp;vlink=purple&nbsp;style='word-wrap:break-word'&gt;&lt;div&nbsp;class=WordSection1&gt;&lt;p&nbsp;class=MsoNormal&gt;Try&nbsp;as&nbsp;test&nbsp;to&nbsp;remove:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;ssl_bump&nbsp;terminate&nbsp;all&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Ie&nbsp;use&nbsp;only&nbsp;the&nbsp;next&nbsp;bump&nbsp;rules:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;###&nbsp;START&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;#&nbsp;TLS/SSL&nbsp;bumping&nbsp;definitions&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;acl&nbsp;tls_s1_connect&nbsp;at_step&nbsp;SslBump1&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;acl&nbsp;tls_s2_client_hello&nbsp;at_step&nbsp;SslBump2&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;acl&nbsp;tls_s3_server_hello&nbsp;at_step&nbsp;SslBump3&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;ssl_bump&nbsp;peek&nbsp;tls_s1_connect&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;###&nbsp;END&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;The&nbsp;above&nbsp;is&nbsp;from&nbsp;an&nbsp;example&nbsp;at&nbsp;ufdbguard&nbsp;manual.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;you&nbsp;are&nbsp;still&nbsp;having&nbsp;issues&nbsp;in&nbsp;full&nbsp;splice&nbsp;mode.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Eliezer&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;div&gt;&lt;p&nbsp;class=MsoNormal&gt;----&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Eliezer&nbsp;Croitoru&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Tech&nbsp;Support&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Mobile:&nbsp;+972-5-28704261&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:ngtech1ltd@gmail.com&quot;&gt;ngtech1ltd@gmail.com&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Zoom:&nbsp;Coming&nbsp;soon&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;div&gt;&lt;div&nbsp;style='border:none;border-top:solid&nbsp;#E1E1E1&nbsp;1.0pt;padding:3.0pt&nbsp;0in&nbsp;0in&nbsp;0in'&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;jean&nbsp;francois&nbsp;hasson&nbsp;&lt;jfhasson@club-internet.fr&gt;&nbsp;&lt;br&gt;&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Monday,&nbsp;January&nbsp;4,&nbsp;2021&nbsp;8:51&nbsp;AM&lt;br&gt;&lt;b&gt;To:&lt;/b&gt;&nbsp;ngtech1ltd@gmail.com&lt;br&gt;&lt;b&gt;Cc:&lt;/b&gt;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;Setting&nbsp;up&nbsp;a&nbsp;transparent&nbsp;http&nbsp;and&nbsp;https&nbsp;proxy&nbsp;server&nbsp;using&nbsp;squid&nbsp;4.6&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Hi,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Thank&nbsp;you&nbsp;for&nbsp;looking&nbsp;at&nbsp;my&nbsp;question.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;I&nbsp;dowloaded&nbsp;the&nbsp;squid&nbsp;4.6&nbsp;source&nbsp;code&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;http://ftp.debian.org/debian/pool/main/s/squid/&quot;&gt;http://ftp.debian.org/debian/pool/main/s/squid/&lt;/a&gt;&nbsp;and&nbsp;selected&nbsp;squid_4.6.orig.tar.gz,&nbsp;squid_4.6-1+deb10u4.debian.tar.xz&nbsp;and&nbsp;squid_4.6-1+deb10u4.dsc.&nbsp;I&nbsp;modified&nbsp;the&nbsp;debian/rules&nbsp;file&nbsp;by&nbsp;adding&nbsp;to&nbsp;DEB_CONFIGURE_EXTRA_FLAGS&nbsp;the&nbsp;following&nbsp;--with-openssl,&nbsp;--enable-ssl&nbsp;and&nbsp;--enable-ssl-crtd.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;The&nbsp;squid&nbsp;-v&nbsp;output&nbsp;is&nbsp;:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;blockquote&nbsp;style='margin-top:5.0pt;margin-bottom:5.0pt'&gt;&lt;p&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;4.6&lt;br&gt;Service&nbsp;Name:&nbsp;squid&lt;br&gt;Raspbian&nbsp;linux&lt;br&gt;&lt;br&gt;This&nbsp;binary&nbsp;uses&nbsp;OpenSSL&nbsp;1.0.2q&nbsp;&nbsp;20&nbsp;Nov&nbsp;2018.&nbsp;For&nbsp;legal&nbsp;restrictions&nbsp;on&nbsp;distribution&nbsp;see&nbsp;&lt;a&nbsp;href=&quot;https://www.openssl.org/source/license.html&quot;&gt;https://www.openssl.org/source/license.html&lt;/a&gt;&lt;br&gt;&lt;br&gt;configure&nbsp;options:&nbsp;&nbsp;'--build=arm-linux-gnueabihf'&nbsp;'--prefix=/usr'&nbsp;'--includedir=${prefix}/include'&nbsp;'--mandir=${prefix}/share/man'&nbsp;'--infodir=${prefix}/share/info'&nbsp;'--sysconfdir=/etc'&nbsp;'--localstatedir=/var'&nbsp;'--libexecdir=${prefix}/lib/squid'&nbsp;'--srcdir=.'&nbsp;'--disable-maintainer-mode'&nbsp;'--disable-dependency-tracking'&nbsp;'--disable-silent-rules'&nbsp;'BUILDCXXFLAGS=-g&nbsp;-O2&nbsp;-fdebug-prefix-map=/home/pi/build/squid/squid-4.6=.&nbsp;-fstack-protector-strong&nbsp;-Wformat&nbsp;-Werror=format-security&nbsp;-Wdate-time&nbsp;-D_FORTIFY_SOURCE=2&nbsp;-Wl,-z,relro&nbsp;-Wl,-z,now&nbsp;-Wl,--as-needed&nbsp;-latomic'&nbsp;'BUILDCXX=arm-linux-gnueabihf-g++'&nbsp;'--with-build-environment=default'&nbsp;'--enable-build-info=Raspbian&nbsp;linux'&nbsp;'--datadir=/usr/share/squid'&nbsp;'--sysconfdir=/etc/squid'&nbsp;'--libexecdir=/usr/lib/squid'&nbsp;'--mandir=/usr/share/man'&nbsp;'--enable-inline'&nbsp;'--disable-arch-native'&nbsp;'--enable-async-io=8'&nbsp;'--enable-storeio=ufs,aufs,diskd,rock'&nbsp;'--enable-removal-policies=lru,heap'&nbsp;'--enable-delay-pools'&nbsp;'--enable-cache-digests'&nbsp;'--enable-icap-client'&nbsp;'--enable-follow-x-forwarded-for'&nbsp;'--enable-auth-basic=DB,fake,getpwnam,LDAP,NCSA,NIS,PAM,POP3,RADIUS,SASL,SMB'&nbsp;'--enable-auth-digest=file,LDAP'&nbsp;'--enable-auth-negotiate=kerberos,wrapper'&nbsp;'--enable-auth-ntlm=fake,SMB_LM'&nbsp;'--enable-external-acl-helpers=file_userip,kerberos_ldap_group,LDAP_group,session,SQL_session,time_quota,unix_group,wbinfo_group'&nbsp;'--enable-security-cert-validators=fake'&nbsp;'--enable-storeid-rewrite-helpers=file'&nbsp;'--enable-url-rewrite-helpers=fake'&nbsp;'--enable-eui'&nbsp;'--enable-esi'&nbsp;'--enable-icmp'&nbsp;'--enable-zph-qos'&nbsp;'--enable-ecap'&nbsp;'--disable-translation'&nbsp;'--with-swapdir=/var/spool/squid'&nbsp;'--with-logdir=/var/log/squid'&nbsp;'--with-pidfile=/var/run/squid.pid'&nbsp;'--with-filedescriptors=65536'&nbsp;'--with-large-files'&nbsp;'--with-default-user=proxy'&nbsp;'--with-gnutls'&nbsp;'--with-openssl'&nbsp;'--enable-ssl'&nbsp;'--enable-ssl-crtd'&nbsp;'--enable-linux-netfilter'&nbsp;'build_alias=arm-linux-gnueabihf'&nbsp;'CC=arm-linux-gnueabihf-gcc'&nbsp;'CFLAGS=-g&nbsp;-O2&nbsp;-fdebug-prefix-map=/home/pi/build/squid/squid-4.6=.&nbsp;-fstack-protector-strong&nbsp;-Wformat&nbsp;-Werror=format-security&nbsp;-Wall'&nbsp;'LDFLAGS=-Wl,-z,relro&nbsp;-Wl,-z,now&nbsp;-Wl,--as-needed&nbsp;-latomic'&nbsp;'CPPFLAGS=-Wdate-time&nbsp;-D_FORTIFY_SOURCE=2'&nbsp;'CXX=arm-linux-gnueabihf-g++'&nbsp;'CXXFLAGS=-g&nbsp;-O2&nbsp;-fdebug-prefix-map=/home/pi/build/squid/squid-4.6=.&nbsp;-fstack-protector-strong&nbsp;-Wformat&nbsp;-Werror=format-security'&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;When&nbsp;I&nbsp;run&nbsp;openssl&nbsp;version&nbsp;I&nbsp;get&nbsp;1.1.1d.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;I&nbsp;hope&nbsp;it&nbsp;helps.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Best&nbsp;regards,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;JF&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;div&gt;&lt;p&nbsp;class=MsoNormal&gt;Le&nbsp;03/01/2021&nbsp;à&nbsp;21:55,&nbsp;&lt;a&nbsp;href=&quot;mailto:ngtech1ltd@gmail.com&quot;&gt;ngtech1ltd@gmail.com&lt;/a&gt;&nbsp;a&nbsp;écrit&nbsp;:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;blockquote&nbsp;style='margin-top:5.0pt;margin-bottom:5.0pt'&gt;&lt;p&nbsp;class=MsoNormal&gt;Hey,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;I&nbsp;am&nbsp;missing&nbsp;a&nbsp;bit&nbsp;of&nbsp;the&nbsp;context,&nbsp;like:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Did&nbsp;you&nbsp;self&nbsp;compiled&nbsp;squid?&nbsp;Is&nbsp;it&nbsp;from&nbsp;the&nbsp;OS&nbsp;repository?&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Squid&nbsp;-v&nbsp;might&nbsp;help&nbsp;a&nbsp;bit&nbsp;to&nbsp;understand&nbsp;what&nbsp;you&nbsp;do&nbsp;have&nbsp;enabled&nbsp;in&nbsp;your&nbsp;Squid.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Eliezer&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;div&gt;&lt;p&nbsp;class=MsoNormal&gt;----&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Eliezer&nbsp;Croitoru&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Tech&nbsp;Support&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Mobile:&nbsp;+972-5-28704261&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:ngtech1ltd@gmail.com&quot;&gt;ngtech1ltd@gmail.com&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;Zoom:&nbsp;Coming&nbsp;soon&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&nbsp;class=MsoNormal&gt;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;div&gt;&lt;div&nbsp;style='border:none;border-top:solid&nbsp;#E1E1E1&nbsp;1.0pt;padding:3.0pt&nbsp;0in&nbsp;0in&nbsp;0in'&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;b&gt;From:&lt;/b&gt;&nbsp;squid-users&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&gt;&lt;squid-users-bounces@lists.squid-cache.org&gt;&lt;/a&gt;&nbsp;&lt;b&gt;On&nbsp;Behalf&nbsp;Of&nbsp;&lt;/b&gt;jean&nbsp;francois&nbsp;hasson&lt;br&gt;&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Thursday,&nbsp;December&nbsp;31,&nbsp;2020&nbsp;11:10&nbsp;AM&lt;br&gt;&lt;b&gt;To:&lt;/b&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;&lt;b&gt;Subject:&lt;/b&gt;&nbsp;[squid-users]&nbsp;Setting&nbsp;up&nbsp;a&nbsp;transparent&nbsp;http&nbsp;and&nbsp;https&nbsp;proxy&nbsp;server&nbsp;using&nbsp;squid&nbsp;4.6&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&nbsp;class=MsoNormal&gt;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Hi,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;create&nbsp;for&nbsp;my&nbsp;home&nbsp;network&nbsp;a&nbsp;transparent&nbsp;proxy&nbsp;to&nbsp;implement&nbsp;filtering&nbsp;rules&nbsp;based&nbsp;on&nbsp;website&nbsp;names&nbsp;mainly.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;I&nbsp;have&nbsp;been&nbsp;looking&nbsp;at&nbsp;using&nbsp;a&nbsp;Raspberry&nbsp;pi&nbsp;3B+&nbsp;running&nbsp;pi&nbsp;OS.&nbsp;I&nbsp;configured&nbsp;it&nbsp;to&nbsp;be&nbsp;a&nbsp;Wifi&nbsp;access&nbsp;point&nbsp;using&nbsp;RaspAP&nbsp;quick&nbsp;install.&nbsp;The&nbsp;Wifi&nbsp;network&nbsp;on&nbsp;which&nbsp;the&nbsp;filtering&nbsp;option&nbsp;is&nbsp;to&nbsp;be&nbsp;implemented&nbsp;is&nbsp;with&nbsp;IP&nbsp;10.3.141.xxx.&nbsp;The&nbsp;router&nbsp;is&nbsp;at&nbsp;address&nbsp;10.3.141.1.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;I&nbsp;have&nbsp;the&nbsp;following&nbsp;squid.conf&nbsp;file&nbsp;which&nbsp;I&nbsp;tried&nbsp;to&nbsp;create&nbsp;based&nbsp;on&nbsp;different&nbsp;mails,&nbsp;websites&nbsp;and&nbsp;blogs&nbsp;I&nbsp;read&nbsp;:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;blockquote&nbsp;style='margin-top:5.0pt;margin-bottom:5.0pt'&gt;&lt;p&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&nbsp;#https&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;563&nbsp;#&nbsp;snews&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;873&nbsp;#&nbsp;rsync&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;#&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;#&nbsp;ftp&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;#&nbsp;https&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;#&nbsp;gopher&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;#&nbsp;wais&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;#&nbsp;http-mgmt&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;#&nbsp;gss-http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;#&nbsp;filemaker&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;&lt;br&gt;#Le&nbsp;réseau&nbsp;local&lt;br&gt;acl&nbsp;LocalNet&nbsp;src&nbsp;10.3.141.0/24&lt;br&gt;&lt;br&gt;acl&nbsp;bump_step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;acl&nbsp;bump_step2&nbsp;at_step&nbsp;SslBump2&lt;br&gt;acl&nbsp;bump_step3&nbsp;at_step&nbsp;SslBump3&lt;br&gt;&lt;br&gt;#Définition&nbsp;des&nbsp;autorisations&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;#http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;http_access&nbsp;allow&nbsp;LocalNet&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;#Définition&nbsp;des&nbsp;ports&nbsp;d'écoute&lt;br&gt;http_port&nbsp;8080&lt;br&gt;http_port&nbsp;3128&nbsp;intercept&lt;br&gt;https_port&nbsp;3129&nbsp;intercept&nbsp;ssl-bump&nbsp;\&lt;br&gt;&nbsp;&nbsp;tls-cert=/etc/squid/cert/example.crt&nbsp;\&lt;br&gt;&nbsp;&nbsp;tls-key=/etc/squid/cert/example.key&nbsp;\&lt;br&gt;&nbsp;&nbsp;generate-host-certificates=on&nbsp;&nbsp;dynamic_cert_mem_cache_size=4MB&lt;br&gt;&lt;br&gt;sslcrtd_program&nbsp;/usr/lib/squid/security_file_certgen&nbsp;-s&nbsp;/var/lib/ssl_db&nbsp;-M&nbsp;4MB&lt;br&gt;sslcrtd_children&nbsp;5&lt;br&gt;&lt;br&gt;ssl_bump&nbsp;peek&nbsp;all&lt;br&gt;acl&nbsp;tls_whitelist&nbsp;ssl::server_name&nbsp;.example.com&lt;br&gt;ssl_bump&nbsp;splice&nbsp;tls_whitelist&lt;br&gt;ssl_bump&nbsp;terminate&nbsp;all&lt;br&gt;&lt;br&gt;coredump_dir&nbsp;/var/spool/squid&lt;br&gt;&lt;br&gt;refresh_pattern&nbsp;^ftp:&nbsp;1440&nbsp;20%&nbsp;10080&lt;br&gt;refresh_pattern&nbsp;^gopher:&nbsp;1440&nbsp;0%&nbsp;1440&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;0%&nbsp;0&lt;br&gt;refresh_pattern&nbsp;.&nbsp;0&nbsp;20%&nbsp;4320&lt;br&gt;&lt;br&gt;cache_dir&nbsp;ufs&nbsp;/cache&nbsp;400&nbsp;16&nbsp;256&lt;br&gt;cache_access_log&nbsp;/var/log/squid/access.log&lt;br&gt;cache_effective_user&nbsp;proxy&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;If&nbsp;I&nbsp;set&nbsp;up&nbsp;on&nbsp;a&nbsp;device&nbsp;connected&nbsp;to&nbsp;the&nbsp;access&nbsp;point&nbsp;a&nbsp;proxy&nbsp;manually&nbsp;ie&nbsp;10.3.141.1&nbsp;on&nbsp;port&nbsp;8080,&nbsp;I&nbsp;can&nbsp;access&nbsp;the&nbsp;internet.&nbsp;If&nbsp;I&nbsp;put&nbsp;the&nbsp;following&nbsp;rules&nbsp;for&nbsp;iptables&nbsp;to&nbsp;use&nbsp;in&nbsp;files&nbsp;rules.v4&nbsp;:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;*nat&lt;br&gt;-A&nbsp;PREROUTING&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;DNAT&nbsp;--to-destination&nbsp;10.3.141.1:3128&lt;br&gt;-A&nbsp;PREROUTING&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;3128&lt;br&gt;-A&nbsp;PREROUTING&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;DNAT&nbsp;--to-destination&nbsp;10.3.141.1:3129&lt;br&gt;-A&nbsp;PREROUTING&nbsp;-i&nbsp;eth0&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;REDIRECT&nbsp;--to-ports&nbsp;3129&lt;br&gt;-A&nbsp;POSTROUTING&nbsp;-s&nbsp;10.3.141.0/24&nbsp;-o&nbsp;eth0&nbsp;-j&nbsp;MASQUERADE&lt;br&gt;COMMIT&lt;br&gt;Now,&nbsp;if&nbsp;I&nbsp;remove&nbsp;the&nbsp;manual&nbsp;proxy&nbsp;configuration&nbsp;of&nbsp;the&nbsp;device&nbsp;connected&nbsp;to&nbsp;the&nbsp;access&nbsp;point,&nbsp;I&nbsp;can't&nbsp;connect&nbsp;to&nbsp;the&nbsp;internet.&nbsp;If&nbsp;I&nbsp;leave&nbsp;the&nbsp;manual&nbsp;proxy&nbsp;configuration&nbsp;it&nbsp;does&nbsp;work&nbsp;and&nbsp;there&nbsp;is&nbsp;activity&nbsp;logged&nbsp;in&nbsp;/var/log/squid/access.log.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Please&nbsp;let&nbsp;me&nbsp;know&nbsp;what&nbsp;might&nbsp;be&nbsp;wrong&nbsp;in&nbsp;my&nbsp;configuration&nbsp;if&nbsp;possible.&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;Best&nbsp;regards,&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;JF&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&gt;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
