<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;an&nbsp;environment&nbsp;with squid&nbsp;version&nbsp;5.0.4&nbsp;with&nbsp;ICAP&nbsp;server&nbsp;adapting&nbsp;requests&nbsp;by&nbsp;adding&nbsp;an&nbsp;header.&lt;/div&gt;&lt;div&gt;When&nbsp;I&#39;m&nbsp;trying&nbsp;to&nbsp;send&nbsp;a&nbsp;POST&nbsp;request&nbsp;with&nbsp;a&nbsp;body&nbsp;I&#39;m&nbsp;having&nbsp;an&nbsp;issue&nbsp;of&nbsp;a&nbsp;stuck&nbsp;connection.&lt;/div&gt;&lt;div&gt;What&nbsp;should&nbsp;the&nbsp;ICAP&nbsp;response&nbsp;look&nbsp;like?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;I&nbsp;do&nbsp;is&nbsp;to&nbsp;reply&nbsp;like&nbsp;this:&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;(dI./M..ICAP/1.0&nbsp;200&nbsp;OK&lt;br&gt;ISTag:&nbsp;&quot;SjIzlRA4te41axxcDOoiSl6rBRg4ZK&quot;&lt;br&gt;Date:&nbsp;Sun,&nbsp;17&nbsp;Jan&nbsp;2021&nbsp;19:34:12&nbsp;GMT&lt;br&gt;Server:&nbsp;BaseICAP/1.0&nbsp;Python/3.6.12&lt;br&gt;Encapsulated:&nbsp;req-hdr=0,&nbsp;req-body=360&lt;br&gt;&lt;br&gt;POST&nbsp;&lt;a&nbsp;href=&quot;http://www.dst-server.com:22222/v1/test&quot;&gt;http://www.dst-server.com:22222/v1/test&lt;/a&gt;&nbsp;HTTP/1.1&lt;br&gt;x-new-header:&nbsp;{&quot;key&quot;:&nbsp;&quot;value&quot;}&lt;br&gt;user-agent:&nbsp;python-requests/2.25.1&lt;br&gt;accept-encoding:&nbsp;gzip,&nbsp;deflate&lt;br&gt;accept:&nbsp;*/*&lt;br&gt;content-length:&nbsp;16&lt;br&gt;content-type:&nbsp;application/json&lt;br&gt;host:&nbsp;&lt;a&nbsp;href=&quot;http://www.dst-server.com:22222&quot;&gt;www.dst-server.com:22222&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; Please&nbsp;assume&nbsp;the&nbsp;number&nbsp;in&nbsp;req-body=360&nbsp;is&nbsp;correct&nbsp;(I&nbsp;trimmed&nbsp;here&nbsp;the&nbsp;content&nbsp;of&nbsp;the&nbsp;new&nbsp;header).&lt;/div&gt;&lt;div&gt;As&nbsp;I&nbsp;said,&nbsp;I&nbsp;use&nbsp;&#39;Preview:&nbsp;0&#39;&nbsp;since&nbsp;I&nbsp;don&#39;t&nbsp;mind&nbsp;the&nbsp;body.&nbsp;The&nbsp;question&nbsp;is&nbsp;whether&nbsp;declaring&nbsp;the&nbsp;body&nbsp;starts&nbsp;at&nbsp;X&nbsp;(req-body=X)&nbsp;is&nbsp;OK&nbsp;even&nbsp;though&nbsp;I&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;body&nbsp;to&nbsp;send?&nbsp;I&nbsp;think&nbsp;having&nbsp;req-null=X&nbsp;is&nbsp;bad&nbsp;since&nbsp;it&nbsp;probably&nbsp;tells&nbsp;squid&nbsp;that&nbsp;I&nbsp;decided&nbsp;the&nbsp;adapted&nbsp;request should&nbsp;have&nbsp;no&nbsp;body,&nbsp;but&nbsp;that&#39;s&nbsp;only&nbsp;a&nbsp;guess.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;the&nbsp;ICAP&nbsp;doesn&#39;t&nbsp;adapt&nbsp;the&nbsp;request,&nbsp;everything&nbsp;looks&nbsp;fine.&lt;/div&gt;&lt;div&gt;When&nbsp;it&nbsp;adapts&nbsp;the&nbsp;request&nbsp;I&nbsp;see&nbsp;that&nbsp;the POST&nbsp;request&nbsp;squid&nbsp;sends&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;http://www.dst-server.com&quot;&gt;www.dst-server.com&lt;/a&gt;&nbsp;doesn&#39;t&nbsp;contain&nbsp;the&nbsp;body.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;the&nbsp;logs&nbsp;of&nbsp;the&nbsp;server&nbsp;behind&nbsp;&lt;a&nbsp;href=&quot;http://www.dst-server.com&quot;&gt;www.dst-server.com&lt;/a&gt;&nbsp;I&nbsp;see&nbsp;an&nbsp;entry&nbsp;for&nbsp;the&nbsp;API&nbsp;request&nbsp;only&nbsp;after&nbsp;I&nbsp;abort&nbsp;the&nbsp;request&nbsp;I&nbsp;sent.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;use&nbsp;python&#39;s&nbsp;requests&nbsp;module&nbsp;to&nbsp;make&nbsp;the&nbsp;request:&lt;br&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;import&nbsp;requests&lt;br&gt;s&nbsp;=&nbsp;requests.Session()&lt;br&gt;s.proxies&nbsp;=&nbsp;{&#39;http&#39;:&nbsp;&#39;localhost:8000&#39;,&nbsp;&#39;https&#39;:&nbsp;&#39;localhost:8000&#39;} &lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;resp&nbsp;=&nbsp;&lt;a&nbsp;href=&quot;http://s.post&quot;&gt;s.post&lt;/a&gt;(&#39;&lt;a&nbsp;href=&quot;http://www.dst-server.com:22222/v1/test&quot;&gt;http://www.dst-server.com:22222/v1/test&lt;/a&gt;&#39;,&nbsp;allow_redirects=False,&nbsp;json={&#39;key&#39;:&nbsp;&#39;value&#39;})&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div&gt;I&#39;ll&nbsp;highly&nbsp;appreciate&nbsp;any&nbsp;help.&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Moti&lt;/div&gt;&lt;/div&gt;<br>

</tt>
