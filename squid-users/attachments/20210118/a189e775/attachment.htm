<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;I&nbsp;assume&nbsp;that&nbsp;a&nbsp;null&nbsp;body&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;logic&nbsp;that&nbsp;the&nbsp;icap&nbsp;client&nbsp;knows&nbsp;the&nbsp;progress&nbsp;and&nbsp;the&nbsp;icap&nbsp;details&nbsp;enough&nbsp;to&nbsp;only&nbsp;modify&nbsp;the&nbsp;headers.&lt;div&nbsp;dir=&quot;auto&quot;&gt;it&nbsp;should&nbsp;be&nbsp;tested.&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;I&nbsp;tried&nbsp;to&nbsp;test&nbsp;it&nbsp;but&nbsp;im&nbsp;busy&nbsp;to&nbsp;test&nbsp;it&nbsp;right&nbsp;now.&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;Eliezer&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Mon,&nbsp;Jan&nbsp;18,&nbsp;2021,&nbsp;13:46&nbsp;Moti&nbsp;Berger&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:moberger@metanetworks.com&quot;&gt;moberger@metanetworks.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;the&nbsp;ICAP&nbsp;server&nbsp;sets&nbsp;&#39;Preview:&nbsp;0&#39;&nbsp;in&nbsp;the&nbsp;OPTIONS&nbsp;it&nbsp;means&nbsp;that&nbsp;when&nbsp;the&nbsp;ICAP&nbsp;client&nbsp;sends&nbsp;a&nbsp;request,&nbsp;it&nbsp;should&nbsp;not&nbsp;contain&nbsp;the&nbsp;body.&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;the&nbsp;REQMOD&nbsp;request:&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;F..n...DREQMOD&nbsp;icap://censor-req.proxy:14590/request&nbsp;ICAP/1.0&lt;br&gt;Host:&nbsp;censor-req.proxy:14590&lt;br&gt;Date:&nbsp;Mon,&nbsp;18&nbsp;Jan&nbsp;2021&nbsp;11:34:54&nbsp;GMT&lt;br&gt;Encapsulated:&nbsp;req-hdr=0,&nbsp;req-body=222&lt;br&gt;Preview:&nbsp;0&lt;br&gt;Allow:&nbsp;204,&nbsp;trailers&lt;br&gt;X-custom-header:&nbsp;data&lt;br&gt;&lt;br&gt;POST&nbsp;&lt;a&nbsp;href=&quot;http://www.dst-server.com:22222/v1/test&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;http://www.dst-server.com:22222/v1/test&lt;/a&gt;&nbsp;HTTP/1.1&lt;br&gt;User-Agent:&nbsp;python-requests/2.25.1&lt;br&gt;Accept-Encoding:&nbsp;gzip,&nbsp;deflate&lt;br&gt;Accept:&nbsp;*/*&lt;br&gt;Content-Length:&nbsp;10&lt;br&gt;Content-Type:&nbsp;application/json&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://www.dst-server.com:22222&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;www.dst-server.com:22222&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;ICAP&nbsp;&#39;Encapsulated&#39;&nbsp;header&nbsp;has&nbsp;a&nbsp;req-body&nbsp;even&nbsp;though&nbsp;no&nbsp;&#39;body&#39;&nbsp;should&nbsp;be&nbsp;in&nbsp;this&nbsp;request.&lt;/div&gt;&lt;div&gt;I&nbsp;wonder&nbsp;why&nbsp;in&nbsp;this&nbsp;case&nbsp;the &#39;Encapsulated&#39;&nbsp;header&nbsp;doesn&#39;t&nbsp;contain&nbsp;null-body.&lt;/div&gt;&lt;div&gt;I&nbsp;could&nbsp;not&nbsp;find&nbsp;any&nbsp;reference&nbsp;to&nbsp;this&nbsp;case&nbsp;in&nbsp;the&nbsp;RFC3507.&lt;/div&gt;&lt;div&gt;The&nbsp;ICAP&nbsp;server&nbsp;has&nbsp;no&nbsp;way&nbsp;to&nbsp;encapsulate&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;body&nbsp;if&nbsp;it&nbsp;didn&#39;t&nbsp;get&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;want&nbsp;to&nbsp;avoid&nbsp;sending&nbsp;the&nbsp;body&nbsp;because&nbsp;the&nbsp;adaptation&nbsp;is&nbsp;body&nbsp;agnostic.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Sun,&nbsp;Jan&nbsp;17,&nbsp;2021&nbsp;at&nbsp;11:34&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;1/17/21&nbsp;3:08&nbsp;PM,&nbsp;Moti&nbsp;Berger&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;should&nbsp;the&nbsp;ICAP&nbsp;response&nbsp;look&nbsp;like?&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;vast&nbsp;majority&nbsp;off&nbsp;ICAP&nbsp;responses&nbsp;containing&nbsp;an&nbsp;HTTP&nbsp;POST&nbsp;message&lt;br&gt;<br>
will&nbsp;look&nbsp;like&nbsp;ICAP&nbsp;header&nbsp;+&nbsp;HTTP&nbsp;header&nbsp;+&nbsp;HTTP&nbsp;body.&nbsp;Please&nbsp;see&nbsp;RFC&lt;br&gt;<br>
3507&nbsp;and&nbsp;its&nbsp;errata&nbsp;for&nbsp;examples&nbsp;of&nbsp;and&nbsp;discussion&nbsp;about&nbsp;those&nbsp;three&lt;br&gt;<br>
components.&nbsp;It&nbsp;should&nbsp;help&nbsp;avoid&nbsp;guessing&nbsp;and&nbsp;developing&nbsp;by&nbsp;examples&lt;br&gt;<br>
(which&nbsp;usually&nbsp;leads&nbsp;to&nbsp;bugs,&nbsp;especially&nbsp;where&nbsp;ICAP&nbsp;is&nbsp;involved).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;I&nbsp;do&nbsp;is&nbsp;to&nbsp;reply&nbsp;like&nbsp;this:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; (dI./M..ICAP/1.0&nbsp;200&nbsp;OK&lt;br&gt;<br>
&gt; &nbsp; &nbsp; ISTag:&nbsp;&quot;SjIzlRA4te41axxcDOoiSl6rBRg4ZK&quot;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Date:&nbsp;Sun,&nbsp;17&nbsp;Jan&nbsp;2021&nbsp;19:34:12&nbsp;GMT&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Server:&nbsp;BaseICAP/1.0&nbsp;Python/3.6.12&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Encapsulated:&nbsp;req-hdr=0,&nbsp;req-body=360&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; POST&nbsp;&lt;a&nbsp;href=&quot;http://www.dst-server.com:22222/v1/test&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.dst-server.com:22222/v1/test&lt;/a&gt;&nbsp;HTTP/1.1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; x-new-header:&nbsp;{&quot;key&quot;:&nbsp;&quot;value&quot;}&lt;br&gt;<br>
&gt; &nbsp; &nbsp; user-agent:&nbsp;python-requests/2.25.1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; accept-encoding:&nbsp;gzip,&nbsp;deflate&lt;br&gt;<br>
&gt; &nbsp; &nbsp; accept:&nbsp;*/*&lt;br&gt;<br>
&gt; &nbsp; &nbsp; content-length:&nbsp;16&lt;br&gt;<br>
&gt; &nbsp; &nbsp; content-type:&nbsp;application/json&lt;br&gt;<br>
&gt; &nbsp; &nbsp; host:&nbsp;&lt;a&nbsp;href=&quot;http://www.dst-server.com:22222&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;www.dst-server.com:22222&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://www.dst-server.com:22222&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.dst-server.com:22222&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
FYI:&nbsp;The&nbsp;above&nbsp;incomplete&nbsp;ICAP&nbsp;response&nbsp;promises&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;body,&lt;br&gt;<br>
both&nbsp;on&nbsp;the&nbsp;ICAP&nbsp;level&nbsp;(req-body)&nbsp;and&nbsp;on&nbsp;the&nbsp;HTTP&nbsp;level&nbsp;(content-length:&lt;br&gt;<br>
16).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;As&nbsp;I&nbsp;said,&nbsp;I&nbsp;use&nbsp;&#39;Preview:&nbsp;0&#39;&nbsp;since&nbsp;I&nbsp;don&#39;t&nbsp;mind&nbsp;the&nbsp;body.&nbsp;The&nbsp;question&lt;br&gt;<br>
&gt;&nbsp;is&nbsp;whether&nbsp;declaring&nbsp;the&nbsp;body&nbsp;starts&nbsp;at&nbsp;X&nbsp;(req-body=X)&nbsp;is&nbsp;OK&nbsp;even&nbsp;though&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;body&nbsp;to&nbsp;send?&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;is&nbsp;not&nbsp;OK&nbsp;not&nbsp;to&nbsp;send&nbsp;the&nbsp;body.&nbsp;Encapsulated:req-body&nbsp;does&nbsp;more&nbsp;than&lt;br&gt;<br>
declaring&nbsp;where&nbsp;the&nbsp;encapsulated&nbsp;headers&nbsp;end.&nbsp;It&nbsp;also&nbsp;promises&nbsp;an&lt;br&gt;<br>
embedded&nbsp;HTTP&nbsp;body&nbsp;after&nbsp;those&nbsp;headers.&nbsp;You&nbsp;must&nbsp;encapsulate&nbsp;the&nbsp;body&nbsp;if&lt;br&gt;<br>
the&nbsp;HTTP&nbsp;message&nbsp;should&nbsp;have&nbsp;one.&nbsp;You&nbsp;cannot&nbsp;adapt&nbsp;the&nbsp;header&nbsp;of&nbsp;an&nbsp;HTTP&lt;br&gt;<br>
message&nbsp;with&nbsp;a&nbsp;body&nbsp;without&nbsp;also&nbsp;sending&nbsp;the&nbsp;HTTP&nbsp;body&nbsp;(virgin&nbsp;or&nbsp;adapted).&lt;br&gt;<br>
&lt;br&gt;<br>
Preview&nbsp;is&nbsp;pretty&nbsp;much&nbsp;irrelevant&nbsp;in&nbsp;this&nbsp;context&nbsp;--&nbsp;the&nbsp;ICAP&nbsp;protocol&lt;br&gt;<br>
does&nbsp;not&nbsp;care&nbsp;how&nbsp;the&nbsp;ICAP&nbsp;service&nbsp;gets&nbsp;the&nbsp;HTTP&nbsp;body&nbsp;to&nbsp;include&nbsp;in&nbsp;the&lt;br&gt;<br>
ICAP&nbsp;response.&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;are&nbsp;unofficial&nbsp;ICAP&nbsp;extensions&nbsp;that&nbsp;make&nbsp;it&nbsp;possible&nbsp;to&nbsp;tell&nbsp;the&lt;br&gt;<br>
ICAP&nbsp;client&nbsp;to&nbsp;reuse&nbsp;the&nbsp;body&nbsp;it&nbsp;has&nbsp;buffered&nbsp;while&nbsp;adapting&nbsp;the&nbsp;header,&lt;br&gt;<br>
but&nbsp;you&nbsp;should&nbsp;get&nbsp;the&nbsp;baseline&nbsp;case&nbsp;working&nbsp;before&nbsp;bothering&nbsp;with&nbsp;those&lt;br&gt;<br>
extensions&nbsp;--&nbsp;they&nbsp;are&nbsp;optimizations&nbsp;that&nbsp;are&nbsp;not&nbsp;applicable&nbsp;to&nbsp;some&lt;br&gt;<br>
transactions.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;think&nbsp;having&nbsp;req-null=X&nbsp;is&nbsp;bad&nbsp;since&nbsp;it&lt;br&gt;<br>
&gt;&nbsp;probably&nbsp;tells&nbsp;squid&nbsp;that&nbsp;I&nbsp;decided&nbsp;the&nbsp;adapted&nbsp;request should&nbsp;have&nbsp;no&lt;br&gt;<br>
&gt;&nbsp;body,&nbsp;but&nbsp;that&#39;s&nbsp;only&nbsp;a&nbsp;guess.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;meant&nbsp;to&nbsp;say&nbsp;&quot;null-body&quot;,&nbsp;then&nbsp;you&nbsp;guessed&nbsp;correctly&nbsp;--&nbsp;null-body&lt;br&gt;<br>
means&nbsp;the&nbsp;adapted&nbsp;HTTP&nbsp;message&nbsp;has&nbsp;no&nbsp;body.&nbsp;That&nbsp;is&nbsp;not&nbsp;what&nbsp;you&nbsp;want&nbsp;to&lt;br&gt;<br>
say&nbsp;when&nbsp;adapting&nbsp;most&nbsp;HTTP&nbsp;POST&nbsp;messages.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
