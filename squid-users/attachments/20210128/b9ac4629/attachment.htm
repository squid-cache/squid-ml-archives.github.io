<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;I&nbsp;have&nbsp;redeployed&nbsp;everything,&nbsp;with&nbsp;most&nbsp;basic&nbsp;configuration,&nbsp;and&nbsp;use&nbsp;the&nbsp;proposed&nbsp;config&nbsp;for&nbsp;ssl_bump.&lt;/div&gt;&lt;div&gt;The&nbsp;test&nbsp;server&nbsp;that&nbsp;goes&nbsp;through&nbsp;Squid&nbsp;now&nbsp;doesn&#39;t&nbsp;get&nbsp;tunneled,&nbsp;and&nbsp;instead&nbsp;checks&nbsp;the&nbsp;cache.&nbsp;I&nbsp;get&nbsp;something&nbsp;like&nbsp;this&lt;/div&gt;&lt;div&gt;NONE/200&lt;br&gt;TCP_MISS/200&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;I&nbsp;have&nbsp;noticed&nbsp;that&nbsp;the&nbsp;test&nbsp;server&nbsp;also&nbsp;doesn&#39;t&nbsp;cache&nbsp;anything,&nbsp;and&nbsp;instead&nbsp;only&nbsp;looks&nbsp;at&nbsp;the&nbsp;cache.&lt;/div&gt;&lt;div&gt;So&nbsp;if&nbsp;I&nbsp;try&nbsp;to&nbsp;go&nbsp;for&nbsp;a&nbsp;file&nbsp;in&nbsp;S3,&nbsp;it&nbsp;says&nbsp;MISS,&nbsp;and&nbsp;after&nbsp;that,&nbsp;MISS&nbsp;again,&nbsp;and&nbsp;I&nbsp;see&nbsp;no&nbsp;new&nbsp;objects&nbsp;in&nbsp;cache&nbsp;being&nbsp;created.&lt;/div&gt;&lt;div&gt;If&nbsp;I&nbsp;try&nbsp;the&nbsp;same&nbsp;thing&nbsp;from&nbsp;the&nbsp;proxy&nbsp;itself,&nbsp;I&nbsp;get&nbsp;the&nbsp;MISS,&nbsp;and&nbsp;the&nbsp;object&nbsp;gets&nbsp;cached,&nbsp;as&nbsp;it&nbsp;should.&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;I&nbsp;go&nbsp;back&nbsp;to&nbsp;the&nbsp;test&nbsp;server,&nbsp;and&nbsp;try&nbsp;again,&nbsp;it&nbsp;sees&nbsp;the&nbsp;object&nbsp;in&nbsp;cache&nbsp;and&nbsp;returns&nbsp;TCP_MEM_HIT/200&nbsp;instead.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is<br>
&nbsp;there&nbsp;a&nbsp;specific&nbsp;configuration&nbsp;that&nbsp;I&nbsp;need&nbsp;to&nbsp;add/enable,&nbsp;in&nbsp;order&nbsp;to&nbsp;<br>
have&nbsp;the&nbsp;server&nbsp;cache&nbsp;the&nbsp;objects,&nbsp;or&nbsp;am&nbsp;I&nbsp;making&nbsp;a&nbsp;mistake&nbsp;elsewhere&nbsp;<br>
perhaps?&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;the&nbsp;entire&nbsp;config&nbsp;file:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;visible_hostname&nbsp;squid&lt;br&gt;cache_dir&nbsp;ufs&nbsp;/test/cache/squid&nbsp;10000&nbsp;16&nbsp;256&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;http_access&nbsp;alow&nbsp;all&lt;span&nbsp;class=&quot;gmail-im&quot;&gt;&lt;br&gt;&lt;br&gt;http_port&nbsp;3128&lt;br&gt;http_port&nbsp;3129&nbsp;intercept&lt;br&gt;acl&nbsp;allowed_http_sites&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://amazonaws.com&quot;&nbsp;target=&quot;_blank&quot;&gt;amazonaws.com&lt;/a&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;allowed_http_sites&lt;br&gt;&lt;br&gt;https_port&nbsp;3130&nbsp;cert=/etc/squid/ssl/squid.pem&nbsp;ssl-bump&nbsp;intercept&lt;br&gt;acl&nbsp;SSL_port&nbsp;port&nbsp;443&lt;br&gt;http_access&nbsp;allow&nbsp;SSL_port&lt;br&gt;&lt;/span&gt;acl&nbsp;allowed_https_sites&nbsp;ssl::server_name&nbsp;.&lt;a&nbsp;href=&quot;http://amazonaws.com&quot;&nbsp;target=&quot;_blank&quot;&gt;amazonaws.com&lt;/a&gt;&lt;br&gt;&lt;br&gt;ssl_bump&nbsp;stare&nbsp;all&lt;br&gt;ssl_bump&nbsp;bump&nbsp;allowed_https_sites&lt;br&gt;ssl_bump&nbsp;terminate&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Tue,&nbsp;Jan&nbsp;26,&nbsp;2021&nbsp;at&nbsp;9:14&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;1/26/21&nbsp;1:54&nbsp;PM,&nbsp;Milos&nbsp;Dodic&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;when&nbsp;the&nbsp;test&nbsp;server&nbsp;goes&nbsp;for&nbsp;a&nbsp;picture&nbsp;I&nbsp;have&nbsp;stored&nbsp;somewhere&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;cloud,&nbsp;the&nbsp;squid&nbsp;access&nbsp;log&nbsp;shows&nbsp;&quot;TCP_TUNNEL/200&quot;.&nbsp;But&nbsp;when&nbsp;I&lt;br&gt;<br>
&gt;&nbsp;try&nbsp;from&nbsp;the&nbsp;proxy&nbsp;itself&nbsp;with&nbsp;squidclient&nbsp;tool,&nbsp;I&nbsp;get&lt;br&gt;<br>
&gt;&nbsp;&quot;TCP_MEM_HIT/200&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Given&nbsp;the&nbsp;very&nbsp;limited&nbsp;information&nbsp;you&nbsp;have&nbsp;provided,&nbsp;I&nbsp;am&nbsp;guessing&nbsp;that&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;the&nbsp;primary&nbsp;tests&nbsp;opens&nbsp;a&nbsp;CONNECT&nbsp;tunnel&nbsp;through&nbsp;Squid&lt;br&gt;<br>
*&nbsp;the&nbsp;squidclient&nbsp;test&nbsp;sends&nbsp;a&nbsp;plain&nbsp;text&nbsp;HTTP&nbsp;request&nbsp;to&nbsp;Squid&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;final&nbsp;origin&nbsp;server&nbsp;destination&nbsp;may&nbsp;be&nbsp;the&nbsp;same&nbsp;in&nbsp;both&nbsp;tests,&nbsp;but&lt;br&gt;<br>
the&nbsp;two&nbsp;transactions&nbsp;are&nbsp;completely&nbsp;different&nbsp;from&nbsp;Squid&nbsp;point&nbsp;of&nbsp;view.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step2&nbsp;allowed_https_sites&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;step3&nbsp;allowed_https_sites&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;terminate&nbsp;step3&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
AFAICT,&nbsp;this&nbsp;configuration&nbsp;is&nbsp;splicing&nbsp;or&nbsp;terminating&nbsp;all&nbsp;TLS&nbsp;traffic.&lt;br&gt;<br>
No&nbsp;bumping&nbsp;at&nbsp;all.&nbsp;If&nbsp;you&nbsp;want&nbsp;your&nbsp;Squid&nbsp;to&nbsp;bump&nbsp;TLS&nbsp;tunnels,&nbsp;then&nbsp;you&lt;br&gt;<br>
have&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;&quot;bump&quot;&nbsp;rule!&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;do&nbsp;not&nbsp;know&nbsp;what&nbsp;your&nbsp;overall&nbsp;SslBump&nbsp;needs&nbsp;are,&nbsp;but&nbsp;perhaps&nbsp;you&nbsp;meant&lt;br&gt;<br>
something&nbsp;like&nbsp;the&nbsp;following?&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;acl&nbsp;shouldBeBumped&nbsp;ssl::server_name&nbsp;.&lt;a&nbsp;href=&quot;http://amazonaws.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;amazonaws.com&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;ssl_bump&nbsp;stare&nbsp;all&lt;br&gt;<br>
 &nbsp; &nbsp;ssl_bump&nbsp;bump&nbsp;shouldBeBumped&lt;br&gt;<br>
 &nbsp; &nbsp;ssl_bump&nbsp;terminate&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;configuration&nbsp;above&nbsp;until&nbsp;you&nbsp;understand&nbsp;what&nbsp;it&lt;br&gt;<br>
does.&nbsp;Please&nbsp;see&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/SslPeekAndSplice&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/Features/SslPeekAndSplice&lt;/a&gt;&lt;br&gt;<br>
for&nbsp;details.&lt;br&gt;<br>
&lt;br&gt;<br>
Depending&nbsp;on&nbsp;your&nbsp;environment,&nbsp;the&nbsp;http_access&nbsp;rules&nbsp;may&nbsp;need&nbsp;to&nbsp;be&lt;br&gt;<br>
adjusted&nbsp;to&nbsp;allow&nbsp;CONNECT&nbsp;requests&nbsp;(to&nbsp;TLS-safe&nbsp;ports)&nbsp;to&nbsp;IP&nbsp;addresses&lt;br&gt;<br>
that&nbsp;do&nbsp;not&nbsp;result&nbsp;in&nbsp;.&lt;a&nbsp;href=&quot;http://amazonaws.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;amazonaws.com&lt;/a&gt;&nbsp;in&nbsp;reverse&nbsp;DNS&nbsp;lookups.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
