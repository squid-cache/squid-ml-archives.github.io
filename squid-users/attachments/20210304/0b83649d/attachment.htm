<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;Hi&nbsp;guys,&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I’m&nbsp;asking&nbsp;here&nbsp;but&nbsp;since&nbsp;I’m&nbsp;not&nbsp;too&nbsp;comfortable&nbsp;with&nbsp;a&nbsp;mailing&nbsp;list,&nbsp;it’s&nbsp;also&nbsp;on&nbsp;&lt;a&nbsp;href=&quot;http://serverfault.com&quot;&nbsp;class=&quot;&quot;&gt;serverfault.com&lt;/a&gt;:&nbsp;&lt;a&nbsp;href=&quot;https://serverfault.com/questions/1055663/squid-icap-not-working-if-using-tls-interception-but-both-work-separately&quot;&nbsp;class=&quot;&quot;&gt;https://serverfault.com/questions/1055663/squid-icap-not-working-if-using-tls-interception-but-both-work-separately&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I&nbsp;have&nbsp;an&nbsp;odd&nbsp;issue&nbsp;that&nbsp;squid&nbsp;will&nbsp;return&nbsp;a&nbsp;HTTP&nbsp;503&nbsp;when&nbsp;I&nbsp;try&nbsp;to&nbsp;do&nbsp;ICAP&nbsp;for&nbsp;an&nbsp;ssl-bumped&nbsp;HTTPS&nbsp;website.&nbsp;HTTP&nbsp;website&nbsp;works&nbsp;fine.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Any&nbsp;ideas?&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Config:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;visible_hostname&nbsp;proxy&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;forwarded_for&nbsp;delete&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;via&nbsp;off&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;httpd_suppress_version_string&nbsp;on&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;logfile_rotate&nbsp;0&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;cache_log&nbsp;stdio:/dev/stdout&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;access_log&nbsp;stdio:/dev/stdout&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;cache_store_log&nbsp;stdio:/dev/stdout&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;dns_v4_first&nbsp;on&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;cache_dir&nbsp;ufs&nbsp;/cache&nbsp;100&nbsp;16&nbsp;256&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;pid_filename&nbsp;/cache/squid.pid&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;mime_table&nbsp;/usr/share/squid/mime.conf&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;http_port&nbsp;0.0.0.0:3128&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;https_port&nbsp;0.0.0.0:3129&nbsp;\&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=10MB&nbsp;\&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;tls-cert=/etc/squid/ssl/squid.crt&nbsp;tls-key=/etc/squid/ssl/squid.key&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;ssl_bump&nbsp;peek&nbsp;all&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;ssl_bump&nbsp;bump&nbsp;all&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;quick_abort_min&nbsp;0&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;quick_abort_max&nbsp;0&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;quick_abort_pct&nbsp;95&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;pinger_enable&nbsp;off&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;icap_enable&nbsp;on&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;icap_service_failure_limit&nbsp;-1&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;icap_service&nbsp;service_req&nbsp;reqmod_precache&nbsp;bypass=0&nbsp;&lt;a&nbsp;href=&quot;icap://10.10.0.119:1344/&quot;&nbsp;class=&quot;&quot;&gt;icap://10.10.0.119:1344/&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;icap_preview_enable&nbsp;on&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;adaptation_access&nbsp;service_req&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;cache_mem&nbsp;512&nbsp;mb&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;dns_nameservers&nbsp;1.1.1.1&nbsp;1.0.0.1&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;cache_effective_user&nbsp;proxy&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;sslcrtd_program&nbsp;/usr/lib/squid/security_file_certgen&nbsp;-s&nbsp;/cache/ssl_db&nbsp;-M&nbsp;4MB&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;sslcrtd_children&nbsp;8&nbsp;startup=1&nbsp;idle=1&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;http_access&nbsp;allow&nbsp;all&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Log&nbsp;line&nbsp;HTTPS&nbsp;when&nbsp;it&nbsp;doesn’t&nbsp;work:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;1614853306.542&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;172.17.0.1&nbsp;NONE/503&nbsp;0&nbsp;CONNECT&nbsp;//&lt;a&nbsp;href=&quot;http://ironpeak.be:443&quot;&nbsp;class=&quot;&quot;&gt;ironpeak.be:443&lt;/a&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;&nbsp;HTTP/1.1&nbsp;503&nbsp;Service&nbsp;Unavailable&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;&nbsp;Server:&nbsp;squid&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;&nbsp;Mime-Version:&nbsp;1.0&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;&nbsp;Date:&nbsp;Thu,&nbsp;04&nbsp;Mar&nbsp;2021&nbsp;10:36:05&nbsp;GMT&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;&nbsp;Content-Type:&nbsp;text/html;charset=utf-8&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;&nbsp;Content-Length:&nbsp;1849&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;&nbsp;X-Squid-Error:&nbsp;ERR_DNS_FAIL&nbsp;0&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Log&nbsp;line&nbsp;HTTP&nbsp;when&nbsp;it&nbsp;does&nbsp;work:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&nbsp;&nbsp;-1&nbsp;1614851916&nbsp;text/plain&nbsp;60/60&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://ironpeak.be/blog/big-sur-t2rminator/&quot;&nbsp;class=&quot;&quot;&gt;http://ironpeak.be/blog/big-sur-t2rminator/&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;1614853320.743&nbsp;SWAPOUT&nbsp;00&nbsp;00000002&nbsp;F7A390D89822E9BA831C47E1B4CDD0A8&nbsp;&nbsp;301&nbsp;1614853320&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1&nbsp;1614853320&nbsp;text/plain&nbsp;60/60&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://ironpeak.be/blog/big-sur-t2rminator/&quot;&nbsp;class=&quot;&quot;&gt;http://ironpeak.be/blog/big-sur-t2rminator/&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;1614853320.748&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;172.17.0.1&nbsp;TCP_REFRESH_MODIFIED/301&nbsp;1647&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;http://ironpeak.be/blog/big-sur-t2rminator/&quot;&nbsp;class=&quot;&quot;&gt;http://ironpeak.be/blog/big-sur-t2rminator/&lt;/a&gt;&nbsp;-&nbsp;HIER_DIRECT/104.21.60.47&nbsp;text/plain&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Example&nbsp;CLI&nbsp;command&nbsp;used:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;ALL_PROXY=&quot;&lt;a&nbsp;href=&quot;https://127.0.0.1:3129&quot;&nbsp;class=&quot;&quot;&gt;https://127.0.0.1:3129&lt;/a&gt;&quot;&nbsp;curl&nbsp;-vvv&nbsp;--proxy-insecure&nbsp;&lt;a&nbsp;href=&quot;http://ironpeak.be/&quot;&nbsp;class=&quot;&quot;&gt;http://ironpeak.be/&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Command&nbsp;used&nbsp;to&nbsp;start&nbsp;squid:&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;pre&nbsp;style=&quot;background-color:&nbsp;rgb(255,&nbsp;255,&nbsp;255);&nbsp;color:&nbsp;rgb(82,&nbsp;91,&nbsp;107);&nbsp;font-family:&nbsp;&quot;JetBrains&nbsp;Mono&quot;,&nbsp;monospace;&quot;&nbsp;class=&quot;&quot;&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(105,&nbsp;159,&nbsp;66);&quot;&nbsp;class=&quot;&quot;&gt;exec&nbsp;/usr/sbin/squid&nbsp;-f&nbsp;/etc/squid/squid.conf&nbsp;--foreground&nbsp;-YCd&nbsp;1&lt;/span&gt;&lt;/pre&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Package&nbsp;info:&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Package:&nbsp;squid-openssl&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Version:&nbsp;4.13-5&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Many&nbsp;thanks!&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;<br>
&lt;meta&nbsp;charset=&quot;UTF-8&quot;&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;style=&quot;caret-color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Helvetica;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant-caps:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;text-decoration:&nbsp;none;&quot;&gt;Regards,&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;Niels&nbsp;Hofmans&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;SITE&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;https://ironpeak.be&quot;&nbsp;class=&quot;&quot;&gt;https://ironpeak.be&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
