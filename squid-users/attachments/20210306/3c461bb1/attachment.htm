<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;line-break:&nbsp;after-white-space;&quot;&nbsp;class=&quot;&quot;&gt;Hi&nbsp;Alex,&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;I’ve&nbsp;uploaded&nbsp;a&nbsp;tcpdump&nbsp;sample&nbsp;of&nbsp;where&nbsp;I’m&nbsp;requesting&nbsp;an&nbsp;image&nbsp;through&nbsp;squid&nbsp;+&nbsp;icap&nbsp;and&nbsp;where&nbsp;you&nbsp;can&nbsp;see&nbsp;the&nbsp;image&nbsp;response&nbsp;being&nbsp;posted&nbsp;fully&nbsp;to&nbsp;the&nbsp;ICAP&nbsp;service.&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Headers&nbsp;passed&nbsp;on&nbsp;are&nbsp;Preview:&nbsp;0&nbsp;for&nbsp;RESPMOD&nbsp;and&nbsp;Transfer-Preview:&nbsp;*.&nbsp;(I&nbsp;only&nbsp;need&nbsp;the&nbsp;headers&nbsp;for&nbsp;the&nbsp;response)&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;PCAP:&nbsp;&lt;a&nbsp;href=&quot;https://www.mediafire.com/file/k7zs51lg9s5ka3h/icap.pcap/file&quot;&nbsp;class=&quot;&quot;&gt;https://www.mediafire.com/file/k7zs51lg9s5ka3h/icap.pcap/file&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Many&nbsp;thanks&nbsp;for&nbsp;co-debugging.&nbsp;:-)&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Enjoy&nbsp;your&nbsp;weekend!&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;&quot;&gt;Regards,&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;style=&quot;caret-color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Helvetica;&nbsp;font-size:&nbsp;12px;&nbsp;font-style:&nbsp;normal;&nbsp;font-variant-caps:&nbsp;normal;&nbsp;font-weight:&nbsp;normal;&nbsp;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&nbsp;text-decoration:&nbsp;none;&quot;&gt;Niels&nbsp;Hofmans&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;SITE&nbsp;&nbsp;&nbsp;&lt;a&nbsp;href=&quot;https://ironpeak.be&quot;&nbsp;class=&quot;&quot;&gt;https://ironpeak.be&lt;/a&gt;&lt;br&nbsp;class=&quot;&quot;&gt;BTW&nbsp;&nbsp;&nbsp;BE0694785660&lt;br&nbsp;class=&quot;&quot;&gt;BANK&nbsp;BE76068909740795&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;5&nbsp;Mar&nbsp;2021,&nbsp;at&nbsp;23:32,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;class=&quot;&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;&lt;div&nbsp;class=&quot;&quot;&gt;On&nbsp;3/5/21&nbsp;5:21&nbsp;PM,&nbsp;Niels&nbsp;Hofmans&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;I&nbsp;receive&nbsp;that&nbsp;large&nbsp;payload&nbsp;right&nbsp;after&nbsp;an&nbsp;OPTIONS&nbsp;call&nbsp;to&nbsp;my&nbsp;ICAP&nbsp;endpoint.&nbsp;It&nbsp;is&nbsp;the&nbsp;preview.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;The&nbsp;timing&nbsp;of&nbsp;an&nbsp;ICAP&nbsp;request&nbsp;does&nbsp;not&nbsp;determine&nbsp;whether&nbsp;that&nbsp;request&lt;br&nbsp;class=&quot;&quot;&gt;has&nbsp;a&nbsp;Preview&nbsp;stage&nbsp;and&nbsp;whether&nbsp;the&nbsp;&quot;unexpected&quot;&nbsp;body&nbsp;bytes&nbsp;were&nbsp;sent&lt;br&nbsp;class=&quot;&quot;&gt;during&nbsp;that&nbsp;Preview&nbsp;stage.&nbsp;I&nbsp;am&nbsp;asking&nbsp;these&nbsp;questions&nbsp;because&nbsp;I&nbsp;want&nbsp;to&lt;br&nbsp;class=&quot;&quot;&gt;determine&nbsp;whether&nbsp;Squid&nbsp;increases&nbsp;Preview&nbsp;size&nbsp;beyond&nbsp;what&nbsp;your&nbsp;server&lt;br&nbsp;class=&quot;&quot;&gt;has&nbsp;requested&nbsp;or&nbsp;does&nbsp;not&nbsp;send&nbsp;Preview&nbsp;at&nbsp;all.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Please&nbsp;share&nbsp;the&nbsp;ICAP&nbsp;headers&nbsp;of&nbsp;the&nbsp;problematic&nbsp;REQMOD&nbsp;request&nbsp;and&nbsp;the&lt;br&nbsp;class=&quot;&quot;&gt;last&nbsp;chunk&nbsp;metadata&nbsp;of&nbsp;that&nbsp;request&nbsp;body.&nbsp;You&nbsp;can&nbsp;get&nbsp;the&nbsp;latter&nbsp;from&nbsp;a&lt;br&nbsp;class=&quot;&quot;&gt;packet&nbsp;capture&nbsp;if&nbsp;your&nbsp;ICAP&nbsp;server&nbsp;does&nbsp;not&nbsp;report&nbsp;it&nbsp;in&nbsp;a&nbsp;convenient&lt;br&nbsp;class=&quot;&quot;&gt;form.&nbsp;In&nbsp;fact,&nbsp;sharing&nbsp;(a&nbsp;pointer&nbsp;to)&nbsp;the&nbsp;packet&nbsp;capture&nbsp;of&nbsp;the&nbsp;whole&lt;br&nbsp;class=&quot;&quot;&gt;problematic&nbsp;ICAP&nbsp;request&nbsp;is&nbsp;probably&nbsp;a&nbsp;good&nbsp;idea!&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Alex.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;On&nbsp;5&nbsp;Mar&nbsp;2021,&nbsp;at&nbsp;17:21,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;﻿On&nbsp;3/5/21&nbsp;2:55&nbsp;AM,&nbsp;Niels&nbsp;Hofmans&nbsp;wrote:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;One&nbsp;more:&nbsp;I&nbsp;believe&nbsp;ICAP&nbsp;is&nbsp;not&nbsp;respecting&nbsp;the&nbsp;Preview&nbsp;header&nbsp;for&nbsp;REQMOD&lt;br&nbsp;class=&quot;&quot;&gt;nor&nbsp;RESPMOD.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;For&nbsp;the&nbsp;REQMOD&nbsp;OPTIONS&nbsp;requests,&nbsp;I&nbsp;respond&nbsp;with:&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;ICAP/1.0&nbsp;200&nbsp;OK&lt;br&nbsp;class=&quot;&quot;&gt;Allow:&nbsp;200,204&lt;br&nbsp;class=&quot;&quot;&gt;Connection:&nbsp;close&lt;br&nbsp;class=&quot;&quot;&gt;Date:&nbsp;Fri,&nbsp;05&nbsp;Mar&nbsp;2021&nbsp;07:34:56&nbsp;GMT&lt;br&nbsp;class=&quot;&quot;&gt;Encapsulated:&nbsp;null-body=0&lt;br&nbsp;class=&quot;&quot;&gt;Methods:&nbsp;REQMOD&lt;br&nbsp;class=&quot;&quot;&gt;Preview:&nbsp;64000&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;However&nbsp;in&nbsp;my&nbsp;ICAP&nbsp;service,&nbsp;I&nbsp;often&nbsp;receive&nbsp;a&nbsp;request&nbsp;body&nbsp;over&nbsp;64000&lt;br&nbsp;class=&quot;&quot;&gt;bytes,&nbsp;e.g.&nbsp;1000000&nbsp;request&nbsp;bytes.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Receive&nbsp;when?&nbsp;During&nbsp;preview,&nbsp;instead&nbsp;of&nbsp;Preview,&nbsp;and/or&nbsp;after&nbsp;Preview?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;I&nbsp;also&nbsp;noticed&nbsp;that&nbsp;a&nbsp;&quot;Preview:&nbsp;0”&nbsp;will&nbsp;not&nbsp;have&nbsp;any&nbsp;effect&nbsp;and&nbsp;the&nbsp;ICAP&lt;br&nbsp;class=&quot;&quot;&gt;service&nbsp;will&nbsp;still&nbsp;receive&nbsp;a&nbsp;complete&nbsp;HTTP&nbsp;REQMOD+REQRESP&nbsp;body.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Receive&nbsp;when?&nbsp;During&nbsp;preview,&nbsp;instead&nbsp;of&nbsp;Preview,&nbsp;and/or&nbsp;after&nbsp;Preview?&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;Alex.&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;class=&quot;&quot;&gt;icap_enable&nbsp;on&lt;br&nbsp;class=&quot;&quot;&gt;icap_connect_timeout&nbsp;1&nbsp;second&lt;br&nbsp;class=&quot;&quot;&gt;icap_service_failure_limit&nbsp;-1&lt;br&nbsp;class=&quot;&quot;&gt;icap_send_client_ip&nbsp;&nbsp;&nbsp;&nbsp;on&lt;br&nbsp;class=&quot;&quot;&gt;icap_preview_size&nbsp;0&lt;br&nbsp;class=&quot;&quot;&gt;icap_persistent_connections&nbsp;on&lt;br&nbsp;class=&quot;&quot;&gt;icap_service&nbsp;service_req&nbsp;reqmod_precache&nbsp;bypass=0&nbsp;&lt;a&nbsp;href=&quot;icap://172.17.0.2:1344/request&quot;&nbsp;class=&quot;&quot;&gt;icap://172.17.0.2:1344/request&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;icap://172.17.0.2:1344/request&quot;&nbsp;class=&quot;&quot;&gt;icap://172.17.0.2:1344/request&lt;/a&gt;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;icap_service&nbsp;service_res&nbsp;respmod_precache&nbsp;bypass=0&nbsp;&lt;a&nbsp;href=&quot;icap://172.17.0.2:1344/response&quot;&nbsp;class=&quot;&quot;&gt;icap://172.17.0.2:1344/response&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;icap://172.17.0.2:1344/response&quot;&nbsp;class=&quot;&quot;&gt;icap://172.17.0.2:1344/response&lt;/a&gt;&gt;&lt;br&nbsp;class=&quot;&quot;&gt;icap_preview_enable&nbsp;on&lt;br&nbsp;class=&quot;&quot;&gt;adaptation_access&nbsp;service_req&nbsp;allow&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;adaptation_access&nbsp;service_res&nbsp;allow&nbsp;all&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/blockquote&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&nbsp;class=&quot;&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
