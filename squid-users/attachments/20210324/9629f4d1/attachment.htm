<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Alex,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;have&nbsp;just&nbsp;started&nbsp;to&nbsp;integrate&nbsp;squid&nbsp;proxy&nbsp;in&nbsp;our&nbsp;project,&nbsp;thanks&nbsp;for&nbsp;your&nbsp;reply&nbsp;and&nbsp;support.&nbsp;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Previously&nbsp;we&nbsp;were&nbsp;seeing&nbsp;TCP_TUNNEL&nbsp;for&nbsp;&lt;a&nbsp;href=&quot;https://www.google.com&quot;&gt;https://www.google.com&lt;/a&gt;.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Now,&nbsp;we&nbsp;are&nbsp;able&nbsp;to&nbsp;see&nbsp;the&nbsp;TCP_MISS&nbsp;transactions&nbsp;for&nbsp;&lt;a&nbsp;href=&quot;https://www.google.com&quot;&gt;https://www.google.com&lt;/a&gt;. &lt;/div&gt;&lt;div&gt;As &lt;a&nbsp;href=&quot;https://www.google.com&quot;&gt;https://www.google.com&lt;/a&gt;&nbsp;does&nbsp;not&nbsp;contain&nbsp;a&nbsp;cache-control&nbsp;header&nbsp;in&nbsp;response,&nbsp;the&nbsp;response&nbsp;cannot&nbsp;be&nbsp;cached&nbsp;which&nbsp;we&nbsp;are&nbsp;aware&nbsp;of.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1616580079.857&nbsp; &nbsp; &nbsp;73&nbsp;::1&nbsp;NONE/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://www.google.com:443&quot;&gt;www.google.com:443&lt;/a&gt;&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://172.217.163.68&quot;&gt;172.217.163.68&lt;/a&gt;&nbsp;-&lt;br&gt;1616580079.945&nbsp; &nbsp; &nbsp;44&nbsp;::1&nbsp;TCP_MISS/200&nbsp;967&nbsp;HEAD&nbsp;&lt;a&nbsp;href=&quot;https://www.google.com/&quot;&gt;https://www.google.com/&lt;/a&gt;&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://172.217.163.68&quot;&gt;172.217.163.68&lt;/a&gt;&nbsp;text/html&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;generated&nbsp;key.pem&nbsp;and&nbsp;cert.pem&nbsp;files&nbsp;using&nbsp;openssl&nbsp;and&nbsp;when&nbsp;i&nbsp;tried&nbsp;to&nbsp;connect&nbsp;a&nbsp;local&nbsp;python&nbsp;https&nbsp;web&nbsp;server&nbsp;which&nbsp;has&nbsp;cache-control&nbsp;headers&nbsp;in&nbsp;https&nbsp;response,&nbsp;got&nbsp;the&nbsp;below&nbsp;error,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;root@raspberrypi-rdk-hybrid:~#&nbsp;curl&nbsp;-I&nbsp;&lt;a&nbsp;href=&quot;https://192.168.1.41:443&quot;&gt;https://192.168.1.41:443&lt;/a&gt;&nbsp;--proxy-cacert&nbsp;cert.pem&nbsp;--proxy&nbsp;&lt;a&nbsp;href=&quot;http://localhost:3128&quot;&gt;http://localhost:3128&lt;/a&gt;&lt;br&gt;HTTP/1.1&nbsp;200&nbsp;Connection&nbsp;established&lt;br&gt;&lt;br&gt;curl:&nbsp;(60)&nbsp;SSL&nbsp;certificate&nbsp;problem:&nbsp;unable&nbsp;to&nbsp;get&nbsp;local&nbsp;issuer&nbsp;certificate&lt;br&gt;More&nbsp;details&nbsp;here:&nbsp;&lt;a&nbsp;href=&quot;https://curl.haxx.se/docs/sslcerts.html&quot;&gt;https://curl.haxx.se/docs/sslcerts.html&lt;/a&gt;&lt;br&gt;&lt;br&gt;curl&nbsp;failed&nbsp;to&nbsp;verify&nbsp;the&nbsp;legitimacy&nbsp;of&nbsp;the&nbsp;server&nbsp;and&nbsp;therefore&nbsp;could&nbsp;not&lt;br&gt;establish&nbsp;a&nbsp;secure&nbsp;connection&nbsp;to&nbsp;it.&nbsp;To&nbsp;learn&nbsp;more&nbsp;about&nbsp;this&nbsp;situation&nbsp;and&lt;br&gt;how&nbsp;to&nbsp;fix&nbsp;it,&nbsp;please&nbsp;visit&nbsp;the&nbsp;web&nbsp;page&nbsp;mentioned&nbsp;above.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Have&nbsp;attached&nbsp;the&nbsp;squid.conf&nbsp;file&nbsp;for&nbsp;your&nbsp;reference.&nbsp;Can&nbsp;you&nbsp;please&nbsp;check&nbsp;and&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;I&nbsp;am&nbsp;missing&nbsp;something&nbsp;?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Regards,&lt;/div&gt;&lt;div&gt;Vignesh &lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Tue,&nbsp;Mar&nbsp;23,&nbsp;2021&nbsp;at&nbsp;7:44&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;3/23/21&nbsp;2:10&nbsp;AM,&nbsp;Vignesh&nbsp;Ramessh&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Currently&nbsp;am&nbsp;running&nbsp;squid&nbsp;version&nbsp;4.14&nbsp;on&nbsp;RPi3.&lt;br&gt;<br>
&gt;&nbsp;Trying&nbsp;to&nbsp;cache&nbsp;https&nbsp;responses&nbsp;with&nbsp;cache-control:max-age&nbsp;headers&lt;br&gt;<br>
&gt;&nbsp;available,&lt;br&gt;<br>
&gt;&nbsp;using&nbsp;ssl&nbsp;bump&nbsp;-&nbsp;peek&nbsp;n&nbsp;splice&nbsp;feature&nbsp;with&nbsp;examples&nbsp;available&nbsp;in&nbsp;this&lt;br&gt;<br>
&gt;&nbsp;link&nbsp;:- &lt;a&nbsp;href=&quot;https://elatov.github.io/2019/01/using-squid-to-proxy-ssl-sites/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://elatov.github.io/2019/01/using-squid-to-proxy-ssl-sites/&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
 &nbsp; ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;<br>
 &nbsp; ssl_bump&nbsp;splice&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
AFAICT,&nbsp;the&nbsp;above&nbsp;&quot;bump&nbsp;all&nbsp;during&nbsp;step2&quot;&nbsp;configuration&nbsp;(the&nbsp;last&nbsp;line&lt;br&gt;<br>
does&nbsp;not&nbsp;do&nbsp;anything&nbsp;and&nbsp;should&nbsp;be&nbsp;removed)&nbsp;should&nbsp;bump&nbsp;all&nbsp;traffic.&nbsp;Is&lt;br&gt;<br>
that&nbsp;your&nbsp;configuration?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;But&nbsp;the&nbsp;https&nbsp;caching&nbsp;doesnt&nbsp;seem&nbsp;to&nbsp;work,&nbsp;https&nbsp;connections&nbsp;are&nbsp;getting&lt;br&gt;<br>
&gt;&nbsp;established&nbsp;as&nbsp;TCP_TUNNEL/200&nbsp;in&nbsp;squid&nbsp;access&nbsp;logs.&lt;br&gt;<br>
&lt;br&gt;<br>
Do&nbsp;you&nbsp;see&nbsp;non-CONNECT&nbsp;HTTP&nbsp;traffic&nbsp;(e.g.&nbsp;GET,&nbsp;POST,&nbsp;etc.)&nbsp;in&nbsp;access&lt;br&gt;<br>
log?&nbsp;If&nbsp;not,&nbsp;then&nbsp;Squid&nbsp;is&nbsp;not&nbsp;bumping&nbsp;traffic&nbsp;OR&nbsp;the&nbsp;client&nbsp;does&nbsp;not&lt;br&gt;<br>
like&nbsp;what&nbsp;Squid&nbsp;is&nbsp;doing.&nbsp;Please&nbsp;post&nbsp;your&nbsp;http*_port&nbsp;and&nbsp;ssl_bump&lt;br&gt;<br>
configuration&nbsp;with&nbsp;access.log&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;a&nbsp;single&nbsp;test&lt;br&gt;<br>
transaction&nbsp;that&nbsp;you&nbsp;think&nbsp;should&nbsp;be&nbsp;bumped.&lt;br&gt;<br>
&lt;br&gt;<br>
Also,&nbsp;does&nbsp;the&nbsp;client&nbsp;(e.g.&nbsp;curl,&nbsp;wget,&nbsp;or&nbsp;browser)&nbsp;get&nbsp;an&nbsp;error&nbsp;from&lt;br&gt;<br>
Squid?&nbsp;Does&nbsp;the&nbsp;client&nbsp;display&nbsp;any&nbsp;kind&nbsp;of&nbsp;warning&nbsp;or&nbsp;error&nbsp;at&nbsp;all?&nbsp;What&lt;br&gt;<br>
certificate&nbsp;does&nbsp;the&nbsp;client&nbsp;show&nbsp;for&nbsp;the&nbsp;test&nbsp;connection?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;wasnt&nbsp;able&nbsp;to&nbsp;find&nbsp;any&nbsp;proper&nbsp;documentation&nbsp;on&nbsp;https&nbsp;caching&nbsp;using&nbsp;squid.&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;you&nbsp;call&nbsp;&quot;HTTPS&nbsp;caching&quot;&nbsp;consists&nbsp;of&nbsp;two&nbsp;virtually&nbsp;independent&lt;br&gt;<br>
actions:&nbsp;Bumping&nbsp;HTTPS&nbsp;connections&nbsp;and&nbsp;caching.&nbsp;Documentation&nbsp;exists&nbsp;for&lt;br&gt;<br>
each&nbsp;action.&nbsp;Currently,&nbsp;it&nbsp;sounds&nbsp;like&nbsp;the&nbsp;first&nbsp;action&nbsp;(bumping)&nbsp;is&nbsp;not&lt;br&gt;<br>
working&nbsp;in&nbsp;your&nbsp;setup.&nbsp;Until&nbsp;that&nbsp;is&nbsp;addressed,&nbsp;you&nbsp;can&nbsp;ignore&nbsp;the&lt;br&gt;<br>
caching&nbsp;part.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
