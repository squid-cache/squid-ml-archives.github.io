<tt>
&lt;!DOCTYPE&nbsp;html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;&lt;/title&gt;&lt;style&nbsp;type=&quot;text/css&quot;&gt;p.MsoNormal,p.MsoNoSpacing{margin:0}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;div&gt;Hi!,&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I've&nbsp;recently&nbsp;been&nbsp;trying&nbsp;to&nbsp;update&nbsp;my&nbsp;version&nbsp;of&nbsp;squid&nbsp;from&nbsp;4.0.20&nbsp;to&nbsp;something&nbsp;more&nbsp;modern&nbsp;(4.13),&nbsp;but&nbsp;I'm&nbsp;having&nbsp;issues&nbsp;with&nbsp;my&nbsp;TLS&nbsp;enabled&nbsp;proxy&nbsp;not&nbsp;returning&nbsp;certificates&nbsp;correctly&nbsp;(it&nbsp;seems).&nbsp;&nbsp;&nbsp;Specifically,&nbsp;when&nbsp;I&nbsp;try&nbsp;and&nbsp;run&nbsp;the&nbsp;following&nbsp;curl&nbsp;(url&nbsp;replaced&nbsp;to&nbsp;protect&nbsp;the&nbsp;innocent):&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&lt;/div&gt;&lt;div&gt;curl&nbsp;-vvI&nbsp;&nbsp;--proxy&nbsp;&lt;a&nbsp;href=&quot;https://vvnncqvnjkclsuu3ctvdp5k4ck72-uupfpbnf.mirageid.com:5000&quot;&gt;https://test.example.com:5000&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;https://google.com&quot;&gt;https://google.com&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;get&nbsp;the&nbsp;following&nbsp;result:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;&nbsp;&nbsp;Trying&nbsp;167.99.53.100:5000...&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;Connected&nbsp;to&nbsp;test.example.com&nbsp;port&nbsp;5000&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;ALPN,&nbsp;offering&nbsp;http/1.1&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;successfully&nbsp;set&nbsp;certificate&nbsp;verify&nbsp;locations:&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;&nbsp;CAfile:&nbsp;/etc/ssl/certs/ca-certificates.crt&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;&nbsp;CApath:&nbsp;none&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(OUT),&nbsp;TLS&nbsp;handshake,&nbsp;Client&nbsp;hello&nbsp;(1):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Server&nbsp;hello&nbsp;(2):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Encrypted&nbsp;Extensions&nbsp;(8):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Certificate&nbsp;(11):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(OUT),&nbsp;TLS&nbsp;alert,&nbsp;unknown&nbsp;CA&nbsp;(560):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;SSL&nbsp;certificate&nbsp;problem:&nbsp;unable&nbsp;to&nbsp;get&nbsp;local&nbsp;issuer&nbsp;certificate&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;Closing&nbsp;connection&nbsp;0&lt;br&gt;&lt;/div&gt;&lt;div&gt;curl:&nbsp;(60)&nbsp;SSL&nbsp;certificate&nbsp;problem:&nbsp;unable&nbsp;to&nbsp;get&nbsp;local&nbsp;issuer&nbsp;certificate&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;different&nbsp;then&nbsp;what&nbsp;I&nbsp;get&nbsp;for&nbsp;my&nbsp;old&nbsp;4.0.20&nbsp;server:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;Connected&nbsp;to&nbsp;test.example.com&nbsp;port&nbsp;3128&nbsp;(#0)&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;successfully&nbsp;set&nbsp;certificate&nbsp;verify&nbsp;locations:&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;&nbsp;CAfile:&nbsp;/etc/ssl/certs/ca-certificates.crt&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;&nbsp;CApath:&nbsp;none&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(OUT),&nbsp;TLS&nbsp;handshake,&nbsp;Client&nbsp;hello&nbsp;(1):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Server&nbsp;hello&nbsp;(2):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Certificate&nbsp;(11):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Server&nbsp;key&nbsp;exchange&nbsp;(12):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Server&nbsp;finished&nbsp;(14):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(OUT),&nbsp;TLS&nbsp;handshake,&nbsp;Client&nbsp;key&nbsp;exchange&nbsp;(16):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(OUT),&nbsp;TLS&nbsp;change&nbsp;cipher,&nbsp;Change&nbsp;cipher&nbsp;spec&nbsp;(1):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(OUT),&nbsp;TLS&nbsp;handshake,&nbsp;Finished&nbsp;(20):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Finished&nbsp;(20):&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;SSL&nbsp;connection&nbsp;using&nbsp;TLSv1.2&nbsp;/&nbsp;ECDHE-RSA-AES256-GCM-SHA384&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;Proxy&nbsp;certificate:&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;&nbsp;subject:&nbsp;CN=*.example.com&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;&nbsp;start&nbsp;date:&nbsp;Apr&nbsp;&nbsp;5&nbsp;21:02:06&nbsp;2021&nbsp;GMT&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;&nbsp;expire&nbsp;date:&nbsp;May&nbsp;&nbsp;7&nbsp;21:02:06&nbsp;2022&nbsp;GMT&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;&nbsp;issuer:&nbsp;C=BE;&nbsp;O=GlobalSign&nbsp;nv-sa;&nbsp;CN=AlphaSSL&nbsp;CA&nbsp;-&nbsp;SHA256&nbsp;-&nbsp;G2&lt;br&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;&nbsp;SSL&nbsp;certificate&nbsp;verify&nbsp;ok.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;the&nbsp;config&nbsp;and&nbsp;certs&nbsp;are&nbsp;exactly&nbsp;the&nbsp;same!&nbsp;&nbsp;I've&nbsp;pasted&nbsp;the&nbsp;config,&nbsp;output&nbsp;of&nbsp;squid&nbsp;-v,&nbsp;and&nbsp;cert&nbsp;information&nbsp;here:&nbsp;&nbsp;&lt;a&nbsp;href=&quot;https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b&quot;&gt;https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;One&nbsp;difference&nbsp;between&nbsp;the&nbsp;two&nbsp;that&nbsp;I&nbsp;noticed&nbsp;is&nbsp;that&nbsp;the&nbsp;old&nbsp;version&nbsp;is&nbsp;compiled&nbsp;with&nbsp;--with-openssl&nbsp;and&nbsp;--enable-ssl&nbsp;and&nbsp;-enable-ssl-crtd,&nbsp;and&nbsp;the&nbsp;new&nbsp;version&nbsp;only&nbsp;has&nbsp;--with-gnutls.&nbsp;&nbsp;Would&nbsp;that&nbsp;be&nbsp;the&nbsp;issue?&nbsp;&nbsp;I&nbsp;appreciate&nbsp;the&nbsp;help!&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;sig110441488&quot;&gt;&lt;div&nbsp;id=&quot;sig115675648&quot;&nbsp;class=&quot;signature&quot;&gt;&lt;div&nbsp;class=&quot;signature&quot;&gt;Dan&nbsp;Steen&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;signature&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
