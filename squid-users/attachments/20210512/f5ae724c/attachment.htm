<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;The&nbsp;main&nbsp;issue&nbsp;you&nbsp;are&nbsp;having&nbsp;is&nbsp;that&nbsp;the&nbsp;old&nbsp;version&nbsp;had&nbsp;no&nbsp;TLS/1.3&nbsp;support.&nbsp;The&nbsp;newer&nbsp;squid&nbsp;have&nbsp;some,&nbsp;but&nbsp;not&nbsp;enough&nbsp;for&nbsp;what&nbsp;you&nbsp;are&nbsp;doing.&lt;div&gt;&lt;br&gt;&lt;div&gt;Switching&nbsp;the&nbsp;build&nbsp;from&nbsp;GnuTLS&nbsp;to&nbsp;OpenSSL&nbsp;may&nbsp;work&nbsp;a&nbsp;little&nbsp;better.&nbsp;But&nbsp;without&nbsp;details&nbsp;of&nbsp;your&nbsp;config&nbsp;it&nbsp;is&nbsp;hard&nbsp;to&nbsp;be&nbsp;certain.&lt;br&gt;&lt;br&gt;Amos&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;line-height:1.5&quot;&gt;&lt;br&gt;&lt;br&gt;--------&nbsp;Original&nbsp;message&nbsp;--------&lt;br&gt;From:&nbsp;Dan&nbsp;Steen&nbsp;&lt;dan@mirageid.com&gt;&lt;br&gt;Date:&nbsp;Wed,&nbsp;12&nbsp;May&nbsp;2021,&nbsp;10:06&lt;br&gt;To:&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;Subject:&nbsp;[squid-users]&nbsp;https_port&nbsp;not&nbsp;correctly&nbsp;sending&nbsp;ssl&nbsp;cert&nbsp;information?&lt;br&gt;&lt;blockquote&gt;&lt;div&gt;&lt;div&gt;Hi!,&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;recently&nbsp;been&nbsp;trying&nbsp;to&nbsp;update&nbsp;my&nbsp;version&nbsp;of&nbsp;squid&nbsp;from&nbsp;4.0.20&nbsp;to&nbsp;something&nbsp;more&nbsp;modern&nbsp;(4.13),&nbsp;but&nbsp;I&#39;m&nbsp;having&nbsp;issues&nbsp;with&nbsp;my&nbsp;TLS&nbsp;enabled&nbsp;proxy&nbsp;not&nbsp;returning&nbsp;certificates&nbsp;correctly&nbsp;(it&nbsp;seems). &nbsp; Specifically,&nbsp;when&nbsp;I&nbsp;try&nbsp;and&nbsp;run&nbsp;the&nbsp;following&nbsp;curl&nbsp;(url&nbsp;replaced&nbsp;to&nbsp;protect&nbsp;the&nbsp;innocent):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;curl&nbsp;-vvI &nbsp;--proxy&nbsp;&lt;a&nbsp;href=&quot;https://vvnncqvnjkclsuu3ctvdp5k4ck72-uupfpbnf.mirageid.com:5000&quot;&gt;https://test.example.com:5000&lt;/a&gt;&nbsp;&lt;a&nbsp;href=&quot;https://google.com&quot;&gt;https://google.com&lt;/a&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;get&nbsp;the&nbsp;following&nbsp;result:&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*  &nbsp;Trying&nbsp;167.99.53.100:5000...&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;Connected&nbsp;to&nbsp;test.example.com&nbsp;port&nbsp;5000&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;ALPN,&nbsp;offering&nbsp;http/1.1&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;successfully&nbsp;set&nbsp;certificate&nbsp;verify&nbsp;locations:&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;* &nbsp;CAfile:&nbsp;/etc/ssl/certs/ca-certificates.crt&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;* &nbsp;CApath:&nbsp;none&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(OUT),&nbsp;TLS&nbsp;handshake,&nbsp;Client&nbsp;hello&nbsp;(1):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Server&nbsp;hello&nbsp;(2):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Encrypted&nbsp;Extensions&nbsp;(8):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Certificate&nbsp;(11):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(OUT),&nbsp;TLS&nbsp;alert,&nbsp;unknown&nbsp;CA&nbsp;(560):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;SSL&nbsp;certificate&nbsp;problem:&nbsp;unable&nbsp;to&nbsp;get&nbsp;local&nbsp;issuer&nbsp;certificate&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;Closing&nbsp;connection&nbsp;0&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;curl:&nbsp;(60)&nbsp;SSL&nbsp;certificate&nbsp;problem:&nbsp;unable&nbsp;to&nbsp;get&nbsp;local&nbsp;issuer&nbsp;certificate&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;different&nbsp;then&nbsp;what&nbsp;I&nbsp;get&nbsp;for&nbsp;my&nbsp;old&nbsp;4.0.20&nbsp;server:&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;Connected&nbsp;to&nbsp;test.example.com&nbsp;port&nbsp;3128&nbsp;(#0)&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;successfully&nbsp;set&nbsp;certificate&nbsp;verify&nbsp;locations:&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;* &nbsp;CAfile:&nbsp;/etc/ssl/certs/ca-certificates.crt&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;* &nbsp;CApath:&nbsp;none&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(OUT),&nbsp;TLS&nbsp;handshake,&nbsp;Client&nbsp;hello&nbsp;(1):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.3&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Server&nbsp;hello&nbsp;(2):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Certificate&nbsp;(11):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Server&nbsp;key&nbsp;exchange&nbsp;(12):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Server&nbsp;finished&nbsp;(14):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(OUT),&nbsp;TLS&nbsp;handshake,&nbsp;Client&nbsp;key&nbsp;exchange&nbsp;(16):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(OUT),&nbsp;TLS&nbsp;change&nbsp;cipher,&nbsp;Change&nbsp;cipher&nbsp;spec&nbsp;(1):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(OUT),&nbsp;TLS&nbsp;handshake,&nbsp;Finished&nbsp;(20):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;TLSv1.2&nbsp;(IN),&nbsp;TLS&nbsp;handshake,&nbsp;Finished&nbsp;(20):&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;SSL&nbsp;connection&nbsp;using&nbsp;TLSv1.2&nbsp;/&nbsp;ECDHE-RSA-AES256-GCM-SHA384&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;*&nbsp;Proxy&nbsp;certificate:&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;* &nbsp;subject:&nbsp;CN&#61;*.example.com&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;* &nbsp;start&nbsp;date:&nbsp;Apr &nbsp;5&nbsp;21:02:06&nbsp;2021&nbsp;GMT&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;* &nbsp;expire&nbsp;date:&nbsp;May &nbsp;7&nbsp;21:02:06&nbsp;2022&nbsp;GMT&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;* &nbsp;issuer:&nbsp;C&#61;BE;&nbsp;O&#61;GlobalSign&nbsp;nv-sa;&nbsp;CN&#61;AlphaSSL&nbsp;CA&nbsp;-&nbsp;SHA256&nbsp;-&nbsp;G2&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;* &nbsp;SSL&nbsp;certificate&nbsp;verify&nbsp;ok.&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;the&nbsp;config&nbsp;and&nbsp;certs&nbsp;are&nbsp;exactly&nbsp;the&nbsp;same! &nbsp;I&#39;ve&nbsp;pasted&nbsp;the&nbsp;config,&nbsp;output&nbsp;of&nbsp;squid&nbsp;-v,&nbsp;and&nbsp;cert&nbsp;information&nbsp;here:  &lt;a&nbsp;href=&quot;https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b&quot;&gt;https://gist.github.com/dansteen/c28343fd025c713bcfba8368ce2b728b&lt;/a&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;One&nbsp;difference&nbsp;between&nbsp;the&nbsp;two&nbsp;that&nbsp;I&nbsp;noticed&nbsp;is&nbsp;that&nbsp;the&nbsp;old&nbsp;version&nbsp;is&nbsp;compiled&nbsp;with --with-openssl&nbsp;and --enable-ssl&nbsp;and&nbsp;-enable-ssl-crtd,&nbsp;and&nbsp;the&nbsp;new&nbsp;version&nbsp;only&nbsp;has --with-gnutls. &nbsp;Would&nbsp;that&nbsp;be&nbsp;the&nbsp;issue? &nbsp;I&nbsp;appreciate&nbsp;the&nbsp;help!&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Dan&nbsp;Steen&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;
</tt>
