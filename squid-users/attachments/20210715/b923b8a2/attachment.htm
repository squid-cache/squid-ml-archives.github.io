<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;an&nbsp;env&nbsp;with&nbsp;Squid&nbsp;4&nbsp;with&nbsp;several&nbsp;ICAPs.&lt;/div&gt;&lt;div&gt;In&nbsp;this&nbsp;env,&nbsp;I&nbsp;set&nbsp;in&nbsp;squid.conf&nbsp;the&nbsp;following:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;adaptation_masterx_shared_names&nbsp;X-My-Header &lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;and&nbsp;I&nbsp;add&nbsp;an&nbsp;ICAP&nbsp;header&nbsp;X-My-Header&nbsp;with&nbsp;some&nbsp;data&nbsp;in&nbsp;one&nbsp;ICAP&nbsp;and&nbsp;next&nbsp;ICAPs&nbsp;can&nbsp;use&nbsp;it&nbsp;(I&nbsp;also&nbsp;see&nbsp;it&nbsp;in&nbsp;tcpdump&nbsp;output).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Now&nbsp;I&#39;m&nbsp;writing&nbsp;an&nbsp;eCAP&nbsp;and&nbsp;I&nbsp;did&nbsp;the&nbsp;following&nbsp;(for&nbsp;testing):&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;static&nbsp;const&nbsp;libecap::Name&nbsp;myHeader(&quot;X-My-Header&quot;,&nbsp;libecap::Name::NextId()); &lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;const&nbsp;libecap::Area&nbsp;Adapter::Xaction::option(const&nbsp;libecap::Name&nbsp;&amp;name)&nbsp;const&nbsp; &lt;br&gt;&nbsp;{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;br&gt;&nbsp; &nbsp; &nbsp;if&nbsp;(name&nbsp;==&nbsp;myHeader)&nbsp;{&lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;std::string&nbsp;t&nbsp;=&nbsp;&quot;popo&quot;; &nbsp; &lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;libecap::Area(t.data(),&nbsp;t.size());&lt;br&gt;&lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt; &nbsp; &nbsp;} &lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&nbsp; &nbsp; &nbsp;return&nbsp;libecap::Area();&lt;br&gt;&nbsp;}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;br&gt;&nbsp;void&nbsp;Adapter::Xaction::visitEachOption(libecap::NamedValueVisitor&nbsp;&amp;visitor)&nbsp;const&lt;br&gt;{&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;br&gt;&nbsp; &nbsp; &nbsp;std::string&nbsp;t&nbsp;=&nbsp;&quot;popo&quot;;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &lt;br&gt; &nbsp; &nbsp;visitor.visit(myHeader,&nbsp;libecap::Area(t.data(),&nbsp;t.size()));&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/blockquote&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;} &nbsp; &lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; It&nbsp;is&nbsp;much&nbsp;like&nbsp;the&nbsp;clamAV&nbsp;eCAP&nbsp;example.&lt;/div&gt;&lt;div&gt;What&nbsp;I&nbsp;see&nbsp;in&nbsp;tcpdump&nbsp;output&nbsp;is&nbsp;the&nbsp;following:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;X.....qZREQMOD&nbsp;icap://my.proxy:1234/request&nbsp;ICAP/1.0&lt;br&gt;Host:&nbsp;my.proxy:1234&lt;br&gt;Date:&nbsp;Wed,&nbsp;14&nbsp;Jul&nbsp;2021&nbsp;20:37:33&nbsp;GMT&lt;br&gt;X-My-Header:&nbsp;.&lt;br&gt;Encapsulated:&nbsp;req-hdr=0,&nbsp;null-body=427&lt;br&gt;Preview:&nbsp;0&lt;br&gt;Allow:&nbsp;204&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Meaning,&nbsp;it&nbsp;indeed&nbsp;added&nbsp;the&nbsp;X-My-Header&nbsp;as&nbsp;ICAP&nbsp;header&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;ICAP&nbsp;server&nbsp;on&nbsp;the&nbsp;chain&nbsp;but&nbsp;it&nbsp;seems&nbsp;the&nbsp;value&nbsp;is&nbsp;just&nbsp;a&nbsp;dot.&lt;/div&gt;&lt;div&gt;What&nbsp;am&nbsp;I&nbsp;doing&nbsp;wrong?&lt;/div&gt;&lt;div&gt;BTW,&nbsp;I&#39;m&nbsp;struggling&nbsp;to&nbsp;find&nbsp;a&nbsp;decent&nbsp;eCAP&nbsp;interface&nbsp;documentation.&nbsp;Can&nbsp;you&nbsp;please&nbsp;help&nbsp;me&nbsp;understand&nbsp;what&nbsp;is&nbsp;the&nbsp;difference&nbsp;between&nbsp;&#39;option&#39;&nbsp;and&nbsp;&#39;visitEachOption&#39; methods? &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&lt;/div&gt;&lt;div&gt;Moti &lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
