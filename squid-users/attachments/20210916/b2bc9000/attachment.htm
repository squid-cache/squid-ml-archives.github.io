<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#464646&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi&nbsp;comunity,&nbsp;Squid&nbsp;fans&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;use&nbsp;an&nbsp;external&nbsp;acl&nbsp;process&nbsp;for&nbsp;Geoip&nbsp;processing&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;have&nbsp;tried&nbsp;to&nbsp;setup&nbsp;squid&nbsp;to&nbsp;send&nbsp;the&nbsp;remote&nbsp;peer&nbsp;address&nbsp;using<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%&lt;a&nbsp;code&nbsp;but&nbsp;it&nbsp;always&nbsp;reply&nbsp;with&nbsp;a&nbsp;&quot;-&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external_acl_type&nbsp;MyGeopip&nbsp;ttl=3600&nbsp;negative_ttl=3600<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;children-startup=2&nbsp;children-idle=2&nbsp;children-max=20&nbsp;concurrency=1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipv4&nbsp;%un&nbsp;%SRC&nbsp;%SRCEUI48&nbsp;%&gt;ha{X-Forwarded-For}&nbsp;%DST<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%ssl::&gt;sni&nbsp;%USER_CERT_CN&nbsp;%note&nbsp;%&lt;a &nbsp;/lib/squid3/squid-geoip&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;&lt;/font&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;MyGeopip&lt;/font&gt;_acl<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;external&nbsp;&lt;/font&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;MyGeopip&nbsp;&lt;/font&gt;&lt;font<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;face=&quot;Arial&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;http_access&nbsp;deny&nbsp;!&lt;/font&gt;&lt;/font&gt;&lt;font<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;face=&quot;Arial&quot;&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;font<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;face=&quot;Arial&quot;&gt;MyGeopip&lt;/font&gt;_acl&nbsp;&lt;/font&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;was&nbsp;thinking&nbsp;that&nbsp;Squid&nbsp;call&nbsp;the&nbsp;helper&nbsp;before&nbsp;resolving&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remote&nbsp;route.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;So&nbsp;to&nbsp;force&nbsp;it,&nbsp;i&nbsp;have&nbsp;added&nbsp;a&nbsp;&quot;fake&quot;&nbsp;acl&nbsp;to&nbsp;force&nbsp;Squid&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calculate&nbsp;the&nbsp;remote&nbsp;address.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;acl&nbsp;fake_dst&nbsp;dst&nbsp;127.0.0.2&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http_access&nbsp;deny&nbsp;!&lt;/font&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;fake_dst<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;!&lt;/font&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;font<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;face=&quot;Arial&quot;&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;MyGeopip&lt;/font&gt;_acl <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;But&nbsp;it&nbsp;failed&nbsp;too,&nbsp;the&nbsp;external_acl&nbsp;still&nbsp;receive&nbsp;the&nbsp;&quot;-&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instead&nbsp;of&nbsp;the&nbsp;remote&nbsp;public&nbsp;IP&nbsp;address&nbsp;of&nbsp;the&nbsp;server&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Where&nbsp;is&nbsp;the&nbsp;mistake&nbsp;?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Regards&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;/font&gt;&lt;/font&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
