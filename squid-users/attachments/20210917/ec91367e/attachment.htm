<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;span&nbsp;style=&quot;font-family:sans-serif;font-size:12.8px&quot;&gt;Hi&lt;/span&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;style=&quot;font-family:sans-serif;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;style=&quot;font-family:sans-serif;font-size:12.8px&quot;&gt;It&#39;s&nbsp;possible&nbsp;that&nbsp;in&nbsp;some&nbsp;cases&nbsp;they&nbsp;will&nbsp;run&nbsp;concurrently,&nbsp;however&nbsp;not&nbsp;in&nbsp;my&nbsp;setup.&nbsp;The&nbsp;ICAPs&nbsp;are&nbsp;chained.&nbsp;If&nbsp;the&nbsp;chain&nbsp;doesn&#39;t&nbsp;guarantee&nbsp;it&nbsp;please&nbsp;let&nbsp;me&nbsp;know&nbsp;since&nbsp;I&nbsp;rely&nbsp;on&nbsp;it. &lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;style=&quot;font-family:sans-serif;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;style=&quot;font-family:sans-serif;font-size:12.8px&quot;&gt;Regarding&nbsp;what&nbsp;you&nbsp;said&nbsp;about&nbsp;things&nbsp;that&nbsp;can&nbsp;happen&nbsp;in&nbsp;parallel,&nbsp;I&#39;m&nbsp;OK&nbsp;with&nbsp;it&nbsp;since&nbsp;what&nbsp;I&nbsp;care&nbsp;the&nbsp;most&nbsp;is&nbsp;the&nbsp;extra&nbsp;time&nbsp;my&nbsp;ICAPs&nbsp;add&nbsp;to&nbsp;the&nbsp;user&nbsp;latency&nbsp;and&nbsp;this&nbsp;is&nbsp;what&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;measure.&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;style=&quot;font-family:sans-serif;font-size:12.8px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;style=&quot;font-family:sans-serif;font-size:12.8px&quot;&gt;Thanks&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Wed,&nbsp;Sep&nbsp;15,&nbsp;2021,&nbsp;20:47&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;9/14/21&nbsp;3:04&nbsp;PM,&nbsp;Moti&nbsp;Berger&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;the&nbsp;followings&nbsp;in&nbsp;squid.conf:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; logformat&nbsp;metrics&nbsp;%icap::tt&nbsp;%adapt::all_trs&nbsp;%adapt::sum_trs&lt;br&gt;<br>
&gt; &nbsp; &nbsp; %{service_req_a}adapt::sum_trs&nbsp;%{service_resp_a}adapt::sum_trs&lt;br&gt;<br>
&gt; &nbsp; &nbsp; %{service_req_b}adapt::sum_trs&nbsp;%{service_resp_b}adapt::sum_trs&lt;br&gt;<br>
&gt; &nbsp; &nbsp; access_log&nbsp;daemon:/var/log/squid/metrics.log&nbsp;metrics&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp; &lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; icap_service&nbsp;service_req_a&nbsp;reqmod_precache&nbsp;bypass=1&nbsp;on-overload=wait&lt;br&gt;<br>
&gt; &nbsp; &nbsp; routing=1&nbsp;icap://a.y:12345/request&lt;br&gt;<br>
&gt; &nbsp; &nbsp; icap_service&nbsp;service_req_b&nbsp;reqmod_precache&nbsp;bypass=1&nbsp;on-overload=wait&lt;br&gt;<br>
&gt; &nbsp; &nbsp; icap://b.y:10101/request&lt;br&gt;<br>
&gt; &nbsp; &nbsp; adaptation_service_chain&nbsp;svcRequest&nbsp;service_req_a service_req_b&lt;br&gt;<br>
&gt; &nbsp; &nbsp; adaptation_access&nbsp;svcRequest&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&gt; &nbsp; &nbsp; adaptation_access&nbsp;svcRequest&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt; &nbsp; &nbsp; icap_service&nbsp;service_resp_a&nbsp;respmod_precache&nbsp;bypass=1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; on-overload=wait&nbsp;routing=1&nbsp;icap://a.y:12345/response&lt;br&gt;<br>
&gt; &nbsp; &nbsp; icap_service&nbsp;service_resp_b&nbsp;respmod_precache&nbsp;bypass=1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; on-overload=wait&nbsp;icap://b.y:10101/response&lt;br&gt;<br>
&gt; &nbsp; &nbsp; adaptation_service_chain&nbsp;svcResponse&nbsp;service_resp_a service_resp_b&lt;br&gt;<br>
&gt; &nbsp; &nbsp; adaptation_access&nbsp;svcResponse&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&gt; &nbsp; &nbsp; adaptation_access&nbsp;svcResponse&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp; I&nbsp;see&nbsp;in&nbsp;metrics.log&nbsp;lines&nbsp;like&nbsp;this:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; 4&nbsp;4,180&nbsp;4,180&nbsp;4&nbsp;180&nbsp;-&nbsp;-&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Now&nbsp;I&nbsp;wonder&nbsp;how&nbsp;come&nbsp;the&nbsp;value&nbsp;of&nbsp;%icap:tt&nbsp;isn&#39;t&nbsp;at&nbsp;least&nbsp;as&nbsp;the&nbsp;sum&nbsp;of&lt;br&gt;<br>
&gt;&nbsp;all&nbsp;the&nbsp;numbers&nbsp;appear&nbsp;on&nbsp;%adapt::all_trs&nbsp;or&nbsp;%adapt::sum_trs&nbsp;(assuming&lt;br&gt;<br>
&gt;&nbsp;no&nbsp;failed&nbsp;transactions)?&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;is&nbsp;probably&nbsp;a&nbsp;bug&nbsp;somewhere,&nbsp;but&nbsp;please&nbsp;note&nbsp;that&nbsp;%icap:tt&nbsp;may&nbsp;not&lt;br&gt;<br>
be&nbsp;the&nbsp;sum&nbsp;of&nbsp;individual&nbsp;transaction&nbsp;response&nbsp;times&nbsp;(in&nbsp;_some_&nbsp;cases)&lt;br&gt;<br>
even&nbsp;after&nbsp;that&nbsp;bug&nbsp;is&nbsp;fixed&nbsp;because&nbsp;those&nbsp;individual&nbsp;transactions&nbsp;may&lt;br&gt;<br>
run&nbsp;_concurrently_&nbsp;(i.e.&nbsp;partially&nbsp;overlap&nbsp;in&nbsp;time).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;If&nbsp;%icap:tt&nbsp;isn&#39;t&nbsp;at&nbsp;least&nbsp;the&nbsp;sum&nbsp;of&nbsp;all&nbsp;ICAPs&nbsp;processing&nbsp;time,&nbsp;what&nbsp;is?&lt;br&gt;<br>
&lt;br&gt;<br>
Bugs&nbsp;notwithstanding,&nbsp;it&nbsp;is&nbsp;approximate&nbsp;time&nbsp;a&nbsp;master&nbsp;transaction&nbsp;spent&lt;br&gt;<br>
doing&nbsp;adaptation&nbsp;(including&nbsp;checking&nbsp;whether&nbsp;adaptation&nbsp;is&nbsp;necessary).&lt;br&gt;<br>
This&nbsp;stopwatch&nbsp;ticks&nbsp;when&nbsp;adaptation_access&nbsp;ACLs&nbsp;are&nbsp;checked&nbsp;and&nbsp;also&lt;br&gt;<br>
when&nbsp;at&nbsp;least&nbsp;one&nbsp;adaptation&nbsp;transaction&nbsp;associated&nbsp;with&nbsp;that&nbsp;master&lt;br&gt;<br>
transaction&nbsp;is&nbsp;in&nbsp;progress.&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;note&nbsp;that&nbsp;a&nbsp;master&nbsp;transaction&nbsp;can&nbsp;do&nbsp;a&nbsp;lot&nbsp;of&nbsp;different&nbsp;things&lt;br&gt;<br>
at&nbsp;once&nbsp;or&nbsp;in&nbsp;parallel.&nbsp;For&nbsp;example,&nbsp;it&nbsp;can&nbsp;communicate&nbsp;with&nbsp;an&nbsp;HTTP&lt;br&gt;<br>
client&nbsp;while&nbsp;communicating&nbsp;with&nbsp;an&nbsp;FTP&nbsp;server&nbsp;while&nbsp;communicating&nbsp;with&lt;br&gt;<br>
an&nbsp;eCAP&nbsp;REQMOD&nbsp;adaptation&nbsp;service&nbsp;while&nbsp;communicating&nbsp;with&nbsp;a&nbsp;DNS&nbsp;server&lt;br&gt;<br>
to&nbsp;decide&nbsp;whether&nbsp;to&nbsp;start&nbsp;communicating&nbsp;with&nbsp;an&nbsp;ICAP&nbsp;RESPMOD&nbsp;service.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
