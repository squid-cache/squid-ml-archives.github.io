<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#464646&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;font&nbsp;face=&quot;Arial&quot;&gt;Thanks&nbsp;Louis&nbsp;for&nbsp;this&nbsp;tips&nbsp;but&nbsp;we&nbsp;did&nbsp;not&nbsp;want&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use&nbsp;NTLM&nbsp;as&nbsp;it&nbsp;is&nbsp;an&nbsp;old&nbsp;way.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;requires&nbsp;a&nbsp;samba&nbsp;on&nbsp;the&nbsp;Squid&nbsp;Box&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As&nbsp;Amos&nbsp;said,&nbsp;this&nbsp;is&nbsp;most&nbsp;a&nbsp;browser&nbsp;(that&nbsp;using&nbsp;Microsoft&nbsp;API&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;issue&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;best&nbsp;way&nbsp;is&nbsp;to&nbsp;make&nbsp;these&nbsp;browsers&nbsp;replicating&nbsp;the&nbsp;correct<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Firefox&nbsp;behavior.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Means&nbsp;swith&nbsp;to&nbsp;basic&nbsp;auth&nbsp;instead&nbsp;of&nbsp;trying&nbsp;this&nbsp;stupid&nbsp;NTLM<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;Le&nbsp;21/09/2021&nbsp;à&nbsp;09:38,&nbsp;L.P.H.&nbsp;van&nbsp;Belle<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;écrit :&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
cite=&quot;mid:vmime.61498c03.38c3.221b82153bf930b3@ms249-lin-003.rotterdam.bazuin.nl&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;<br>
<br>
in&nbsp;your&nbsp;smb.conf&nbsp;add<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Added&nbsp;to&nbsp;enforced&nbsp;NTLM&nbsp;2,&nbsp;must&nbsp;be&nbsp;set&nbsp;on&nbsp;all&nbsp;Samba&nbsp;AD-DC's&nbsp;and&nbsp;the&nbsp;needed&nbsp;members.&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;is&nbsp;used&nbsp;in&nbsp;combination&nbsp;with&nbsp;ntlm_auth&nbsp;--allow-mschapv2&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ntlm&nbsp;auth&nbsp;=&nbsp;mschapv2-and-ntlmv2-only<br>
<br>
In&nbsp;squid&nbsp;use:&nbsp;<br>
auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/lib/squid/negotiate_wrapper_auth&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;--kerberos&nbsp;/usr/lib/squid/negotiate_kerberos_auth&nbsp;-k&nbsp;/etc/squid/krb5-squid-HTTP.keytab&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;-s&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:HTTP/proxy.fq.dn.tld@MY.REALM.TLD&quot;&gt;HTTP/proxy.fq.dn.tld@MY.REALM.TLD&lt;/a&gt;&nbsp;\<br>
&nbsp;&nbsp;&nbsp;&nbsp;--ntlm&nbsp;/usr/bin/ntlm_auth&nbsp;--allow-mschapv2&nbsp;--helper-protocol=gss-spnego&nbsp;--domain=ADDOM<br>
<br>
&nbsp;<br>
If&nbsp;you&nbsp;connecting&nbsp;for&nbsp;ldap..&nbsp;Dont&nbsp;use&nbsp;-h&nbsp;192.168.90.10&nbsp;<br>
Uses&nbsp;-H&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;ldaps://host.name.fq.dn&quot;&gt;ldaps://host.name.fq.dn&lt;/a&gt;&nbsp;<br>
<br>
Also&nbsp;push&nbsp;the&nbsp;root-CA&nbsp;off&nbsp;the&nbsp;domain&nbsp;to&nbsp;pc's&nbsp;with&nbsp;GPO&nbsp;for&nbsp;example&nbsp;<br>
And&nbsp;in&nbsp;that&nbsp;GPO&nbsp;you&nbsp;can&nbsp;set&nbsp;the&nbsp;parts&nbsp;you&nbsp;need&nbsp;to&nbsp;enable&nbsp;for&nbsp;the&nbsp;users/pcs&nbsp;to&nbsp;make&nbsp;it&nbsp;all&nbsp;work.&nbsp;<br>
<br>
But&nbsp;your&nbsp;close,&nbsp;your&nbsp;almost&nbsp;there..&nbsp;<br>
<br>
On&nbsp;thing&nbsp;i&nbsp;have&nbsp;not&nbsp;looked&nbsp;at&nbsp;myself&nbsp;yet,&nbsp;ext_kerberos_ldap_group_acl&nbsp;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://fossies.org/linux/squid/src/acl/external/kerberos_ldap_group/ext_kerberos_ldap_group_acl.8&quot;&gt;https://fossies.org/linux/squid/src/acl/external/kerberos_ldap_group/ext_kerberos_ldap_group_acl.8&lt;/a&gt;&nbsp;<br>
Thats&nbsp;one&nbsp;i'll&nbsp;be&nbsp;using&nbsp;with&nbsp;squid&nbsp;5.1,&nbsp;im&nbsp;still&nbsp;compiling&nbsp;everyting&nbsp;i&nbsp;need,&nbsp;but&nbsp;then&nbsp;im&nbsp;setting<br>
It&nbsp;up,&nbsp;i'll&nbsp;document&nbsp;it&nbsp;and&nbsp;make&nbsp;and&nbsp;howto&nbsp;of&nbsp;it.&nbsp;<br>
<br>
Greetz,&nbsp;<br>
<br>
Louis<br>
<br>
<br>
<br>
________________________________<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Van:&nbsp;squid-users&nbsp;[&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&gt;mailto:squid-users-bounces@lists.squid-cache.org&lt;/a&gt;]&nbsp;Namens&nbsp;David&nbsp;Touzeau<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verzonden:&nbsp;dinsdag&nbsp;21&nbsp;september&nbsp;2021&nbsp;1:49<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Aan:&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Onderwerp:&nbsp;[squid-users]&nbsp;squid&nbsp;5.1:&nbsp;Kerberos:&nbsp;Unable&nbsp;to&nbsp;switch&nbsp;to&nbsp;basic&nbsp;auth&nbsp;with&nbsp;Edge&nbsp;-&nbsp;IE&nbsp;-&nbsp;Chrome<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hi&nbsp;all<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;have&nbsp;setup&nbsp;Kerberos&nbsp;authentication&nbsp;with&nbsp;Windows&nbsp;2019&nbsp;domain&nbsp;using&nbsp;Squid&nbsp;5.1&nbsp;(&nbsp;The&nbsp;Squid&nbsp;version&nbsp;did&nbsp;not&nbsp;fix&nbsp;the&nbsp;issue&nbsp;-&nbsp;Tested&nbsp;4.x&nbsp;and&nbsp;5.x)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;some&nbsp;cases,&nbsp;some&nbsp;computers&nbsp;are&nbsp;not&nbsp;joined&nbsp;to&nbsp;the&nbsp;domain&nbsp;and&nbsp;ween&nbsp;need&nbsp;to&nbsp;allow&nbsp;authenticate&nbsp;on&nbsp;Squid<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;allow&nbsp;this,&nbsp;&nbsp;Basic&nbsp;Authentication&nbsp;is&nbsp;defined&nbsp;in&nbsp;Squid&nbsp;&nbsp;and&nbsp;we&nbsp;expect&nbsp;that&nbsp;browsers&nbsp;prompt&nbsp;a&nbsp;login&nbsp;to&nbsp;be&nbsp;authenticated&nbsp;and&nbsp;access&nbsp;to&nbsp;Internet<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;But&nbsp;the&nbsp;behavior&nbsp;is&nbsp;strange.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;a&nbsp;computer&nbsp;outside&nbsp;the&nbsp;windows&nbsp;domain:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Firefox&nbsp;is&nbsp;be&nbsp;able&nbsp;to&nbsp;be&nbsp;successfully&nbsp;authenticated&nbsp;to&nbsp;squid&nbsp;using&nbsp;basic&nbsp;auth.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Edge,&nbsp;Chrome&nbsp;and&nbsp;IE&nbsp;still&nbsp;try&nbsp;ujsing&nbsp;NTLM&nbsp;method&nbsp;and&nbsp;are&nbsp;allways&nbsp;rejected&nbsp;with&nbsp;a&nbsp;407<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;When&nbsp;edge,&nbsp;chrome&nbsp;and&nbsp;IE&nbsp;try&nbsp;to&nbsp;establish&nbsp;a&nbsp;session,&nbsp;Squid&nbsp;claim&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/09/21&nbsp;01:17:27&nbsp;kid1|&nbsp;ERROR:&nbsp;Negotiate&nbsp;Authentication&nbsp;validating&nbsp;user.&nbsp;Result:&nbsp;{result=BH,&nbsp;notes={message:&nbsp;received&nbsp;type&nbsp;1&nbsp;NTLM&nbsp;token;&nbsp;}}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;let&nbsp;us&nbsp;understanding&nbsp;that&nbsp;these&nbsp;3&nbsp;browsers&nbsp;try&nbsp;NTLM&nbsp;instead&nbsp;of&nbsp;a&nbsp;Basic&nbsp;Authentication.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;did&nbsp;not&nbsp;know&nbsp;why&nbsp;these&nbsp;browsers&nbsp;using&nbsp;NTLM&nbsp;as&nbsp;they&nbsp;did&nbsp;not&nbsp;connected&nbsp;to&nbsp;the&nbsp;Windows&nbsp;domain&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Why&nbsp;squid&nbsp;never&nbsp;get&nbsp;the&nbsp;Basic&nbsp;Authentication&nbsp;credentials.&nbsp;?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Did&nbsp;i&nbsp;miss&nbsp;something&nbsp;?<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here&nbsp;it&nbsp;is&nbsp;my&nbsp;configuration.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auth_param&nbsp;negotiate&nbsp;program&nbsp;/lib/squid3/negotiate_kerberos_auth&nbsp;-r&nbsp;-s&nbsp;GSS_C_NO_NAME&nbsp;-k&nbsp;/etc/squid3/PROXY.keytab<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auth_param&nbsp;negotiate&nbsp;children&nbsp;20&nbsp;startup=5&nbsp;idle=1&nbsp;concurrency=0&nbsp;queue-size=80&nbsp;on-persistent-overload=ERR<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;on<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auth_param&nbsp;basic&nbsp;program&nbsp;/lib/squid3/basic_ldap_auth&nbsp;-v&nbsp;-R&nbsp;-b&nbsp;&quot;DC=articatech,DC=int&quot;&nbsp;-D&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:administrator@articatech.int&quot;&gt;&quot;administrator@articatech.int&quot;&lt;/a&gt;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;mailto:administrator@articatech.int&quot;&gt;&lt;mailto:administrator@articatech.int&gt;&lt;/a&gt;&nbsp;&nbsp;-W&nbsp;/etc/squid3/ldappass.txt&nbsp;-f&nbsp;sAMAccountName=%s&nbsp;-v&nbsp;3&nbsp;-h&nbsp;192.168.90.10<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auth_param&nbsp;basic&nbsp;children&nbsp;3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auth_param&nbsp;basic&nbsp;realm&nbsp;Active&nbsp;Directory&nbsp;articatech.int<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;7200&nbsp;seconds<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authenticate_ttl&nbsp;3600&nbsp;seconds<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authenticate_ip_ttl&nbsp;1&nbsp;seconds<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authenticate_cache_garbage_interval&nbsp;3600&nbsp;seconds<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;AUTHENTICATED&nbsp;proxy_auth&nbsp;REQUIRED<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<br>
<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
