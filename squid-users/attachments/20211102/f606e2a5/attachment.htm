<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#464646&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Ok,&nbsp;we&nbsp;will&nbsp;investigate&nbsp;on&nbsp;the&nbsp;Parent&nbsp;Proxy&nbsp;but&nbsp;it&nbsp;seems&nbsp;that&nbsp;when<br>
&nbsp;&nbsp;&nbsp;&nbsp;squid&nbsp;child&nbsp;claim&nbsp;about&nbsp;TCP&nbsp;failed,&nbsp;it&nbsp;understand&nbsp;that&nbsp;the&nbsp;peer&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;dead&nbsp;and&nbsp;the&nbsp;whole&nbsp;surf&nbsp;is&nbsp;stopped&nbsp;during&nbsp;several&nbsp;times&nbsp;(&nbsp;a&nbsp;squid&nbsp;-k<br>
&nbsp;&nbsp;&nbsp;&nbsp;reconfigure &nbsp;fix&nbsp;the&nbsp;issue&nbsp;quickly &nbsp;)&nbsp;because&nbsp;it&nbsp;did&nbsp;not&nbsp;have&nbsp;any<br>
&nbsp;&nbsp;&nbsp;&nbsp;other&nbsp;path&nbsp;to&nbsp;forward&nbsp;the&nbsp;request.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-cite-prefix&quot;&gt;Le&nbsp;02/11/2021&nbsp;à&nbsp;16:17,&nbsp;Alex&nbsp;Rousskov&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;écrit :&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cite=&quot;mid:b14300f3-fe86-ddb8-190f-3a09282f026b@measurement-factory.com&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;On&nbsp;11/2/21&nbsp;10:40&nbsp;AM,&nbsp;David&nbsp;Touzeau&nbsp;wrote:<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;2021/11/01&nbsp;16:50:48.787&nbsp;kid1|&nbsp;93,3|&nbsp;Http::Tunneler::handleReadyRead(conn9812727&nbsp;local=127.0.0.1:23408&nbsp;remote=127.0.0.1:2320&nbsp;FIRSTUP_PARENT)<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;2021/11/01&nbsp;16:50:48.787&nbsp;kid1|&nbsp;74,5|&nbsp;parse:&nbsp;status-line:&nbsp;proto&nbsp;HTTP/1.1<br>
2021/11/01&nbsp;16:50:48.787&nbsp;kid1|&nbsp;74,5|&nbsp;parse:&nbsp;status-line:&nbsp;status-code&nbsp;503<br>
2021/11/01&nbsp;16:50:48.787&nbsp;kid1|&nbsp;74,5|&nbsp;parse:&nbsp;status-line:&nbsp;reason-phrase&nbsp;Service&nbsp;Unavailable<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;Server:&nbsp;squid<br>
Date:&nbsp;Mon,&nbsp;01&nbsp;Nov&nbsp;2021&nbsp;15:50:48&nbsp;GMT<br>
X-Squid-Error:&nbsp;ERR_CONNECT_FAIL&nbsp;110<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;2021/11/01&nbsp;16:50:48.787&nbsp;kid1|&nbsp;83,3|&nbsp;bailOnResponseError:&nbsp;unsupported&nbsp;CONNECT&nbsp;response&nbsp;status&nbsp;code<br>
2021/11/01&nbsp;16:50:48.787&nbsp;kid1|&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;127.0.0.1/2320&nbsp;failed<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;<br>
<br>
A&nbsp;parent[^1]&nbsp;proxy&nbsp;is&nbsp;a&nbsp;Squid&nbsp;proxy&nbsp;that&nbsp;cannot&nbsp;connect&nbsp;to&nbsp;the&nbsp;server&nbsp;in<br>
question.&nbsp;That&nbsp;Squid&nbsp;proxy&nbsp;responds&nbsp;with&nbsp;an&nbsp;HTTP&nbsp;503&nbsp;Error&nbsp;to&nbsp;your&nbsp;Squid<br>
CONNECT&nbsp;request.&nbsp;Your&nbsp;Squid&nbsp;logs&nbsp;the&nbsp;&quot;TCP&nbsp;connection&nbsp;to&nbsp;...&nbsp;failed&quot;<br>
error&nbsp;that&nbsp;you&nbsp;were&nbsp;wondering&nbsp;about.<br>
<br>
This&nbsp;sequence&nbsp;highlights&nbsp;a&nbsp;deficiency&nbsp;in&nbsp;Squid&nbsp;CONNECT&nbsp;error&nbsp;handling<br>
code&nbsp;(and&nbsp;possibly&nbsp;cache_peer&nbsp;configuration&nbsp;abilities).&nbsp;Ideally,&nbsp;Squid<br>
should&nbsp;recognize&nbsp;Squid&nbsp;error&nbsp;responses&nbsp;coming&nbsp;from&nbsp;a&nbsp;parent&nbsp;HTTP&nbsp;proxy<br>
and&nbsp;avoid&nbsp;complaining&nbsp;about&nbsp;remote&nbsp;Squid-origin&nbsp;errors&nbsp;as&nbsp;if&nbsp;they&nbsp;are<br>
local&nbsp;Squid-parent&nbsp;errors.&nbsp;IIRC,&nbsp;some&nbsp;folks&nbsp;still&nbsp;insist&nbsp;on&nbsp;Squid<br>
complaining&nbsp;about&nbsp;the&nbsp;latter&nbsp;&quot;within&nbsp;hierarchy&quot;&nbsp;errors,&nbsp;but&nbsp;the&nbsp;former<br>
&quot;external&nbsp;Squid-origin&quot;&nbsp;errors&nbsp;are&nbsp;definitely&nbsp;not&nbsp;supposed&nbsp;to&nbsp;be<br>
reported&nbsp;to&nbsp;admins&nbsp;via&nbsp;level-0/1&nbsp;messages&nbsp;in&nbsp;cache.log.<br>
<br>
<br>
HTH,<br>
<br>
Alex.<br>
<br>
[^1]:&nbsp;Direct&nbsp;or&nbsp;indirect&nbsp;parent&nbsp;--&nbsp;I&nbsp;could&nbsp;not&nbsp;tell&nbsp;quickly&nbsp;but&nbsp;you<br>
should&nbsp;be&nbsp;able&nbsp;to&nbsp;tell&nbsp;by&nbsp;looking&nbsp;at&nbsp;addresses,&nbsp;configurations,&nbsp;and/or<br>
access&nbsp;logs.&nbsp;My&nbsp;bet&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;an&nbsp;indirect&nbsp;parent&nbsp;if&nbsp;you&nbsp;are&nbsp;still<br>
using&nbsp;a&nbsp;load&nbsp;balancer&nbsp;between&nbsp;Squids.<br>
<br>
<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;Le&nbsp;01/11/2021&nbsp;à&nbsp;15:53,&nbsp;Alex&nbsp;Rousskov&nbsp;a&nbsp;écrit :<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;On&nbsp;11/1/21&nbsp;7:55&nbsp;AM,&nbsp;David&nbsp;Touzeau&nbsp;wrote:<br>
<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;The&nbsp;Squid&nbsp;uses&nbsp;the&nbsp;loopback&nbsp;as&nbsp;a&nbsp;parent.<br>
<br>
The&nbsp;same&nbsp;problem&nbsp;occurs:<br>
06:19:47&nbsp;kid1|&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;127.0.0.1/2320&nbsp;failed<br>
06:15:13&nbsp;kid1|&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;127.0.0.1/2320&nbsp;failed<br>
06:14:41&nbsp;kid1|&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;127.0.0.1/2320&nbsp;failed<br>
06:14:38&nbsp;kid1|&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;127.0.0.1/2320&nbsp;failed<br>
06:13:15&nbsp;kid1|&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;127.0.0.1/2320&nbsp;failed<br>
06:11:23&nbsp;kid1|&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;127.0.0.1/2320&nbsp;failed<br>
cache_peer&nbsp;127.0.0.1&nbsp;parent&nbsp;2320&nbsp;0&nbsp;name=Peer11&nbsp;no-query&nbsp;default<br>
connect-timeout=3&nbsp;connect-fail-limit=5&nbsp;no-tproxy<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;It&nbsp;is&nbsp;impossible&nbsp;to&nbsp;tell&nbsp;for&nbsp;sure&nbsp;what&nbsp;is&nbsp;going&nbsp;on&nbsp;because&nbsp;Squid&nbsp;does<br>
not&nbsp;(unfortunately;&nbsp;yet)&nbsp;report&nbsp;the&nbsp;exact&nbsp;reason&nbsp;behind&nbsp;these&nbsp;connection<br>
establishment&nbsp;failures&nbsp;or&nbsp;even&nbsp;the&nbsp;context&nbsp;in&nbsp;which&nbsp;a&nbsp;failure&nbsp;has<br>
occurred.&nbsp;You&nbsp;may&nbsp;be&nbsp;able&nbsp;to&nbsp;tell&nbsp;more&nbsp;by&nbsp;collecting/analyzing&nbsp;packet<br>
captures.&nbsp;Developers&nbsp;may&nbsp;be&nbsp;able&nbsp;to&nbsp;tell&nbsp;more&nbsp;if&nbsp;you&nbsp;share,&nbsp;say,&nbsp;ALL,5<br>
debugging&nbsp;logs&nbsp;that&nbsp;show&nbsp;what&nbsp;led&nbsp;to&nbsp;the&nbsp;failure&nbsp;report.<br>
<br>
Alex.<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;class=&quot;moz-quote-pre&quot;&nbsp;wrap=&quot;&quot;&gt;<br>
&lt;/pre&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;
</tt>
