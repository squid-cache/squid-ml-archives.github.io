<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;style=&quot;font-family:&nbsp;Verdana;font-size:&nbsp;12.0px;&quot;&gt;&lt;div&gt;<br>
&lt;div&gt;At&nbsp;first&nbsp;thank&nbsp;you&nbsp;for&nbsp;your&nbsp;tips&nbsp;about&nbsp;the&nbsp;config!&lt;/div&gt;<br>
<br>
&lt;div&gt;So&nbsp;I&nbsp;figured&nbsp;out,&nbsp;that&nbsp;everything&nbsp;was&nbsp;not&nbsp;kerberos-authenticated,&nbsp;but&nbsp;ntlm-authenticated,&nbsp;so&nbsp;I&nbsp;had&nbsp;to&nbsp;adjust&nbsp;my&nbsp;config&nbsp;a&nbsp;bit,&nbsp;because&nbsp;I&#39;ve&nbsp;heard&nbsp;in&nbsp;another&nbsp;thread&nbsp;here,&nbsp;that&nbsp;actually&nbsp;using&nbsp;kerberos&nbsp;is&nbsp;a&nbsp;lot&nbsp;faster&nbsp;than&nbsp;NTLM.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Old&nbsp;part:&lt;/div&gt;<br>
<br>
&lt;div&gt;&gt;&nbsp;auth_param&nbsp;negotiate&nbsp;program&nbsp;/lib/squid/negotiate_wrapper_auth&nbsp;-d&nbsp;--ntlm&lt;br/&gt;<br>
&gt;&nbsp;/bin/ntlm_auth&nbsp;--diagnostics&nbsp;--helper-protocol=squid-2.5-ntlmssp&lt;br/&gt;<br>
&gt;&nbsp;--domain=DOMAIN.TLD&nbsp;--kerberos&nbsp;/lib/squid/negotiate_kerberos_auth&nbsp;-d&nbsp;-s&lt;br/&gt;<br>
&gt;&nbsp;HTTP/proxy.domain.tld@DOMAIN.TLD&lt;br/&gt;<br>
&gt;&nbsp;auth_param&nbsp;negotiate&nbsp;children&nbsp;200&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;New&nbsp;part:&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;auth_param&nbsp;negotiate&nbsp;program&nbsp;/lib/Squid/negotiate_kerberos_auth&nbsp;-d&nbsp;-s&nbsp;HTTP/proxy.domain.tld@DOMAIN.TLD&nbsp;-k&nbsp;/etc/squid/krb5.keytab&lt;br/&gt;<br>
&nbsp;auth_param&nbsp;negotiate&nbsp;children&nbsp;100&nbsp;startup=10&nbsp;idle=3&lt;br/&gt;<br>
&nbsp;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;on&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;But&nbsp;then&nbsp;I&nbsp;got&nbsp;warnings&nbsp;about&nbsp;NTLM&nbsp;1&nbsp;tokens&nbsp;in&nbsp;my&nbsp;cache.log&nbsp;and&nbsp;authentication&nbsp;didn&#39;t&nbsp;work&nbsp;at&nbsp;all.&nbsp;After&nbsp;a&nbsp;bit&nbsp;of&nbsp;research&nbsp;I&nbsp;figured&nbsp;out&nbsp;not&nbsp;to&nbsp;write&nbsp;the&nbsp;IP&nbsp;from&nbsp;the&nbsp;proxy,&nbsp;but&nbsp;the&nbsp;FQDN&nbsp;from&nbsp;the&nbsp;proxy&nbsp;inside&nbsp;the&nbsp;client&nbsp;proxy&nbsp;settings.&nbsp;That&nbsp;makes&nbsp;sense,&nbsp;because&nbsp;in&nbsp;Microsoft&nbsp;Outlook&nbsp;using&nbsp;Kerberos&nbsp;you&nbsp;have&nbsp;to&nbsp;do&nbsp;that&nbsp;too.&nbsp;It&nbsp;does&nbsp;not&nbsp;work&nbsp;with&nbsp;IPs,&nbsp;only&nbsp;with&nbsp;FQDN.&nbsp;So&nbsp;I&nbsp;guess&nbsp;it&nbsp;is&nbsp;a&nbsp;kerberos&nbsp;&quot;issue&quot;.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;So&nbsp;everything&nbsp;works&nbsp;as&nbsp;it&nbsp;should&nbsp;and&nbsp;squid&nbsp;is&nbsp;a&nbsp;lot&nbsp;faster(could&nbsp;not&nbsp;test&nbsp;yet&nbsp;if&nbsp;fast&nbsp;enough)&nbsp;because&nbsp;of&nbsp;that&nbsp;kerberos&nbsp;auth.&nbsp;But&nbsp;now&nbsp;I&nbsp;got&nbsp;another&nbsp;problem:&nbsp;&lt;strong&gt;My&nbsp;access.log&nbsp;does&nbsp;not&nbsp;get&nbsp;filled!&nbsp;:(&lt;/strong&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;I&nbsp;did:&lt;/div&gt;<br>
<br>
&lt;div&gt;chmod&nbsp;644&nbsp;/var/log/squid/access.log&lt;/div&gt;<br>
<br>
&lt;div&gt;chown&nbsp;squid:squid&nbsp;/var/log/squid/access.log&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;but&nbsp;nothing&nbsp;helped&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;errors&nbsp;inside&nbsp;the&nbsp;cache.log,&nbsp;even&nbsp;with&nbsp;&quot;debug&nbsp;ALL&quot;,&nbsp;so&nbsp;I&nbsp;guess&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;permission&nbsp;problem.&nbsp;With&nbsp;the&nbsp;old&nbsp;NTLM&nbsp;auth&nbsp;and&nbsp;the&nbsp;IP&nbsp;from&nbsp;the&nbsp;squid&nbsp;proxy&nbsp;inside&nbsp;the&nbsp;client&nbsp;proxy&nbsp;settings&nbsp;the&nbsp;access.log&nbsp;gets&nbsp;filled&nbsp;up.&nbsp;But&nbsp;as&nbsp;soon&nbsp;as&nbsp;I&nbsp;switch&nbsp;to&nbsp;my&nbsp;new&nbsp;kerberos&nbsp;auth&nbsp;and&nbsp;the&nbsp;proxy-FQDN&nbsp;inside&nbsp;the&nbsp;client(windows)&nbsp;proxy&nbsp;settings,&nbsp;access.log&nbsp;will&nbsp;not&nbsp;get&nbsp;written&nbsp;anymore.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;strong&gt;Can&nbsp;anyone&nbsp;help?&lt;/strong&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;My&nbsp;current&nbsp;squid.conf(thanks&nbsp;again&nbsp;to&nbsp;Amos&nbsp;Jeffries!):&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&gt;&nbsp;#########&nbsp;allowed&nbsp;port&nbsp;part&nbsp;########################&lt;br/&gt;<br>
acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ftp&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;https&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gopher&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;wais&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http-mgmt&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gss-http&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;filemaker&lt;br/&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;multiling&nbsp;http&lt;br/&gt;<br>
acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br/&gt;<br>
http_access&nbsp;deny&nbsp;!Safe_ports&lt;br/&gt;<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br/&gt;<br>
&nbsp;#####################&nbsp;cache/logs&nbsp;########################&lt;br/&gt;<br>
&nbsp;cache_log&nbsp;/var/log/squid/cache.log&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;logformat&nbsp;myformat&nbsp;%{%d.%m&nbsp;%H:%M:%S}tl&nbsp;%&gt;a&nbsp;%Ss&nbsp;%ru&nbsp;%tr&lt;br/&gt;<br>
&nbsp;access_log&nbsp;/var/log/squid/access.log&nbsp;myformat&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;cache&nbsp;deny&nbsp;all&lt;br/&gt;<br>
&nbsp;coredump_dir&nbsp;/dev/null&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;cache_dir&nbsp;aufs&nbsp;/var/spool/squid&nbsp;100&nbsp;16&nbsp;256&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;##########&nbsp;Debug&nbsp;########################&lt;br/&gt;<br>
&nbsp;#debug_options&nbsp;ALL,1&nbsp;33,2&nbsp;28,9&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;#########################&nbsp;squid-port&nbsp;#######&lt;br/&gt;<br>
&nbsp;http_port&nbsp;3128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#proxy&nbsp;port&lt;br/&gt;<br>
&nbsp;authenticate_ttl&nbsp;2&nbsp;hours&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#auth&nbsp;timeout&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;acl&nbsp;black_regex&nbsp;url_regex&nbsp;&quot;/etc/squid/regex_black.acl&quot;&lt;br/&gt;<br>
&nbsp;acl&nbsp;white_regex&nbsp;url_regex&nbsp;&quot;/etc/squid/regex_white.acl&quot;&lt;br/&gt;<br>
&nbsp;acl&nbsp;license_regex&nbsp;url_regex&nbsp;&quot;/etc/squid/regex_license_servers_no_auth.acl&quot;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;#############################&nbsp;allow&nbsp;License&nbsp;Managers&nbsp;##########&lt;br/&gt;<br>
&nbsp;http_access&nbsp;allow&nbsp;license_regex&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;###################&nbsp;Kerberos&nbsp;##################################&lt;br/&gt;<br>
&nbsp;auth_param&nbsp;negotiate&nbsp;program&nbsp;/lib/Squid/negotiate_kerberos_auth&nbsp;-d&nbsp;-s&nbsp;HTTP/proxy.domain.tld@DOMAIN.TLD&nbsp;-k&nbsp;/etc/squid/krb5.keytab&lt;br/&gt;<br>
&nbsp;auth_param&nbsp;negotiate&nbsp;children&nbsp;100&nbsp;startup=10&nbsp;idle=3&lt;br/&gt;<br>
&nbsp;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;on&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br/&gt;<br>
&nbsp;##########################&nbsp;Allow&nbsp;based&nbsp;on&nbsp;group&nbsp;membership&nbsp;######&lt;br/&gt;<br>
&nbsp;#&nbsp;Authentication&nbsp;required,&nbsp;otherwise&nbsp;Pop-Up&lt;br/&gt;<br>
&nbsp;acl&nbsp;Authenticated_Users&nbsp;proxy_auth&nbsp;REQUIRED&lt;br/&gt;<br>
&nbsp;http_access&nbsp;deny&nbsp;!Authenticated_Users&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;#&nbsp;Define&nbsp;external&nbsp;acl&nbsp;for&nbsp;group&nbsp;check&lt;br/&gt;<br>
&nbsp;external_acl_type&nbsp;ldap_group&nbsp;ipv4&nbsp;ttl=300&nbsp;negative_ttl=120&lt;br/&gt;<br>
&nbsp;&nbsp;children-max=100&nbsp;%LOGIN&nbsp;/lib/squid/ext_ldap_group_acl&nbsp;-K&nbsp;-S&nbsp;-R&nbsp;&#92;&lt;br/&gt;<br>
&nbsp;-b&nbsp;&quot;ou=Users,DC=domain,DC=tld&quot;&nbsp;&#92;&lt;br/&gt;<br>
&nbsp;-D&nbsp;&quot;ProxyUser@DOMAIN.TLD&quot;&nbsp;&#92;&lt;br/&gt;<br>
&nbsp;-W&nbsp;/etc/squid/authfile&nbsp;&#92;&lt;br/&gt;<br>
&nbsp;-f&lt;br/&gt;<br>
&nbsp;&quot;(&amp;(objectclass=person)(sAMAccountName=%v)(memberof=CN=%a,OU=Groups,DC=domain,DC=tl))&quot;&lt;br/&gt;<br>
&nbsp;&#92;&lt;br/&gt;<br>
&nbsp;-h&nbsp;192.0.1.1&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;acl&nbsp;Users_Internet_Users&nbsp;external&nbsp;ldap_group&nbsp;Users&lt;br/&gt;<br>
&nbsp;http_access&nbsp;allow&nbsp;!black_regex&nbsp;Users_Internet_Users&nbsp;all&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;http_access&nbsp;deny&nbsp;all&lt;br/&gt;<br>
&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;dns_v4_first&nbsp;on&lt;br/&gt;<br>
&nbsp;connect_timeout&nbsp;3&nbsp;seconds&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;strong&gt;Regards&lt;/strong&gt;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;<br>
&lt;div&gt;&nbsp;<br>
&lt;div&nbsp;name=&quot;quote&quot;&nbsp;style=&quot;margin:10px&nbsp;5px&nbsp;5px&nbsp;10px;&nbsp;padding:&nbsp;10px&nbsp;0&nbsp;10px&nbsp;10px;&nbsp;border-left:2px&nbsp;solid&nbsp;#C3D9E5;&nbsp;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;<br>
&lt;div&nbsp;style=&quot;margin:0&nbsp;0&nbsp;10px&nbsp;0;&quot;&gt;&lt;b&gt;Gesendet:&lt;/b&gt;&nbsp;Dienstag,&nbsp;09.&nbsp;November&nbsp;2021&nbsp;um&nbsp;08:38&nbsp;Uhr&lt;br/&gt;<br>
&lt;b&gt;Von:&lt;/b&gt;&nbsp;heimarbeit123.99@web.de&lt;br/&gt;<br>
&lt;b&gt;An:&lt;/b&gt;&nbsp;heimarbeit123.99@web.de&lt;br/&gt;<br>
&lt;b&gt;Betreff:&lt;/b&gt;&nbsp;Aw:&nbsp;[squid-users]&nbsp;Squid&nbsp;very&nbsp;slow&nbsp;with&nbsp;kerberos&nbsp;auth&nbsp;and&nbsp;LDAP&nbsp;Group&nbsp;Search(AD)&lt;/div&gt;<br>
<br>
&lt;div&nbsp;name=&quot;quoted-content&quot;&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Verdana;font-size:&nbsp;12.0px;&quot;&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&gt;Edit:&lt;/div&gt;<br>
<br>
&lt;div&gt;I&nbsp;also&nbsp;tried&nbsp;with&nbsp;kerberos&nbsp;auth&nbsp;only.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;auth_param&nbsp;negotiate&nbsp;program&nbsp;/lib/squid/negotiate_kerberos_auth&nbsp;-d&nbsp;-s&nbsp;HTTP/proxy.domain.tld@DOMAIN.TLD&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;but&nbsp;then&nbsp;I&nbsp;can&nbsp;not&nbsp;authenticate&nbsp;anyone,&nbsp;because&nbsp;cache.log&nbsp;says&nbsp;&quot;Warning:&nbsp;Received&nbsp;NTLM&nbsp;1&nbsp;Token&quot;.&nbsp;That&#39;s&nbsp;why&nbsp;I&nbsp;did&nbsp;with&nbsp;ntlm_auth,&nbsp;even&nbsp;though&nbsp;I&nbsp;read,&nbsp;that&nbsp;ntlm&nbsp;is&nbsp;way&nbsp;slower&nbsp;than&nbsp;kerberos.&nbsp;That&nbsp;could&nbsp;cause&nbsp;these&nbsp;waiting&nbsp;times&nbsp;too&nbsp;with&nbsp;60+&nbsp;clients&nbsp;but&nbsp;I&nbsp;don&#39;t&nbsp;quite&nbsp;know&nbsp;how&nbsp;to&nbsp;handle&nbsp;this..&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Maybe&nbsp;someone&nbsp;can&nbsp;help.&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Regards&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;<br>
&lt;div&nbsp;style=&quot;margin:&nbsp;10.0px&nbsp;5.0px&nbsp;5.0px&nbsp;10.0px;padding:&nbsp;10.0px&nbsp;0&nbsp;10.0px&nbsp;10.0px;border-left:&nbsp;2.0px&nbsp;solid&nbsp;rgb(195,217,229);&quot;&gt;<br>
&lt;div&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;10.0px&nbsp;0;&quot;&gt;&lt;b&gt;Gesendet:&lt;/b&gt;&nbsp;Montag,&nbsp;08.&nbsp;November&nbsp;2021&nbsp;um&nbsp;13:19&nbsp;Uhr&lt;br/&gt;<br>
&lt;b&gt;Von:&lt;/b&gt;&nbsp;heimarbeit123.99@web.de&lt;br/&gt;<br>
&lt;b&gt;An:&lt;/b&gt;&nbsp;squid-users@lists.squid-cache.org&lt;br/&gt;<br>
&lt;b&gt;Betreff:&lt;/b&gt;&nbsp;[squid-users]&nbsp;Squid&nbsp;very&nbsp;slow&nbsp;with&nbsp;kerberos&nbsp;auth&nbsp;and&nbsp;LDAP&nbsp;Group&nbsp;Search(AD)&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Verdana;font-size:&nbsp;12.0px;&quot;&gt;<br>
&lt;div&gt;Hello&nbsp;all,&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;I&nbsp;finaly&nbsp;got&nbsp;a&nbsp;squid&nbsp;proxy&nbsp;with&nbsp;kerberos&nbsp;authentification&nbsp;and&nbsp;LDAP&nbsp;group&nbsp;check&nbsp;to&nbsp;work!&nbsp;With&nbsp;a&nbsp;small&nbsp;amount&nbsp;of&nbsp;clients(1-10)&nbsp;everything&nbsp;works&nbsp;as&nbsp;it&nbsp;should&nbsp;and&nbsp;the&nbsp;squid&nbsp;is&nbsp;fast(no&nbsp;noticeable&nbsp;waiting&nbsp;time&nbsp;for&nbsp;websites&nbsp;to&nbsp;open).&nbsp;Users&nbsp;get&nbsp;authenticated,&nbsp;different&nbsp;AD&nbsp;groups&nbsp;can&nbsp;access&nbsp;the&nbsp;internet&nbsp;with&nbsp;blacklists/whitelists/full&nbsp;access&nbsp;and&nbsp;so&nbsp;on..&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;But&nbsp;as&nbsp;soon&nbsp;as&nbsp;I&nbsp;make&nbsp;the&nbsp;whole&nbsp;company(round&nbsp;about&nbsp;80&nbsp;clients)&nbsp;use&nbsp;the&nbsp;new&nbsp;proxy,&nbsp;it&nbsp;begins&nbsp;to&nbsp;be&nbsp;very&nbsp;slow.&nbsp;And&nbsp;by&nbsp;very&nbsp;slow&nbsp;I&nbsp;mean&nbsp;like&nbsp;1-2&nbsp;minutes&nbsp;waiting&nbsp;time(response&nbsp;time&nbsp;in&nbsp;access.log&nbsp;is&nbsp;like&nbsp;60000-270000&nbsp;milliseconds&nbsp;for&nbsp;TCP_TUNNEL)&nbsp;until&nbsp;a&nbsp;website&nbsp;is&nbsp;fully&nbsp;loaded.&nbsp;We&nbsp;got&nbsp;a&nbsp;old&nbsp;squid&nbsp;proxy&nbsp;too,&nbsp;but&nbsp;without&nbsp;any&nbsp;authentication&nbsp;(just&nbsp;some&nbsp;dstdomain&nbsp;in&nbsp;general)&nbsp;and&nbsp;it&#39;s&nbsp;working&nbsp;great.&nbsp;But&nbsp;the&nbsp;new&nbsp;one&nbsp;is&nbsp;very&nbsp;slow..&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Btw.&nbsp;some&nbsp;of&nbsp;our&nbsp;clients&nbsp;have&nbsp;ipv6,&nbsp;others&nbsp;ipv4(~90%)..There&nbsp;were&nbsp;no&nbsp;errors&nbsp;in&nbsp;cache.log(activated&nbsp;it&nbsp;for&nbsp;some&nbsp;minutes&nbsp;with&nbsp;debug&nbsp;ALL&nbsp;for&nbsp;error&nbsp;checking).&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Can&nbsp;anyone&nbsp;help?&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;What&nbsp;I&nbsp;tried&nbsp;so&nbsp;far:&lt;/div&gt;<br>
<br>
&lt;div&gt;dns_v4_first&nbsp;on&nbsp;at&nbsp;the&nbsp;very&nbsp;end/very&nbsp;beginning&nbsp;from&nbsp;squid.conf&lt;/div&gt;<br>
<br>
&lt;div&gt;enable/disable&nbsp;(memory)&nbsp;caching&lt;/div&gt;<br>
<br>
&lt;div&gt;use&nbsp;Google&nbsp;DNS&nbsp;instead&nbsp;of&nbsp;our&nbsp;own&lt;/div&gt;<br>
<br>
&lt;div&gt;connect_timeout&nbsp;3&nbsp;seconds&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Nothing&nbsp;realy&nbsp;helped..&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Here&nbsp;is&nbsp;my&nbsp;squid.conf:&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;<br>
&lt;div&gt;#########&nbsp;allowed&nbsp;port&nbsp;part&nbsp;########################&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ftp&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;https&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gopher&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;wais&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;1025-65535&nbsp;&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;280&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http-mgmt&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;488&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gss-http&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;591&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;filemaker&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;multiling&nbsp;http&lt;br/&gt;<br>
acl&nbsp;Allowed_port&nbsp;port&nbsp;10000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Proofpoint&lt;br/&gt;<br>
acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br/&gt;<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!Allowed_port&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;#####################&nbsp;cache/logs&nbsp;########################&lt;br/&gt;<br>
cache_log&nbsp;/dev/null&lt;br/&gt;<br>
#logfile_rotate&nbsp;0&lt;br/&gt;<br>
logformat&nbsp;myformat&nbsp;%{%d.%m&nbsp;%H:%M:%S}tl&nbsp;%&gt;a&nbsp;%Ss&nbsp;%ru&nbsp;%tr&lt;br/&gt;<br>
access_log&nbsp;/var/log/squid/access.log&nbsp;myformat&lt;br/&gt;<br>
#cache_dir&nbsp;aufs&nbsp;/var/spool/squid&nbsp;16384&nbsp;32&nbsp;512&lt;br/&gt;<br>
#cache_mem&nbsp;8&nbsp;MB&lt;br/&gt;<br>
#maximum_object_size_in_memory&nbsp;64&nbsp;KB&lt;br/&gt;<br>
#maximum_object_size&nbsp;4&nbsp;MB&lt;br/&gt;<br>
#coredump_dir&nbsp;/var/spool/squid&lt;/div&gt;<br>
<br>
&lt;div&gt;cache&nbsp;deny&nbsp;all&lt;br/&gt;<br>
coredump_dir&nbsp;/dev/null&lt;br/&gt;<br>
cache_dir&nbsp;null&nbsp;/dev/null&lt;br/&gt;<br>
cache_store_log&nbsp;none&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;##########&nbsp;Debug&nbsp;########################&lt;br/&gt;<br>
#debug_options&nbsp;ALL,1&nbsp;33,2&nbsp;28,9&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;#########################&nbsp;squid-port&nbsp;#######&lt;br/&gt;<br>
http_port&nbsp;3128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#proxy&nbsp;port&lt;/div&gt;<br>
<br>
&lt;div&gt;authenticate_ttl&nbsp;2&nbsp;hours&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#auth&nbsp;timeout&nbsp;squid-&gt;passwd_server&lt;/div&gt;<br>
<br>
&lt;div&gt;#acl&nbsp;localhost&nbsp;src&nbsp;192.168.2.2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#proxy&nbsp;IP&lt;br/&gt;<br>
#follow_x_forwarded_for&nbsp;allow&nbsp;localhost&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#trust&nbsp;localhost&lt;/div&gt;<br>
<br>
&lt;div&gt;#general&nbsp;allow&nbsp;everything&lt;br/&gt;<br>
#acl&nbsp;whole_company&nbsp;src&nbsp;192.0.0.0-192.255.255.254&lt;br/&gt;<br>
#http_access&nbsp;allow&nbsp;whole_company&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;###############&nbsp;url_regex&nbsp;####&lt;br/&gt;<br>
acl&nbsp;black_regex&nbsp;url_regex&nbsp;&quot;/etc/squid/regex_black.acl&quot;&lt;br/&gt;<br>
#http_access&nbsp;allow&nbsp;white_regexp&lt;br/&gt;<br>
acl&nbsp;white_regex&nbsp;url_regex&nbsp;&quot;/etc/squid/regex_white.acl&quot;&lt;br/&gt;<br>
acl&nbsp;license_regex&nbsp;url_regex&nbsp;&quot;/etc/squid/regex_license_servers_no_auth.acl&quot;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;#############################&nbsp;allow&nbsp;License&nbsp;Managers&nbsp;##########&lt;br/&gt;<br>
http_access&nbsp;allow&nbsp;license_regex&nbsp;all&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;###################&nbsp;Kerberos&nbsp;##################################&lt;br/&gt;<br>
auth_param&nbsp;negotiate&nbsp;program&nbsp;/lib/squid/negotiate_wrapper_auth&nbsp;-d&nbsp;--ntlm&nbsp;/bin/ntlm_auth&nbsp;--diagnostics&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--domain=DOMAIN.TLD&nbsp;--kerberos&nbsp;/lib/squid/negotiate_kerberos_auth&nbsp;-d&nbsp;-s&nbsp;HTTP/proxy.domain.tld@DOMAIN.TLD&lt;br/&gt;<br>
auth_param&nbsp;negotiate&nbsp;children&nbsp;200&lt;br/&gt;<br>
auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;on&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;##########################&nbsp;Allow&nbsp;based&nbsp;on&nbsp;group&nbsp;membership&nbsp;######&lt;br/&gt;<br>
#&nbsp;Authentication&nbsp;required,&nbsp;otherwise&nbsp;Pop-Up&lt;br/&gt;<br>
acl&nbsp;Authenticated_Users&nbsp;proxy_auth&nbsp;REQUIRED&lt;br/&gt;<br>
http_access&nbsp;deny&nbsp;!Authenticated_Users&nbsp;all&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;#&nbsp;Define&nbsp;external&nbsp;acl&nbsp;for&nbsp;group&nbsp;check&lt;br/&gt;<br>
external_acl_type&nbsp;ldap_group&nbsp;ipv4&nbsp;ttl=300&nbsp;negative_ttl=120&nbsp;children-max=200&nbsp;%LOGIN&nbsp;/lib/squid/ext_ldap_group_acl&nbsp;-K&nbsp;-S&nbsp;-R&nbsp;&#92;&lt;br/&gt;<br>
-b&nbsp;&quot;ou=Users,DC=domain,DC=tld&quot;&nbsp;&#92;&lt;br/&gt;<br>
-D&nbsp;&quot;ProxyUser@DOMAIN.TLD&quot;&nbsp;&#92;&lt;br/&gt;<br>
-W&nbsp;/etc/squid/authfile&nbsp;&#92;&lt;br/&gt;<br>
-f&nbsp;&quot;(&amp;(objectclass=person)(sAMAccountName=%v)(memberof=CN=%a,OU=Groups,DC=domain,DC=tl))&quot;&nbsp;&#92;&lt;br/&gt;<br>
-h&nbsp;192.0.1.1&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;##&nbsp;check&nbsp;whitelist&nbsp;group&lt;br/&gt;<br>
#acl&nbsp;whitelist_Internet_Users&nbsp;external&nbsp;ldap_group&nbsp;whitelist&lt;br/&gt;<br>
#http_access&nbsp;allow&nbsp;whitelist_Internet_Users&nbsp;white_regex&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;##&nbsp;check&nbsp;blacklist&nbsp;group&lt;br/&gt;<br>
#acl&nbsp;blacklist_Internet_Users&nbsp;external&nbsp;ldap_group&nbsp;blacklist&lt;br/&gt;<br>
#http_access&nbsp;allow&nbsp;blacklist_Internet_Users&nbsp;!black_regex&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;##&nbsp;check&nbsp;full_access&nbsp;group&lt;br/&gt;<br>
#acl&nbsp;full_access_Internet_Users&nbsp;external&nbsp;ldap_group&nbsp;full_access&lt;br/&gt;<br>
#http_access&nbsp;allow&nbsp;full_access_Internet_Users&nbsp;all&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;##&nbsp;check&nbsp;Users&nbsp;group&lt;br/&gt;<br>
acl&nbsp;Users_Internet_Users&nbsp;external&nbsp;ldap_group&nbsp;Users&lt;br/&gt;<br>
http_access&nbsp;allow&nbsp;Users_Internet_Users&nbsp;!black_regex&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;http_access&nbsp;deny&nbsp;all&lt;/div&gt;<br>
<br>
&lt;div&gt;dns_v4_first&nbsp;on&lt;br/&gt;<br>
connect_timeout&nbsp;3&nbsp;seconds&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
<br>
&lt;div&gt;Regards!&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
_______________________________________________&nbsp;squid-users&nbsp;mailing&nbsp;list&nbsp;squid-users@lists.squid-cache.org&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;<br>
<br>

</tt>
