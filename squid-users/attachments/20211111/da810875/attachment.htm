<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#464646&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;font&nbsp;face=&quot;Arial&quot;&gt;Hi&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;for&nbsp;information&nbsp;and&nbsp;i&nbsp;hope&nbsp;it&nbsp;will&nbsp;help.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;have&nbsp;installed&nbsp;Squid&nbsp;5.1&nbsp;and&nbsp;Squid&nbsp;5.2&nbsp;in&nbsp;production&nbsp;mode.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It&nbsp;seems&nbsp;that&nbsp;after&nbsp;several&nbsp;days,&nbsp;the&nbsp;Squid&nbsp;become&nbsp;very&nbsp;unstable.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;mention&nbsp;that&nbsp;when&nbsp;switching&nbsp;to&nbsp;4.x&nbsp;we&nbsp;did&nbsp;not&nbsp;encounter&nbsp;these<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errors&nbsp;with&nbsp;the&nbsp;same&nbsp;configuration,&nbsp;same&nbsp;users,&nbsp;same&nbsp;network&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;replace&nbsp;binaries&nbsp;and&nbsp;keep&nbsp;same&nbsp;configuration&nbsp;)&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;All&nbsp;production&nbsp;servers&nbsp;are&nbsp;installed&nbsp;in&nbsp;a&nbsp;virtual&nbsp;environment&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ESXI&nbsp;or&nbsp;Nutanix&nbsp;)&nbsp;on&nbsp;Debian&nbsp;10.x&nbsp;with&nbsp;about&nbsp;4&nbsp;to&nbsp;8&nbsp;vCPUs&nbsp;and&nbsp;8GB<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;memory.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;from&nbsp;20&nbsp;to&nbsp;5000&nbsp;users.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;After&nbsp;severals&nbsp;tests&nbsp;we&nbsp;see&nbsp;that&nbsp;the&nbsp;number&nbsp;of&nbsp;users&nbsp;did&nbsp;not&nbsp;have<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;impact&nbsp;with&nbsp;the&nbsp;stability.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;encounter&nbsp;same&nbsp;errors&nbsp;on&nbsp;a&nbsp;20&nbsp;users&nbsp;proxy&nbsp;and&nbsp;the&nbsp;same&nbsp;way&nbsp;of&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5000&nbsp;users&nbsp;proxy.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1)&nbsp;Memory&nbsp;leak&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---------------------------------&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;was&nbsp;encounter&nbsp;on&nbsp;computer&nbsp;that&nbsp;handle&nbsp;more&nbsp;than&nbsp;10Gb&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memory,&nbsp;squid&nbsp;eat&nbsp;more&nbsp;than&nbsp;8Gb&nbsp;of&nbsp;memory.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;After&nbsp;eating&nbsp;all&nbsp;memory,&nbsp;squid&nbsp;is&nbsp;unable&nbsp;to&nbsp;load&nbsp;helpers&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;freeze&nbsp;listen&nbsp;ports.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;restart&nbsp;service&nbsp;free&nbsp;the&nbsp;memory&nbsp;and&nbsp;fix&nbsp;the&nbsp;issue.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2)&nbsp;Max&nbsp;filedescriptors&nbsp;issues:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--------------------------------&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;strange&nbsp;behavior&nbsp;that&nbsp;Squid&nbsp;did&nbsp;not&nbsp;accept&nbsp;defined<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter:&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Example&nbsp;we&nbsp;set&nbsp;65535&nbsp;filedescriptors&nbsp;but&nbsp;squidclient&nbsp;mgr:info<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;report&nbsp;4096&nbsp;and&nbsp;sometimes&nbsp;return&nbsp;back&nbsp;to&nbsp;1024.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Several&nbsp;times&nbsp;squid&nbsp;report&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;current&nbsp;master&nbsp;transaction:&nbsp;master15881&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/11/11&nbsp;17:10:09&nbsp;kid1|&nbsp;WARNING!&nbsp;Your&nbsp;cache&nbsp;is&nbsp;running&nbsp;out&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filedescriptors&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;listening&nbsp;port:&nbsp;MyPortNameID1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/11/11&nbsp;17:10:29&nbsp;kid1|&nbsp;WARNING!&nbsp;Your&nbsp;cache&nbsp;is&nbsp;running&nbsp;out&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filedescriptors&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;listening&nbsp;port:&nbsp;MyPortNameID1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/11/11&nbsp;17:10:51&nbsp;kid1|&nbsp;WARNING!&nbsp;Your&nbsp;cache&nbsp;is&nbsp;running&nbsp;out&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filedescriptors&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;listening&nbsp;port:&nbsp;MyPortNameID1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/11/11&nbsp;17:11:56&nbsp;kid1|&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;127.0.0.1/2320&nbsp;failed&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;current&nbsp;master&nbsp;transaction:&nbsp;master15881&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/11/11&nbsp;17:13:02&nbsp;kid1|&nbsp;WARNING!&nbsp;Your&nbsp;cache&nbsp;is&nbsp;running&nbsp;out&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filedescriptors&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;listening&nbsp;port:&nbsp;MyPortNameID1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2021/11/11&nbsp;17:13:19&nbsp;kid1|&nbsp;WARNING!&nbsp;Your&nbsp;cache&nbsp;is&nbsp;running&nbsp;out&nbsp;of<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filedescriptors&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;But&nbsp;a&nbsp;mgr:info&nbsp;report:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;memPoolFree&nbsp;calls:   &nbsp;4295601&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File&nbsp;descriptor&nbsp;usage&nbsp;for&nbsp;squid:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;Maximum&nbsp;number&nbsp;of&nbsp;file&nbsp;descriptors:  &nbsp;10048&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;Largest&nbsp;file&nbsp;desc&nbsp;currently&nbsp;in&nbsp;use:   &nbsp;262&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;Number&nbsp;of&nbsp;file&nbsp;desc&nbsp;currently&nbsp;in&nbsp;use: &nbsp;135&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;Files&nbsp;queued&nbsp;for&nbsp;open:                  &nbsp;0&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;Available&nbsp;number&nbsp;of&nbsp;file&nbsp;descriptors:&nbsp;9913&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;Reserved&nbsp;number&nbsp;of&nbsp;file&nbsp;descriptors: &nbsp;9789&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;After&nbsp;these&nbsp;errors&nbsp;the&nbsp;listen&nbsp;port&nbsp;is&nbsp;freeze&nbsp;and&nbsp;nobody&nbsp;is&nbsp;able&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;surf.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;just&nbsp;&quot;squid&nbsp;-k&nbsp;reconfigure&quot;&nbsp;fix&nbsp;the&nbsp;issue&nbsp;and&nbsp;the&nbsp;proxy&nbsp;return<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;normal&nbsp;mode&nbsp;for&nbsp;several&nbsp;minutes&nbsp;and&nbsp;back&nbsp;again&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filedescriptors&nbsp;issues.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;relationship&nbsp;between&nbsp;&lt;/font&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;font<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;face=&quot;Arial&quot;&gt;filedescriptors&nbsp;issues&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;clients.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sometimes&nbsp;the&nbsp;issue&nbsp;is&nbsp;discovered&nbsp;during&nbsp;the&nbsp;night&nbsp;when&nbsp;there&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no&nbsp;user&nbsp;that&nbsp;using&nbsp;the&nbsp;proxy&nbsp;(&nbsp;just&nbsp;some&nbsp;robots&nbsp;like&nbsp;windows<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;update&nbsp;)&nbsp;&lt;/font&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Is&nbsp;there&nbsp;something&nbsp;other&nbsp;we&nbsp;can&nbsp;investigate&nbsp;to&nbsp;help&nbsp;more<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stability&nbsp;of&nbsp;the&nbsp;5.x&nbsp;branch&nbsp;?&lt;/font&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Regards&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/font&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;
</tt>
