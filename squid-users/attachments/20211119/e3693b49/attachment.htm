<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;I&nbsp;have&nbsp;created&nbsp;an&nbsp;example&nbsp;how&nbsp;to&nbsp;use&nbsp;and&nbsp;match&nbsp;usernames&nbsp;to&nbsp;tcp_outgoing_ports&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;a&nbsp;href=&quot;https://github.com/elico/vagrant-squid-outgoing-addresses&quot;&gt;https://github.com/elico/vagrant-squid-outgoing-addresses&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;its&nbsp;better&nbsp;to&nbsp;use&nbsp;a&nbsp;single&nbsp;port&nbsp;with&nbsp;different&nbsp;user&nbsp;names&nbsp;(if&nbsp;possible).&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;Let&nbsp;me&nbsp;know&nbsp;what&nbsp;do&nbsp;you&nbsp;think&nbsp;about&nbsp;the&nbsp;solution&nbsp;I&nbsp;am&nbsp;offering&nbsp;and&nbsp;if&nbsp;the&nbsp;example&nbsp;is&nbsp;understandable.&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;Eliezer&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;בתאריך&nbsp;יום&nbsp;ה׳,&nbsp;18&nbsp;בנוב׳&nbsp;2021,&nbsp;22:56,&nbsp;מאת&nbsp;Graminsta&nbsp;‏&lt;&lt;a&nbsp;href=&quot;mailto:marcelorodrigo@graminsta.com.br&quot;&gt;marcelorodrigo@graminsta.com.br&lt;/a&gt;&gt;:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Tks&nbsp;for&nbsp;the&nbsp;answers.&lt;br&gt;<br>
&lt;br&gt;<br>
Considerations:&lt;br&gt;<br>
&lt;br&gt;<br>
1-&nbsp;&quot;Please&nbsp;note&nbsp;that&nbsp;you&nbsp;are&nbsp;allowing&nbsp;authenticated&nbsp;clients&nbsp;to&nbsp;send&nbsp;traffic&lt;br&gt;<br>
to&nbsp;unsafe&nbsp;ports.&nbsp;For&nbsp;example,&nbsp;they&nbsp;can&nbsp;CONNECT&nbsp;to&nbsp;non-SSL&nbsp;ports.&nbsp;You&nbsp;may&lt;br&gt;<br>
want&nbsp;to&nbsp;reorder&nbsp;the&nbsp;above&nbsp;rules&nbsp;if&nbsp;that&nbsp;is&nbsp;not&nbsp;what&nbsp;you&nbsp;want.&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
ANSWER:&lt;br&gt;<br>
Tks&nbsp;for&nbsp;the&nbsp;advice,&nbsp;I&nbsp;already&nbsp;had&nbsp;it&nbsp;changed.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
2-&nbsp;&quot;However,&nbsp;you&nbsp;should&nbsp;also&nbsp;ask&nbsp;yourself&nbsp;another&nbsp;question:&nbsp;&quot;Why&nbsp;am&nbsp;I&nbsp;using&lt;br&gt;<br>
multiple&nbsp;http_ports&nbsp;if&nbsp;all&nbsp;I&nbsp;care&nbsp;about&nbsp;is&nbsp;who&nbsp;uses&nbsp;which&lt;br&gt;<br>
tcp_outgoing_address?&quot;.&nbsp;The&nbsp;listening&nbsp;ports&nbsp;have&nbsp;virtually&nbsp;nothing&nbsp;to&nbsp;do&lt;br&gt;<br>
with&nbsp;tcp_outgoing_address...&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
ANSWER:&lt;br&gt;<br>
Because&nbsp;I&nbsp;have&nbsp;to&nbsp;route&nbsp;each&nbsp;http_port&nbsp;to&nbsp;specific&nbsp;tcp_outgoing_address.&lt;br&gt;<br>
I&nbsp;have&nbsp;several&nbsp;customers&nbsp;per&nbsp;VPS.&lt;br&gt;<br>
Each&nbsp;one&nbsp;uses&nbsp;like&nbsp;10&nbsp;different&nbsp;ports&nbsp;to&nbsp;direct&nbsp;connections&nbsp;through&lt;br&gt;<br>
different&nbsp;IPv6s.&lt;br&gt;<br>
&lt;br&gt;<br>
3-&nbsp;&quot;Use&nbsp;http_access&nbsp;to&nbsp;deny&nbsp;authenticated&nbsp;users&nbsp;connected&nbsp;to&nbsp;wrong&nbsp;ports.&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
ANSWER:&lt;br&gt;<br>
So,&nbsp;in&nbsp;this&nbsp;scenario,&nbsp;how&nbsp;can&nbsp;I&nbsp;prevent&nbsp;users&nbsp;in&nbsp;the&nbsp;same&nbsp;users&nbsp;list&nbsp;to&lt;br&gt;<br>
access&nbsp;ports&nbsp;that&nbsp;not&nbsp;belong&nbsp;to&nbsp;them.&lt;br&gt;<br>
How&nbsp;to&nbsp;deny&nbsp;it&nbsp;in&nbsp;http_access&nbsp;rules?&lt;br&gt;<br>
&lt;br&gt;<br>
Marcelo&lt;br&gt;<br>
&lt;br&gt;<br>
-----Mensagem&nbsp;original-----&lt;br&gt;<br>
De:&nbsp;squid-users&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users-bounces@lists.squid-cache.org&lt;/a&gt;]&nbsp;Em&nbsp;nome&lt;br&gt;<br>
de&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users-request@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users-request@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
Enviada&nbsp;em:&nbsp;terça-feira,&nbsp;16&nbsp;de&nbsp;novembro&nbsp;de&nbsp;2021&nbsp;15:23&lt;br&gt;<br>
Para:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
Assunto:&nbsp;squid-users&nbsp;Digest,&nbsp;Vol&nbsp;87,&nbsp;Issue&nbsp;19&lt;br&gt;<br>
&lt;br&gt;<br>
Send&nbsp;squid-users&nbsp;mailing&nbsp;list&nbsp;submissions&nbsp;to&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;subscribe&nbsp;or&nbsp;unsubscribe&nbsp;via&nbsp;the&nbsp;World&nbsp;Wide&nbsp;Web,&nbsp;visit&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
or,&nbsp;via&nbsp;email,&nbsp;send&nbsp;a&nbsp;message&nbsp;with&nbsp;subject&nbsp;or&nbsp;body&nbsp;&#39;help&#39;&nbsp;to&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users-request@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users-request@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;reach&nbsp;the&nbsp;person&nbsp;managing&nbsp;the&nbsp;list&nbsp;at&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users-owner@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users-owner@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
When&nbsp;replying,&nbsp;please&nbsp;edit&nbsp;your&nbsp;Subject&nbsp;line&nbsp;so&nbsp;it&nbsp;is&nbsp;more&nbsp;specific&nbsp;than&lt;br&gt;<br>
&quot;Re:&nbsp;Contents&nbsp;of&nbsp;squid-users&nbsp;digest...&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Today&#39;s&nbsp;Topics:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; 1.&nbsp;Multi-clients&nbsp;VPS&nbsp;-&nbsp;Authentication&nbsp;been&nbsp;shared.&nbsp;(Graminsta)&lt;br&gt;<br>
 &nbsp; 2.&nbsp;Re:&nbsp;Too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&nbsp;overflow&nbsp;for&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&nbsp;(Lou?ansk?&nbsp;Luk??)&lt;br&gt;<br>
 &nbsp; 3.&nbsp;Re:&nbsp;Stable&nbsp;Squid&nbsp;Version&nbsp;for&nbsp;production&nbsp;on&nbsp;Linux&nbsp;(David&nbsp;Touzeau)&lt;br&gt;<br>
 &nbsp; 4.&nbsp;Re:&nbsp;Too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&nbsp;overflow&nbsp;for&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&nbsp;(Alex&nbsp;Rousskov)&lt;br&gt;<br>
 &nbsp; 5.&nbsp;Re:&nbsp;Multi-clients&nbsp;VPS&nbsp;-&nbsp;Authentication&nbsp;been&nbsp;shared.&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;(Alex&nbsp;Rousskov)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
----------------------------------------------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
Message:&nbsp;1&lt;br&gt;<br>
Date:&nbsp;Tue,&nbsp;16&nbsp;Nov&nbsp;2021&nbsp;13:53:52&nbsp;-0300&lt;br&gt;<br>
From:&nbsp;&quot;Graminsta&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:marcelorodrigo@graminsta.com.br&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;marcelorodrigo@graminsta.com.br&lt;/a&gt;&gt;&lt;br&gt;<br>
To:&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&gt;&lt;br&gt;<br>
Subject:&nbsp;[squid-users]&nbsp;Multi-clients&nbsp;VPS&nbsp;-&nbsp;Authentication&nbsp;been&nbsp;shared.&lt;br&gt;<br>
Message-ID:&nbsp;&lt;005e01d7db0a$8ab2ab80$a0180280$@&lt;a&nbsp;href=&quot;http://graminsta.com.br&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;graminsta.com.br&lt;/a&gt;&gt;&lt;br&gt;<br>
Content-Type:&nbsp;text/plain;&nbsp;charset=&quot;us-ascii&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
Hello&nbsp;friends,&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
I&#39;m&nbsp;using&nbsp;these&nbsp;user&nbsp;authentication&nbsp;lines&nbsp;in&nbsp;squid.conf&nbsp;based&nbsp;on&nbsp;user&#39;s&lt;br&gt;<br>
authentication&nbsp;list:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib/squid/basic_ncsa_auth&nbsp;/etc/squid/users&lt;br&gt;<br>
&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;children&nbsp;5&lt;br&gt;<br>
&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;realm&nbsp;Squid&nbsp;proxy-caching&nbsp;web&nbsp;server&lt;br&gt;<br>
&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;2&nbsp;hours&lt;br&gt;<br>
&lt;br&gt;<br>
auth_param&nbsp;basic&nbsp;casesensitive&nbsp;off&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;clientes&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;<br>
&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;clientes&lt;br&gt;<br>
&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;<br>
&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
#List&nbsp;of&nbsp;outgoings&nbsp;(all&nbsp;IPs&nbsp;are&nbsp;fake)&lt;br&gt;<br>
&lt;br&gt;<br>
http_port&nbsp;&lt;a&nbsp;href=&quot;http://181.111.11.111:4000&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;181.111.11.111:4000&lt;/a&gt;&nbsp;name=3&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;ip3&nbsp;myportname&nbsp;3&lt;br&gt;<br>
&lt;br&gt;<br>
tcp_outgoing_address&nbsp;2804:1934:2E1::3D6&nbsp;ip3&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
http_port&nbsp;&lt;a&nbsp;href=&quot;http://181.111.11.112:4001&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;181.111.11.112:4001&lt;/a&gt;&nbsp;name=4&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;ip4&nbsp;myportname&nbsp;4&lt;br&gt;<br>
&lt;br&gt;<br>
tcp_outgoing_address&nbsp;2804:1934:3a8::3D7&nbsp;ip4&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;problem&nbsp;is&nbsp;that&nbsp;everyone&nbsp;whom&nbsp;is&nbsp;in&nbsp;the&nbsp;users&nbsp;file&nbsp;are&nbsp;allow&nbsp;to&nbsp;use&nbsp;all&lt;br&gt;<br>
tcp_outgoing_address.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;a&nbsp;smarter&nbsp;client&nbsp;scans&nbsp;for&nbsp;open&nbsp;IPs&nbsp;and&nbsp;ports&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;find&nbsp;these&lt;br&gt;<br>
outgoings.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
How&nbsp;can&nbsp;I&nbsp;restrict&nbsp;each&nbsp;user&nbsp;to&nbsp;their&nbsp;own&nbsp;tcp_outgoing_address&nbsp;output?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Tks.&lt;br&gt;<br>
&lt;br&gt;<br>
Marcelo&lt;br&gt;<br>
&lt;br&gt;<br>
--------------&nbsp;next&nbsp;part&nbsp;--------------&lt;br&gt;<br>
An&nbsp;HTML&nbsp;attachment&nbsp;was&nbsp;scrubbed...&lt;br&gt;<br>
URL:&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/pipermail/squid-users/attachments/20211116/69fb0a22/attachment-0001.htm&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/pipermail/squid-users/attachments/20211116/69f&lt;br&gt;<br>
b0a22/attachment-0001.htm&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
Message:&nbsp;2&lt;br&gt;<br>
Date:&nbsp;Tue,&nbsp;16&nbsp;Nov&nbsp;2021&nbsp;18:00:56&nbsp;+0100&lt;br&gt;<br>
From:&nbsp;Lou?ansk?&nbsp;Luk??&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:Loucansky.Lukas@kjj.cz&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;Loucansky.Lukas@kjj.cz&lt;/a&gt;&gt;&lt;br&gt;<br>
To:&nbsp;&quot;Alex&nbsp;Rousskov&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;,&nbsp;&quot;Squid&nbsp;Users&quot;&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&gt;&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;overflow&nbsp;for&nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&lt;br&gt;<br>
Message-ID:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;72DD5D5CF661B5459DC08A060BF26B53010897A8@kjj-server.KJJ.local&gt;&lt;br&gt;<br>
Content-Type:&nbsp;text/plain; &nbsp; &nbsp; &nbsp; charset=&quot;windows-1250&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
Ok&nbsp;-&nbsp;I&nbsp;will&nbsp;try&nbsp;to&nbsp;backport&nbsp;it&nbsp;from&nbsp;that&nbsp;patch&nbsp;into&nbsp;the&nbsp;v5&nbsp;tree&nbsp;I&#39;ve&lt;br&gt;<br>
downloaded&nbsp;today.&nbsp;As&nbsp;we&nbsp;were&nbsp;using&nbsp;the&nbsp;mentioned&nbsp;build&nbsp;I&nbsp;came&nbsp;across&nbsp;these&lt;br&gt;<br>
new&nbsp;assertions:&lt;br&gt;<br>
&lt;br&gt;<br>
2021/11/16&nbsp;10:29:46&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;StoreMap.cc:241:&lt;br&gt;<br>
&quot;anchorAt(anchorId).reading()&quot;&lt;br&gt;<br>
2021/11/16&nbsp;11:32:51&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&nbsp;e&quot;&lt;br&gt;<br>
2021/11/16&nbsp;13:02:09&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&nbsp;e&quot;&lt;br&gt;<br>
2021/11/16&nbsp;13:52:05&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&nbsp;e&quot;&lt;br&gt;<br>
2021/11/16&nbsp;14:29:41&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;store.cc:1108:&nbsp;&quot;store_status&nbsp;==&lt;br&gt;<br>
STORE_PENDING&quot;&lt;br&gt;<br>
2021/11/16&nbsp;15:26:15&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&nbsp;e&quot;&lt;br&gt;<br>
2021/11/16&nbsp;17:40:21&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;cbdata.cc:372:&nbsp;&quot;c-&gt;locks&nbsp;&gt;&nbsp;0&quot;&lt;br&gt;<br>
2021/11/16&nbsp;17:40:44&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;cbdata.cc:115:&nbsp;&quot;cookie&nbsp;==&lt;br&gt;<br>
((long)this&nbsp;^&nbsp;Cookie)&quot;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
(no&nbsp;config&nbsp;changes)&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;1w&nbsp;cache.log&nbsp;is&nbsp;about&nbsp;300MB&nbsp;-&nbsp;without&nbsp;elevated&nbsp;debug&nbsp;options&nbsp;(debug&lt;br&gt;<br>
options&nbsp;ALL,1)&nbsp;-&nbsp;so&nbsp;it?s&nbsp;not&nbsp;easy&nbsp;to&nbsp;find&nbsp;something&nbsp;relevant&nbsp;with&nbsp;&quot;9&quot;&lt;br&gt;<br>
options&nbsp;enabled...&lt;br&gt;<br>
&lt;br&gt;<br>
LL&lt;br&gt;<br>
&lt;br&gt;<br>
-----Original&nbsp;Message-----&lt;br&gt;<br>
From:&nbsp;Alex&nbsp;Rousskov&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;]&lt;br&gt;<br>
Sent:&nbsp;Tuesday,&nbsp;November&nbsp;16,&nbsp;2021&nbsp;3:42&nbsp;PM&lt;br&gt;<br>
To:&nbsp;Lou?ansk?&nbsp;Luk??;&nbsp;Squid&nbsp;Users&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&lt;br&gt;<br>
overflow&nbsp;for&nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;11/16/21&nbsp;4:38&nbsp;AM,&nbsp;Lou?ansk?&nbsp;Luk??&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;is&nbsp;it&nbsp;going&nbsp;to&nbsp;be&nbsp;patched&nbsp;only&nbsp;in&nbsp;the&nbsp;v6&nbsp;version?&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;hope&nbsp;the&nbsp;existing&nbsp;fix&nbsp;applies&nbsp;to&nbsp;v5&nbsp;cleanly,&nbsp;and&nbsp;I&nbsp;am&nbsp;ready&nbsp;to&nbsp;help&nbsp;with&lt;br&gt;<br>
backporting&nbsp;if&nbsp;it&nbsp;does&nbsp;not.&nbsp;Beyond&nbsp;that,&nbsp;it&nbsp;is&nbsp;in&nbsp;the&nbsp;maintainer&nbsp;hands.&nbsp;I&lt;br&gt;<br>
cannot&nbsp;predict&nbsp;whether&nbsp;or&nbsp;when&nbsp;the&nbsp;fix&nbsp;will&nbsp;be&nbsp;officially&nbsp;merged&nbsp;into&nbsp;v5&lt;br&gt;<br>
because&nbsp;I&nbsp;do&nbsp;not&nbsp;understand&nbsp;how&nbsp;those&nbsp;decisions&nbsp;are&nbsp;made.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Anyway&nbsp;-&nbsp;in&nbsp;the&nbsp;morning&nbsp;I&nbsp;run&nbsp;debug&nbsp;with&nbsp;20,9&nbsp;to&nbsp;see:&lt;br&gt;<br>
&gt;&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;2021/11/16&nbsp;09:02:06.496&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&lt;br&gt;<br>
e&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
Unfortunately,&nbsp;I&nbsp;cannot&nbsp;see&nbsp;the&nbsp;cause&nbsp;of&nbsp;the&nbsp;assertion&nbsp;in&nbsp;this&nbsp;short/partial&lt;br&gt;<br>
trace&nbsp;--&nbsp;the&nbsp;problematic&nbsp;actions&nbsp;happened&nbsp;before&nbsp;the&nbsp;trace&nbsp;or&nbsp;were&nbsp;not&lt;br&gt;<br>
logged&nbsp;during&nbsp;the&nbsp;trace.&lt;br&gt;<br>
&lt;br&gt;<br>
Patching&nbsp;your&nbsp;Squid&nbsp;with&nbsp;commit&nbsp;5210df4&nbsp;is&nbsp;the&nbsp;best&nbsp;next&nbsp;step&nbsp;IMO.&nbsp;If&nbsp;that&lt;br&gt;<br>
patch&nbsp;does&nbsp;not&nbsp;help,&nbsp;then&nbsp;there&nbsp;are&nbsp;probably&nbsp;other&nbsp;bugs&nbsp;that&nbsp;we&nbsp;need&nbsp;to&nbsp;fix&lt;br&gt;<br>
in&nbsp;v5&nbsp;(at&nbsp;least).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;-----Original&nbsp;Message-----&lt;br&gt;<br>
&gt;&nbsp;From:&nbsp;Alex&nbsp;Rousskov&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;]&lt;br&gt;<br>
&gt;&nbsp;Sent:&nbsp;Monday,&nbsp;November&nbsp;15,&nbsp;2021&nbsp;5:17&nbsp;PM&lt;br&gt;<br>
&gt;&nbsp;To:&nbsp;Squid&nbsp;Users&lt;br&gt;<br>
&gt;&nbsp;Cc:&nbsp;Lou?ansk?&nbsp;Luk??&lt;br&gt;<br>
&gt;&nbsp;Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&nbsp;&lt;br&gt;<br>
&gt;&nbsp;overflow&nbsp;for&nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;11/15/21&nbsp;7:43&nbsp;AM,&nbsp;Lou?ansk?&nbsp;Luk??&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;2021/11/14&nbsp;10:13:30&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&nbsp;e&quot;&lt;br&gt;<br>
&gt;&gt;&nbsp;2021/11/15&nbsp;08:37:36&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&nbsp;e&quot;&lt;br&gt;<br>
&gt;&gt;&nbsp;2021/11/15&nbsp;11:54:14&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&nbsp;e&quot;&lt;br&gt;<br>
&gt;&gt;&nbsp;2021/11/15&nbsp;12:16:27&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&nbsp;e&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;recommend&nbsp;ignoring&nbsp;queue&nbsp;overflows&nbsp;until&nbsp;the&nbsp;above&nbsp;assertions&nbsp;are&nbsp;fixed&lt;br&gt;<br>
because&nbsp;worker&nbsp;deaths&nbsp;cause&nbsp;queue&nbsp;overflows.&nbsp;Your&nbsp;Squid&nbsp;is&nbsp;buggy,&nbsp;and&nbsp;those&lt;br&gt;<br>
bugs&nbsp;essentially&nbsp;cause&nbsp;queue&nbsp;overflows.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;assertion&nbsp;itself&nbsp;is&nbsp;known&nbsp;as&nbsp;Bug&nbsp;5134:&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://bugs.squid-cache.org/show_bug.cgi?id=5134&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugs.squid-cache.org/show_bug.cgi?id=5134&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;That&nbsp;bug&nbsp;has&nbsp;a&nbsp;speculative&nbsp;fix&nbsp;(master/v6&nbsp;commit&nbsp;5210df4).&nbsp;Please&nbsp;try&nbsp;it&lt;br&gt;<br>
if&nbsp;you&nbsp;can.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;HTH,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Alex.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;-----Original&nbsp;Message-----&lt;br&gt;<br>
&gt;&gt;&nbsp;From:&nbsp;Alex&nbsp;Rousskov&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;]&lt;br&gt;<br>
&gt;&gt;&nbsp;Sent:&nbsp;Friday,&nbsp;November&nbsp;12,&nbsp;2021&nbsp;5:24&nbsp;PM&lt;br&gt;<br>
&gt;&gt;&nbsp;To:&nbsp;Lou?ansk?&nbsp;Luk??;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;overflow&nbsp;for&nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;On&nbsp;11/11/21&nbsp;10:19&nbsp;AM,&nbsp;Lou?ansk?&nbsp;Luk??&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;recently&nbsp;I&#39;m&nbsp;facing&nbsp;too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&nbsp;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;overflow&nbsp;for&nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&nbsp;lines&nbsp;in&nbsp;my&nbsp;Squid&nbsp;5.2&nbsp;log&nbsp;files.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;We&nbsp;see&nbsp;those&nbsp;overflows&nbsp;when&nbsp;kids&nbsp;die.&nbsp;Do&nbsp;you&nbsp;see&nbsp;any&nbsp;FATAL&nbsp;messages,&lt;br&gt;<br>
assertions,&nbsp;or&nbsp;similar&nbsp;deadly&nbsp;errors&nbsp;in&nbsp;cache.log?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;Could&nbsp;someone&nbsp;elaborate&nbsp;how&nbsp;the&nbsp;queue&nbsp;is&nbsp;filled&nbsp;-&nbsp;what&nbsp;is&nbsp;clogging&nbsp;it?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;The&nbsp;sender/writer&nbsp;sends&nbsp;messages&nbsp;faster&nbsp;than&nbsp;the&nbsp;recipient/reader&nbsp;is&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;reading&nbsp;them,&nbsp;eventually&nbsp;exceeding&nbsp;the&nbsp;queue&nbsp;capacity&nbsp;(i.e.&nbsp;1024&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;messages).&nbsp;These&nbsp;messages&nbsp;are&nbsp;about&nbsp;Store&nbsp;entries&nbsp;that&nbsp;may&nbsp;need&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;synchronization&nbsp;across&nbsp;workers.&nbsp;Each&nbsp;message&nbsp;is&nbsp;very&nbsp;sm&lt;br&gt;<br>
&gt;&nbsp;all.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;I&nbsp;don&#39;t&nbsp;mind&nbsp;too&nbsp;much&nbsp;if&nbsp;I&nbsp;have&nbsp;to&nbsp;turn&nbsp;collapsed&nbsp;forwarding&nbsp;off&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Most&nbsp;likely,&nbsp;the&nbsp;problem&nbsp;is&nbsp;not&nbsp;tied&nbsp;to&nbsp;collapsed&nbsp;forwarding.&nbsp;These&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;queues&nbsp;were&nbsp;used&nbsp;for&nbsp;collapsed&nbsp;forwarding&nbsp;when&nbsp;they&nbsp;were&nbsp;added,&nbsp;but&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;they&nbsp;are&nbsp;used&nbsp;for&nbsp;regular&nbsp;traffic&nbsp;as&nbsp;well&nbsp;in&nbsp;modern&nbsp;SMP&nbsp;Squids.&nbsp;We&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;need&nbsp;to&nbsp;change&nbsp;the&nbsp;queue&nbsp;names&nbsp;(and&nbsp;related&nbsp;code/m&lt;br&gt;<br>
&gt;&nbsp;essage&nbsp;text)&nbsp;to&nbsp;reflect&nbsp;the&nbsp;expanded&nbsp;nature&nbsp;of&nbsp;these&nbsp;queues.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;HTH,&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Alex.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
Message:&nbsp;3&lt;br&gt;<br>
Date:&nbsp;Tue,&nbsp;16&nbsp;Nov&nbsp;2021&nbsp;18:33:30&nbsp;+0100&lt;br&gt;<br>
From:&nbsp;David&nbsp;Touzeau&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:david@articatech.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;david@articatech.com&lt;/a&gt;&gt;&lt;br&gt;<br>
To:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Stable&nbsp;Squid&nbsp;Version&nbsp;for&nbsp;production&nbsp;on&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;Linux&lt;br&gt;<br>
Message-ID:&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:60b9c5c9-202c-ad3c-c90d-a78f45f6c89c@articatech.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;60b9c5c9-202c-ad3c-c90d-a78f45f6c89c@articatech.com&lt;/a&gt;&gt;&lt;br&gt;<br>
Content-Type:&nbsp;text/plain;&nbsp;charset=&quot;utf-8&quot;;&nbsp;Format=&quot;flowed&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
Hi,&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;us&nbsp;it&nbsp;is&nbsp;Squid&nbsp;v4.17&lt;br&gt;<br>
&lt;br&gt;<br>
Le&nbsp;16/11/2021&nbsp;?&nbsp;17:40,&nbsp;Graminsta&nbsp;a&nbsp;?crit?:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Hey&nbsp;folks&nbsp;?;)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;is&nbsp;the&nbsp;most&nbsp;stable&nbsp;squid&nbsp;version&nbsp;for&nbsp;production&nbsp;on&nbsp;Ubuntu&nbsp;18&nbsp;or&nbsp;20?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Marcelo&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
--------------&nbsp;next&nbsp;part&nbsp;--------------&lt;br&gt;<br>
An&nbsp;HTML&nbsp;attachment&nbsp;was&nbsp;scrubbed...&lt;br&gt;<br>
URL:&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/pipermail/squid-users/attachments/20211116/5b31cc34/attachment-0001.htm&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/pipermail/squid-users/attachments/20211116/5b3&lt;br&gt;<br>
1cc34/attachment-0001.htm&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
Message:&nbsp;4&lt;br&gt;<br>
Date:&nbsp;Tue,&nbsp;16&nbsp;Nov&nbsp;2021&nbsp;13:09:12&nbsp;-0500&lt;br&gt;<br>
From:&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&lt;br&gt;<br>
To:&nbsp;Lou?ansk?&nbsp;Luk??&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:Loucansky.Lukas@kjj.cz&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;Loucansky.Lukas@kjj.cz&lt;/a&gt;&gt;,&nbsp;Squid&nbsp;Users&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&gt;&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;overflow&nbsp;for&nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&lt;br&gt;<br>
Message-ID:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:369d5766-b6ab-f4cd-8cef-64b298d84638@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;369d5766-b6ab-f4cd-8cef-64b298d84638@measurement-factory.com&lt;/a&gt;&gt;&lt;br&gt;<br>
Content-Type:&nbsp;text/plain;&nbsp;charset=windows-1250&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;11/16/21&nbsp;12:00&nbsp;PM,&nbsp;Lou?ansk?&nbsp;Luk??&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;will&nbsp;try&nbsp;to&nbsp;backport&nbsp;it&nbsp;from&nbsp;that&nbsp;patch&nbsp;into&nbsp;the&nbsp;v5&nbsp;tree&nbsp;I&#39;ve&nbsp;&lt;br&gt;<br>
&gt;&nbsp;downloaded&nbsp;today.&nbsp;As&nbsp;we&nbsp;were&nbsp;using&nbsp;the&nbsp;mentioned&nbsp;build&nbsp;I&nbsp;came&nbsp;across&nbsp;&lt;br&gt;<br>
&gt;&nbsp;these&nbsp;new&nbsp;assertions:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;2021/11/16&nbsp;10:29:46&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;StoreMap.cc:241:&lt;br&gt;<br>
&quot;anchorAt(anchorId).reading()&quot;&lt;br&gt;<br>
&gt;&nbsp;2021/11/16&nbsp;11:32:51&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&nbsp;e&quot;&lt;br&gt;<br>
&gt;&nbsp;2021/11/16&nbsp;14:29:41&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;store.cc:1108:&nbsp;&quot;store_status&lt;br&gt;<br>
==&nbsp;STORE_PENDING&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;hope&nbsp;that&nbsp;at&nbsp;least&nbsp;some&nbsp;of&nbsp;the&nbsp;above&nbsp;assertions&nbsp;are&nbsp;fixed&nbsp;by&nbsp;master/v6&lt;br&gt;<br>
commit&nbsp;5210df4.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;2021/11/16&nbsp;17:40:21&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;cbdata.cc:372:&nbsp;&quot;c-&gt;locks&nbsp;&gt;&nbsp;0&quot;&lt;br&gt;<br>
&gt;&nbsp;2021/11/16&nbsp;17:40:44&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;cbdata.cc:115:&nbsp;&quot;cookie&nbsp;==&lt;br&gt;<br>
((long)this&nbsp;^&nbsp;Cookie)&quot;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;probably&nbsp;an&nbsp;unrelated&nbsp;bug.&nbsp;I&nbsp;recommend&nbsp;filing&nbsp;a&nbsp;bug&nbsp;report&nbsp;in&nbsp;Squid&lt;br&gt;<br>
bugzilla&nbsp;and&nbsp;posting&nbsp;the&nbsp;corresponding&nbsp;&quot;bt&nbsp;full&quot;&nbsp;backtrace&nbsp;there.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;-----Original&nbsp;Message-----&lt;br&gt;<br>
&gt;&nbsp;From:&nbsp;Alex&nbsp;Rousskov&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;]&lt;br&gt;<br>
&gt;&nbsp;Sent:&nbsp;Tuesday,&nbsp;November&nbsp;16,&nbsp;2021&nbsp;3:42&nbsp;PM&lt;br&gt;<br>
&gt;&nbsp;To:&nbsp;Lou?ansk?&nbsp;Luk??;&nbsp;Squid&nbsp;Users&lt;br&gt;<br>
&gt;&nbsp;Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&nbsp;&lt;br&gt;<br>
&gt;&nbsp;overflow&nbsp;for&nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;11/16/21&nbsp;4:38&nbsp;AM,&nbsp;Lou?ansk?&nbsp;Luk??&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&nbsp;is&nbsp;it&nbsp;going&nbsp;to&nbsp;be&nbsp;patched&nbsp;only&nbsp;in&nbsp;the&nbsp;v6&nbsp;version?&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;hope&nbsp;the&nbsp;existing&nbsp;fix&nbsp;applies&nbsp;to&nbsp;v5&nbsp;cleanly,&nbsp;and&nbsp;I&nbsp;am&nbsp;ready&nbsp;to&nbsp;help&nbsp;with&lt;br&gt;<br>
backporting&nbsp;if&nbsp;it&nbsp;does&nbsp;not.&nbsp;Beyond&nbsp;that,&nbsp;it&nbsp;is&nbsp;in&nbsp;the&nbsp;maintainer&nbsp;hands.&nbsp;I&lt;br&gt;<br>
cannot&nbsp;predict&nbsp;whether&nbsp;or&nbsp;when&nbsp;the&nbsp;fix&nbsp;will&nbsp;be&nbsp;officially&nbsp;merged&nbsp;into&nbsp;v5&lt;br&gt;<br>
because&nbsp;I&nbsp;do&nbsp;not&nbsp;understand&nbsp;how&nbsp;those&nbsp;decisions&nbsp;are&nbsp;made.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;Anyway&nbsp;-&nbsp;in&nbsp;the&nbsp;morning&nbsp;I&nbsp;run&nbsp;debug&nbsp;with&nbsp;20,9&nbsp;to&nbsp;see:&lt;br&gt;<br>
&gt;&gt;&nbsp;...&lt;br&gt;<br>
&gt;&gt;&nbsp;2021/11/16&nbsp;09:02:06.496&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&lt;br&gt;<br>
==&nbsp;e&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Unfortunately,&nbsp;I&nbsp;cannot&nbsp;see&nbsp;the&nbsp;cause&nbsp;of&nbsp;the&nbsp;assertion&nbsp;in&nbsp;this&lt;br&gt;<br>
short/partial&nbsp;trace&nbsp;--&nbsp;the&nbsp;problematic&nbsp;actions&nbsp;happened&nbsp;before&nbsp;the&nbsp;trace&nbsp;or&lt;br&gt;<br>
were&nbsp;not&nbsp;logged&nbsp;during&nbsp;the&nbsp;trace.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Patching&nbsp;your&nbsp;Squid&nbsp;with&nbsp;commit&nbsp;5210df4&nbsp;is&nbsp;the&nbsp;best&nbsp;next&nbsp;step&nbsp;IMO.&nbsp;If&nbsp;that&lt;br&gt;<br>
patch&nbsp;does&nbsp;not&nbsp;help,&nbsp;then&nbsp;there&nbsp;are&nbsp;probably&nbsp;other&nbsp;bugs&nbsp;that&nbsp;we&nbsp;need&nbsp;to&nbsp;fix&lt;br&gt;<br>
in&nbsp;v5&nbsp;(at&nbsp;least).&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;HTH,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Alex.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;-----Original&nbsp;Message-----&lt;br&gt;<br>
&gt;&gt;&nbsp;From:&nbsp;Alex&nbsp;Rousskov&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;]&lt;br&gt;<br>
&gt;&gt;&nbsp;Sent:&nbsp;Monday,&nbsp;November&nbsp;15,&nbsp;2021&nbsp;5:17&nbsp;PM&lt;br&gt;<br>
&gt;&gt;&nbsp;To:&nbsp;Squid&nbsp;Users&lt;br&gt;<br>
&gt;&gt;&nbsp;Cc:&nbsp;Lou?ansk?&nbsp;Luk??&lt;br&gt;<br>
&gt;&gt;&nbsp;Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;overflow&nbsp;for&nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;On&nbsp;11/15/21&nbsp;7:43&nbsp;AM,&nbsp;Lou?ansk?&nbsp;Luk??&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;2021/11/14&nbsp;10:13:30&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&lt;br&gt;<br>
e&quot;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;2021/11/15&nbsp;08:37:36&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&lt;br&gt;<br>
e&quot;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;2021/11/15&nbsp;11:54:14&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&lt;br&gt;<br>
e&quot;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;2021/11/15&nbsp;12:16:27&nbsp;kid1|&nbsp;assertion&nbsp;failed:&nbsp;Transients.cc:221:&nbsp;&quot;old&nbsp;==&lt;br&gt;<br>
e&quot;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;recommend&nbsp;ignoring&nbsp;queue&nbsp;overflows&nbsp;until&nbsp;the&nbsp;above&nbsp;assertions&nbsp;are&nbsp;fixed&lt;br&gt;<br>
because&nbsp;worker&nbsp;deaths&nbsp;cause&nbsp;queue&nbsp;overflows.&nbsp;Your&nbsp;Squid&nbsp;is&nbsp;buggy,&nbsp;and&nbsp;those&lt;br&gt;<br>
bugs&nbsp;essentially&nbsp;cause&nbsp;queue&nbsp;overflows.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;The&nbsp;assertion&nbsp;itself&nbsp;is&nbsp;known&nbsp;as&nbsp;Bug&nbsp;5134:&lt;br&gt;<br>
&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;https://bugs.squid-cache.org/show_bug.cgi?id=5134&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugs.squid-cache.org/show_bug.cgi?id=5134&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;That&nbsp;bug&nbsp;has&nbsp;a&nbsp;speculative&nbsp;fix&nbsp;(master/v6&nbsp;commit&nbsp;5210df4).&nbsp;Please&nbsp;try&nbsp;it&lt;br&gt;<br>
if&nbsp;you&nbsp;can.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;HTH,&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Alex.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;-----Original&nbsp;Message-----&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;From:&nbsp;Alex&nbsp;Rousskov&nbsp;[mailto:&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;]&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;Sent:&nbsp;Friday,&nbsp;November&nbsp;12,&nbsp;2021&nbsp;5:24&nbsp;PM&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;To:&nbsp;Lou?ansk?&nbsp;Luk??;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;queue&nbsp;overflow&nbsp;for&nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;On&nbsp;11/11/21&nbsp;10:19&nbsp;AM,&nbsp;Lou?ansk?&nbsp;Luk??&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&nbsp;recently&nbsp;I&#39;m&nbsp;facing&nbsp;too&nbsp;many&nbsp;ERROR:&nbsp;Collapsed&nbsp;forwarding&nbsp;queue&nbsp;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&nbsp;overflow&nbsp;for&nbsp;kid2&nbsp;at&nbsp;1024&nbsp;items&nbsp;lines&nbsp;in&nbsp;my&nbsp;Squid&nbsp;5.2&nbsp;log&nbsp;files.&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;We&nbsp;see&nbsp;those&nbsp;overflows&nbsp;when&nbsp;kids&nbsp;die.&nbsp;Do&nbsp;you&nbsp;see&nbsp;any&nbsp;FATAL&nbsp;messages,&lt;br&gt;<br>
assertions,&nbsp;or&nbsp;similar&nbsp;deadly&nbsp;errors&nbsp;in&nbsp;cache.log?&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&nbsp;Could&nbsp;someone&nbsp;elaborate&nbsp;how&nbsp;the&nbsp;queue&nbsp;is&nbsp;filled&nbsp;-&nbsp;what&nbsp;is&nbsp;clogging&nbsp;it?&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;The&nbsp;sender/writer&nbsp;sends&nbsp;messages&nbsp;faster&nbsp;than&nbsp;the&nbsp;recipient/reader&nbsp;is&nbsp;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;reading&nbsp;them,&nbsp;eventually&nbsp;exceeding&nbsp;the&nbsp;queue&nbsp;capacity&nbsp;(i.e.&nbsp;1024&nbsp;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;messages).&nbsp;These&nbsp;messages&nbsp;are&nbsp;about&nbsp;Store&nbsp;entries&nbsp;that&nbsp;may&nbsp;need&nbsp;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;synchronization&nbsp;across&nbsp;workers.&nbsp;Each&nbsp;message&nbsp;is&nbsp;very&nbsp;sm&lt;br&gt;<br>
&gt;&gt;&nbsp;all.&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&gt;&nbsp;I&nbsp;don&#39;t&nbsp;mind&nbsp;too&nbsp;much&nbsp;if&nbsp;I&nbsp;have&nbsp;to&nbsp;turn&nbsp;collapsed&nbsp;forwarding&nbsp;off&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;Most&nbsp;likely,&nbsp;the&nbsp;problem&nbsp;is&nbsp;not&nbsp;tied&nbsp;to&nbsp;collapsed&nbsp;forwarding.&nbsp;These&nbsp;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;queues&nbsp;were&nbsp;used&nbsp;for&nbsp;collapsed&nbsp;forwarding&nbsp;when&nbsp;they&nbsp;were&nbsp;added,&nbsp;but&nbsp;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;they&nbsp;are&nbsp;used&nbsp;for&nbsp;regular&nbsp;traffic&nbsp;as&nbsp;well&nbsp;in&nbsp;modern&nbsp;SMP&nbsp;Squids.&nbsp;We&nbsp;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;need&nbsp;to&nbsp;change&nbsp;the&nbsp;queue&nbsp;names&nbsp;(and&nbsp;related&nbsp;code/m&lt;br&gt;<br>
&gt;&gt;&nbsp;essage&nbsp;text)&nbsp;to&nbsp;reflect&nbsp;the&nbsp;expanded&nbsp;nature&nbsp;of&nbsp;these&nbsp;queues.&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;HTH,&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&gt;&nbsp;Alex.&lt;br&gt;<br>
&gt;&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
Message:&nbsp;5&lt;br&gt;<br>
Date:&nbsp;Tue,&nbsp;16&nbsp;Nov&nbsp;2021&nbsp;13:23:00&nbsp;-0500&lt;br&gt;<br>
From:&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&lt;br&gt;<br>
To:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Multi-clients&nbsp;VPS&nbsp;-&nbsp;Authentication&nbsp;been&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;shared.&lt;br&gt;<br>
Message-ID:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:7d3ac49b-d2f7-fffa-cb2d-e2377b8ada5e@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;7d3ac49b-d2f7-fffa-cb2d-e2377b8ada5e@measurement-factory.com&lt;/a&gt;&gt;&lt;br&gt;<br>
Content-Type:&nbsp;text/plain;&nbsp;charset=windows-1252&lt;br&gt;<br>
&lt;br&gt;<br>
On&nbsp;11/16/21&nbsp;11:53&nbsp;AM,&nbsp;Graminsta&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hello&nbsp;friends,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;using&nbsp;these&nbsp;user&nbsp;authentication&nbsp;lines&nbsp;in&nbsp;squid.conf&nbsp;based&nbsp;on&nbsp;&lt;br&gt;<br>
&gt;&nbsp;user?s&nbsp;authentication&nbsp;list:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib/squid/basic_ncsa_auth&nbsp;&lt;br&gt;<br>
&gt;&nbsp;/etc/squid/users&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;basic&nbsp;children&nbsp;5&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;basic&nbsp;realm&nbsp;Squid&nbsp;proxy-caching&nbsp;web&nbsp;server&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;2&nbsp;hours&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;basic&nbsp;casesensitive&nbsp;off&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;clientes&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;clientes&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;note&nbsp;that&nbsp;you&nbsp;are&nbsp;allowing&nbsp;authenticated&nbsp;clients&nbsp;to&nbsp;send&nbsp;traffic&nbsp;to&lt;br&gt;<br>
unsafe&nbsp;ports.&nbsp;For&nbsp;example,&nbsp;they&nbsp;can&nbsp;CONNECT&nbsp;to&nbsp;non-SSL&nbsp;ports.&nbsp;You&nbsp;may&nbsp;want&lt;br&gt;<br>
to&nbsp;reorder&nbsp;the&nbsp;above&nbsp;rules&nbsp;if&nbsp;that&nbsp;is&nbsp;not&nbsp;what&nbsp;you&nbsp;want.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;#List&nbsp;of&nbsp;outgoings&nbsp;(all&nbsp;IPs&nbsp;are&nbsp;fake)&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;&lt;a&nbsp;href=&quot;http://181.111.11.111:4000&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;181.111.11.111:4000&lt;/a&gt;&nbsp;name=3&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;ip3&nbsp;myportname&nbsp;3&lt;br&gt;<br>
&gt;&nbsp;tcp_outgoing_address&nbsp;2804:1934:2E1::3D6&nbsp;ip3&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;&lt;a&nbsp;href=&quot;http://181.111.11.112:4001&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;181.111.11.112:4001&lt;/a&gt;&nbsp;name=4&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;ip4&nbsp;myportname&nbsp;4&lt;br&gt;<br>
&gt;&nbsp;tcp_outgoing_address&nbsp;2804:1934:3a8::3D7&nbsp;ip4&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;problem&nbsp;is&nbsp;that&nbsp;everyone&nbsp;whom&nbsp;is&nbsp;in&nbsp;the&nbsp;users&nbsp;file&nbsp;are&nbsp;allow&nbsp;to&nbsp;&lt;br&gt;<br>
&gt;&nbsp;use&nbsp;all&nbsp;tcp_outgoing_address.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;If&nbsp;a&nbsp;smarter&nbsp;client&nbsp;scans&nbsp;for&nbsp;open&nbsp;IPs&nbsp;and&nbsp;ports&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;find&nbsp;&lt;br&gt;<br>
&gt;&nbsp;these&nbsp;outgoings.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;How&nbsp;can&nbsp;I&nbsp;restrict&nbsp;each&nbsp;user&nbsp;to&nbsp;their&nbsp;own&nbsp;tcp_outgoing_address&nbsp;output?&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;suspect&nbsp;you&nbsp;are&nbsp;asking&nbsp;the&nbsp;wrong&nbsp;question.&nbsp;A&nbsp;better&nbsp;question&nbsp;is&nbsp;&quot;How&nbsp;do&nbsp;I&lt;br&gt;<br>
restrict&nbsp;each&nbsp;user&nbsp;to&nbsp;their&nbsp;own&nbsp;http_port?&quot;.&nbsp;The&nbsp;answer&nbsp;is&nbsp;&quot;Use&nbsp;http_access&lt;br&gt;<br>
to&nbsp;deny&nbsp;authenticated&nbsp;users&nbsp;connected&nbsp;to&nbsp;wrong&nbsp;ports.&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
However,&nbsp;you&nbsp;should&nbsp;also&nbsp;ask&nbsp;yourself&nbsp;another&nbsp;question:&nbsp;&quot;Why&nbsp;am&nbsp;I&nbsp;using&lt;br&gt;<br>
multiple&nbsp;http_ports&nbsp;if&nbsp;all&nbsp;I&nbsp;care&nbsp;about&nbsp;is&nbsp;who&nbsp;uses&nbsp;which&lt;br&gt;<br>
tcp_outgoing_address?&quot;.&nbsp;The&nbsp;listening&nbsp;ports&nbsp;have&nbsp;virtually&nbsp;nothing&nbsp;to&nbsp;do&lt;br&gt;<br>
with&nbsp;tcp_outgoing_address...&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;suspect&nbsp;you&nbsp;want&nbsp;something&nbsp;like&nbsp;this&nbsp;instead:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; &nbsp;http_port&nbsp;...&lt;br&gt;<br>
 &nbsp; &nbsp;tcp_outgoing_address&nbsp;...:3D01&nbsp;user1&lt;br&gt;<br>
 &nbsp; &nbsp;tcp_outgoing_address&nbsp;...:3D02&nbsp;user2&lt;br&gt;<br>
 &nbsp; &nbsp;tcp_outgoing_address&nbsp;...:3D03&nbsp;user3&lt;br&gt;<br>
 &nbsp; &nbsp;...&lt;br&gt;<br>
&lt;br&gt;<br>
...where&nbsp;userN&nbsp;is&nbsp;an&nbsp;ACL&nbsp;that&nbsp;matches&nbsp;an&nbsp;authenticated&nbsp;user&nbsp;N.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
Subject:&nbsp;Digest&nbsp;Footer&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
End&nbsp;of&nbsp;squid-users&nbsp;Digest,&nbsp;Vol&nbsp;87,&nbsp;Issue&nbsp;19&lt;br&gt;<br>
*******************************************&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
