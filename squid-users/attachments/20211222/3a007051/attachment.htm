<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Alex,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;BTW,&nbsp;where&nbsp;do&nbsp;I&nbsp;send&nbsp;the&nbsp;files&nbsp;with&nbsp;the&nbsp;memory&nbsp;logs? I&nbsp;had&nbsp;sent&nbsp;a&nbsp;few&nbsp;attachments in&nbsp;an&nbsp;email&nbsp;reply&nbsp;to&nbsp;this&nbsp;thread&nbsp;but&nbsp;got&nbsp;back&nbsp;a&nbsp;message saying it&nbsp;is&nbsp;too&nbsp;large&nbsp;and&nbsp;will&nbsp;need&nbsp;to&nbsp;be&nbsp;reviewed&nbsp;by&nbsp;an&nbsp;admin.&lt;/div&gt;&lt;div&gt;Thanks&lt;/div&gt;&lt;div&gt;Praveen&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Wed,&nbsp;Dec&nbsp;22,&nbsp;2021&nbsp;at&nbsp;10:58&nbsp;PM&nbsp;Praveen&nbsp;Ponakanti&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:pponakanti@roblox.com&quot;&gt;pponakanti@roblox.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Alex,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks,&nbsp;please&nbsp;see&nbsp;inline&nbsp;below.&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Wed,&nbsp;Dec&nbsp;22,&nbsp;2021&nbsp;at&nbsp;6:45&nbsp;AM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;12/21/21&nbsp;7:48&nbsp;PM,&nbsp;Praveen&nbsp;Ponakanti&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;We&nbsp;are&nbsp;running&nbsp;the&nbsp;squid&nbsp;proxy&nbsp;for&nbsp;servicing&nbsp;outbound&nbsp;HTTP&nbsp;quests&nbsp;from&lt;br&gt;<br>
&gt;&nbsp;our&nbsp;network&nbsp;and&nbsp;have&nbsp;observed&nbsp;a&nbsp;significant&nbsp;memory&nbsp;leak&nbsp;with&nbsp;5.x&lt;br&gt;<br>
&gt;&nbsp;versions.&nbsp;While&nbsp;there&nbsp;are&nbsp;several&nbsp;discussions&nbsp;about&nbsp;memory&nbsp;leaks&nbsp;with&lt;br&gt;<br>
&gt;&nbsp;recent&nbsp;versions,&nbsp;just&nbsp;wanted&nbsp;to&nbsp;list&nbsp;out&nbsp;what&nbsp;we&nbsp;have&nbsp;observed&nbsp;in&nbsp;case&lt;br&gt;<br>
&gt;&nbsp;this&nbsp;is&nbsp;an&nbsp;unknown&nbsp;leak.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;recommend&nbsp;sharing&nbsp;a&nbsp;log&nbsp;with&nbsp;48+&nbsp;hourly&nbsp;mgr:mem&nbsp;snapshots.&nbsp;These&lt;br&gt;<br>
snapshots&nbsp;help&nbsp;compare&nbsp;your&nbsp;leak&nbsp;with&nbsp;others&nbsp;we&nbsp;know&nbsp;about&nbsp;and&nbsp;may&nbsp;help&lt;br&gt;<br>
isolate&nbsp;some&nbsp;of&nbsp;the&nbsp;memory&nbsp;leaks:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://bugs.squid-cache.org/show_bug.cgi?id=5132#c8&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugs.squid-cache.org/show_bug.cgi?id=5132#c8&lt;/a&gt;&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Attached&nbsp;the&nbsp;current&nbsp;memory&nbsp;stats&nbsp;from&nbsp;the&nbsp;2&nbsp;nodes&nbsp;that&nbsp;have&nbsp;been&nbsp;taking&nbsp;a&nbsp;similar&nbsp;rate&nbsp;of&nbsp;requests,&nbsp;with&nbsp;the&nbsp;node&nbsp;running&nbsp;5.3&nbsp;already&nbsp;using&nbsp;up&nbsp;20G&nbsp;more&nbsp;than&nbsp;the&nbsp;4.17&nbsp;version.&nbsp;The&nbsp;memory&nbsp;leak&nbsp;increases&nbsp;over&nbsp;a&nbsp;few&nbsp;hours&nbsp;in&nbsp;almost&nbsp;a&nbsp;step-like&nbsp;curve&nbsp;each&nbsp;day&nbsp;on&nbsp;the&nbsp;5.x&nbsp;versions;&nbsp;I&nbsp;will&nbsp;continue&nbsp;collecting&nbsp;these&nbsp;stats&nbsp;hourly.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Note,&nbsp;I&nbsp;am&nbsp;using&nbsp;a&nbsp;curl&nbsp;to &lt;a&nbsp;href=&quot;http://localhost:3128/squid-internal-mgr/mem&quot;&nbsp;target=&quot;_blank&quot;&gt;http://localhost:3128/squid-internal-mgr/mem&lt;/a&gt;&nbsp;to&nbsp;collect&nbsp;the&nbsp;memory&nbsp;stats&nbsp;as&nbsp;we&nbsp;dont&nbsp;have&nbsp;the&nbsp;squidclient&nbsp;built&nbsp;into&nbsp;the&nbsp;docker&nbsp;container&nbsp;that&nbsp;runs&nbsp;the&nbsp;squid&nbsp;proxy.&nbsp;The&nbsp;output&nbsp;appears&nbsp;to&nbsp;be&nbsp;quite&nbsp;large&nbsp;with&nbsp;data&nbsp;for&nbsp;each&nbsp;kid&nbsp;process&nbsp;(we&nbsp;have&nbsp;30&nbsp;workers&nbsp;configured).&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;attempted&nbsp;to&nbsp;build&nbsp;squid&nbsp;with&nbsp;-with-valgrind-debug,&nbsp;and&nbsp;run&nbsp;it&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;a&nbsp;test&nbsp;env.&nbsp;However&nbsp;valgrind&nbsp;appears&nbsp;to&nbsp;collect&nbsp;some&nbsp;data&nbsp;from&nbsp;the&nbsp;parse&lt;br&gt;<br>
&gt;&nbsp;config&nbsp;functions&nbsp;and&nbsp;then&nbsp;the&nbsp;squid&nbsp;proxy&nbsp;restarts.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
FWIW,&nbsp;valgrind&nbsp;works&nbsp;as&nbsp;expected&nbsp;in&nbsp;my&nbsp;environment.&nbsp;If&nbsp;your&nbsp;Squid&nbsp;proxy&lt;br&gt;<br>
is&nbsp;killed&nbsp;by&nbsp;an&nbsp;assertion&nbsp;or&nbsp;crashes,&nbsp;even&nbsp;in&nbsp;a&nbsp;test&nbsp;environment,&nbsp;please&lt;br&gt;<br>
consider&nbsp;reporting&nbsp;that&nbsp;bug&nbsp;(after&nbsp;checking&nbsp;that&nbsp;it&nbsp;has&nbsp;not&nbsp;been&lt;br&gt;<br>
reported&nbsp;already,&nbsp;of&nbsp;course).&nbsp;If&nbsp;your&nbsp;test&nbsp;proxy&nbsp;is&nbsp;misconfigured,&nbsp;then&lt;br&gt;<br>
please&nbsp;fix&nbsp;the&nbsp;configuration&nbsp;before&nbsp;proceeding&nbsp;with&nbsp;tests.&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;The&nbsp;Valgrind&nbsp;image&nbsp;isnt crashing,&nbsp;and&nbsp;it&nbsp;uses&nbsp;the&nbsp;same&nbsp;config&nbsp;that&nbsp;works&nbsp;in&nbsp;prod&nbsp;without&nbsp;valgrind.&nbsp;I&nbsp;might&nbsp;have&nbsp;to&nbsp;fix&nbsp;how&nbsp;it&nbsp;is&nbsp;launched&nbsp;from&nbsp;the&nbsp;docker&nbsp;entrypoint&nbsp;script&nbsp;in&nbsp;my&nbsp;test&nbsp;env. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;root&nbsp; &nbsp; &nbsp;117051&nbsp;117005&nbsp; 0&nbsp;Dec11&nbsp;?&nbsp; &nbsp; &nbsp; &nbsp; 00:00:00&nbsp;/usr/bin/valgrind.bin&nbsp;--leak-check=full&nbsp;--show-leak-kinds=all&nbsp;--verbose&nbsp;--log-file=/squid/var/logs/valgrind-out.txt&nbsp;/squid/sbin/squid&nbsp;-f&nbsp;/squid/etc/squid.conf&lt;/div&gt;&lt;div&gt; &lt;/div&gt;&lt;div&gt;gdb&nbsp;attach&nbsp;1&lt;br&gt;GNU&nbsp;gdb&nbsp;(Ubuntu&nbsp;9.2-0ubuntu1~20.04)&nbsp;9.2&lt;br&gt;&lt;br&gt;(gdb)&nbsp;monitor&lt;br&gt;&quot;monitor&quot;&nbsp;command&nbsp;not&nbsp;supported&nbsp;by&nbsp;this&nbsp;target.&lt;br&gt;(gdb)&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
