<tt>
&lt;html&nbsp;xmlns:v=&quot;urn:schemas-microsoft-com:vml&quot;&nbsp;xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;&nbsp;xmlns:w=&quot;urn:schemas-microsoft-com:office:word&quot;&nbsp;xmlns:m=&quot;http://schemas.microsoft.com/office/2004/12/omml&quot;&nbsp;xmlns=&quot;http://www.w3.org/TR/REC-html40&quot;&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=Content-Type&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;&lt;meta&nbsp;name=Generator&nbsp;content=&quot;Microsoft&nbsp;Word&nbsp;15&nbsp;(filtered&nbsp;medium)&quot;&gt;&lt;style&gt;&lt;!--<br>
/*&nbsp;Font&nbsp;Definitions&nbsp;*/<br>
@font-face<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{font-family:&quot;Cambria&nbsp;Math&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;panose-1:2&nbsp;4&nbsp;5&nbsp;3&nbsp;5&nbsp;4&nbsp;6&nbsp;3&nbsp;2&nbsp;4;}<br>
@font-face<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{font-family:Calibri;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;panose-1:2&nbsp;15&nbsp;5&nbsp;2&nbsp;2&nbsp;2&nbsp;4&nbsp;3&nbsp;2&nbsp;4;}<br>
@font-face<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{font-family:&quot;Courier&nbsp;New&nbsp;\;color\:windowtext&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;panose-1:0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0&nbsp;0;}<br>
/*&nbsp;Style&nbsp;Definitions&nbsp;*/<br>
p.MsoNormal,&nbsp;li.MsoNormal,&nbsp;div.MsoNormal<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{margin:0in;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-size:11.0pt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&quot;Calibri&quot;,sans-serif;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color:#464646;}<br>
a:link,&nbsp;span.MsoHyperlink<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-priority:99;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color:blue;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text-decoration:underline;}<br>
span.EmailStyle19<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-type:personal-reply;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-family:&quot;Calibri&quot;,sans-serif;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color:windowtext;}<br>
.MsoChpDefault<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{mso-style-type:export-only;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-size:10.0pt;}<br>
@page&nbsp;WordSection1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{size:8.5in&nbsp;11.0in;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin:1.0in&nbsp;1.0in&nbsp;1.0in&nbsp;1.0in;}<br>
div.WordSection1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{page:WordSection1;}<br>
--&gt;&lt;/style&gt;&lt;!--[if&nbsp;gte&nbsp;mso&nbsp;9]&gt;&lt;xml&gt;<br>
&lt;o:shapedefaults&nbsp;v:ext=&quot;edit&quot;&nbsp;spidmax=&quot;1026&quot;&nbsp;/&gt;<br>
&lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if&nbsp;gte&nbsp;mso&nbsp;9]&gt;&lt;xml&gt;<br>
&lt;o:shapelayout&nbsp;v:ext=&quot;edit&quot;&gt;<br>
&lt;o:idmap&nbsp;v:ext=&quot;edit&quot;&nbsp;data=&quot;1&quot;&nbsp;/&gt;<br>
&lt;/o:shapelayout&gt;&lt;/xml&gt;&lt;![endif]--&gt;&lt;/head&gt;&lt;body&nbsp;bgcolor=white&nbsp;lang=EN-US&nbsp;link=blue&nbsp;vlink=purple&nbsp;style='word-wrap:break-word'&gt;&lt;div&nbsp;class=WordSection1&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Hey&nbsp;David,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Since&nbsp;the&nbsp;handle_stdout&nbsp;runs&nbsp;in&nbsp;it’s&nbsp;own&nbsp;thread&nbsp;it’s&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;to&nbsp;send&nbsp;results&nbsp;to&nbsp;stdout.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;If&nbsp;I&nbsp;will&nbsp;run&nbsp;the&nbsp;next&nbsp;code&nbsp;in&nbsp;a&nbsp;simple&nbsp;software&nbsp;without&nbsp;the&nbsp;0.5&nbsp;sleep&nbsp;time:&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;RUNNING:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;quit&nbsp;&gt;&nbsp;0:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;len(queue)&nbsp;&gt;&nbsp;0:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item&nbsp;=&nbsp;queue.pop(0)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.stdout.write(item)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.stdout.flush()&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(0.5)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;what&nbsp;will&nbsp;happen&nbsp;is&nbsp;that&nbsp;the&nbsp;software&nbsp;will&nbsp;run&nbsp;with&nbsp;100%&nbsp;CPU&nbsp;looping&nbsp;over&nbsp;and&nbsp;over&nbsp;on&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;queue&lt;br&gt;while&nbsp;sometimes&nbsp;it&nbsp;will&nbsp;spit&nbsp;some&nbsp;data&nbsp;to&nbsp;stdout.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Adding&nbsp;a&nbsp;small&nbsp;delay&nbsp;with&nbsp;0.5&nbsp;secs&nbsp;will&nbsp;allow&nbsp;some&nbsp;“idle”&nbsp;time&nbsp;for&nbsp;the&nbsp;cpu&nbsp;in&nbsp;the&nbsp;loop&nbsp;preventing&nbsp;it&nbsp;from&nbsp;consuming&lt;br&gt;all&nbsp;the&nbsp;CPU&nbsp;time.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;It’s&nbsp;a&nbsp;very&nbsp;old&nbsp;technique&nbsp;and&nbsp;there&nbsp;are&nbsp;others&nbsp;which&nbsp;are&nbsp;more&nbsp;efficient&nbsp;but&nbsp;it’s&nbsp;enough&nbsp;to&nbsp;demonstrate&nbsp;that&nbsp;a&nbsp;simple&lt;br&gt;threaded&nbsp;helper&nbsp;is&nbsp;much&nbsp;better&nbsp;then&nbsp;any&nbsp;PHP&nbsp;code&nbsp;that&nbsp;was&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;running&nbsp;as&nbsp;a&nbsp;STDIN/OUT&nbsp;daemon/helper&nbsp;software.&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;All&nbsp;The&nbsp;Bests,&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Eliezer&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;div&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;----&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Eliezer&nbsp;Croitoru&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;NgTech,&nbsp;Tech&nbsp;Support&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Mobile:&nbsp;+972-5-28704261&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:ngtech1ltd@gmail.com&quot;&gt;ngtech1ltd@gmail.com&lt;/a&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;div&gt;&lt;div&nbsp;style='border:none;border-top:solid&nbsp;#E1E1E1&nbsp;1.0pt;padding:3.0pt&nbsp;0in&nbsp;0in&nbsp;0in'&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;b&gt;&lt;span&nbsp;style='color:windowtext'&gt;From:&lt;/span&gt;&lt;/b&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;David&nbsp;Touzeau&nbsp;&lt;david@articatech.com&gt;&nbsp;&lt;br&gt;&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Monday,&nbsp;February&nbsp;7,&nbsp;2022&nbsp;02:42&lt;br&gt;&lt;b&gt;To:&lt;/b&gt;&nbsp;Eliezer&nbsp;Croitoru&nbsp;&lt;ngtech1ltd@gmail.com&gt;;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;external&nbsp;helper&nbsp;development&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='margin-bottom:12.0pt'&gt;&lt;span&nbsp;style='font-family:&quot;Arial&quot;,sans-serif'&gt;Sorry&nbsp;&nbsp;Elizer&lt;br&gt;&lt;br&gt;It&nbsp;was&nbsp;a&nbsp;mistake...&nbsp;No,&nbsp;your&nbsp;code&nbsp;is&nbsp;clean..&lt;br&gt;Impressive&nbsp;for&nbsp;the&nbsp;first&nbsp;shot&lt;br&gt;Many&nbsp;thanks&nbsp;for&nbsp;your&nbsp;example,&nbsp;we&nbsp;will&nbsp;run&nbsp;our&nbsp;stress&nbsp;tool&nbsp;to&nbsp;see&nbsp;the&nbsp;difference...&lt;br&gt;&lt;br&gt;Just&nbsp;a&nbsp;question&lt;br&gt;&lt;br&gt;Why&nbsp;did&nbsp;you&nbsp;send&nbsp;500&nbsp;milliseconds&nbsp;of&nbsp;sleep&nbsp;in&nbsp;the&nbsp;handle_stdoud&nbsp;?&nbsp;Is&nbsp;it&nbsp;for&nbsp;let&nbsp;squid&nbsp;closing&nbsp;the&nbsp;pipe&nbsp;?&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;div&gt;&lt;p&nbsp;class=MsoNormal&gt;Le&nbsp;06/02/2022&nbsp;à&nbsp;11:46,&nbsp;Eliezer&nbsp;Croitoru&nbsp;a&nbsp;écrit&nbsp;:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;blockquote&nbsp;style='margin-top:5.0pt;margin-bottom:5.0pt'&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Hey&nbsp;David,&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Not&nbsp;a&nbsp;fully&nbsp;completed&nbsp;helper&nbsp;but&nbsp;it&nbsp;seems&nbsp;to&nbsp;works&nbsp;pretty&nbsp;nice&nbsp;and&nbsp;might&nbsp;be&nbsp;better&nbsp;then&nbsp;what&nbsp;exist&nbsp;already:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&lt;a&nbsp;href=&quot;https://gist.githubusercontent.com/elico/03938e3a796c53f7c925872bade78195/raw/21ff1bbc0cf3d91719db27d9d027652e8bd3de4e/threaded-helper-example.py&quot;&gt;https://gist.githubusercontent.com/elico/03938e3a796c53f7c925872bade78195/raw/21ff1bbc0cf3d91719db27d9d027652e8bd3de4e/threaded-helper-example.py&lt;/a&gt;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;#!/usr/bin/env&nbsp;python&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;import&nbsp;sys&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;import&nbsp;time&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;import&nbsp;urllib.request&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;import&nbsp;signal&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;import&nbsp;threading&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;#set&nbsp;debug&nbsp;mode&nbsp;for&nbsp;True&nbsp;or&nbsp;False&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;debug&nbsp;=&nbsp;False&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;#debug&nbsp;=&nbsp;True&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;queue&nbsp;=&nbsp;[]&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;threads&nbsp;=&nbsp;[]&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;RUNNING&nbsp;=&nbsp;True&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;quit&nbsp;=&nbsp;0&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;rand_api_url&nbsp;=&nbsp;&lt;a&nbsp;href=&quot;https://cloud1.ngtech.co.il/api/test.php&quot;&gt;&quot;https://cloud1.ngtech.co.il/api/test.php&quot;&lt;/a&gt;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;def&nbsp;sig_handler(signum,&nbsp;frame):&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;sys.stderr.write(&quot;Signal&nbsp;is&nbsp;received:&quot;&nbsp;+&nbsp;str(signum)&nbsp;+&nbsp;&quot;\n&quot;)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;quit&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;quit&nbsp;=&nbsp;1&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;RUNNING&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;RUNNING=False&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;def&nbsp;handle_line(line):&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;RUNNING:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;line:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;quit&nbsp;&gt;&nbsp;0:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arr&nbsp;=&nbsp;line.split()&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response&nbsp;=&nbsp;urllib.request.urlopen(&nbsp;rand_api_url&nbsp;)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response_text&nbsp;=&nbsp;response.read()&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;queue.append(arr[0]&nbsp;+&nbsp;&quot;&nbsp;&quot;&nbsp;+&nbsp;response_text.decode(&quot;utf-8&quot;))&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;def&nbsp;handle_stdout(n):&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;RUNNING:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;quit&nbsp;&gt;&nbsp;0:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;len(queue)&nbsp;&gt;&nbsp;0:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item&nbsp;=&nbsp;queue.pop(0)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.stdout.write(item)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.stdout.flush()&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(0.5)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;def&nbsp;handle_stdin(n):&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;RUNNING:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;sys.stdin.readline()&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;line:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;quit&nbsp;&gt;&nbsp;0:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;line.strip()&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread&nbsp;=&nbsp;threading.Thread(target=handle_line,&nbsp;args=(line,))&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;thread.start()&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threads.append(thread)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;signal.signal(signal.SIGUSR1,&nbsp;sig_handler)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;signal.signal(signal.SIGUSR2,&nbsp;sig_handler)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;signal.signal(signal.SIGALRM,&nbsp;sig_handler)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;signal.signal(signal.SIGINT,&nbsp;sig_handler)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;signal.signal(signal.SIGQUIT,&nbsp;sig_handler)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;signal.signal(signal.SIGTERM,&nbsp;sig_handler)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;stdout_thread&nbsp;=&nbsp;threading.Thread(target=handle_stdout,&nbsp;args=(1,))&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;stdout_thread.start()&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;threads.append(stdout_thread)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;stdin_thread&nbsp;=&nbsp;threading.Thread(target=handle_stdin,&nbsp;args=(2,))&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;stdin_thread.start()&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;threads.append(stdin_thread)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;while(RUNNING):&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;time.sleep(3)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;print(&quot;Not&nbsp;RUNNING&quot;)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;for&nbsp;thread&nbsp;in&nbsp;threads:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;&nbsp;&nbsp;&nbsp;&nbsp;thread.join()&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='font-size:10.0pt;font-family:&quot;Courier&nbsp;New&nbsp;;color:windowtext&quot;,serif'&gt;print(&quot;All&nbsp;threads&nbsp;stopped.&quot;)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;##&nbsp;END&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Eliezer&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;div&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;----&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Eliezer&nbsp;Croitoru&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;NgTech,&nbsp;Tech&nbsp;Support&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Mobile:&nbsp;+972-5-28704261&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;Email:&nbsp;&lt;a&nbsp;href=&quot;mailto:ngtech1ltd@gmail.com&quot;&gt;ngtech1ltd@gmail.com&lt;/a&gt;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;div&gt;&lt;div&nbsp;style='border:none;border-top:solid&nbsp;#E1E1E1&nbsp;1.0pt;padding:3.0pt&nbsp;0in&nbsp;0in&nbsp;0in'&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;b&gt;&lt;span&nbsp;style='color:windowtext'&gt;From:&lt;/span&gt;&lt;/b&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;squid-users&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&gt;&lt;squid-users-bounces@lists.squid-cache.org&gt;&lt;/a&gt;&nbsp;&lt;b&gt;On&nbsp;Behalf&nbsp;Of&nbsp;&lt;/b&gt;David&nbsp;Touzeau&lt;br&gt;&lt;b&gt;Sent:&lt;/b&gt;&nbsp;Friday,&nbsp;February&nbsp;4,&nbsp;2022&nbsp;16:29&lt;br&gt;&lt;b&gt;To:&lt;/b&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;&lt;b&gt;Subject:&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;external&nbsp;helper&nbsp;development&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&nbsp;class=MsoNormal&gt;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='margin-bottom:12.0pt'&gt;Elizer,&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;all&nbsp;this&nbsp;advice&nbsp;and&nbsp;indeed&nbsp;your&nbsp;arguments&nbsp;are&nbsp;valid&nbsp;between&nbsp;opening&nbsp;a&nbsp;socket,&nbsp;sending&nbsp;data,&nbsp;receiving&nbsp;data&nbsp;and&nbsp;closing&nbsp;the&nbsp;socket&nbsp;unlike&nbsp;direct&nbsp;access&nbsp;to&nbsp;a&nbsp;regex&nbsp;or&nbsp;a&nbsp;memory&nbsp;entry&nbsp;even&nbsp;if&nbsp;the&nbsp;calculation&nbsp;has&nbsp;already&nbsp;been&nbsp;done.&lt;br&gt;&lt;br&gt;But&nbsp;what&nbsp;surprises&nbsp;me&nbsp;the&nbsp;most&nbsp;is&nbsp;that&nbsp;we&nbsp;have&nbsp;produced&nbsp;a&nbsp;python&nbsp;plugin&nbsp;in&nbsp;thread&nbsp;which&nbsp;I&nbsp;provide&nbsp;you&nbsp;a&nbsp;code&nbsp;below.&nbsp;&lt;br&gt;The&nbsp;php&nbsp;code&nbsp;is&nbsp;like&nbsp;your&nbsp;mentioned&nbsp;example&nbsp;(&nbsp;No&nbsp;thread,&nbsp;just&nbsp;a&nbsp;loop&nbsp;and&nbsp;output&nbsp;OK&nbsp;)&nbsp;&lt;br&gt;&lt;br&gt;Results&nbsp;are&nbsp;after&nbsp;6k&nbsp;requests,&nbsp;squid&nbsp;freeze&nbsp;and&nbsp;no&nbsp;surf&nbsp;can&nbsp;be&nbsp;made&nbsp;as&nbsp;with&nbsp;PHP&nbsp;code&nbsp;we&nbsp;can&nbsp;up&nbsp;to&nbsp;10K&nbsp;requests&nbsp;and&nbsp;squid&nbsp;is&nbsp;happy&lt;br&gt;really,&nbsp;we&nbsp;did&nbsp;not&nbsp;understand&nbsp;why&nbsp;python&nbsp;is&nbsp;so&nbsp;low.&lt;br&gt;&lt;br&gt;&lt;span&nbsp;style='font-family:&quot;Arial&quot;,sans-serif'&gt;Here&nbsp;a&nbsp;python&nbsp;code&nbsp;using&nbsp;threads&lt;br&gt;&lt;br&gt;#!/usr/bin/env&nbsp;python&lt;br&gt;import&nbsp;os&lt;br&gt;import&nbsp;sys&lt;br&gt;import&nbsp;time&lt;br&gt;import&nbsp;signal&lt;br&gt;import&nbsp;locale&lt;br&gt;import&nbsp;traceback&lt;br&gt;import&nbsp;threading&lt;br&gt;import&nbsp;select&lt;br&gt;import&nbsp;traceback&nbsp;as&nbsp;tb&lt;br&gt;&lt;br&gt;class&nbsp;ClienThread():&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._exiting&nbsp;=&nbsp;False&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._cache&nbsp;=&nbsp;{}&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;exit(self):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._exiting&nbsp;=&nbsp;True&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;stdout(self,&nbsp;lineToSend):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.stdout.write(lineToSend)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sys.stdout.flush()&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;IOError&nbsp;as&nbsp;e:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;e.errno==32:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Error&nbsp;Broken&nbsp;PIPE!&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;other&nbsp;execpt&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;run(self):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;not&nbsp;self._exiting:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;sys.stdin&nbsp;in&nbsp;select.select([sys.stdin],&nbsp;[],&nbsp;[],&nbsp;0.5)[0]:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=&nbsp;sys.stdin.readline()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LenOfline=len(line)&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;LenOfline==0:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._exiting=True&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;line[-1]&nbsp;==&nbsp;'\n':line&nbsp;=&nbsp;line[:-1]&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel&nbsp;=&nbsp;None&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;options&nbsp;=&nbsp;line.split()&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;options[0].isdigit():&nbsp;channel&nbsp;=&nbsp;options.pop(0)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;IndexError:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.stdout(&quot;0&nbsp;OK&nbsp;first=ERROR\n&quot;)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Processing&nbsp;here&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.stdout(&quot;%s&nbsp;OK\n&quot;&nbsp;%&nbsp;channel)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.stdout(&quot;%s&nbsp;ERROR&nbsp;first=ERROR\n&quot;&nbsp;%&nbsp;channel)&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;class&nbsp;Main(object):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._threads&nbsp;=&nbsp;[]&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._exiting&nbsp;=&nbsp;False&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._reload&nbsp;=&nbsp;False&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._config&nbsp;=&nbsp;&quot;&quot;&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;sig,&nbsp;action&nbsp;in&nbsp;(&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(signal.SIGINT,&nbsp;self.shutdown),&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(signal.SIGQUIT,&nbsp;self.shutdown),&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(signal.SIGTERM,&nbsp;self.shutdown),&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(signal.SIGHUP,&nbsp;lambda&nbsp;s,&nbsp;f:&nbsp;setattr(self,&nbsp;'_reload',&nbsp;True)),&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(signal.SIGPIPE,&nbsp;signal.SIG_IGN),&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;signal.signal(sig,&nbsp;action)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;AttributeError:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;shutdown(self,&nbsp;sig&nbsp;=&nbsp;None,&nbsp;frame&nbsp;=&nbsp;None):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._exiting&nbsp;=&nbsp;True&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.stop_threads()&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;start_threads(self):&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sThread&nbsp;=&nbsp;ClienThread()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;threading.Thread(target&nbsp;=&nbsp;sThread.run)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.start()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._threads.append((sThread,&nbsp;t))&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;stop_threads(self):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;p,&nbsp;t&nbsp;in&nbsp;self._threads:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.exit()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;p,&nbsp;t&nbsp;in&nbsp;self._threads:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.join(timeout&nbsp;=&nbsp;&nbsp;1.0)&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._threads&nbsp;=&nbsp;[]&lt;br&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;run(self):&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;&quot;&quot;&nbsp;main&nbsp;loop&nbsp;&quot;&quot;&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;0&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.start_threads()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ret&lt;br&gt;&lt;br&gt;&lt;br&gt;if&nbsp;__name__&nbsp;==&nbsp;'__main__':&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;set&nbsp;C&nbsp;locale&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;locale.setlocale(locale.LC_ALL,&nbsp;'C')&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;os.environ['LANG']&nbsp;=&nbsp;'C'&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;0&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;try:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;main&nbsp;=&nbsp;Main()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;main.run()&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;SystemExit:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;KeyboardInterrupt:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;4&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;except:&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;sys.exit(ret)&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;div&gt;&lt;p&nbsp;class=MsoNormal&gt;Le&nbsp;04/02/2022&nbsp;à&nbsp;07:06,&nbsp;Eliezer&nbsp;Croitoru&nbsp;a&nbsp;écrit&nbsp;:&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;blockquote&nbsp;style='margin-top:5.0pt;margin-bottom:5.0pt'&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;And&nbsp;about&nbsp;the&nbsp;cache&nbsp;of&nbsp;each&nbsp;helpers,&nbsp;the&nbsp;cost&nbsp;of&nbsp;a&nbsp;cache&nbsp;on&nbsp;a&nbsp;single&nbsp;helper&nbsp;is&nbsp;not&nbsp;much&nbsp;in&nbsp;terms&nbsp;of&nbsp;memory&nbsp;comparing&nbsp;to&nbsp;some&nbsp;network&nbsp;access.&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;Again&nbsp;it’s&nbsp;possible&nbsp;to&nbsp;test&nbsp;and&nbsp;verify&nbsp;this&nbsp;on&nbsp;a&nbsp;loaded&nbsp;system&nbsp;to&nbsp;get&nbsp;results.&nbsp;The&nbsp;delay&nbsp;itself&nbsp;can&nbsp;be&nbsp;seen&nbsp;from&nbsp;squid&nbsp;side&nbsp;in&nbsp;the&nbsp;cache&nbsp;manager&nbsp;statistics.&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;You&nbsp;can&nbsp;also&nbsp;try&nbsp;to&nbsp;compare&nbsp;the&nbsp;next&nbsp;ruby&nbsp;helper:&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper&quot;&gt;https://wiki.squid-cache.org/EliezerCroitoru/SessionHelper&lt;/a&gt;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;About&nbsp;a&nbsp;shared&nbsp;“base”&nbsp;which&nbsp;allows&nbsp;helpers&nbsp;to&nbsp;avoid&nbsp;computation&nbsp;of&nbsp;the&nbsp;query….&nbsp;It’s&nbsp;a&nbsp;good&nbsp;argument,&nbsp;however&nbsp;it&nbsp;depends&nbsp;what&nbsp;is&nbsp;the&nbsp;cost&nbsp;of&lt;br&gt;pulling&nbsp;from&nbsp;the&nbsp;cache&nbsp;compared&nbsp;to&nbsp;calculating&nbsp;the&nbsp;answer.&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;A&nbsp;very&nbsp;simple&nbsp;string&nbsp;comparison&nbsp;or&nbsp;regex&nbsp;matching&nbsp;would&nbsp;probably&nbsp;be&nbsp;faster&nbsp;than&nbsp;reaching&nbsp;a&nbsp;shared&nbsp;storage&nbsp;in&nbsp;many&nbsp;cases.&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;Also&nbsp;take&nbsp;into&nbsp;account&nbsp;the&nbsp;“concurrency”&nbsp;support&nbsp;from&nbsp;the&nbsp;helper&nbsp;side.&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;A&nbsp;helper&nbsp;that&nbsp;supports&nbsp;parallel&nbsp;processing&nbsp;of&nbsp;requests/lines&nbsp;can&nbsp;do&nbsp;better&nbsp;then&nbsp;many&nbsp;single&nbsp;helpers&nbsp;in&nbsp;more&nbsp;than&nbsp;once&nbsp;use&nbsp;case.&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;In&nbsp;any&nbsp;case&nbsp;I&nbsp;would&nbsp;suggest&nbsp;to&nbsp;enable&nbsp;requests&nbsp;concurrency&nbsp;from&nbsp;squid&nbsp;side&nbsp;since&nbsp;the&nbsp;STDIN&nbsp;buffer&nbsp;will&nbsp;emulate&nbsp;some&nbsp;level&nbsp;of&nbsp;concurrency&lt;br&gt;by&nbsp;itself&nbsp;and&nbsp;will&nbsp;allow&nbsp;squid&nbsp;to&nbsp;keep&nbsp;going&nbsp;forward&nbsp;faster.&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;Just&nbsp;to&nbsp;mention&nbsp;that&nbsp;SquidGuard&nbsp;have&nbsp;used&nbsp;a&nbsp;single&nbsp;helper&nbsp;cache&nbsp;for&nbsp;a&nbsp;very&nbsp;long&nbsp;time,&nbsp;ie&nbsp;every&nbsp;single&nbsp;SquidGuard&nbsp;helper&nbsp;has&nbsp;it’s&nbsp;own&nbsp;copy&nbsp;of&nbsp;the&nbsp;whole&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;configuration&nbsp;and&nbsp;database&nbsp;files&nbsp;in&nbsp;memory.&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;And&nbsp;again,&nbsp;if&nbsp;you&nbsp;do&nbsp;have&nbsp;any&nbsp;option&nbsp;to&nbsp;implement&nbsp;a&nbsp;server&nbsp;service&nbsp;model&nbsp;and&nbsp;that&nbsp;the&nbsp;helpers&nbsp;will&nbsp;contact&nbsp;this&nbsp;main&nbsp;service&nbsp;you&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;implement&lt;br&gt;much&nbsp;faster&nbsp;internal&nbsp;in-memory&nbsp;cache&nbsp;compared&nbsp;to&nbsp;a&nbsp;redis/memcahe/other&nbsp;external&nbsp;daemon(need&nbsp;to&nbsp;be&nbsp;tested).&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;A&nbsp;good&nbsp;example&nbsp;for&nbsp;this&nbsp;is&nbsp;ufdbguard&nbsp;which&nbsp;has&nbsp;helpers&nbsp;that&nbsp;are&nbsp;clients&nbsp;of&nbsp;the&nbsp;main&nbsp;service&nbsp;which&nbsp;does&nbsp;the&nbsp;whole&nbsp;heavy&nbsp;lifting&nbsp;and&nbsp;also&nbsp;holds&nbsp;&lt;br&gt;one&nbsp;copy&nbsp;of&nbsp;the&nbsp;DB.&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;&nbsp;&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;p&nbsp;class=MsoNormal&nbsp;style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'&gt;&lt;span&nbsp;style='color:windowtext'&gt;I&nbsp;have&nbsp;implemented&nbsp;SquidBlocker&nbsp;this&nbsp;way&nbsp;and&nbsp;have&nbsp;seen&nbsp;that&nbsp;it&nbsp;out-performs&nbsp;any&nbsp;other&nbsp;service&nbsp;I&nbsp;have&nbsp;tried&nbsp;until&nbsp;now.&lt;/span&gt;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&nbsp;class=MsoNormal&gt;&nbsp;&lt;o:p&gt;&lt;/o:p&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&nbsp;class=MsoNormal&gt;&lt;o:p&gt;&nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
