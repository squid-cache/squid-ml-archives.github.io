<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hey&nbsp;Alex,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;reply,&nbsp;I&nbsp;am&nbsp;sorry,&nbsp;I&nbsp;think&nbsp;I&nbsp;explained&nbsp;myself&nbsp;wrong.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;I&nbsp;meant&nbsp;by&nbsp;option&nbsp;C,&nbsp;is&nbsp;to&nbsp;have&nbsp;basically&nbsp;3&nbsp;functions,&nbsp;2&nbsp;functions&nbsp;for&nbsp;std/stdout,&nbsp;and&nbsp;one&nbsp;function&lt;/div&gt;&lt;div&gt;that&nbsp;will&nbsp;fetch&nbsp;the&nbsp;data&nbsp;from&nbsp;the&nbsp;DB&nbsp;every&nbsp;60&nbsp;seconds,&nbsp;and&nbsp;save&nbsp;it&nbsp;into&nbsp;a&nbsp;global&nbsp;variable&nbsp;for&nbsp;the&nbsp;other&nbsp;functions &lt;/div&gt;&lt;div&gt;to&nbsp;use.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Then,&nbsp;when&nbsp;a&nbsp;new&nbsp;std&nbsp;request&nbsp;comes&nbsp;in,&nbsp;the&nbsp;std&nbsp;handler will&nbsp;simply&nbsp;read&nbsp;from&nbsp;that&nbsp;variable,&nbsp;instead&nbsp;of&nbsp;from&nbsp;the&nbsp;DB.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;see&nbsp;the&nbsp;following&nbsp;benefits in&nbsp;this&nbsp;approach:&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;1.&nbsp;We&nbsp;will&nbsp;have&nbsp;only one&nbsp;DB&nbsp;connection&nbsp;every&nbsp;60&nbsp;seconds,&nbsp;per&nbsp;Squid&nbsp;worker&nbsp;instance.&lt;/div&gt;&lt;div&gt;2.&nbsp;It&nbsp;will&nbsp;be&nbsp;very&nbsp;fast&nbsp;since&nbsp;the&nbsp;std&nbsp;handler&nbsp;will&nbsp;simply&nbsp;read&nbsp;from&nbsp;a&nbsp;local&nbsp;variable.&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;you&nbsp;will&nbsp;have&nbsp;as&nbsp;many&nbsp;database&lt;br&gt;clients&nbsp;as&nbsp;there&nbsp;are&nbsp;workers&nbsp;in&nbsp;your&nbsp;Squid&nbsp;instance&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;are&nbsp;definitely right,&nbsp;but&nbsp;as&nbsp;this&nbsp;will&nbsp;be&nbsp;much&nbsp;faster&nbsp;I&nbsp;think&nbsp;I&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;decrease&nbsp;my&nbsp;number&nbsp;of&nbsp;workers&nbsp;significantly.&lt;/div&gt;&lt;div&gt;Also,&nbsp;we&nbsp;might&nbsp;be&nbsp;able&nbsp;to&nbsp;use &lt;span&nbsp;style=&quot;color:rgb(30,30,30);font-family:courier;font-size:12px&quot;&gt;concurrency=n &lt;/span&gt;here&nbsp;to&nbsp;decrease it&nbsp;further?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Would&nbsp;love&nbsp;to&nbsp;hear&nbsp;your&nbsp;thoughts&nbsp;on&nbsp;this,&lt;/div&gt;&lt;div&gt;Roee&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Tue,&nbsp;Feb&nbsp;8,&nbsp;2022&nbsp;at&nbsp;6:38&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;2/8/22&nbsp;11:08,&nbsp;roee&nbsp;klinger&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;thought&nbsp;about&nbsp;the&nbsp;following&nbsp;approach:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;1.&nbsp;Have&nbsp;only&nbsp;one&nbsp;python&nbsp;helper,&nbsp;this&nbsp;helper&nbsp;fetches&nbsp;the&nbsp;data&nbsp;every&nbsp;&lt;br&gt;<br>
&gt;&nbsp;minute&nbsp;from&nbsp;the&nbsp;main&nbsp;DB.&lt;br&gt;<br>
&gt;&nbsp;2.&nbsp;This&nbsp;helper&nbsp;has&nbsp;concurrency set&nbsp;for&nbsp;it.&lt;br&gt;<br>
&gt;&nbsp;3.&nbsp;The&nbsp;helper&nbsp;then&nbsp;spawns&nbsp;child&nbsp;processes using&nbsp;multithreading,&nbsp;each&nbsp;&lt;br&gt;<br>
&gt;&nbsp;process responds&nbsp;to&nbsp;std/stdout&nbsp;and&nbsp;reads&nbsp;the&nbsp;data&nbsp;from&nbsp;the&nbsp;main&nbsp;process&nbsp;&lt;br&gt;<br>
&gt;&nbsp;which&nbsp;spawned&nbsp;it.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;What&nbsp;do&nbsp;you&nbsp;think&nbsp;about&nbsp;taking&nbsp;this&nbsp;route?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;will&nbsp;require&nbsp;no&nbsp;extra&nbsp;DBs&nbsp;and&nbsp;no&nbsp;tweaks&nbsp;to&nbsp;Squid,&nbsp;but&nbsp;maybe&nbsp;I&nbsp;am&nbsp;&lt;br&gt;<br>
&gt;&nbsp;missing&nbsp;something&lt;br&gt;<br>
&lt;br&gt;<br>
With&nbsp;this&nbsp;approach&nbsp;(let&#39;s&nbsp;call&nbsp;it&nbsp;C),&nbsp;you&nbsp;will&nbsp;have&nbsp;as&nbsp;many&nbsp;database&nbsp;&lt;br&gt;<br>
clients&nbsp;as&nbsp;there&nbsp;are&nbsp;workers&nbsp;in&nbsp;your&nbsp;Squid&nbsp;instance,&nbsp;just&nbsp;like&nbsp;in&nbsp;option&nbsp;&lt;br&gt;<br>
A.&nbsp;Option&nbsp;C&nbsp;is&nbsp;probably&nbsp;a&nbsp;lot&nbsp;easier&nbsp;to&nbsp;implement&nbsp;for&nbsp;a&nbsp;given&nbsp;helper&nbsp;&lt;br&gt;<br>
than&nbsp;the&nbsp;generic&nbsp;option&nbsp;A.&nbsp;Option&nbsp;B&nbsp;gives&nbsp;you&nbsp;one&nbsp;database&nbsp;client&nbsp;per&nbsp;&lt;br&gt;<br>
Squid&nbsp;instance.&lt;br&gt;<br>
&lt;br&gt;<br>
It&nbsp;is&nbsp;not&nbsp;clear&nbsp;to&nbsp;me&nbsp;why&nbsp;C&nbsp;parallelizes&nbsp;reading/writing&nbsp;from/to&nbsp;&lt;br&gt;<br>
stdin/stdout&nbsp;--&nbsp;I&nbsp;doubt&nbsp;that&nbsp;task&nbsp;is&nbsp;the&nbsp;bottleneck&nbsp;in&nbsp;your&nbsp;environment.&nbsp;&lt;br&gt;<br>
I&nbsp;would&nbsp;expect&nbsp;a&nbsp;single&nbsp;stdin&nbsp;reader&nbsp;thread&nbsp;and&nbsp;a&nbsp;single&nbsp;stdout&nbsp;writer&nbsp;&lt;br&gt;<br>
thread&nbsp;instead.&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;not&nbsp;my&nbsp;area&nbsp;of&nbsp;expertise,&nbsp;but&nbsp;if&nbsp;you&nbsp;do&nbsp;go&nbsp;option&nbsp;C&nbsp;route,&nbsp;you&nbsp;&lt;br&gt;<br>
may&nbsp;need&nbsp;to&nbsp;protect&nbsp;helper&#39;s&nbsp;stdin/stdout&nbsp;descriptors&nbsp;with&nbsp;a&nbsp;mutex&nbsp;so&nbsp;&lt;br&gt;<br>
that&nbsp;threads&nbsp;can&nbsp;read/write&nbsp;from/to&nbsp;stdin/stdout&nbsp;without&nbsp;getting&nbsp;&lt;br&gt;<br>
mangled/partial&nbsp;reads&nbsp;and&nbsp;mangled/overlapping&nbsp;writes.&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;Tue,&nbsp;Feb&nbsp;8,&nbsp;2022&nbsp;at&nbsp;5:12&nbsp;PM&nbsp;Alex&nbsp;Rousskov &nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; On&nbsp;2/8/22&nbsp;09:50,&nbsp;roee&nbsp;klinger&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Alex:&nbsp;If&nbsp;there&nbsp;are&nbsp;a&nbsp;lot&nbsp;more&nbsp;requests&nbsp;than&nbsp;your&nbsp;users/TTLs&nbsp;should&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; generate,&nbsp;then&nbsp;you&nbsp;may&nbsp;be&nbsp;able&nbsp;to&nbsp;decrease&nbsp;db&nbsp;load&nbsp;by&lt;br&gt;<br>
&gt; &nbsp; &nbsp; figuring&nbsp;out&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; where&nbsp;the&nbsp;extra&nbsp;requests&nbsp;are&nbsp;coming&nbsp;from.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;actually,&nbsp;I&nbsp;don&#39;t&nbsp;think&nbsp;it&nbsp;matters&nbsp;much&nbsp;now&nbsp;that&nbsp;I&nbsp;think&nbsp;about&nbsp;it&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;again,&nbsp;since&nbsp;as&nbsp;per&nbsp;my&nbsp;requirements,&nbsp;I&nbsp;need&nbsp;to&nbsp;reload&nbsp;the&nbsp;cache&nbsp;every&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;60&nbsp;seconds,&nbsp;which&nbsp;means&nbsp;that&nbsp;even&nbsp;if&nbsp;it&nbsp;is&nbsp;perfect,&nbsp;MariaDB&nbsp;will&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;still&nbsp;get&nbsp;a&nbsp;high&nbsp;load.&nbsp;I&nbsp;think&nbsp;the&nbsp;second&nbsp;approach&nbsp;will&nbsp;be&nbsp;better&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;suited.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Your&nbsp;call.&nbsp;Wiping&nbsp;out&nbsp;the&nbsp;entire&nbsp;authentication&nbsp;cache&nbsp;every&nbsp;60&nbsp;seconds&lt;br&gt;<br>
&gt; &nbsp; &nbsp; feels&nbsp;odd,&nbsp;but&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;enough&nbsp;about&nbsp;your&nbsp;environment&nbsp;to&nbsp;judge.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Alex:&nbsp;aggregating&nbsp;helper-db&nbsp;connections&nbsp;(helpers&nbsp;can&nbsp;be&nbsp;written&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; talk&nbsp;through&nbsp;a&nbsp;central&nbsp;connection&nbsp;aggregator)&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;That&nbsp;sounds&nbsp;like&nbsp;exactly&nbsp;what&nbsp;I&nbsp;am&nbsp;looking&nbsp;for,&nbsp;how&nbsp;would&nbsp;one&nbsp;go&lt;br&gt;<br>
&gt; &nbsp; &nbsp; about&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;doing&nbsp;this?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; You&nbsp;have&nbsp;at&nbsp;least&nbsp;two&nbsp;basic&nbsp;options:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; A.&nbsp;Enhance&nbsp;Squid&nbsp;to&nbsp;let&nbsp;SMP&nbsp;workers&nbsp;share&nbsp;helpers.&nbsp;I&nbsp;assume&nbsp;that&nbsp;you&lt;br&gt;<br>
&gt; &nbsp; &nbsp; have&nbsp;C&nbsp;SMP&nbsp;workers&nbsp;and&nbsp;N&nbsp;helpers&nbsp;per&nbsp;worker,&nbsp;with&nbsp;C&nbsp;and&nbsp;N&nbsp;significantly&lt;br&gt;<br>
&gt; &nbsp; &nbsp; greater&nbsp;than&nbsp;1.&nbsp;Instead&nbsp;of&nbsp;having&nbsp;N&nbsp;helpers&nbsp;per&nbsp;worker&nbsp;and&nbsp;C*N&nbsp;helpers&lt;br&gt;<br>
&gt; &nbsp; &nbsp; total,&nbsp;you&nbsp;will&nbsp;have&nbsp;just&nbsp;one&nbsp;concurrent&nbsp;helper&nbsp;per&nbsp;worker&nbsp;and&nbsp;C&lt;br&gt;<br>
&gt; &nbsp; &nbsp; helpers&lt;br&gt;<br>
&gt; &nbsp; &nbsp; total.&nbsp;This&nbsp;will&nbsp;be&nbsp;a&nbsp;significant,&nbsp;generally&nbsp;useful&nbsp;improvement&nbsp;that&lt;br&gt;<br>
&gt; &nbsp; &nbsp; should&nbsp;be&nbsp;officially&nbsp;accepted&nbsp;if&nbsp;implemented&nbsp;well.&nbsp;This&nbsp;enhancement&lt;br&gt;<br>
&gt; &nbsp; &nbsp; requires&nbsp;serious&nbsp;Squid&nbsp;code&nbsp;modifications&nbsp;in&nbsp;a&nbsp;neglected&nbsp;error-prone&lt;br&gt;<br>
&gt; &nbsp; &nbsp; area,&nbsp;but&nbsp;it&nbsp;is&nbsp;certainly&nbsp;doable&nbsp;--&nbsp;Squid&nbsp;already&nbsp;shares&nbsp;rock&nbsp;diskers&lt;br&gt;<br>
&gt; &nbsp; &nbsp; across&nbsp;workers,&nbsp;for&nbsp;example.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; B.&nbsp;Convert&nbsp;your&nbsp;helper&nbsp;from&nbsp;a&nbsp;database&nbsp;client&nbsp;program&nbsp;to&nbsp;an&nbsp;Aggregator&lt;br&gt;<br>
&gt; &nbsp; &nbsp; client&nbsp;program&nbsp;(and&nbsp;write&nbsp;the&nbsp;Aggregator).&nbsp;Depending&nbsp;on&nbsp;your&nbsp;needs&nbsp;and&lt;br&gt;<br>
&gt; &nbsp; &nbsp; skill,&nbsp;you&nbsp;can&nbsp;use&nbsp;TCP&nbsp;or&nbsp;Unix&nbsp;Domain&nbsp;Sockets&nbsp;(UDS)&nbsp;for&lt;br&gt;<br>
&gt; &nbsp; &nbsp; helper-Aggregator&nbsp;communication.&nbsp;The&nbsp;Aggregator&nbsp;may&nbsp;look&nbsp;very&lt;br&gt;<br>
&gt; &nbsp; &nbsp; similar&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; the&nbsp;current&nbsp;helper,&nbsp;except&nbsp;it&nbsp;will&nbsp;not&nbsp;use&nbsp;stdin/stdout&nbsp;for&lt;br&gt;<br>
&gt; &nbsp; &nbsp; receiving/sending&nbsp;helper&nbsp;queries/responses.&nbsp;This&nbsp;option&nbsp;also&nbsp;requires&lt;br&gt;<br>
&gt; &nbsp; &nbsp; development,&nbsp;but&nbsp;it&nbsp;is&nbsp;much&nbsp;simpler&nbsp;than&nbsp;option&nbsp;A.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; HTH,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;On&nbsp;Tue,&nbsp;Feb&nbsp;8,&nbsp;2022&nbsp;at&nbsp;4:41&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; On&nbsp;2/8/22&nbsp;09:13,&nbsp;roee&nbsp;klinger&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;I&nbsp;am&nbsp;running&nbsp;multiple&nbsp;instances&nbsp;of&nbsp;Squid&nbsp;in&nbsp;a&nbsp;K8S&lt;br&gt;<br>
&gt; &nbsp; &nbsp; environment,&nbsp;each&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Squid&nbsp;instance&nbsp;has&nbsp;a&nbsp;helper that&nbsp;authenticates&nbsp;users&nbsp;based&lt;br&gt;<br>
&gt; &nbsp; &nbsp; on&nbsp;their&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;username&nbsp;and&nbsp;password,&nbsp;the&nbsp;scripts&nbsp;are&nbsp;written&nbsp;in&nbsp;Python.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;I&nbsp;have&nbsp;been&nbsp;facing&nbsp;an&nbsp;issue,&nbsp;that&nbsp;when&nbsp;under&nbsp;load,&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; helpers&nbsp;(even&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;with&nbsp;3600&nbsp;sec&nbsp;TTL)&nbsp;swamp&nbsp;the&nbsp;MariaDB&nbsp;instance,&nbsp;causing it&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; reach&nbsp;100%&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;CPU,&nbsp;basically I&nbsp;believe&nbsp;because&nbsp;each&nbsp;helper&nbsp;opens&nbsp;up&nbsp;its&nbsp;own&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; connection&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;to&nbsp;MariaDB,&nbsp;which&nbsp;ends&nbsp;up&nbsp;as&nbsp;a&nbsp;lot&nbsp;of&nbsp;connections.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;My&nbsp;initial&nbsp;idea&nbsp;was&nbsp;to&nbsp;create&nbsp;a&nbsp;Redis&nbsp;DB&nbsp;next&nbsp;to&nbsp;each&nbsp;Squid&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; instance&nbsp;and&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;connect&nbsp;each&nbsp;Squid&nbsp;to&nbsp;its&nbsp;own&nbsp;dedicated&nbsp;Redis.&nbsp;I&nbsp;will&nbsp;sync&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Redis&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; with&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;MariaDB&nbsp;every&nbsp;minute,&nbsp;thus&nbsp;decreasing&nbsp;the&nbsp;connections&lt;br&gt;<br>
&gt; &nbsp; &nbsp; count&nbsp;from&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; a&nbsp;few&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;100s&nbsp;to&nbsp;just&nbsp;1&nbsp;every&nbsp;minute.&nbsp;This&nbsp;will&nbsp;also&nbsp;improve&nbsp;speeds&lt;br&gt;<br>
&gt; &nbsp; &nbsp; since&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Redis&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;is&nbsp;much&nbsp;faster&nbsp;than&nbsp;MariaDB.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;The&nbsp;problem&nbsp;is,&nbsp;however,&nbsp;that&nbsp;there&nbsp;will&nbsp;still&nbsp;be&nbsp;many&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; connections&nbsp;from&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Squid&nbsp;to&nbsp;Redis,&nbsp;and&nbsp;I&nbsp;probably&nbsp;that&nbsp;will&nbsp;consume&nbsp;a&nbsp;lot&nbsp;of&nbsp;DB&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; resources&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;as&nbsp;well,&nbsp;which&nbsp;I&nbsp;don&#39;t&nbsp;actually&nbsp;know&nbsp;how&nbsp;to&nbsp;optimize,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; since&nbsp;it&nbsp;seems&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;that&nbsp;Squid&nbsp;opens&nbsp;many&nbsp;processes,&nbsp;and&nbsp;there&nbsp;is&nbsp;no&nbsp;way&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; get&nbsp;them&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; to&nbsp;talk&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;to&nbsp;each&nbsp;other&nbsp;(expect&nbsp;TTL&nbsp;values,&nbsp;which&nbsp;seems&nbsp;not&nbsp;to&nbsp;help&lt;br&gt;<br>
&gt; &nbsp; &nbsp; in&nbsp;my&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; case,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;which&nbsp;I&nbsp;also&nbsp;don&#39;t&nbsp;understand&nbsp;why&nbsp;that&nbsp;is).&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;What&nbsp;is&nbsp;the&nbsp;best&nbsp;practice&nbsp;to&nbsp;handle&nbsp;this?&nbsp;considering&nbsp;I&lt;br&gt;<br>
&gt; &nbsp; &nbsp; have&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;following&nbsp;requirements:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; 1.&nbsp;Fast&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; 2.&nbsp;Refresh&nbsp;data&nbsp;every&nbsp;minute&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; 3.&nbsp;Consume&nbsp;as&nbsp;least&nbsp;amount&nbsp;of&nbsp;DB&nbsp;resources&nbsp;as&nbsp;possible&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; I&nbsp;would&nbsp;start&nbsp;from&nbsp;the&nbsp;beginning:&nbsp;Does&nbsp;the&nbsp;aggregate&nbsp;number&lt;br&gt;<br>
&gt; &nbsp; &nbsp; of&nbsp;database&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; requests&nbsp;match&nbsp;your&nbsp;expectations?&nbsp;In&nbsp;other&nbsp;words,&nbsp;do&nbsp;you&nbsp;see&lt;br&gt;<br>
&gt; &nbsp; &nbsp; lots&nbsp;of&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; database&nbsp;requests&nbsp;that&nbsp;should&nbsp;not&nbsp;be&nbsp;there&nbsp;given&nbsp;your&nbsp;user&nbsp;access&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; patterns&nbsp;and&nbsp;authentication&nbsp;TTLs?&nbsp;In&nbsp;yet&nbsp;other&nbsp;words,&nbsp;are&lt;br&gt;<br>
&gt; &nbsp; &nbsp; there&nbsp;many&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; repeated&nbsp;authentication&nbsp;accesses&nbsp;that&nbsp;should&nbsp;have&nbsp;been&lt;br&gt;<br>
&gt; &nbsp; &nbsp; authentication&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; cache&nbsp;hits?&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; If&nbsp;there&nbsp;are&nbsp;a&nbsp;lot&nbsp;more&nbsp;requests&nbsp;than&nbsp;your&nbsp;users/TTLs&nbsp;should&lt;br&gt;<br>
&gt; &nbsp; &nbsp; generate,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; then&nbsp;you&nbsp;may&nbsp;be&nbsp;able&nbsp;to&nbsp;decrease&nbsp;db&nbsp;load&nbsp;by&nbsp;figuring&nbsp;out&lt;br&gt;<br>
&gt; &nbsp; &nbsp; where&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; extra&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; requests&nbsp;are&nbsp;coming&nbsp;from.&nbsp;For&nbsp;example,&nbsp;it&nbsp;is&nbsp;possible&nbsp;that&nbsp;your&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; authentication&nbsp;cache&nbsp;key&nbsp;includes&nbsp;some&nbsp;noise&nbsp;that&nbsp;renders&nbsp;caching&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; ineffective&nbsp;(e.g.,&nbsp;see&nbsp;comments&nbsp;about&nbsp;key_extras&nbsp;in&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; squid.conf.documented).&nbsp;Or&nbsp;maybe&nbsp;you&nbsp;need&nbsp;a&nbsp;bigger&lt;br&gt;<br>
&gt; &nbsp; &nbsp; authentication&nbsp;cache.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; If&nbsp;the&nbsp;total&nbsp;stream&nbsp;of&nbsp;authentication&nbsp;requests&nbsp;during&nbsp;peak&lt;br&gt;<br>
&gt; &nbsp; &nbsp; hours&nbsp;is&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; reasonable,&nbsp;with&nbsp;few&nbsp;unwarranted&nbsp;cache&nbsp;misses,&nbsp;then&nbsp;you&nbsp;can&nbsp;start&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; working&nbsp;on&nbsp;aggregating&nbsp;helper-db&nbsp;connections&nbsp;(helpers&nbsp;can&nbsp;be&lt;br&gt;<br>
&gt; &nbsp; &nbsp; written&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; talk&nbsp;through&nbsp;a&nbsp;central&nbsp;connection&nbsp;aggregator)&nbsp;and/or&nbsp;adding&lt;br&gt;<br>
&gt; &nbsp; &nbsp; database&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; power&nbsp;(e.g.,&nbsp;by&nbsp;introducing&nbsp;additional&nbsp;databases&nbsp;running&nbsp;on&lt;br&gt;<br>
&gt; &nbsp; &nbsp; previously&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; unused&nbsp;hardware&nbsp;--&nbsp;just&nbsp;like&nbsp;your&nbsp;MariaDB&nbsp;idea).&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Cheers,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
