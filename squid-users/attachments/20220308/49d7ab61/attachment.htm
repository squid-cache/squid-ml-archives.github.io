<tt>
&lt;br&gt;&lt;div&gt;Hi&nbsp;Alex,&nbsp;thanks&nbsp;for&nbsp;your&nbsp;reply!&nbsp;I&nbsp;did&nbsp;get&nbsp;access&nbsp;to&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;and&nbsp;my&nbsp;assumption&nbsp;was&nbsp;wrong,&nbsp;it's&nbsp;doing&nbsp;minimal&nbsp;bumping.&nbsp;Also,&nbsp;the&nbsp;reason&nbsp;it's&nbsp;on&nbsp;443&nbsp;is&nbsp;to&nbsp;operate&nbsp;on&nbsp;a&nbsp;&quot;standard&quot;&nbsp;port&nbsp;for&nbsp;firewalls.&lt;/div&gt;&lt;br&gt;&lt;div&gt;The&nbsp;parent&nbsp;is&nbsp;doing&nbsp;peek&nbsp;and&nbsp;splice&nbsp;to&nbsp;an&nbsp;exact&nbsp;list&nbsp;of&nbsp;internal&nbsp;destinations.&nbsp;Specifically,&nbsp;peek&nbsp;step1&nbsp;all,&nbsp;peek&nbsp;step2&nbsp;allowed_sites,&nbsp;splice&nbsp;allowed_sites,&nbsp;terminate&nbsp;all.&nbsp;That&nbsp;shouldn't&nbsp;(to&nbsp;my&nbsp;imperfect&nbsp;knowledge)&nbsp;interfere&nbsp;with&nbsp;what&nbsp;I'm&nbsp;doing&nbsp;though.&lt;/div&gt;&lt;br&gt;&lt;div&gt;That's&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;do&nbsp;splice&nbsp;only&nbsp;and&nbsp;see&nbsp;if&nbsp;that's&nbsp;successful.&nbsp;Trying&nbsp;to&nbsp;do&nbsp;too&nbsp;much&nbsp;at&nbsp;once!&nbsp;I'll&nbsp;see&nbsp;what&nbsp;that&nbsp;does,&nbsp;then&nbsp;try&nbsp;debug&nbsp;again.&nbsp;The&nbsp;debug&nbsp;output&nbsp;wasn't&nbsp;very&nbsp;helpful&nbsp;before,&nbsp;but&nbsp;stepwise&nbsp;may&nbsp;be&nbsp;better.&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote_attribution&quot;&gt;On&nbsp;Mar&nbsp;8&nbsp;2022,&nbsp;at&nbsp;1:43&nbsp;pm,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;&nbsp;wrote:&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;div&gt;On&nbsp;3/8/22&nbsp;14:16,&nbsp;Aaron&nbsp;Dewell&nbsp;wrote:&lt;/div&gt;&lt;br&gt;&lt;div&gt;&gt;&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;use&nbsp;these&nbsp;two&nbsp;features&nbsp;at&nbsp;the&nbsp;same&nbsp;time.&nbsp;&nbsp;The&nbsp;use&nbsp;case&nbsp;is&lt;/div&gt;&lt;div&gt;&gt;&nbsp;pretty&nbsp;simple.&nbsp;&nbsp;I&nbsp;want&nbsp;to&nbsp;capture&nbsp;all&nbsp;traffic&nbsp;from&nbsp;a&nbsp;single&nbsp;source&nbsp;(a&lt;/div&gt;&lt;div&gt;&gt;&nbsp;device&nbsp;of&nbsp;mine)&nbsp;to&nbsp;another&nbsp;squid&nbsp;proxy&nbsp;server&nbsp;and&nbsp;decrypt/log&nbsp;it.&nbsp;&nbsp;&nbsp;&nbsp;I'm&lt;/div&gt;&lt;div&gt;&gt;&nbsp;using&nbsp;the&nbsp;Ubuntu&nbsp;20&nbsp;package&nbsp;of&nbsp;squid-ssl&nbsp;version&nbsp;4.13.&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Device&nbsp;-&gt;&nbsp;ssl_bump&nbsp;proxy&nbsp;-&gt;&nbsp;upstream&nbsp;proxy&nbsp;-&gt;&nbsp;website&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;It&nbsp;was&nbsp;all&nbsp;successfully&nbsp;working&nbsp;without&nbsp;ssl_bump,&nbsp;so&nbsp;the&nbsp;cache_peer&lt;/div&gt;&lt;div&gt;&gt;&nbsp;configuration&nbsp;works.&nbsp;&nbsp;One&nbsp;side&nbsp;note:&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;is&nbsp;running&nbsp;on&nbsp;443&lt;/div&gt;&lt;div&gt;&gt;&nbsp;without&nbsp;SSL&nbsp;(I&nbsp;believe&nbsp;-&nbsp;I&nbsp;don't&nbsp;run&nbsp;it&nbsp;but&nbsp;I've&nbsp;asked&nbsp;those&nbsp;that&nbsp;do&nbsp;for&lt;/div&gt;&lt;div&gt;&gt;&nbsp;confirmation,&nbsp;but&nbsp;I&nbsp;do&nbsp;know&nbsp;it's&nbsp;a&nbsp;pretty&nbsp;standard&nbsp;destination&nbsp;proxy&lt;/div&gt;&lt;div&gt;&gt;&nbsp;configuration).&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;The&nbsp;website&nbsp;itself&nbsp;is&nbsp;not&nbsp;directly&nbsp;accessible&nbsp;thus&nbsp;the&nbsp;upstream&nbsp;proxy&nbsp;is&lt;/div&gt;&lt;div&gt;&gt;&nbsp;required.&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Adding&nbsp;the&nbsp;ssl_bump&nbsp;configuration&nbsp;caused&nbsp;it&nbsp;to&nbsp;not&nbsp;work,&nbsp;with&nbsp;errors&lt;/div&gt;&lt;div&gt;&gt;&nbsp;about&nbsp;SSL&nbsp;versions&nbsp;and&nbsp;&quot;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;xx&quot;.&nbsp;&nbsp;My&lt;/div&gt;&lt;div&gt;&gt;&nbsp;best&nbsp;guess&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;attempting&nbsp;to&nbsp;establish&nbsp;an&nbsp;SSL&nbsp;connection&nbsp;to&lt;/div&gt;&lt;div&gt;&gt;&nbsp;the&nbsp;upstream&nbsp;and&nbsp;failing.&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/div&gt;&lt;div&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;/div&gt;&lt;div&gt;&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;all&lt;/div&gt;&lt;div&gt;&gt;&nbsp;http_port&nbsp;3128&nbsp;ssl-bump&nbsp;cert=/var/lib/squid/ssl_cert/myCA.pem&lt;/div&gt;&lt;div&gt;&gt;&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&lt;/div&gt;&lt;div&gt;&gt;&nbsp;tls_outgoing_options&nbsp;options=NO_SSLv3&lt;/div&gt;&lt;div&gt;&gt;&nbsp;flags=DON'T_VERIFY_PEER,DONT_VERIFY_DOMAIN&lt;/div&gt;&lt;div&gt;&gt;&nbsp;cert=/var/lib/squid/ssl_cert/device.pem&lt;/div&gt;&lt;div&gt;&gt;&nbsp;key=/var/lib/squid/ssl_cert/client.key&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;(client.key&nbsp;and&nbsp;client.pem&nbsp;are&nbsp;from&nbsp;the&nbsp;device&nbsp;and&nbsp;are&nbsp;needed&nbsp;due&nbsp;to&nbsp;the&lt;/div&gt;&lt;div&gt;&gt;&nbsp;authentication&nbsp;of&nbsp;the&nbsp;session&nbsp;at&nbsp;the&nbsp;destination&nbsp;server.&nbsp;&nbsp;Also,&nbsp;I&lt;/div&gt;&lt;div&gt;&gt;&nbsp;haven't&nbsp;looked&nbsp;at&nbsp;the&nbsp;packet&nbsp;logging&nbsp;yet.&nbsp;I&nbsp;assume&nbsp;that&nbsp;will&nbsp;be&nbsp;an&nbsp;easy&lt;/div&gt;&lt;div&gt;&gt;&nbsp;addition&nbsp;once&nbsp;the&nbsp;setup&nbsp;works&nbsp;generally.)&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;However,&nbsp;my&nbsp;understanding&nbsp;is&nbsp;that&nbsp;the&nbsp;cache_peer&nbsp;configuration&nbsp;should&lt;/div&gt;&lt;div&gt;&gt;&nbsp;NOT&nbsp;do&nbsp;TLS&nbsp;by&nbsp;default&nbsp;unless&nbsp;that&nbsp;was&nbsp;specified&nbsp;in&nbsp;the&nbsp;options,&nbsp;and&nbsp;I&lt;/div&gt;&lt;div&gt;&gt;&nbsp;see&nbsp;no&nbsp;way&nbsp;to&nbsp;explicitly&nbsp;disable&nbsp;it.&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;So&nbsp;first&nbsp;question:&nbsp;is&nbsp;that&nbsp;assumption&nbsp;accurate?&nbsp;&nbsp;No&nbsp;TLS&nbsp;to&nbsp;the&nbsp;parent&lt;/div&gt;&lt;div&gt;&gt;&nbsp;unless&nbsp;explicitly&nbsp;configured?&lt;/div&gt;&lt;br&gt;&lt;div&gt;Yes,&nbsp;that&nbsp;is&nbsp;correct:&nbsp;cache_peers&nbsp;are&nbsp;plain&nbsp;HTTP&nbsp;forward&nbsp;proxies&nbsp;unless&lt;/div&gt;&lt;div&gt;explicitly&nbsp;configured&nbsp;otherwise.&nbsp;Their&nbsp;listening&nbsp;port&nbsp;value&nbsp;does&nbsp;carry&lt;/div&gt;&lt;div&gt;any&nbsp;special&nbsp;meaning&nbsp;as&nbsp;far&nbsp;as&nbsp;Squid&nbsp;code&nbsp;is&nbsp;concerned.&lt;/div&gt;&lt;br&gt;&lt;div&gt;However,&nbsp;it&nbsp;is&nbsp;very&nbsp;unusual&nbsp;to&nbsp;run&nbsp;a&nbsp;plain&nbsp;HTTP&nbsp;forward&nbsp;proxy&nbsp;on&nbsp;port&lt;/div&gt;&lt;div&gt;443.&nbsp;That&nbsp;port&nbsp;may&nbsp;imply&nbsp;that&nbsp;your&nbsp;parent&nbsp;proxy&nbsp;is&nbsp;an&nbsp;HTTPS&nbsp;reverse&lt;/div&gt;&lt;div&gt;proxy.&nbsp;If&nbsp;it&nbsp;is,&nbsp;you&nbsp;need&nbsp;to&nbsp;use&nbsp;originserver&nbsp;flag&nbsp;when&nbsp;configuring&nbsp;the&lt;/div&gt;&lt;div&gt;corresponding&nbsp;cache_peer&nbsp;line.&nbsp;You&nbsp;can&nbsp;check&nbsp;by&nbsp;sending&nbsp;plain&nbsp;CONNECT&lt;/div&gt;&lt;div&gt;requests&nbsp;to&nbsp;that&nbsp;upstream&nbsp;proxy&nbsp;using&nbsp;wget,&nbsp;curl,&nbsp;or&nbsp;some&nbsp;such.&nbsp;A&lt;/div&gt;&lt;div&gt;reverse&nbsp;HTTPS&nbsp;proxy&nbsp;would&nbsp;reject&nbsp;such&nbsp;requests.&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&gt;&nbsp;if&nbsp;the&nbsp;ssl_bump&nbsp;configuration&nbsp;is&nbsp;causing&nbsp;it&nbsp;to&nbsp;attempt&nbsp;an&nbsp;upstream&lt;/div&gt;&lt;div&gt;&gt;&nbsp;TLS&nbsp;connection&nbsp;...&lt;/div&gt;&lt;br&gt;&lt;div&gt;Bugs&nbsp;notwithstanding,&nbsp;it&nbsp;should&nbsp;not.&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&gt;&nbsp;Anything&nbsp;here&nbsp;that&nbsp;I'm&nbsp;doing&nbsp;obviously&nbsp;wrong?&lt;/div&gt;&lt;br&gt;&lt;div&gt;I&nbsp;see&nbsp;no&nbsp;red&nbsp;flags&nbsp;relevant&nbsp;to&nbsp;your&nbsp;specific&nbsp;question.&lt;/div&gt;&lt;br&gt;&lt;div&gt;Does&nbsp;replacing&nbsp;&quot;bump&nbsp;all&quot;&nbsp;with&nbsp;&quot;splice&nbsp;all&quot;&nbsp;fix&nbsp;the&nbsp;problem?&nbsp;I&nbsp;realize&lt;/div&gt;&lt;div&gt;that&nbsp;you&nbsp;do&nbsp;want&nbsp;to&nbsp;bump/see&nbsp;the&nbsp;device&nbsp;traffic,&nbsp;but&nbsp;I&nbsp;wonder&nbsp;whether&lt;/div&gt;&lt;div&gt;the&nbsp;errors&nbsp;are&nbsp;not&nbsp;between&nbsp;Squid&nbsp;and&nbsp;the&nbsp;upstream&nbsp;proxy&nbsp;but&nbsp;Squid&nbsp;and&lt;/div&gt;&lt;div&gt;the&nbsp;web&nbsp;site.&nbsp;Splicing&nbsp;would&nbsp;remove&nbsp;those&nbsp;errors&nbsp;while&nbsp;still&nbsp;keeping&lt;/div&gt;&lt;div&gt;some&nbsp;SslBump&nbsp;code&nbsp;active.&lt;/div&gt;&lt;br&gt;&lt;div&gt;Sharing&nbsp;a&nbsp;(pointer&nbsp;to&nbsp;compressed)&nbsp;libpcap&nbsp;packet&nbsp;capture&nbsp;and/or&nbsp;a&lt;/div&gt;&lt;div&gt;(pointer&nbsp;to&nbsp;compressed)&nbsp;ALL,9&nbsp;cache.log&nbsp;while&nbsp;reproducing&nbsp;the&nbsp;problem&lt;/div&gt;&lt;div&gt;with&nbsp;a&nbsp;single&nbsp;transaction&nbsp;may&nbsp;help:&lt;/div&gt;&lt;div&gt;https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction&lt;/div&gt;&lt;br&gt;&lt;div&gt;Alex.&lt;/div&gt;&lt;div&gt;_______________________________________________&lt;/div&gt;&lt;div&gt;squid-users&nbsp;mailing&nbsp;list&lt;/div&gt;&lt;div&gt;squid-users@lists.squid-cache.org&lt;/div&gt;&lt;div&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;img&nbsp;class=&quot;mailspring-open&quot;&nbsp;alt=&quot;Sent&nbsp;from&nbsp;Mailspring&quot;&nbsp;width=&quot;0&quot;&nbsp;height=&quot;0&quot;&nbsp;style=&quot;border:0;&nbsp;width:0;&nbsp;height:0;&quot;&nbsp;src=&quot;https://link.getmailspring.com/open/C17056D9-5664-484C-A6F9-EE8358223779@getmailspring.com?me=3a79f6de&amp;recipient=c3F1aWQtdXNlcnNAbGlzdHMuc3F1aWQtY2FjaGUub3Jn&quot;&gt;
</tt>
