<tt>
&lt;br&gt;&lt;div&gt;So&nbsp;after&nbsp;a&nbsp;bit&nbsp;more&nbsp;experimentation.&nbsp;the&nbsp;difference&nbsp;in&nbsp;what&nbsp;works&nbsp;and&nbsp;what&nbsp;doesn't&nbsp;is:&lt;/div&gt;&lt;br&gt;&lt;div&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;splice&nbsp;all&lt;/div&gt;&lt;br&gt;&lt;div&gt;(working)&nbsp;and&nbsp;this&nbsp;not&nbsp;working:&lt;/div&gt;&lt;br&gt;&lt;div&gt;ssl_bump&nbsp;peek&nbsp;all&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;splice&nbsp;all&lt;/div&gt;&lt;br&gt;&lt;div&gt;I'm&nbsp;not&nbsp;clear&nbsp;on&nbsp;why&nbsp;peeking&nbsp;at&nbsp;&quot;all&quot;&nbsp;vs.&nbsp;&quot;step1&quot;&nbsp;would&nbsp;cause&nbsp;it&nbsp;to&nbsp;fail.&nbsp;&nbsp;However,&nbsp;I&nbsp;also&nbsp;note&nbsp;that&nbsp;not&nbsp;peeking&nbsp;at&nbsp;anything&nbsp;makes&nbsp;it&nbsp;work&nbsp;also&nbsp;(commenting&nbsp;out&nbsp;the&nbsp;&quot;peek&quot;&nbsp;line),&nbsp;so&nbsp;I'm&nbsp;suspicious&nbsp;that&nbsp;&quot;peek&nbsp;step1&quot;&nbsp;is&nbsp;effectively&nbsp;having&nbsp;it&nbsp;do&nbsp;nothing.&lt;/div&gt;&lt;br&gt;&lt;div&gt;&quot;stare&nbsp;step1&quot;&nbsp;also&nbsp;works,&nbsp;but&nbsp;&quot;stare&nbsp;all&quot;&nbsp;does&nbsp;not&nbsp;(i.e.&nbsp;same&nbsp;result&nbsp;as&nbsp;&quot;peek&quot;).&lt;/div&gt;&lt;br&gt;&lt;div&gt;&quot;stare&nbsp;step1&quot;&nbsp;followed&nbsp;by&nbsp;&quot;bump&nbsp;all&quot;&nbsp;fails&nbsp;as&nbsp;well&nbsp;(i.e.&nbsp;changing&nbsp;&quot;splice&quot;&nbsp;to&nbsp;&quot;bump&quot;),&nbsp;as&nbsp;does&nbsp;&quot;stare&nbsp;all/bump&nbsp;all&quot;.&lt;/div&gt;&lt;br&gt;&lt;div&gt;I'm&nbsp;probably&nbsp;not&nbsp;going&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;share&nbsp;any&nbsp;packet&nbsp;dumps&nbsp;so&nbsp;that&nbsp;does&nbsp;make&nbsp;things&nbsp;difficult.&nbsp;&nbsp;This&nbsp;device&nbsp;is&nbsp;under&nbsp;development&nbsp;and&nbsp;the&nbsp;details&nbsp;of&nbsp;&quot;what&nbsp;it's&nbsp;doing&quot;&nbsp;is&nbsp;likely&nbsp;to&nbsp;be&nbsp;sensitive.&nbsp;&nbsp;I&nbsp;appreciate&nbsp;that&nbsp;makes&nbsp;troubleshooting&nbsp;things&nbsp;difficult.&nbsp;&nbsp;What&nbsp;I&nbsp;could&nbsp;do&nbsp;is&nbsp;put&nbsp;a&nbsp;VM&nbsp;behind&nbsp;it&nbsp;and&nbsp;do&nbsp;manual&nbsp;wgets&nbsp;or&nbsp;something&nbsp;from&nbsp;it&nbsp;but&nbsp;that&nbsp;will&nbsp;take&nbsp;some&nbsp;changes&nbsp;to&nbsp;the&nbsp;environment,&nbsp;or&nbsp;perhaps&nbsp;just&nbsp;creating&nbsp;a&nbsp;new&nbsp;one&nbsp;to&nbsp;test&nbsp;this&nbsp;where&nbsp;this&nbsp;device&nbsp;isn't&nbsp;present.&nbsp;&nbsp;If&nbsp;that's&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;go,&nbsp;I'll&nbsp;have&nbsp;to&nbsp;start&nbsp;discussions&nbsp;on&nbsp;exactly&nbsp;how&nbsp;sensitive&nbsp;it&nbsp;is&nbsp;and/or&nbsp;start&nbsp;creating&nbsp;the&nbsp;new/modified&nbsp;setup.&lt;/div&gt;&lt;br&gt;&lt;div&gt;Anyway,&nbsp;I&nbsp;do&nbsp;appreciate&nbsp;the&nbsp;suggestions,&nbsp;and&nbsp;the&nbsp;lightbulb&nbsp;is&nbsp;starting&nbsp;to&nbsp;go&nbsp;on,&nbsp;albeit&nbsp;dimly.&nbsp;&lt;span&nbsp;data-emoji-typing=&quot;true&quot;&gt;:)&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote_attribution&quot;&gt;On&nbsp;Mar&nbsp;8&nbsp;2022,&nbsp;at&nbsp;4:16&nbsp;pm,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;&nbsp;wrote:&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;div&gt;On&nbsp;3/8/22&nbsp;17:56,&nbsp;Aaron&nbsp;Dewell&nbsp;wrote:&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Ok,&nbsp;with&nbsp;a&nbsp;bit&nbsp;more&nbsp;messing&nbsp;with&nbsp;it...&nbsp;&nbsp;Changing&nbsp;bump&nbsp;to&nbsp;splice&nbsp;does&nbsp;work:&lt;/div&gt;&lt;br&gt;&lt;div&gt;&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;all&lt;/div&gt;&lt;br&gt;&lt;div&gt;Noted.&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&gt;&nbsp;Adding:&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;/div&gt;&lt;div&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;/div&gt;&lt;div&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step2&lt;/div&gt;&lt;div&gt;&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;step2&lt;/div&gt;&lt;br&gt;&lt;div&gt;The&nbsp;above&nbsp;is&nbsp;a&nbsp;bad&nbsp;configuration&nbsp;because&nbsp;no&nbsp;rule&nbsp;matches&nbsp;during&nbsp;step3.&lt;/div&gt;&lt;br&gt;&lt;div&gt;Please&nbsp;try&nbsp;this&nbsp;configuration&nbsp;instead,&nbsp;to&nbsp;make&nbsp;sure&nbsp;you&nbsp;are&nbsp;not&nbsp;seeing&nbsp;a&lt;/div&gt;&lt;div&gt;side&nbsp;effect&nbsp;of&nbsp;various&nbsp;Squid&nbsp;bugs&nbsp;related&nbsp;to&nbsp;such&nbsp;configurations&nbsp;(we&nbsp;are&lt;/div&gt;&lt;div&gt;working&nbsp;on&nbsp;fixing&nbsp;them):&lt;/div&gt;&lt;br&gt;&lt;div&gt;ssl_bump&nbsp;peek&nbsp;all&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;splice&nbsp;all&lt;/div&gt;&lt;br&gt;&lt;div&gt;If&nbsp;the&nbsp;above&nbsp;fails,&nbsp;please&nbsp;see&nbsp;my&nbsp;earlier&nbsp;suggestions&nbsp;about&nbsp;sharing&nbsp;test&lt;/div&gt;&lt;div&gt;artifacts.&nbsp;Otherwise,&nbsp;please&nbsp;try&nbsp;this:&lt;/div&gt;&lt;br&gt;&lt;div&gt;ssl_bump&nbsp;stare&nbsp;all&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;bump&nbsp;all&lt;/div&gt;&lt;br&gt;&lt;div&gt;If&nbsp;the&nbsp;above&nbsp;fails,&nbsp;please&nbsp;see&nbsp;my&nbsp;earlier&nbsp;suggestions&nbsp;about&nbsp;sharing&nbsp;test&lt;/div&gt;&lt;div&gt;artifacts.&nbsp;Otherwise,&nbsp;please&nbsp;try&nbsp;this:&lt;/div&gt;&lt;br&gt;&lt;div&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;/div&gt;&lt;div&gt;ssl_bump&nbsp;bump&nbsp;all&lt;/div&gt;&lt;br&gt;&lt;div&gt;If&nbsp;the&nbsp;above&nbsp;fails,&nbsp;please&nbsp;see&nbsp;my&nbsp;earlier&nbsp;suggestions&nbsp;about&nbsp;sharing&nbsp;test&lt;/div&gt;&lt;div&gt;artifacts.&nbsp;Otherwise,&nbsp;you&nbsp;got&nbsp;a&nbsp;working&nbsp;config&nbsp;(which&nbsp;is&nbsp;the&nbsp;same&nbsp;config&lt;/div&gt;&lt;div&gt;you&nbsp;have&nbsp;started&nbsp;with,&nbsp;so&nbsp;I&nbsp;doubt&nbsp;you&nbsp;will&nbsp;get&nbsp;to&nbsp;this&nbsp;stage!).&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&gt;&nbsp;This&nbsp;appears&nbsp;to&nbsp;be&nbsp;the&nbsp;relevant&nbsp;data&nbsp;from&nbsp;the&nbsp;log:&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;2022/03/08&nbsp;14:35:47.644&nbsp;kid1|&nbsp;83,7|&nbsp;bio.cc(163)&nbsp;stateChanged:&nbsp;FD&nbsp;10&nbsp;now:&nbsp;0x4004&nbsp;TED&nbsp;(TLSv1.3&nbsp;early&nbsp;data)&lt;/div&gt;&lt;div&gt;&gt;&nbsp;2022/03/08&nbsp;14:35:47.644&nbsp;kid1|&nbsp;83,7|&nbsp;bio.cc(163)&nbsp;stateChanged:&nbsp;FD&nbsp;10&nbsp;now:&nbsp;0x2002&nbsp;SSLERR&nbsp;(error)&lt;/div&gt;&lt;div&gt;&gt;&nbsp;2022/03/08&nbsp;14:35:47.644&nbsp;kid1|&nbsp;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&nbsp;10:&nbsp;error:00000001:lib(0):func(0):reason(1)&nbsp;(1/-1)&lt;/div&gt;&lt;br&gt;&lt;div&gt;YMMV,&nbsp;but&nbsp;I&nbsp;will&nbsp;need&nbsp;to&nbsp;see&nbsp;a&nbsp;lot&nbsp;more&nbsp;lines&nbsp;surrounding&nbsp;this&nbsp;snippet&lt;/div&gt;&lt;div&gt;to&nbsp;understand&nbsp;what&nbsp;exactly&nbsp;went&nbsp;wrong.&nbsp;That&nbsp;is&nbsp;why&nbsp;I&nbsp;am&nbsp;asking&nbsp;for&nbsp;the&lt;/div&gt;&lt;div&gt;entire&nbsp;transaction&nbsp;log&nbsp;rather&nbsp;than&nbsp;selected&nbsp;&quot;error&quot;&nbsp;lines.&lt;/div&gt;&lt;br&gt;&lt;div&gt;Sharing&nbsp;a&nbsp;packet&nbsp;capture&nbsp;might&nbsp;be&nbsp;sufficient&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;basic&lt;/div&gt;&lt;div&gt;misconfiguration&nbsp;error&nbsp;--&nbsp;we&nbsp;will&nbsp;see&nbsp;wrong&nbsp;protocol&nbsp;traffic&nbsp;on&nbsp;one&nbsp;of&lt;/div&gt;&lt;div&gt;both&nbsp;Squid&nbsp;sides.&nbsp;You&nbsp;can&nbsp;start&nbsp;with&nbsp;that&nbsp;(often,&nbsp;but&nbsp;not&nbsp;always,&nbsp;safer&lt;/div&gt;&lt;div&gt;as&nbsp;far&nbsp;as&nbsp;sensitive&nbsp;info&nbsp;disclosure)&nbsp;step&nbsp;if&nbsp;you&nbsp;prefer.&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;HTH,&lt;/div&gt;&lt;br&gt;&lt;div&gt;Alex.&lt;/div&gt;&lt;br&gt;&lt;br&gt;&lt;div&gt;&gt;&nbsp;On&nbsp;Mar&nbsp;8&nbsp;2022,&nbsp;at&nbsp;2:57&nbsp;pm,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;On&nbsp;3/8/22&nbsp;16:38,&nbsp;Aaron&nbsp;Dewell&nbsp;wrote:&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;Hi&nbsp;Alex,&nbsp;thanks&nbsp;for&nbsp;your&nbsp;reply!&nbsp;&nbsp;I&nbsp;did&nbsp;get&nbsp;access&nbsp;to&nbsp;the&nbsp;parent&nbsp;proxy&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;and&nbsp;my&nbsp;assumption&nbsp;was&nbsp;wrong,&nbsp;it's&nbsp;doing&nbsp;minimal&nbsp;bumping.&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;TLS&nbsp;inspection&nbsp;at&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;does&nbsp;not&nbsp;affect&nbsp;what&nbsp;I&nbsp;was&nbsp;trying&nbsp;to&lt;/div&gt;&lt;div&gt;&gt;&nbsp;double&nbsp;check.&nbsp;What&nbsp;matters&nbsp;is&nbsp;whether&nbsp;it&nbsp;is&nbsp;a&nbsp;forward&nbsp;HTTP&nbsp;proxy&nbsp;(e.g.,&lt;/div&gt;&lt;div&gt;&gt;&nbsp;a&nbsp;Squid&nbsp;instance&nbsp;listening&nbsp;on&nbsp;an&nbsp;http_port&nbsp;configured&nbsp;without&nbsp;intercept,&lt;/div&gt;&lt;div&gt;&gt;&nbsp;tproxy,&nbsp;or&nbsp;accel&nbsp;flags).&nbsp;It&nbsp;sounds&nbsp;like&nbsp;that&nbsp;is&nbsp;what&nbsp;it&nbsp;is.&nbsp;That's&nbsp;OK!&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;I&nbsp;do&nbsp;not&nbsp;remember&nbsp;whether&nbsp;your&nbsp;Squid&nbsp;version&nbsp;(v4.13)&nbsp;supports&nbsp;SslBump&lt;/div&gt;&lt;div&gt;&gt;&nbsp;with&nbsp;parent&nbsp;forward&nbsp;proxies,&nbsp;but&nbsp;I&nbsp;believe&nbsp;modern&nbsp;Squids&nbsp;do,&nbsp;and&nbsp;we&nbsp;can&lt;/div&gt;&lt;div&gt;&gt;&nbsp;assume&nbsp;that&nbsp;your&nbsp;Squid&nbsp;version&nbsp;does&nbsp;as&nbsp;well.&nbsp;The&nbsp;debugging&nbsp;should&nbsp;show&lt;/div&gt;&lt;div&gt;&gt;&nbsp;whether&nbsp;that&nbsp;is&nbsp;indeed&nbsp;the&nbsp;case.&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;The&nbsp;parent&nbsp;is&nbsp;doing&nbsp;peek&nbsp;and&nbsp;splice&nbsp;to&nbsp;an&nbsp;exact&nbsp;list&nbsp;of&nbsp;internal&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;destinations.&nbsp;&nbsp;Specifically,&nbsp;peek&nbsp;step1&nbsp;all,&nbsp;peek&nbsp;step2&lt;/div&gt;&lt;div&gt;&gt;&nbsp;allowed_sites,&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;splice&nbsp;allowed_sites,&nbsp;terminate&nbsp;all.&nbsp;&nbsp;That&nbsp;shouldn't&nbsp;(to&nbsp;my&nbsp;imperfect&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;knowledge)&nbsp;interfere&nbsp;with&nbsp;what&nbsp;I'm&nbsp;doing&nbsp;though.&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Yes,&nbsp;assuming&nbsp;the&nbsp;parent&nbsp;does&nbsp;not&nbsp;terminate&nbsp;your&nbsp;Squid&nbsp;connections,&nbsp;of&lt;/div&gt;&lt;div&gt;&gt;&nbsp;course&nbsp;(i.e.&nbsp;assuming&nbsp;connections&nbsp;from&nbsp;your&nbsp;Squid&nbsp;always&nbsp;match&lt;/div&gt;&lt;div&gt;&gt;&nbsp;allowed_sites&nbsp;after&nbsp;step1&nbsp;at&nbsp;the&nbsp;parent&nbsp;proxy).&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;That's&nbsp;a&nbsp;good&nbsp;idea&nbsp;to&nbsp;do&nbsp;splice&nbsp;only&nbsp;and&nbsp;see&nbsp;if&nbsp;that's&nbsp;successful.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;Trying&nbsp;to&nbsp;do&nbsp;too&nbsp;much&nbsp;at&nbsp;once!&nbsp;&nbsp;I'll&nbsp;see&nbsp;what&nbsp;that&nbsp;does,&nbsp;then&nbsp;try&lt;/div&gt;&lt;div&gt;&gt;&nbsp;debug&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;again.&nbsp;&nbsp;The&nbsp;debug&nbsp;output&nbsp;wasn't&nbsp;very&nbsp;helpful&nbsp;before,&nbsp;but&nbsp;stepwise&lt;/div&gt;&lt;div&gt;&gt;&nbsp;may&nbsp;be&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;more&nbsp;useful.&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Just&nbsp;to&nbsp;clarify:&nbsp;The&nbsp;debugging&nbsp;output&nbsp;was&nbsp;not&nbsp;meant&nbsp;for&nbsp;you&nbsp;to&lt;/div&gt;&lt;div&gt;&gt;&nbsp;interpret.&nbsp;A&nbsp;Squid&nbsp;developer&nbsp;should&nbsp;do&nbsp;that.&nbsp;It&nbsp;may&nbsp;contain&nbsp;sensitive&lt;/div&gt;&lt;div&gt;&gt;&nbsp;details;&nbsp;it&nbsp;is&nbsp;best&nbsp;to&nbsp;not&nbsp;use&nbsp;anything&nbsp;but&nbsp;test&nbsp;traffic&nbsp;and&nbsp;test&lt;/div&gt;&lt;div&gt;&gt;&nbsp;certificate&nbsp;keys&nbsp;when&nbsp;sharing&nbsp;ALL,9&nbsp;output.&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Alex.&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;On&nbsp;Mar&nbsp;8&nbsp;2022,&nbsp;at&nbsp;1:43&nbsp;pm,&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;On&nbsp;3/8/22&nbsp;14:16,&nbsp;Aaron&nbsp;Dewell&nbsp;wrote:&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;use&nbsp;these&nbsp;two&nbsp;features&nbsp;at&nbsp;the&nbsp;same&nbsp;time.&nbsp;&nbsp;The&nbsp;use&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;case&nbsp;is&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;pretty&nbsp;simple.&nbsp;&nbsp;I&nbsp;want&nbsp;to&nbsp;capture&nbsp;all&nbsp;traffic&nbsp;from&nbsp;a&nbsp;single&lt;/div&gt;&lt;div&gt;&gt;&nbsp;source&nbsp;(a&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;device&nbsp;of&nbsp;mine)&nbsp;to&nbsp;another&nbsp;squid&nbsp;proxy&nbsp;server&nbsp;and&nbsp;decrypt/log&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;it.&nbsp;&nbsp;&nbsp;&nbsp;I'm&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;using&nbsp;the&nbsp;Ubuntu&nbsp;20&nbsp;package&nbsp;of&nbsp;squid-ssl&nbsp;version&nbsp;4.13.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;Device&nbsp;-&gt;&nbsp;ssl_bump&nbsp;proxy&nbsp;-&gt;&nbsp;upstream&nbsp;proxy&nbsp;-&gt;&nbsp;website&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;It&nbsp;was&nbsp;all&nbsp;successfully&nbsp;working&nbsp;without&nbsp;ssl_bump,&nbsp;so&nbsp;the&nbsp;cache_peer&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;configuration&nbsp;works.&nbsp;&nbsp;One&nbsp;side&nbsp;note:&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;is&nbsp;running&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;on&nbsp;443&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;without&nbsp;SSL&nbsp;(I&nbsp;believe&nbsp;-&nbsp;I&nbsp;don't&nbsp;run&nbsp;it&nbsp;but&nbsp;I've&nbsp;asked&nbsp;those&nbsp;that&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;do&nbsp;for&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;confirmation,&nbsp;but&nbsp;I&nbsp;do&nbsp;know&nbsp;it's&nbsp;a&nbsp;pretty&nbsp;standard&nbsp;destination&lt;/div&gt;&lt;div&gt;&gt;&nbsp;proxy&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;configuration).&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;The&nbsp;website&nbsp;itself&nbsp;is&nbsp;not&nbsp;directly&nbsp;accessible&nbsp;thus&nbsp;the&nbsp;upstream&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;proxy&nbsp;is&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;required.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;Adding&nbsp;the&nbsp;ssl_bump&nbsp;configuration&nbsp;caused&nbsp;it&nbsp;to&nbsp;not&nbsp;work,&nbsp;with&lt;/div&gt;&lt;div&gt;&gt;&nbsp;errors&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;about&nbsp;SSL&nbsp;versions&nbsp;and&nbsp;&quot;Error&nbsp;negotiating&nbsp;SSL&nbsp;connection&nbsp;on&nbsp;FD&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;xx&quot;.&nbsp;&nbsp;My&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;best&nbsp;guess&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;attempting&nbsp;to&nbsp;establish&nbsp;an&nbsp;SSL&lt;/div&gt;&lt;div&gt;&gt;&nbsp;connection&nbsp;to&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;the&nbsp;upstream&nbsp;and&nbsp;failing.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;all&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;http_port&nbsp;3128&nbsp;ssl-bump&nbsp;cert=/var/lib/squid/ssl_cert/myCA.pem&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;tls_outgoing_options&nbsp;options=NO_SSLv3&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;flags=DON'T_VERIFY_PEER,DONT_VERIFY_DOMAIN&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;cert=/var/lib/squid/ssl_cert/device.pem&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;key=/var/lib/squid/ssl_cert/client.key&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;(client.key&nbsp;and&nbsp;client.pem&nbsp;are&nbsp;from&nbsp;the&nbsp;device&nbsp;and&nbsp;are&nbsp;needed&nbsp;due&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;to&nbsp;the&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;authentication&nbsp;of&nbsp;the&nbsp;session&nbsp;at&nbsp;the&nbsp;destination&nbsp;server.&nbsp;&nbsp;Also,&nbsp;I&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;haven't&nbsp;looked&nbsp;at&nbsp;the&nbsp;packet&nbsp;logging&nbsp;yet.&nbsp;I&nbsp;assume&nbsp;that&nbsp;will&nbsp;be&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;an&nbsp;easy&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;addition&nbsp;once&nbsp;the&nbsp;setup&nbsp;works&nbsp;generally.)&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;However,&nbsp;my&nbsp;understanding&nbsp;is&nbsp;that&nbsp;the&nbsp;cache_peer&nbsp;configuration&lt;/div&gt;&lt;div&gt;&gt;&nbsp;should&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;NOT&nbsp;do&nbsp;TLS&nbsp;by&nbsp;default&nbsp;unless&nbsp;that&nbsp;was&nbsp;specified&nbsp;in&nbsp;the&nbsp;options,&lt;/div&gt;&lt;div&gt;&gt;&nbsp;and&nbsp;I&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;see&nbsp;no&nbsp;way&nbsp;to&nbsp;explicitly&nbsp;disable&nbsp;it.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;So&nbsp;first&nbsp;question:&nbsp;is&nbsp;that&nbsp;assumption&nbsp;accurate?&nbsp;&nbsp;No&nbsp;TLS&nbsp;to&nbsp;the&lt;/div&gt;&lt;div&gt;&gt;&nbsp;parent&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;unless&nbsp;explicitly&nbsp;configured?&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;Yes,&nbsp;that&nbsp;is&nbsp;correct:&nbsp;cache_peers&nbsp;are&nbsp;plain&nbsp;HTTP&nbsp;forward&nbsp;proxies&lt;/div&gt;&lt;div&gt;&gt;&nbsp;unless&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;explicitly&nbsp;configured&nbsp;otherwise.&nbsp;Their&nbsp;listening&nbsp;port&nbsp;value&nbsp;does&lt;/div&gt;&lt;div&gt;&gt;&nbsp;carry&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;any&nbsp;special&nbsp;meaning&nbsp;as&nbsp;far&nbsp;as&nbsp;Squid&nbsp;code&nbsp;is&nbsp;concerned.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;However,&nbsp;it&nbsp;is&nbsp;very&nbsp;unusual&nbsp;to&nbsp;run&nbsp;a&nbsp;plain&nbsp;HTTP&nbsp;forward&nbsp;proxy&nbsp;on&nbsp;port&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;443.&nbsp;That&nbsp;port&nbsp;may&nbsp;imply&nbsp;that&nbsp;your&nbsp;parent&nbsp;proxy&nbsp;is&nbsp;an&nbsp;HTTPS&nbsp;reverse&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;proxy.&nbsp;If&nbsp;it&nbsp;is,&nbsp;you&nbsp;need&nbsp;to&nbsp;use&nbsp;originserver&nbsp;flag&nbsp;when&lt;/div&gt;&lt;div&gt;&gt;&nbsp;configuring&nbsp;the&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;corresponding&nbsp;cache_peer&nbsp;line.&nbsp;You&nbsp;can&nbsp;check&nbsp;by&nbsp;sending&nbsp;plain&nbsp;CONNECT&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;requests&nbsp;to&nbsp;that&nbsp;upstream&nbsp;proxy&nbsp;using&nbsp;wget,&nbsp;curl,&nbsp;or&nbsp;some&nbsp;such.&nbsp;A&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;reverse&nbsp;HTTPS&nbsp;proxy&nbsp;would&nbsp;reject&nbsp;such&nbsp;requests.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;if&nbsp;the&nbsp;ssl_bump&nbsp;configuration&nbsp;is&nbsp;causing&nbsp;it&nbsp;to&nbsp;attempt&nbsp;an&nbsp;upstream&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;TLS&nbsp;connection&nbsp;...&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;Bugs&nbsp;notwithstanding,&nbsp;it&nbsp;should&nbsp;not.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;&gt;&nbsp;Anything&nbsp;here&nbsp;that&nbsp;I'm&nbsp;doing&nbsp;obviously&nbsp;wrong?&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;I&nbsp;see&nbsp;no&nbsp;red&nbsp;flags&nbsp;relevant&nbsp;to&nbsp;your&nbsp;specific&nbsp;question.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;Does&nbsp;replacing&nbsp;&quot;bump&nbsp;all&quot;&nbsp;with&nbsp;&quot;splice&nbsp;all&quot;&nbsp;fix&nbsp;the&nbsp;problem?&nbsp;I&lt;/div&gt;&lt;div&gt;&gt;&nbsp;realize&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;that&nbsp;you&nbsp;do&nbsp;want&nbsp;to&nbsp;bump/see&nbsp;the&nbsp;device&nbsp;traffic,&nbsp;but&nbsp;I&nbsp;wonder&nbsp;whether&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;the&nbsp;errors&nbsp;are&nbsp;not&nbsp;between&nbsp;Squid&nbsp;and&nbsp;the&nbsp;upstream&nbsp;proxy&nbsp;but&nbsp;Squid&nbsp;and&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;the&nbsp;web&nbsp;site.&nbsp;Splicing&nbsp;would&nbsp;remove&nbsp;those&nbsp;errors&nbsp;while&nbsp;still&nbsp;keeping&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;some&nbsp;SslBump&nbsp;code&nbsp;active.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;Sharing&nbsp;a&nbsp;(pointer&nbsp;to&nbsp;compressed)&nbsp;libpcap&nbsp;packet&nbsp;capture&nbsp;and/or&nbsp;a&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;(pointer&nbsp;to&nbsp;compressed)&nbsp;ALL,9&nbsp;cache.log&nbsp;while&nbsp;reproducing&nbsp;the&nbsp;problem&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;with&nbsp;a&nbsp;single&nbsp;transaction&nbsp;may&nbsp;help:&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;https://wiki.squid-cache.org/SquidFaq/BugReporting#Debugging_a_single_transaction&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;Alex.&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;_______________________________________________&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;squid-users@lists.squid-cache.org&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;http://lists.squid-cache.org/listinfo/squid-users&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;&gt;&nbsp;Sent&nbsp;from&nbsp;Mailspring&lt;/div&gt;&lt;div&gt;&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;Sent&nbsp;from&nbsp;Mailspring&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;
</tt>
