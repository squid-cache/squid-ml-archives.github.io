<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi,&nbsp;I´m&nbsp;trying&nbsp;to&nbsp;set&nbsp;up&nbsp;squid&nbsp;authentication&nbsp;with&nbsp;a&nbsp;Windows&nbsp;AD&nbsp;domain&nbsp;controller,&nbsp;and&nbsp;everything&nbsp;goes&nbsp;well&nbsp;until&nbsp;I&nbsp;try&nbsp;to&nbsp;check&nbsp;if&nbsp;the&nbsp;host&nbsp;account&nbsp;updates&nbsp;successfully,&nbsp;using&nbsp;the&nbsp;following&nbsp;commands:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;msktutil&nbsp;--auto-update&nbsp;--verbose&nbsp;--dont-expire-password&nbsp;\&lt;/div&gt;-b&nbsp;&quot;CN=SQUIDPROXY,OU=OU_NAME,,DC=MYDOMAIN,DC=XX&quot;&nbsp;\&lt;br&gt;--user-creds-only&nbsp;\&lt;br&gt;--computer-name&nbsp;SQUIDPROXY&nbsp;\&lt;br&gt;-k&nbsp;/etc/squid/squidproxy.keytab&nbsp;\&lt;br&gt;--server&nbsp;pdc1.mydomain.xx&nbsp;\&lt;br&gt;&lt;div&gt;--no-reverse-lookups&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;and&nbsp;I&nbsp;always&nbsp;end&nbsp;up&nbsp;with&nbsp;the&nbsp;same&nbsp;error:&lt;/div&gt;&lt;div&gt; --&nbsp;init_password:&nbsp;Wiping&nbsp;the&nbsp;computer&nbsp;password&nbsp;structure&lt;br&gt; --&nbsp;generate_new_password:&nbsp;Generating&nbsp;a&nbsp;new,&nbsp;random&nbsp;password&nbsp;for&nbsp;the&nbsp;computer&nbsp;account&lt;br&gt; --&nbsp;generate_new_password:&nbsp; Characters&nbsp;read&nbsp;from&nbsp;/dev/urandom&nbsp;=&nbsp;93&lt;br&gt; --&nbsp;create_fake_krb5_conf:&nbsp;Created&nbsp;a&nbsp;fake&nbsp;krb5.conf&nbsp;file:&nbsp;/tmp/.msktkrb5.conf-atrIYH&lt;br&gt; --&nbsp;destroy_g_context:&nbsp;Destroying&nbsp;Kerberos&nbsp;Context&lt;br&gt; --&nbsp;initialize_g_context:&nbsp;Creating&nbsp;Kerberos&nbsp;Context&lt;br&gt; --&nbsp;finalize_exec:&nbsp;SAM&nbsp;Account&nbsp;Name&nbsp;is:&nbsp;SQUIDPROXY$&lt;br&gt; --&nbsp;try_user_creds:&nbsp;Checking&nbsp;if&nbsp;default&nbsp;ticket&nbsp;cache&nbsp;has&nbsp;tickets&lt;br&gt; --&nbsp;finalize_exec:&nbsp;Authenticated&nbsp;using&nbsp;method&nbsp;5&lt;br&gt; --&nbsp;LDAPConnection:&nbsp;Connecting&nbsp;to&nbsp;LDAP&nbsp;server:&nbsp;&lt;a&nbsp;href=&quot;http://dc1.cip.cu&quot;&gt;dc1.cip.cu&lt;/a&gt;&lt;br&gt;SASL/GSSAPI&nbsp;authentication&nbsp;started&lt;br&gt;SASL&nbsp;username:&nbsp;HTTP/squidproxy.mydomain.xx@MYDOMAIN.XX&lt;br&gt;SASL&nbsp;SSF:&nbsp;256&lt;br&gt;SASL&nbsp;data&nbsp;security&nbsp;layer&nbsp;installed.&lt;br&gt; --&nbsp;ldap_get_base_dn:&nbsp;Determining&nbsp;default&nbsp;LDAP&nbsp;base:&nbsp;dc=MYDOMAIN,dc=XX&lt;br&gt; --&nbsp;ldap_check_account:&nbsp;Checking&nbsp;that&nbsp;a&nbsp;computer&nbsp;account&nbsp;for&nbsp;SQUIDPROXY$&nbsp;exists&lt;br&gt; --&nbsp;ldap_check_account:&nbsp;Checking&nbsp;computer&nbsp;account&nbsp;-&nbsp;found&lt;br&gt; --&nbsp;ldap_check_account:&nbsp;Found&nbsp;userAccountControl&nbsp;=&nbsp;0x11000&lt;br&gt; --&nbsp;ldap_check_account:&nbsp;Found&nbsp;supportedEncryptionTypes&nbsp;=&nbsp;28&lt;br&gt; --&nbsp;ldap_check_account:&nbsp;Found&nbsp;dNSHostName&nbsp;=&nbsp;squidproxy.mydomain.xx<br>
<br>
&lt;br&gt; --&nbsp;ldap_check_account:&nbsp;Found&nbsp;Principal:&nbsp;host/squidproxy.mydomain.xx<br>
<br>
&lt;br&gt; --&nbsp;ldap_check_account:&nbsp;Found&nbsp;Principal:&nbsp;HTTP/squidproxy.mydomain.xx<br>
<br>
&lt;br&gt; --&nbsp;ldap_check_account:&nbsp;Found&nbsp;User&nbsp;Principal:&nbsp;HTTP/squidproxy.mydomain.xx<br>
<br>
&lt;br&gt; --&nbsp;ldap_check_account_strings:&nbsp;Inspecting&nbsp;(and&nbsp;updating)&nbsp;computer&nbsp;account&nbsp;attributes&lt;br&gt; --&nbsp;ldap_set_supportedEncryptionTypes:&nbsp;No&nbsp;need&nbsp;to&nbsp;change&nbsp;msDs-supportedEncryptionTypes&nbsp;they&nbsp;are&nbsp;28&lt;br&gt; --&nbsp;ldap_set_userAccountControl_flag:&nbsp;Setting&nbsp;userAccountControl&nbsp;bit&nbsp;at&nbsp;0x200000&nbsp;to&nbsp;0x0&lt;br&gt; --&nbsp;ldap_set_userAccountControl_flag:&nbsp;userAccountControl&nbsp;not&nbsp;changed&nbsp;0x11000&lt;br&gt; --&nbsp;ldap_set_userAccountControl_flag:&nbsp;Setting&nbsp;userAccountControl&nbsp;bit&nbsp;at&nbsp;0x10000&nbsp;to&nbsp;0x1&lt;br&gt; --&nbsp;ldap_set_userAccountControl_flag:&nbsp;userAccountControl&nbsp;not&nbsp;changed&nbsp;0x11000&lt;br&gt; --&nbsp;ldap_get_kvno:&nbsp;KVNO&nbsp;is&nbsp;1&lt;br&gt; --&nbsp;set_password:&nbsp;Attempting&nbsp;to&nbsp;reset&nbsp;computer&#39;s&nbsp;password&lt;br&gt; --&nbsp;set_password:&nbsp;Try&nbsp;change&nbsp;password&nbsp;using&nbsp;user&#39;s&nbsp;ticket&nbsp;cache&lt;br&gt; --&nbsp;ldap_get_pwdLastSet:&nbsp;pwdLastSet&nbsp;is&nbsp;132929651811891069&lt;br&gt;Error:&nbsp;Unable&nbsp;to&nbsp;set&nbsp;machine&nbsp;password&nbsp;for&nbsp;SQUIDPROXY$:&nbsp;(5)&nbsp;Access&nbsp;denied&lt;br&gt;Error:&nbsp;set_password&nbsp;failed&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;account&nbsp;I&#39;m&nbsp;using&nbsp;for&nbsp;this&nbsp;procedure&nbsp;is&nbsp;the&nbsp;domain&nbsp;administrator&nbsp;account,&nbsp;so&nbsp;I&nbsp;don´t&nbsp;know&nbsp;why&nbsp;is&nbsp;giving&nbsp;me&nbsp;an&nbsp;access&nbsp;denied&nbsp;error.&nbsp;This&nbsp;is&nbsp;the&nbsp;procedure&nbsp;I´m&nbsp;using:&lt;/div&gt;&lt;div&gt;1&nbsp;-&nbsp;start&nbsp;the&nbsp;session&nbsp;using&nbsp;the&nbsp;domain&nbsp;controller&nbsp;account&nbsp;&lt;kinit&nbsp;manager@MYDOMAIN.XX&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2&nbsp;-&nbsp;created&nbsp;the&nbsp;ticket&nbsp;and&nbsp;host&nbsp;account&nbsp;in&nbsp;the&nbsp;domain&nbsp;controller,&nbsp;and&nbsp;everytihng&nbsp;went&nbsp;well&lt;br&gt;&lt;/div&gt;&lt;div&gt;msktutil&nbsp;-c&nbsp;-b&nbsp;&quot;OU=OU_NAME&quot;&nbsp;\&lt;br&gt;-s&nbsp;HTTP/squidproxy.mydomain.xx<br>
<br>
&nbsp;\&lt;br&gt;-h&nbsp;squidproxy.mydomain.xx<br>
<br>
&nbsp;\&lt;br&gt;-k&nbsp;/etc/squid/squidproxy.keytab&nbsp;\&lt;br&gt;--computer-name&nbsp;SQUIDPROXY&nbsp;\&lt;br&gt;--upn&nbsp;HTTP/squidproxy.mydomain.xx<br>
<br>
&nbsp;\&lt;br&gt;--server&nbsp;pdc1.mydomain.xx<br>
<br>
&nbsp;\&lt;br&gt;--verbose&nbsp;\&lt;br&gt;--dont-expire-password&nbsp;\&lt;br&gt;--no-reverse-lookups&nbsp;\&lt;/div&gt;&lt;div&gt;<br>
&lt;div&nbsp;class=&quot;gmail-crayon-line&quot;&nbsp;id=&quot;gmail-urvanov-syntax-highlighter-623ca42d06d74317003577-11&quot;&gt;&lt;span&nbsp;class=&quot;gmail-crayon-o&quot;&gt;--&lt;/span&gt;&lt;span&nbsp;class=&quot;gmail-crayon-i&quot;&gt;enctypes&lt;/span&gt;&lt;span&nbsp;class=&quot;gmail-crayon-h&quot;&gt;&nbsp;&lt;/span&gt;&lt;span&nbsp;class=&quot;gmail-crayon-cn&quot;&gt;28&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-crayon-line&quot;&gt;&lt;span&nbsp;class=&quot;gmail-crayon-cn&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;3&nbsp;-&nbsp;checked&nbsp;if&nbsp;the&nbsp;previous&nbsp;procedure&nbsp;went&nbsp;well&nbsp;by&nbsp;typing&nbsp;the&nbsp;following&nbsp;and&nbsp;it&nbsp;returns&nbsp;nothing&nbsp;as&nbsp;it&nbsp;should&lt;br&gt;&lt;/div&gt;&lt;div&gt;kinit&nbsp;-k&nbsp;HTTP/squidproxy.mydomain.xx&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4&nbsp;-&nbsp;Checked&nbsp;the&nbsp;keytab&nbsp;with&nbsp;klist&nbsp;-k&nbsp;and&nbsp;then&nbsp;changed&nbsp;the&nbsp;permissions&nbsp;and&nbsp;owner&nbsp;to&nbsp;the&nbsp;keytab&nbsp;file&nbsp;(640&nbsp;/&nbsp;proxy:proxy)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Then&nbsp;the&nbsp;error&nbsp;when&nbsp;I&nbsp;try&nbsp;to&nbsp;check&nbsp;if&nbsp;the&nbsp;host&nbsp;account&nbsp;updates&nbsp;succesfuly&nbsp;as&nbsp;explained&nbsp;at&nbsp;the&nbsp;begining,&nbsp;any&nbsp;ideas&nbsp;why&nbsp;this&nbsp;is&nbsp;happening?&nbsp;I&nbsp;would&nbsp;appreciate&nbsp;the&nbsp;help!!&lt;br&gt;<br>
<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
