<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;Trying&nbsp;to&nbsp;set&nbsp;up&nbsp;a&nbsp;non-transparent&nbsp;forward&nbsp;proxy&nbsp;with&nbsp;TLS,&lt;br&gt;using&nbsp;squid&nbsp;4.10-1ubuntu1.5&nbsp;(ubuntu&nbsp;20.04)&lt;br&gt;config&nbsp;line&lt;br&gt;`https_port&nbsp;12345&nbsp;tls-cert=/etc/letsencrypt/.../fullchain.pem&nbsp;tls-key=/etc/letsencrypt/.../privkey.pem`&lt;br&gt;When&nbsp;establishing&nbsp;a&nbsp;TLS&nbsp;connection&nbsp;to&nbsp;that&nbsp;port,&nbsp;squid&nbsp;seems&nbsp;to&nbsp;return&nbsp;only&nbsp;the&nbsp;domain&nbsp;certificate&nbsp;from&nbsp;the&nbsp;certificate&nbsp;chain:&lt;br&gt;&lt;br&gt;$&nbsp;openssl&nbsp;s_client&nbsp;-showcerts&nbsp;-connect&nbsp;hostname:12345&nbsp;|&nbsp;grep&nbsp;-v&nbsp;&#39;^[A-Za-z0-9]&#39;&lt;br&gt;depth=0&nbsp;CN&nbsp;=&nbsp;...&lt;br&gt;verify&nbsp;error:num=20:unable&nbsp;to&nbsp;get&nbsp;local&nbsp;issuer&nbsp;certificate&lt;br&gt;verify&nbsp;return:1&lt;br&gt;depth=0&nbsp;CN&nbsp;=&nbsp;...&lt;br&gt;verify&nbsp;error:num=21:unable&nbsp;to&nbsp;verify&nbsp;the&nbsp;first&nbsp;certificate&lt;br&gt;verify&nbsp;return:1&lt;br&gt;---&lt;br&gt;0&nbsp;s:CN&nbsp;=&nbsp;...&lt;br&gt; &nbsp;i:C&nbsp;=&nbsp;US,&nbsp;O&nbsp;=&nbsp;Let&#39;s&nbsp;Encrypt,&nbsp;CN&nbsp;=&nbsp;R3&lt;br&gt;-----BEGIN&nbsp;CERTIFICATE-----&lt;br&gt;-----END&nbsp;CERTIFICATE-----&lt;br&gt;&lt;br&gt;While&nbsp;nginx,&nbsp;using&nbsp;the&nbsp;same&nbsp;pair&nbsp;of&nbsp;files,&nbsp;works&nbsp;correctly:&lt;br&gt;&lt;br&gt;$&nbsp;openssl&nbsp;s_client&nbsp;-showcerts&nbsp;-connect&nbsp;hostname:443&nbsp;|&nbsp;grep&nbsp;-v&nbsp;&#39;^[A-Za-z0-9]&#39;&nbsp; &nbsp;&lt;br&gt;depth=2&nbsp;C&nbsp;=&nbsp;US,&nbsp;O&nbsp;=&nbsp;Internet&nbsp;Security&nbsp;Research&nbsp;Group,&nbsp;CN&nbsp;=&nbsp;ISRG&nbsp;Root&nbsp;X1&lt;br&gt;verify&nbsp;return:1&lt;br&gt;depth=1&nbsp;C&nbsp;=&nbsp;US,&nbsp;O&nbsp;=&nbsp;Let&#39;s&nbsp;Encrypt,&nbsp;CN&nbsp;=&nbsp;R3&lt;br&gt;verify&nbsp;return:1&lt;br&gt;depth=0&nbsp;CN&nbsp;=&nbsp;...&lt;br&gt;verify&nbsp;return:1&lt;br&gt;---&lt;br&gt;0&nbsp;s:CN&nbsp;=&nbsp;...&lt;br&gt; &nbsp;i:C&nbsp;=&nbsp;US,&nbsp;O&nbsp;=&nbsp;Let&#39;s&nbsp;Encrypt,&nbsp;CN&nbsp;=&nbsp;R3&lt;br&gt;-----BEGIN&nbsp;CERTIFICATE-----&lt;br&gt;-----END&nbsp;CERTIFICATE-----&lt;br&gt;1&nbsp;s:C&nbsp;=&nbsp;US,&nbsp;O&nbsp;=&nbsp;Let&#39;s&nbsp;Encrypt,&nbsp;CN&nbsp;=&nbsp;R3&lt;br&gt; &nbsp;i:C&nbsp;=&nbsp;US,&nbsp;O&nbsp;=&nbsp;Internet&nbsp;Security&nbsp;Research&nbsp;Group,&nbsp;CN&nbsp;=&nbsp;ISRG&nbsp;Root&nbsp;X1&lt;br&gt;-----BEGIN&nbsp;CERTIFICATE-----&lt;br&gt;-----END&nbsp;CERTIFICATE-----&lt;br&gt;2&nbsp;s:C&nbsp;=&nbsp;US,&nbsp;O&nbsp;=&nbsp;Internet&nbsp;Security&nbsp;Research&nbsp;Group,&nbsp;CN&nbsp;=&nbsp;ISRG&nbsp;Root&nbsp;X1&lt;br&gt; &nbsp;i:O&nbsp;=&nbsp;Digital&nbsp;Signature&nbsp;Trust&nbsp;Co.,&nbsp;CN&nbsp;=&nbsp;DST&nbsp;Root&nbsp;CA&nbsp;X3&lt;br&gt;-----BEGIN&nbsp;CERTIFICATE-----&lt;br&gt;-----END&nbsp;CERTIFICATE-----&lt;br&gt;&lt;br&gt;Am&nbsp;I&nbsp;missing&nbsp;some&nbsp;configuration&nbsp;option,&nbsp;or&nbsp;is&nbsp;this&nbsp;a&nbsp;squid4&nbsp;bug?&lt;/span&gt;&lt;/div&gt;<br>

</tt>
