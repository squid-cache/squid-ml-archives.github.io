<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;I&nbsp;have&nbsp;squid&nbsp;5.3&nbsp;running&nbsp;on&nbsp;amazon&nbsp;linux&nbsp;2&nbsp;and&nbsp;it&nbsp;was&nbsp;running&nbsp;fine&nbsp;for&nbsp;some&nbsp;weeks&nbsp;until&nbsp;it&nbsp;suddenly&nbsp;stopped&nbsp;working&nbsp;yesterday&nbsp;on&nbsp;our&nbsp;production&nbsp;server&nbsp;and&nbsp;caused&nbsp;outage.&nbsp;I&nbsp;have&nbsp;set&nbsp;it&nbsp;to&nbsp;auto-restart&nbsp;for&nbsp;now.&nbsp;But&nbsp;if&nbsp;someone&nbsp;could&nbsp;review&nbsp;my&nbsp;squid.conf&nbsp;file&nbsp;and&nbsp;see&nbsp;if&nbsp;there&nbsp;is&nbsp;something&nbsp;wrong?&lt;br&gt;&lt;/div&gt;This&nbsp;is&nbsp;the&nbsp;error&nbsp;I&nbsp;saw&lt;br&gt;===&lt;br&gt;2022/04/06&nbsp;00:45:31|&nbsp;FATAL:&nbsp;xcalloc:&nbsp;Unable&nbsp;to&nbsp;allocate&nbsp;1&nbsp;blocks&nbsp;of&nbsp;68431&nbsp;bytes!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;current&nbsp;master&nbsp;transaction:&nbsp;master27687315&lt;br&gt;<br>
2022/04/06&nbsp;00:45:31|&nbsp;Squid&nbsp;Cache&nbsp;(Version&nbsp;5.3):&nbsp;Terminated&nbsp;abnormally.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;current&nbsp;master&nbsp;transaction:&nbsp;master27687315&lt;br&gt;===&lt;br&gt;&lt;/div&gt;&lt;div&gt;squid.conf&lt;/div&gt;&lt;div&gt;---&lt;br&gt;[ec2-user@ip-172-24-9-143&nbsp;~]$&nbsp;sudo&nbsp;cat&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;#&lt;br&gt;#&nbsp;Recommended&nbsp;minimum&nbsp;configuration:&lt;br&gt;#&lt;br&gt;&lt;br&gt;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;br&gt;#&nbsp;Adapt&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&nbsp;from&nbsp;where&nbsp;browsing&lt;br&gt;#&nbsp;should&nbsp;be&nbsp;allowed&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;0.0.0.1-0.255.255.255&nbsp;&nbsp;#&nbsp;RFC&nbsp;1122&nbsp;&quot;this&quot;&nbsp;network&nbsp;(LAN)&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&gt;10.0.0.0/8&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;1918&nbsp;local&nbsp;private&nbsp;network&nbsp;(LAN)&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://100.64.0.0/10&quot;&gt;100.64.0.0/10&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;6598&nbsp;shared&nbsp;address&nbsp;space&nbsp;(CGN)&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://169.254.0.0/16&quot;&gt;169.254.0.0/16&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;3927&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://172.16.0.0/12&quot;&gt;172.16.0.0/12&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;1918&nbsp;local&nbsp;private&nbsp;network&nbsp;(LAN)&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/16&quot;&gt;192.168.0.0/16&lt;/a&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;1918&nbsp;local&nbsp;private&nbsp;network&nbsp;(LAN)&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ftp&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;https&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gopher&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;wais&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http-mgmt&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gss-http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;filemaker&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;&lt;br&gt;server_idle_pconn_timeout&nbsp;60&nbsp;minute&lt;br&gt;connect_timeout&nbsp;60&nbsp;minute&lt;br&gt;read_timeout&nbsp;60&nbsp;minute&lt;br&gt;write_timeout&nbsp;60&nbsp;minute&lt;br&gt;request_timeout&nbsp;60&nbsp;minute&lt;br&gt;&lt;br&gt;#&lt;br&gt;#&nbsp;Recommended&nbsp;minimum&nbsp;Access&nbsp;Permission&nbsp;configuration:&lt;br&gt;#&lt;br&gt;#&nbsp;Deny&nbsp;requests&nbsp;to&nbsp;certain&nbsp;unsafe&nbsp;ports&lt;br&gt;http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;&lt;br&gt;#&nbsp;Deny&nbsp;CONNECT&nbsp;to&nbsp;other&nbsp;than&nbsp;secure&nbsp;SSL&nbsp;ports&lt;br&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;&lt;br&gt;#&nbsp;Only&nbsp;allow&nbsp;cachemgr&nbsp;access&nbsp;from&nbsp;localhost&lt;br&gt;#http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;&lt;br&gt;#&nbsp;We&nbsp;strongly&nbsp;recommend&nbsp;the&nbsp;following&nbsp;be&nbsp;uncommented&nbsp;to&nbsp;protect&nbsp;innocent&lt;br&gt;#&nbsp;web&nbsp;applications&nbsp;running&nbsp;on&nbsp;the&nbsp;proxy&nbsp;server&nbsp;who&nbsp;think&nbsp;the&nbsp;only&lt;br&gt;#&nbsp;one&nbsp;who&nbsp;can&nbsp;access&nbsp;services&nbsp;on&nbsp;&quot;localhost&quot;&nbsp;is&nbsp;a&nbsp;local&nbsp;user&lt;br&gt;#http_access&nbsp;deny&nbsp;to_localhost&lt;br&gt;&lt;br&gt;#&lt;br&gt;#&nbsp;INSERT&nbsp;YOUR&nbsp;OWN&nbsp;RULE(S)&nbsp;HERE&nbsp;TO&nbsp;ALLOW&nbsp;ACCESS&nbsp;FROM&nbsp;YOUR&nbsp;CLIENTS&lt;br&gt;#&lt;br&gt;&lt;br&gt;#&nbsp;Filter&nbsp;HTTPS&nbsp;requests&nbsp;based&nbsp;on&nbsp;the&nbsp;whitelist&nbsp;&lt;br&gt;acl&nbsp;allowed_https_sites&nbsp;ssl::server_name&nbsp;.&lt;a&nbsp;href=&quot;http://pypi.org&quot;&gt;pypi.org&lt;/a&gt;&nbsp;.&lt;a&nbsp;href=&quot;http://pythonhosted.org&quot;&gt;pythonhosted.org&lt;/a&gt;&nbsp;.&lt;a&nbsp;href=&quot;http://tfhub.dev&quot;&gt;tfhub.dev&lt;/a&gt;&nbsp;.&lt;a&nbsp;href=&quot;http://gstatic.com&quot;&gt;gstatic.com&lt;/a&gt;&nbsp;.&lt;a&nbsp;href=&quot;http://googleapis.com&quot;&gt;googleapis.com&lt;/a&gt;&lt;br&gt;acl&nbsp;allowed_https_sites&nbsp;ssl::server_name&nbsp;.&lt;a&nbsp;href=&quot;http://veevasourcedev.com&quot;&gt;veevasourcedev.com&lt;/a&gt;&nbsp;.&lt;a&nbsp;href=&quot;http://veevasource.com&quot;&gt;veevasource.com&lt;/a&gt;&nbsp;.&lt;a&nbsp;href=&quot;http://google.com&quot;&gt;google.com&lt;/a&gt;&lt;br&gt;acl&nbsp;allowed_https_sites&nbsp;ssl::server_name&nbsp;.&lt;a&nbsp;href=&quot;http://amazonaws.com&quot;&gt;amazonaws.com&lt;/a&gt;&lt;br&gt;&lt;br&gt;#&nbsp;Example&nbsp;rule&nbsp;allowing&nbsp;access&nbsp;from&nbsp;your&nbsp;local&nbsp;networks.&lt;br&gt;#&nbsp;Adapt&nbsp;localnet&nbsp;in&nbsp;the&nbsp;ACL&nbsp;section&nbsp;to&nbsp;list&nbsp;your&nbsp;(internal)&nbsp;IP&nbsp;networks&lt;br&gt;#&nbsp;from&nbsp;where&nbsp;browsing&nbsp;should&nbsp;be&nbsp;allowed&lt;br&gt;#http_access&nbsp;allow&nbsp;localnet&lt;br&gt;#http_access&nbsp;allow&nbsp;localhost&lt;br&gt;&lt;br&gt;#&nbsp;And&nbsp;finally&nbsp;deny&nbsp;all&nbsp;other&nbsp;access&nbsp;to&nbsp;this&nbsp;proxy&lt;br&gt;#http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;br&gt;http_port&nbsp;3128&lt;br&gt;https_port&nbsp;3130&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/usr/local/squid/ssl_cert/myCA.pem&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=256MB&lt;br&gt;http_access&nbsp;allow&nbsp;SSL_ports&lt;br&gt;sslcrtd_program&nbsp;/usr/local/squid/libexec/security_file_certgen&nbsp;-s&nbsp;/usr/local/squid/var/lib/ssl_db&nbsp;-M&nbsp;256MB&lt;br&gt;#sslcrtd_children&nbsp;3&nbsp;startup=1&nbsp;idle=1&lt;br&gt;#tls_outgoing_options&nbsp;options=NO_SSLv3&lt;br&gt;&lt;br&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;br&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;br&gt;##ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&nbsp;&lt;br&gt;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;ssl_bump&nbsp;peek&nbsp;step2&nbsp;allowed_https_sites&lt;br&gt;##ssl_bump&nbsp;splice&nbsp;step3&nbsp;allowed_https_sites&lt;br&gt;ssl_bump&nbsp;splice&nbsp;step3&nbsp;allowed_https_sites&lt;br&gt;#ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;ssl_bump&nbsp;terminate&nbsp;step2&nbsp;all&lt;br&gt;#ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;#http_access&nbsp;allow&nbsp;allowed_https_sites&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;#&nbsp;Uncomment&nbsp;and&nbsp;adjust&nbsp;the&nbsp;following&nbsp;to&nbsp;add&nbsp;a&nbsp;disk&nbsp;cache&nbsp;directory.&lt;br&gt;#cache_dir&nbsp;ufs&nbsp;/usr/local/squid/var/cache/squid&nbsp;100&nbsp;16&nbsp;256&lt;br&gt;&lt;br&gt;#&nbsp;Leave&nbsp;coredumps&nbsp;in&nbsp;the&nbsp;first&nbsp;cache&nbsp;dir&lt;br&gt;coredump_dir&nbsp;/usr/local/squid/var/cache/squid&lt;br&gt;&lt;br&gt;#&lt;br&gt;#&nbsp;Add&nbsp;any&nbsp;of&nbsp;your&nbsp;own&nbsp;refresh_pattern&nbsp;entries&nbsp;above&nbsp;these.&lt;br&gt;#&lt;br&gt;refresh_pattern&nbsp;^ftp:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10080&lt;br&gt;refresh_pattern&nbsp;^gopher:&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;br&gt;refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4320&lt;br&gt;&lt;br&gt;logformat&nbsp;custom&nbsp; %tg&nbsp;rep_time==%1tr&nbsp;%&gt;a&nbsp;%Ss/%03&gt;Hs&nbsp;%&lt;st&nbsp;%[un&nbsp;%Sh/%&lt;a&nbsp;%mt&nbsp;--&nbsp;%ssl::bump_mode&nbsp;%ssl::&gt;sni&nbsp;server==&gt;&nbsp;%ssl::&lt;cert_subject&nbsp;err=%ssl::&lt;cert_errors&nbsp;%ssl::&lt;negotiated_version&nbsp;%ssl::&lt;received_supported_version&nbsp;%ssl::&lt;received_hello_version&nbsp;%ssl::&lt;negotiated_version&nbsp;&lt;br&gt;access_log&nbsp; /usr/local/squid/var/logs/access.log&nbsp;custom&lt;br&gt;debug_options&nbsp;ALL,&nbsp;2,&nbsp;rotate=1&lt;br&gt;forwarded_for&nbsp;delete&lt;br&gt;via&nbsp;off&lt;/div&gt;&lt;/div&gt;<br>

</tt>
