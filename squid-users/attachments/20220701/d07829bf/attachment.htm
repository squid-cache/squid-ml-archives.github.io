<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&nbsp;class=&quot;elementToProof&quot;&gt;<br>
&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12pt;&quot;&gt;Hello,&lt;/span&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
I'm&nbsp;facing&nbsp;to&nbsp;issue&nbsp;with&nbsp;squid&nbsp;:&nbsp;i&nbsp;want&nbsp;to&nbsp;use&nbsp;squid&nbsp;to&nbsp;route&nbsp;http&nbsp;traffic&nbsp;though&nbsp;the&nbsp;fastest&nbsp;path&nbsp;(&nbsp;based&nbsp;on&nbsp;RTT&nbsp;).&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;span&nbsp;style=&quot;color:rgb(0,0,0);&nbsp;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt&quot;&gt;Before&nbsp;to&nbsp;explain&nbsp;my&nbsp;problem,&nbsp;this&nbsp;is&nbsp;my&nbsp;configuration&nbsp;where&nbsp;:&lt;/span&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;b&gt;client&lt;/b&gt;&nbsp;is&nbsp;a&nbsp;http&nbsp;client&nbsp;:&nbsp;curl,&nbsp;wget,&nbsp;firefox,&nbsp;...&lt;/li&gt;&lt;li&gt;&lt;b&gt;squid&lt;/b&gt;&nbsp;is&nbsp;a&nbsp;squid&nbsp;instance&nbsp;with&nbsp;&lt;i&gt;never_direct&nbsp;allow&nbsp;all&lt;/i&gt;&nbsp;option&nbsp;to&nbsp;prevent&nbsp;direct&nbsp;access&nbsp;but&nbsp;with&nbsp;&lt;b&gt;squid&nbsp;a&lt;/b&gt;&nbsp;and<br>
&lt;b&gt;squid&nbsp;b&lt;/b&gt;&nbsp;as&nbsp;parents&nbsp;peers&nbsp;and&nbsp;&lt;i&gt;query_icmp&lt;/i&gt;&nbsp;&lt;i&gt;on&lt;/i&gt;&nbsp;option&lt;/li&gt;&lt;li&gt;&lt;b&gt;squid&nbsp;a&lt;/b&gt;&nbsp;and&nbsp;&lt;b&gt;squid&nbsp;b&lt;/b&gt;&nbsp;are&nbsp;squid&nbsp;instances&nbsp;that&nbsp;can&nbsp;make&nbsp;direct&nbsp;connections&lt;/li&gt;&lt;li&gt;all&nbsp;&lt;b&gt;squid&nbsp;&lt;/b&gt;instances&nbsp;are&nbsp;cacheless&nbsp;and&nbsp;built&nbsp;with&nbsp;&lt;i&gt;--enable-icmp&lt;/i&gt;&lt;/li&gt;&lt;/ul&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;img&nbsp;size=&quot;27112&quot;&nbsp;class=&quot;x_w-320&nbsp;x_h-465&quot;&nbsp;width=&quot;183&quot;&nbsp;height=&quot;266&quot;&nbsp;style=&quot;width:183.054px;&nbsp;height:266px;&nbsp;max-width:initial&quot;&nbsp;data-outlook-trace=&quot;F:2|T:2&quot;&nbsp;src=&quot;cid:d09aa68c-f986-4341-9d45-52c2a7a7a2d9&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
Now,&nbsp;come&nbsp;issues.&nbsp;When&nbsp;&lt;b&gt;squid&lt;/b&gt;&nbsp;send&nbsp;a&nbsp;request&nbsp;to&nbsp;&lt;b&gt;squid&nbsp;a&lt;/b&gt;&nbsp;or&nbsp;&lt;b&gt;squid&nbsp;b&lt;/b&gt;,&nbsp;two&nbsp;ICP&nbsp;packets&nbsp;are&nbsp;sent&nbsp;(&nbsp;to<br>
&lt;b&gt;squid&nbsp;a&lt;/b&gt;&nbsp;and&nbsp;&lt;b&gt;squid&nbsp;b&lt;/b&gt;&nbsp;)&nbsp;and&nbsp;the&nbsp;squid&nbsp;which&nbsp;do&nbsp;the&nbsp;direct&nbsp;connection&nbsp;send&nbsp;an&nbsp;icmp&nbsp;to&nbsp;origin&nbsp;server&nbsp;and&nbsp;squid&nbsp;instances&nbsp;update&nbsp;their&nbsp;netdb&nbsp;informations&nbsp;(<br>
&lt;b&gt;squid&nbsp;a&lt;/b&gt;&nbsp;or&nbsp;&lt;b&gt;squid&nbsp;b&lt;/b&gt;&nbsp;&quot;locally&quot;&nbsp;from&nbsp;icmp&nbsp;answer&nbsp;and&nbsp;&lt;b&gt;squid&lt;/b&gt;&nbsp;though&nbsp;ICP&nbsp;).&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
If&nbsp;&lt;b&gt;link&nbsp;a&lt;/b&gt;&nbsp;slows&nbsp;down,&nbsp;the&nbsp;RTT&nbsp;will&nbsp;increase&nbsp;and&nbsp;&lt;b&gt;squid&lt;/b&gt;&nbsp;will&nbsp;send&nbsp;all&nbsp;requests&nbsp;to<br>
&lt;b&gt;squid&nbsp;b&lt;/b&gt;&nbsp;because&nbsp;his&nbsp;RTT&nbsp;is&nbsp;low.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
But,&nbsp;if&nbsp;&lt;b&gt;link&nbsp;a&lt;/b&gt;&nbsp;come&nbsp;back&nbsp;and&nbsp;with&nbsp;a&nbsp;lower&nbsp;RTT&nbsp;than&nbsp;&lt;b&gt;squid&nbsp;b&lt;/b&gt;,&nbsp;&lt;b&gt;squid&nbsp;a&lt;/b&gt;&nbsp;will&nbsp;never&nbsp;know&nbsp;because&nbsp;no&nbsp;requests&nbsp;are&nbsp;made&nbsp;to&nbsp;him&nbsp;until&nbsp;RTT&nbsp;on&nbsp;&lt;b&gt;squid&nbsp;b&lt;/b&gt;&nbsp;goes&nbsp;up&nbsp;(&nbsp;upper&nbsp;than&nbsp;the&nbsp;&quot;uppest&quot;&nbsp;/&nbsp;&quot;oldest&quot;&nbsp;RTT&nbsp;of<br>
&lt;b&gt;squid&nbsp;a&lt;/b&gt;&nbsp;).&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
How&nbsp;to&nbsp;deal&nbsp;with&nbsp;this&nbsp;scenario&nbsp;?&nbsp;Maybe&nbsp;my&nbsp;approach&nbsp;is&nbsp;bad&nbsp;or&nbsp;even&nbsp;worst,&nbsp;it's&nbsp;not&nbsp;possible&nbsp;with&nbsp;squid&nbsp;?&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
I&nbsp;can&nbsp;curl&nbsp;regulary&nbsp;on&nbsp;&lt;b&gt;squid&nbsp;a&lt;/b&gt;&nbsp;and&nbsp;&lt;b&gt;squid&nbsp;b&lt;/b&gt;&nbsp;to&nbsp;keep&nbsp;RTT&nbsp;up&nbsp;to&nbsp;date&nbsp;but&nbsp;this&nbsp;solution&nbsp;is&nbsp;more&nbsp;a&nbsp;workaround&nbsp;from&nbsp;my&nbsp;point&nbsp;of&nbsp;view&nbsp;than&nbsp;a&nbsp;good&nbsp;solution.&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
I&nbsp;can&nbsp;also&nbsp;restart&nbsp;&lt;b&gt;squid&nbsp;a&lt;/b&gt;&nbsp;and&nbsp;&lt;b&gt;squid&nbsp;b&lt;/b&gt;&nbsp;every&nbsp;5&nbsp;minutes&nbsp;for&nbsp;example&nbsp;to&nbsp;flush&nbsp;netdb&nbsp;informations&nbsp;but&nbsp;same&nbsp;things&nbsp;as&nbsp;above,&nbsp;not&nbsp;a&nbsp;good&nbsp;solution.&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
Waiting&nbsp;to&nbsp;read&nbsp;you,&nbsp;i&nbsp;hope&nbsp;you&nbsp;have&nbsp;a&nbsp;solution&nbsp;for&nbsp;my&nbsp;case,&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;x_elementToProof&nbsp;elementToProof&quot;&nbsp;style=&quot;font-family:Calibri,Arial,Helvetica,sans-serif;&nbsp;font-size:12pt;&nbsp;color:rgb(0,0,0)&quot;&gt;<br>
Théo&nbsp;BARRAGUE&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
