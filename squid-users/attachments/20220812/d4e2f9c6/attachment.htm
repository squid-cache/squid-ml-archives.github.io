<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Gotcha&nbsp;-&nbsp;I&#39;ll&nbsp;upgrade&nbsp;to&nbsp;5&nbsp;shortly,&nbsp;but&nbsp;I&nbsp;don&#39;t&nbsp;think&nbsp;that&#39;s&nbsp;affecting&nbsp;my&nbsp;confusion.&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;your&nbsp;nitpick,&nbsp;I&nbsp;think&nbsp;it&#39;s&nbsp;actually&nbsp;part&nbsp;of&nbsp;the&nbsp;key.&nbsp;I&nbsp;followed&nbsp;your&nbsp;suggestion,&nbsp;trying&nbsp;the&nbsp;parent&nbsp;cache_peer&nbsp;just&nbsp;on&nbsp;http,&nbsp;with&nbsp;the&nbsp;following&nbsp;squid.conf.&nbsp;&lt;br&gt;&lt;br&gt;http_port&nbsp;80&nbsp;accel&lt;br&gt;cache_peer&nbsp;10.60.4.178&nbsp;parent&nbsp;3128&nbsp;0&nbsp;no-query&nbsp;no-digest&nbsp;name=forward&lt;br&gt;request_header_add&nbsp;Joel&nbsp;Joel&lt;br&gt;&lt;br&gt;#&nbsp;Simplified&nbsp;acl&lt;br&gt;http_access&nbsp;allow&nbsp;all&lt;br&gt;cache_peer_access&nbsp;forward&nbsp;allow&nbsp;all&lt;br&gt;&lt;br&gt;#&nbsp;Misc&lt;br&gt;shutdown_lifetime&nbsp;1&nbsp;seconds&lt;br&gt;debug_options&nbsp;ALL,6&lt;br&gt;&lt;br&gt;I&nbsp;upped&nbsp;the&nbsp;log&nbsp;level&nbsp;and&nbsp;followed&nbsp;how&nbsp;squid&nbsp;transformed&nbsp;the&nbsp;request,&nbsp;and&nbsp;saw&nbsp;it&nbsp;change&lt;/div&gt;&lt;div&gt;&lt;br&gt;GET&nbsp;/&nbsp;to&nbsp;&lt;br&gt;GET&nbsp;its-own-hostname/&lt;br&gt;&lt;br&gt;based&nbsp;on&nbsp;the&nbsp;Host&nbsp;header&nbsp;on&nbsp;the&nbsp;incoming&nbsp;request,&nbsp;as&nbsp;you&nbsp;pointed&nbsp;out. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;first&nbsp;problem&nbsp;is,&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;doesn&#39;t&nbsp;know&nbsp;how&nbsp;to&nbsp;resolve&nbsp;that&nbsp;host&nbsp;-&nbsp;it&nbsp;rejects&nbsp;the&nbsp;request&nbsp;with &quot;Invalid&nbsp;URL&quot;.&nbsp;I&nbsp;need&nbsp;the&nbsp;reverse&nbsp;proxy&nbsp;to&nbsp;rewrite&nbsp;both&nbsp;the&nbsp;host&nbsp;header&nbsp;and&nbsp;url&nbsp;to&nbsp;their&nbsp;correct&nbsp;target&nbsp;values&nbsp;for&nbsp;the&nbsp;parent&nbsp;proxy.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;tested&nbsp;this&nbsp;via&nbsp;telnet&nbsp;to&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;(since&nbsp;I&#39;m&nbsp;still&nbsp;struggling&nbsp;to&nbsp;get&nbsp;squid&nbsp;url&nbsp;rewriting&nbsp;working,&nbsp;will&nbsp;try&nbsp;that&nbsp;more&nbsp;later).&nbsp;When&nbsp;I&nbsp;sent&lt;br&gt;&lt;br&gt;GET&nbsp;&lt;a&nbsp;href=&quot;http://target-hostname/&quot;&gt;http://target-hostname/&lt;/a&gt;&nbsp;HTTP/1.1&lt;br&gt;User-Agent:&nbsp;curl/7.68.0&lt;br&gt;Accept:&nbsp;*/*&lt;br&gt;Host:&nbsp;target-hostname&lt;br&gt;Via:&nbsp;1.1&nbsp;ip-10-60-4-103&nbsp;(squid/3.5.27)&lt;br&gt;Surrogate-Capability:&nbsp;ip-10-60-4-103=&quot;Surrogate/1.0&nbsp;ESI/1.0&quot;&lt;br&gt;X-Forwarded-For:&nbsp;10.40.0.194&lt;br&gt;Cache-Control:&nbsp;max-age=259200&lt;br&gt;Connection:&nbsp;keep-alive&lt;br&gt;Joel:&nbsp;Joel&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;it&nbsp;works,&nbsp;but&nbsp;if&nbsp;I&nbsp;try&nbsp;https&nbsp;I&nbsp;get&nbsp;&quot;Unsupported&nbsp;Request&nbsp;Method&nbsp;and&nbsp;Protocol&quot;&nbsp;(it&nbsp;so&nbsp;happens&nbsp;that&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;is&nbsp;also&nbsp;a&nbsp;squid&nbsp;in&nbsp;this&nbsp;case).&nbsp;I&nbsp;think&nbsp;this&nbsp;is&nbsp;expected,&nbsp;as&nbsp;the&nbsp;request&nbsp;above&nbsp;(https&nbsp;from&nbsp;proxy&nbsp;to&nbsp;proxy,&nbsp;on&nbsp;behalf&nbsp;of&nbsp;http&nbsp;client)&nbsp;should&nbsp;have&nbsp;been&nbsp;a&nbsp;CONNECT&nbsp;followed&nbsp;by&nbsp;the&nbsp;GET&nbsp;once&nbsp;the&nbsp;tunnel&nbsp;was&nbsp;established.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So:&nbsp;is&nbsp;squid&nbsp;capable&nbsp;of&nbsp;receiving&nbsp;the&nbsp;GET&nbsp;/&nbsp;to&nbsp;itself,&nbsp;sending&nbsp;a&nbsp;CONNECT&nbsp;/target-hostname&nbsp;to&nbsp;the&nbsp;parent&nbsp;proxy,&nbsp;negotiating&nbsp;that&nbsp;connection&nbsp;and&nbsp;then&nbsp;returning&nbsp;the&nbsp;result&nbsp;to&nbsp;the&nbsp;client?&nbsp;Obviously&nbsp;when&nbsp;it&#39;s&nbsp;functioning&nbsp;as&nbsp;a&nbsp;forward&nbsp;proxy&nbsp;it&nbsp;can&nbsp;&lt;i&gt;receive&lt;/i&gt; CONNECTs&nbsp;and&nbsp;handle&nbsp;them,&nbsp;but&nbsp;this&nbsp;is&nbsp;the&nbsp;&quot;flip&quot;&nbsp;I&#39;m&nbsp;still&nbsp;struggling&nbsp;with. &lt;/div&gt;&lt;div&gt;&lt;br&gt;Thanks&nbsp;so&nbsp;much&nbsp;for&nbsp;your&nbsp;time,&nbsp;I&#39;m&nbsp;learning&nbsp;this&nbsp;as&nbsp;I&nbsp;go&nbsp;and&nbsp;you&#39;ve&nbsp;been&nbsp;very&nbsp;helpful.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;--&nbsp;&lt;br&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;p&gt;&lt;span&nbsp;style=&quot;font-family:Titillium&nbsp;Web,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-size:16px&quot;&gt;&lt;strong&gt;&lt;span&nbsp;style=&quot;color:#0e3179&quot;&gt;Joel Howard&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&nbsp;style=&quot;font-size:9.5pt&quot;&gt;&lt;span&nbsp;style=&quot;font-variant:normal&quot;&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&#39;Titillium&nbsp;Web&#39;,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;font-style:normal&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:none&quot;&gt;&lt;font&nbsp;color=&quot;#444444&quot;&gt;Software&nbsp;Technical&nbsp;Lead&lt;/font&gt;&lt;br&gt;<br>
&lt;font&nbsp;color=&quot;#1155cc&quot;&gt;&lt;a&nbsp;href=&quot;mailto:jhoward@tetrascience.com&quot;&nbsp;target=&quot;_blank&quot;&gt;jhoward@tetrascience.com&lt;/a&gt;&lt;/font&gt;&lt;font&nbsp;color=&quot;#0e3179&quot;&gt;&lt;b&gt;&nbsp;&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:#0e3179&quot;&gt;&lt;span&nbsp;style=&quot;font-weight:400&quot;&gt;&lt;span&nbsp;style=&quot;font-style:normal&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:none&quot;&gt;|&nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-size:9.5pt&quot;&gt;&lt;span&nbsp;style=&quot;font-variant:normal&quot;&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&#39;Titillium&nbsp;Web&#39;,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:#30c2dc&quot;&gt;&lt;span&nbsp;style=&quot;font-weight:400&quot;&gt;&lt;span&nbsp;style=&quot;font-style:normal&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:none&quot;&gt;(330)&nbsp;209-5779&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;<br>
<br>
&lt;p&gt;&lt;a&nbsp;href=&quot;http://www.tetrascience.com&quot;&nbsp;style=&quot;text-decoration:none&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;span&nbsp;style=&quot;font-size:9.5pt&quot;&gt;&lt;span&nbsp;style=&quot;font-variant:normal&quot;&gt;&lt;span&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-family:&#39;Titillium&nbsp;Web&#39;,sans-serif&quot;&gt;&lt;span&nbsp;style=&quot;color:#1155cc&quot;&gt;&lt;span&nbsp;style=&quot;font-weight:400&quot;&gt;&lt;span&nbsp;style=&quot;font-style:normal&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:underline&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;border:none&quot;&gt;&lt;span&nbsp;style=&quot;display:inline-block&quot;&gt;&lt;span&nbsp;style=&quot;overflow:hidden&quot;&gt;&lt;span&nbsp;style=&quot;width:178px&quot;&gt;&lt;span&nbsp;style=&quot;height:44px&quot;&gt;&lt;img&nbsp;alt=&quot;Logo<br>
<br>
Description&nbsp;automatically&nbsp;generated&quot;&nbsp;height=&quot;44&quot;&nbsp;src=&quot;https://lh6.googleusercontent.com/NzD4TDBZin8qsiofYSBUmepyA3NIethFmH54EZqL1zIO_n2igLduDxcf8jP6TpJpCtrOxiKjyF4gb3AP9YjicjlelgYbr_h5BePagIxgGxYV6HtzQV00zZM9M_FrPXBMxd8wGwP1&quot;&nbsp;width=&quot;178&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/a&gt; &lt;/p&gt;<br>
<br>
&lt;p&nbsp;style=&quot;line-height:1.2;background-color:#ffffff&quot;&gt;&lt;a&nbsp;href=&quot;https://www.linkedin.com/company/tetrascience&quot;&nbsp;style=&quot;text-decoration:none&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-variant:normal;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Arial&quot;&gt;&lt;span&nbsp;style=&quot;color:#1155cc&quot;&gt;&lt;span&nbsp;style=&quot;font-weight:400&quot;&gt;&lt;span&nbsp;style=&quot;font-style:normal&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:none&quot;&gt;&lt;span&nbsp;style=&quot;border:none&quot;&gt;&lt;span&nbsp;style=&quot;display:inline-block&quot;&gt;&lt;span&nbsp;style=&quot;overflow:hidden&quot;&gt;&lt;span&nbsp;style=&quot;width:23px&quot;&gt;&lt;span&nbsp;style=&quot;height:23px&quot;&gt;&lt;img&nbsp;height=&quot;23&quot;&nbsp;src=&quot;https://lh6.googleusercontent.com/QqR_YmXdk5xxe5Een_XDRU7bl8KxoHWaxortR-u_jTs7hwoI8DY89fTS5Lsn8WEjAd-NMZnu1LjutVTx15_1nA4FzfTtHc8esaIUU2fAlpEGdzj3eBVAWpIDUEmGPMC954KRjhYL&quot;&nbsp;width=&quot;23&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/a&gt; &lt;a&nbsp;href=&quot;https://twitter.com/TetraScience&quot;&nbsp;style=&quot;text-decoration:none&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-variant:normal;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Arial&quot;&gt;&lt;span&nbsp;style=&quot;color:#1155cc&quot;&gt;&lt;span&nbsp;style=&quot;font-weight:400&quot;&gt;&lt;span&nbsp;style=&quot;font-style:normal&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:none&quot;&gt;&lt;span&nbsp;style=&quot;border:none&quot;&gt;&lt;span&nbsp;style=&quot;display:inline-block&quot;&gt;&lt;span&nbsp;style=&quot;overflow:hidden&quot;&gt;&lt;span&nbsp;style=&quot;width:24px&quot;&gt;&lt;span&nbsp;style=&quot;height:20px&quot;&gt;&lt;img&nbsp;height=&quot;20&quot;&nbsp;src=&quot;https://lh6.googleusercontent.com/dDjJOFTexDcB1XzS2fcMWc2eHy-dmTzFzBgpM1RIGUvm3WiIhleKXgxZ8Etuou0EnvsoC3MofWYHElVZf3YXeO0EP7lEnoLXg85fc_a4CzpQY8i7jhleUOFvwtvVD1AqSwck0fUt&quot;&nbsp;width=&quot;24&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-variant:normal;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Arial&quot;&gt;&lt;span&nbsp;style=&quot;color:#000000&quot;&gt;&lt;span&nbsp;style=&quot;font-weight:400&quot;&gt;&lt;span&nbsp;style=&quot;font-style:normal&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:none&quot;&gt;&nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;a&nbsp;href=&quot;https://www.youtube.com/channel/UCxAIGW2oF5jgJ062pax98UQ&quot;&nbsp;style=&quot;text-decoration:none&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;span&nbsp;style=&quot;font-size:11pt;font-variant:normal;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-family:Arial&quot;&gt;&lt;span&nbsp;style=&quot;color:#1155cc&quot;&gt;&lt;span&nbsp;style=&quot;font-weight:400&quot;&gt;&lt;span&nbsp;style=&quot;font-style:normal&quot;&gt;&lt;span&nbsp;style=&quot;text-decoration:none&quot;&gt;&lt;span&nbsp;style=&quot;border:none&quot;&gt;&lt;span&nbsp;style=&quot;display:inline-block&quot;&gt;&lt;span&nbsp;style=&quot;overflow:hidden&quot;&gt;&lt;span&nbsp;style=&quot;width:28px&quot;&gt;&lt;span&nbsp;style=&quot;height:20px&quot;&gt;&lt;img&nbsp;height=&quot;20&quot;&nbsp;src=&quot;https://lh3.googleusercontent.com/nuS46HfspdDsHftRD5n0g0P2dv5MyeNLNjOSXwBrSZVaHia39aVsFFofIGErpOBUueTWBPhlJM1Acch47iDkofIQ_ppdV-Y01rHyx3iraR7dSqM0lNl_ZWICvUPNUUiURLvH90v_&quot;&nbsp;width=&quot;28&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
