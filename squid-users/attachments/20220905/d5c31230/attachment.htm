<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;bgcolor=&quot;#FFFFFF&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hello,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;directives&nbsp;&quot;reply_body_max_size&quot;,&nbsp;&quot;request_body_max_size&quot;&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;delay_access&quot;&nbsp;to&nbsp;limit&nbsp;upload,&nbsp;download&nbsp;and&nbsp;passband&nbsp;in&nbsp;our&nbsp;infra.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;configuration&nbsp;existes&nbsp;since&nbsp;a&nbsp;while,&nbsp;but&nbsp;we&nbsp;have&nbsp;noticed&nbsp;that<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;squid&nbsp;v4.16,&nbsp;our&nbsp;delay&nbsp;pool&nbsp;didn't&nbsp;react&nbsp;as&nbsp;we&nbsp;wanted&nbsp;anymore.<br>
&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;were&nbsp;excpeting&nbsp;improvment&nbsp;upgrading&nbsp;squid&nbsp;to&nbsp;v5.6.&nbsp;But&nbsp;it&nbsp;got<br>
&nbsp;&nbsp;&nbsp;&nbsp;worth&nbsp;:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;restriction&nbsp;still&nbsp;didn't&nbsp;work&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;and&nbsp;squid&nbsp;had&nbsp;a&nbsp;segmentation&nbsp;fault&nbsp;each&nbsp;time&nbsp;some&nbsp;acl&nbsp;where&nbsp;used&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thanks&nbsp;to&nbsp;Alex&nbsp;Rousskov&nbsp;(bug&nbsp;5231),&nbsp;after&nbsp;some&nbsp;investigation,&nbsp;it<br>
&nbsp;&nbsp;&nbsp;&nbsp;appears&nbsp;that&nbsp;we&nbsp;used&nbsp;&quot;slow&quot;&nbsp;acl&nbsp;(proxy_auth&nbsp;an&nbsp;time&nbsp;acl)&nbsp;where&nbsp;only<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;fast&quot;&nbsp;acl&nbsp;where&nbsp;authorized...).&nbsp;The&nbsp;bug&nbsp;is&nbsp;still&nbsp;open&nbsp;as&nbsp;squid&nbsp;has<br>
&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;flagged&nbsp;the&nbsp;problem&nbsp;in&nbsp;cache&nbsp;logs,&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;My&nbsp;email,&nbsp;is&nbsp;to&nbsp;show&nbsp;you&nbsp;our&nbsp;configuration&nbsp;and&nbsp;the&nbsp;behaviour&nbsp;we<br>
&nbsp;&nbsp;&nbsp;&nbsp;espect,&nbsp;and&nbsp;the&nbsp;behaviour&nbsp;we&nbsp;finally&nbsp;have.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;-&nbsp;squd&nbsp;v4.12&nbsp;:&nbsp;we&nbsp;expect&nbsp;to&nbsp;limit&nbsp;downlod/upload&nbsp;and&nbsp;passband<br>
&nbsp;&nbsp;&nbsp;&nbsp;during&nbsp;working&nbsp;time&nbsp;for&nbsp;all&nbsp;login&nbsp;except&nbsp;those&nbsp;starting&nbsp;with&nbsp;cg_*&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;code&gt;######&nbsp;Gestion&nbsp;de&nbsp;bande&nbsp;passante&nbsp;##########&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;bureau&nbsp;time&nbsp;09:00-12:00&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;bureau&nbsp;time&nbsp;14:00-17:00&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Comptes&nbsp;generiques&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/code&gt;&lt;code&gt;&lt;code&gt;acl&nbsp;my_ldap_auth&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/code&gt;acl&nbsp;cgen&nbsp;proxy_auth_regex&nbsp;cg_&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reply_body_max_size&nbsp;800&nbsp;MB&nbsp;&lt;b&gt;bureau&nbsp;!cgen&lt;/b&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request_body_max_size&nbsp;5&nbsp;MB&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;La&nbsp;limite&nbsp;de&nbsp;bande&nbsp;passante&nbsp;ne&nbsp;fonctionne&nbsp;plus&nbsp;avec&nbsp;le&nbsp;BUMP&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;A&nbsp;tester&nbsp;...&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delay_pools&nbsp;1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Pendant&nbsp;time&nbsp;sauf&nbsp;cgen,&nbsp;emeraude&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delay_class&nbsp;1&nbsp;4&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delay_access&nbsp;1&nbsp;allow&lt;b&gt;&nbsp;&lt;/b&gt;&lt;/code&gt;&lt;code&gt;&lt;b&gt;&lt;code&gt;&lt;code&gt;my_ldap_auth<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!cgen&lt;/code&gt;&lt;/code&gt;&lt;/b&gt;&lt;b&gt;&nbsp;&lt;/b&gt;!emeraude&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delay_access&nbsp;1&nbsp;deny&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;512000&nbsp;=&nbsp;5120&nbsp;kbits/user&nbsp;640&nbsp;ko&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;307200&nbsp;=&nbsp;3072&nbsp;kbits/user&nbsp;384&nbsp;ko&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delay_parameters&nbsp;1&nbsp;-1/-1&nbsp;-1/-1&nbsp;-1/-1&nbsp;107200/107200&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;##################################################&lt;/code&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;with&nbsp;this&nbsp;configuration,&nbsp;the&nbsp;delay&nbsp;pool&nbsp;seemed&nbsp;not&nbsp;to&nbsp;work<br>
&nbsp;&nbsp;&nbsp;&nbsp;anymore,&nbsp;so&nbsp;we&nbsp;upgraded&nbsp;squid&nbsp;to&nbsp;v5.6.&nbsp;Which&nbsp;caused&nbsp;the&nbsp;squid<br>
&nbsp;&nbsp;&nbsp;&nbsp;segmentation&nbsp;fault...&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;-&nbsp;squid&nbsp;v5.6&nbsp;:&nbsp;to&nbsp;solve&nbsp;the&nbsp;segmentation&nbsp;fault,&nbsp;we&nbsp;had&nbsp;to&nbsp;take&nbsp;off<br>
&nbsp;&nbsp;&nbsp;&nbsp;my_ldap_auth/cgen&nbsp;(proxy_auth&nbsp;acl)&nbsp;and&nbsp;bureau&nbsp;(time&nbsp;acl).&nbsp;The<br>
&nbsp;&nbsp;&nbsp;&nbsp;limitation&nbsp;work&nbsp;again,&nbsp;but&nbsp;we&nbsp;are&nbsp;no&nbsp;more&nbsp;able&nbsp;to&nbsp;limit&nbsp;restriction<br>
&nbsp;&nbsp;&nbsp;&nbsp;during&nbsp;working&nbsp;time,&nbsp;or&nbsp;for&nbsp;spécific&nbsp;login...&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;code&gt;######&nbsp;Gestion&nbsp;de&nbsp;bande&nbsp;passante&nbsp;##########&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;bureau&nbsp;time&nbsp;09:00-12:00&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;bureau&nbsp;time&nbsp;14:00-17:00&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Comptes&nbsp;generiques&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acl&nbsp;userrgt&nbsp;src&nbsp;10.0.0.0/8&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/code&gt;&lt;code&gt;&lt;code&gt;acl&nbsp;my_ldap_auth&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/code&gt;acl&nbsp;cgen&nbsp;proxy_auth_regex&nbsp;cg_&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reply_body_max_size&nbsp;800&nbsp;MB&nbsp;&lt;b&gt;userrgt&lt;/b&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request_body_max_size&nbsp;5&nbsp;MB&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;La&nbsp;limite&nbsp;de&nbsp;bande&nbsp;passante&nbsp;ne&nbsp;fonctionne&nbsp;plus&nbsp;avec&nbsp;le&nbsp;BUMP&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;A&nbsp;tester&nbsp;...&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delay_pools&nbsp;1&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Pendant&nbsp;time&nbsp;sauf&nbsp;cgen,&nbsp;emeraude&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delay_class&nbsp;1&nbsp;4&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delay_access&nbsp;1&nbsp;allow&lt;/code&gt;&lt;code&gt;&lt;b&gt;&lt;code&gt;&lt;code&gt;&lt;/code&gt;&lt;/code&gt;&lt;/b&gt;&lt;b&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/b&gt;!emeraude&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delay_access&nbsp;1&nbsp;deny&nbsp;all&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;512000&nbsp;=&nbsp;5120&nbsp;kbits/user&nbsp;640&nbsp;ko&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;307200&nbsp;=&nbsp;3072&nbsp;kbits/user&nbsp;384&nbsp;ko&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delay_parameters&nbsp;1&nbsp;-1/-1&nbsp;-1/-1&nbsp;-1/-1&nbsp;107200/107200&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;##################################################&lt;/code&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Can&nbsp;you&nbsp;tell&nbsp;me&nbsp;if&nbsp;what&nbsp;we&nbsp;want&nbsp;to&nbsp;do&nbsp;is&nbsp;still&nbsp;possible?&nbsp;Limiting<br>
&nbsp;&nbsp;&nbsp;&nbsp;upload/download/passband&nbsp;for&nbsp;all&nbsp;logged&nbsp;user&nbsp;except&nbsp;those&nbsp;starting<br>
&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;cg_*..?.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Thank&nbsp;you&nbsp;for&nbsp;the&nbsp;time&nbsp;reading,&nbsp;and&nbsp;thank&nbsp;you&nbsp;for&nbsp;your&nbsp;answers.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Regards,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Eric&nbsp;Perrot&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;div&nbsp;class=&quot;moz-signature&quot;&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;img&nbsp;src=&quot;cid:part1.09050505.06030306@interieur.gouv.fr&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;border=&quot;0&quot;&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&nbsp;style=&quot;line-height:&nbsp;0;&quot;&gt;&lt;/br&gt;&lt;div&nbsp;style=&quot;border-top:&nbsp;2px&nbsp;solid<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rgb(48,&nbsp;145,&nbsp;71);&nbsp;display:&nbsp;inline-block;&nbsp;color:&nbsp;rgb(48,&nbsp;145,&nbsp;71);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;font-size:&nbsp;x-small;&nbsp;padding:&nbsp;5px;&nbsp;margin:&nbsp;10px&nbsp;auto;&nbsp;font-family:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Arial,Garamond,Times&nbsp;New&nbsp;Roman,Times,serif;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class=&quot;signature_ecolo_classname&quot;&gt;&lt;div&gt;Pour&nbsp;une&nbsp;administration<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exemplaire,&nbsp;préservons&nbsp;l'environnement.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;div&gt;N'imprimons&nbsp;que&nbsp;si&nbsp;nécessaire.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/div&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
