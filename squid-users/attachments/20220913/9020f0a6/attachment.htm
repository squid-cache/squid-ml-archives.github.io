<tt>
&lt;html&nbsp;xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;<br>
&lt;head&gt;<br>
&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&gt;<br>
&lt;div&nbsp;name=&quot;messageBodySection&quot;&gt;<br>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;Hello,&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;advice,&nbsp;as&nbsp;suggested&nbsp;I&nbsp;tested&nbsp;a&nbsp;both&nbsp;TCP&nbsp;and&nbsp;UDP,&nbsp;and&nbsp;found&nbsp;TCP&nbsp;to&nbsp;be&nbsp;so&nbsp;slow&lt;br&nbsp;/&gt;<br>
that&nbsp;is&nbsp;it&nbsp;practically&nbsp;unusable,&nbsp;UDP&nbsp;however&nbsp;works&nbsp;fine,&nbsp;but&nbsp;has&nbsp;the&nbsp;normal&nbsp;disadvantages&nbsp;of&nbsp;UDP.&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
It&nbsp;seems&nbsp;that&nbsp;TCP&nbsp;sends&nbsp;each&nbsp;message&nbsp;by&nbsp;itself,&nbsp;and&nbsp;UDP&nbsp;sends&nbsp;them&nbsp;in&nbsp;bulk&nbsp;(10-20&nbsp;at&nbsp;a&nbsp;time),&#160;&lt;br&nbsp;/&gt;<br>
which&nbsp;seems&nbsp;to&nbsp;be&nbsp;a&nbsp;big&nbsp;part&nbsp;of&nbsp;the&nbsp;performance&nbsp;difference,&nbsp;in&nbsp;fact&nbsp;TCP&nbsp;is&nbsp;so&nbsp;slow&nbsp;that&nbsp;it&nbsp;causes&lt;br&nbsp;/&gt;<br>
Squid&nbsp;to&nbsp;crash&nbsp;after&nbsp;a&nbsp;while.&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
After&nbsp;carefully&nbsp;reading&nbsp;the&nbsp;logs,&nbsp;I&nbsp;tried&nbsp;to&nbsp;get&nbsp;TCP&nbsp;to&nbsp;send&nbsp;in&nbsp;bulk&nbsp;as&nbsp;well&nbsp;by&nbsp;configuring:&lt;br&nbsp;/&gt;&lt;/div&gt;<br>
&lt;blockquote&nbsp;style=&quot;border:&nbsp;none;&nbsp;margin:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;25px;&nbsp;padding:&nbsp;0px;&quot;&gt;<br>
&lt;div&nbsp;style=&quot;indent-level:&nbsp;1&quot;&gt;logformat&nbsp;logstash&nbsp;%ts.%03tu&nbsp;%6tr&nbsp;%&gt;a&nbsp;%&lt;la&nbsp;%&gt;lp&nbsp;%Ss/%03&gt;Hs&nbsp;%&lt;st&nbsp;%rm&nbsp;%ru&nbsp;%[un&nbsp;%Sh/%&lt;a&nbsp;%mt&nbsp;%{Client-Tags}&gt;h&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;indent-level:&nbsp;1&quot;&gt;access_log&nbsp;tcp://127.0.0.1:5400&nbsp;logformat=logstash&nbsp;buffer-size=64KB&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;indent-level:&nbsp;1&quot;&gt;buffered_logs&nbsp;on&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;indent-level:&nbsp;1&quot;&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;But&nbsp;it&nbsp;seems&nbsp;to&nbsp;still&nbsp;be&nbsp;sending&nbsp;the&nbsp;logs&nbsp;line&nbsp;by&nbsp;line,&nbsp;am&nbsp;I&nbsp;missing&nbsp;something?&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
Thanks,&lt;br&nbsp;/&gt;<br>
Roee&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;name=&quot;messageReplySection&quot;&gt;On&nbsp;9&nbsp;Sep&nbsp;2022,&nbsp;19:57&nbsp;+0300,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;,&nbsp;wrote:&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;border-left-color:&nbsp;grey;&nbsp;border-left-width:&nbsp;thin;&nbsp;border-left-style:&nbsp;solid;&nbsp;margin:&nbsp;5px&nbsp;5px;padding-left:&nbsp;10px;&quot;&gt;On&nbsp;9/9/22&nbsp;08:49,&nbsp;roee&nbsp;klinger&nbsp;wrote:&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Hello,&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
I&nbsp;have&nbsp;just&nbsp;recently&nbsp;started&nbsp;exploring&nbsp;ingesting&nbsp;logs&nbsp;from&nbsp;Squid&nbsp;via&lt;br&nbsp;/&gt;<br>
Logstash&nbsp;(TCP&nbsp;log&nbsp;ingestion)&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
I&nbsp;now&nbsp;have&nbsp;to&nbsp;make&nbsp;the&nbsp;decision&nbsp;of&nbsp;how&nbsp;to&nbsp;deploy&nbsp;Logstash,&nbsp;it&nbsp;seems&nbsp;to&lt;br&nbsp;/&gt;<br>
me&nbsp;that&nbsp;I&nbsp;have&nbsp;two&nbsp;options:&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
1.&nbsp;Deploy&nbsp;a&nbsp;Logstash&nbsp;instance&nbsp;for&nbsp;every&nbsp;region&nbsp;where&nbsp;I&nbsp;have&nbsp;a&nbsp;Squid&lt;br&nbsp;/&gt;<br>
instance&nbsp;running,&nbsp;resulting&nbsp;in&nbsp;the&nbsp;lowest&nbsp;latency&nbsp;possible&nbsp;between&lt;br&nbsp;/&gt;<br>
Squid&nbsp;and&nbsp;Logstash.&lt;br&nbsp;/&gt;<br>
2.&nbsp;Deploy&nbsp;a&nbsp;central&nbsp;Logstash&nbsp;instance&nbsp;for&nbsp;all&nbsp;Squid&nbsp;instance&nbsp;worldwide,&lt;br&nbsp;/&gt;<br>
which&nbsp;is&nbsp;the&nbsp;cheapest&nbsp;and&nbsp;easiest&nbsp;option,&nbsp;but&nbsp;will&nbsp;have&nbsp;high&nbsp;latency&lt;br&nbsp;/&gt;<br>
for&nbsp;some&nbsp;of&nbsp;the&nbsp;Squid&nbsp;instance&nbsp;which&nbsp;are&nbsp;located&nbsp;far&nbsp;away&lt;br&nbsp;/&gt;<br>
geographically&nbsp;from&nbsp;the&nbsp;Logstash&nbsp;instance.&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
I&nbsp;already&nbsp;know&nbsp;that&nbsp;if&nbsp;the&nbsp;log&nbsp;server&nbsp;crashes&nbsp;in&nbsp;Squid,&nbsp;then&nbsp;Squid&nbsp;will&lt;br&nbsp;/&gt;<br>
crash&nbsp;with&nbsp;a&nbsp;fatal&nbsp;error,&lt;br&nbsp;/&gt;&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;<br>
FYI:&nbsp;Logging&nbsp;error&nbsp;handling&nbsp;is&nbsp;configurable&nbsp;via&nbsp;&quot;access_log&nbsp;on-error&quot;.&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;so&nbsp;Squid&nbsp;takes&nbsp;logging&nbsp;very&nbsp;seriously,&nbsp;so&nbsp;my&lt;br&nbsp;/&gt;<br>
question&nbsp;is:&nbsp;does&nbsp;TCP&nbsp;logging&nbsp;performance&nbsp;in&nbsp;Squid&nbsp;effect&nbsp;the&nbsp;total&lt;br&nbsp;/&gt;<br>
request&nbsp;performance,&nbsp;or&nbsp;are&nbsp;they&nbsp;independent&nbsp;from&nbsp;each&nbsp;other?&lt;br&nbsp;/&gt;&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;<br>
TCP&nbsp;logger&nbsp;uses&nbsp;asynchronous&nbsp;non-blocking&nbsp;I/O.&nbsp;Individual&nbsp;HTTP&lt;br&nbsp;/&gt;<br>
transactions&nbsp;do&nbsp;not&nbsp;wait&nbsp;for&nbsp;individual&nbsp;log&nbsp;records&nbsp;to&nbsp;be&nbsp;sent.&nbsp;Needless&lt;br&nbsp;/&gt;<br>
to&nbsp;say,&nbsp;logging&nbsp;does&nbsp;consume&nbsp;resources&nbsp;and,&nbsp;hence,&nbsp;may&nbsp;affect&nbsp;overall&lt;br&nbsp;/&gt;<br>
HTTP&nbsp;transaction&nbsp;performance.&nbsp;And&nbsp;if&nbsp;the&nbsp;log&nbsp;record&nbsp;recipient&nbsp;is&nbsp;too&lt;br&nbsp;/&gt;<br>
slow,&nbsp;then&nbsp;Squid&nbsp;will&nbsp;die&nbsp;and/or&nbsp;log&nbsp;records&nbsp;will&nbsp;be&nbsp;dropped.&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;What&nbsp;would&nbsp;be&nbsp;you&nbsp;recommendations,&nbsp;if&nbsp;request&nbsp;performance&nbsp;is&nbsp;crucial&lt;br&nbsp;/&gt;<br>
(and&nbsp;log&nbsp;performance&nbsp;is&nbsp;not)?&lt;br&nbsp;/&gt;&lt;/blockquote&gt;<br>
&lt;br&nbsp;/&gt;<br>
I&nbsp;would&nbsp;not&nbsp;be&nbsp;surprised&nbsp;if&nbsp;you&nbsp;would&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;measure&nbsp;meaningful&lt;br&nbsp;/&gt;<br>
performance&nbsp;difference&nbsp;among&nbsp;these&nbsp;modules.&nbsp;From&nbsp;general&nbsp;performance&lt;br&nbsp;/&gt;<br>
point&nbsp;of&nbsp;view,&nbsp;and&nbsp;module-specific&nbsp;bugs&nbsp;and&nbsp;limitations&nbsp;notwithstanding,&lt;br&nbsp;/&gt;<br>
I&nbsp;would&nbsp;expect&nbsp;&quot;daemon&quot;&nbsp;and&nbsp;&quot;udp&quot;&nbsp;modules&nbsp;to&nbsp;have&nbsp;smaller&nbsp;performance&lt;br&nbsp;/&gt;<br>
overhead/cost&nbsp;for&nbsp;Squid&nbsp;workers&nbsp;than&nbsp;the&nbsp;&quot;tcp&quot;&nbsp;module&nbsp;because&nbsp;I&nbsp;expect&lt;br&nbsp;/&gt;<br>
that&nbsp;TCP&nbsp;has&nbsp;to&nbsp;&quot;do&nbsp;more&quot;&nbsp;than&nbsp;stdout&nbsp;I/O&nbsp;and&nbsp;UDP.&nbsp;However,&nbsp;I&nbsp;would&nbsp;not&lt;br&nbsp;/&gt;<br>
base&nbsp;this&nbsp;decision&nbsp;on&nbsp;such&nbsp;high-level&nbsp;speculations&nbsp;and&nbsp;test&nbsp;various&lt;br&nbsp;/&gt;<br>
options&nbsp;instead.&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
HTH,&lt;br&nbsp;/&gt;<br>
&lt;br&nbsp;/&gt;<br>
Alex.&lt;br&nbsp;/&gt;<br>
_______________________________________________&lt;br&nbsp;/&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&nbsp;/&gt;<br>
squid-users@lists.squid-cache.org&lt;br&nbsp;/&gt;<br>
http://lists.squid-cache.org/listinfo/squid-users&lt;br&nbsp;/&gt;&lt;/blockquote&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
