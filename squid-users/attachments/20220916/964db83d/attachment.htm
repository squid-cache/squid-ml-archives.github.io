<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;XHTML&nbsp;1.0&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;&lt;body&nbsp;style='font-size:&nbsp;10pt;&nbsp;font-family:&nbsp;Verdana,Geneva,sans-serif'&gt;<br>
&lt;p&gt;Hello&nbsp;Amos,&lt;/p&gt;<br>
&lt;p&gt;This&nbsp;seems&nbsp;to&nbsp;be&nbsp;a&nbsp;solved&nbsp;issue.&nbsp;With&nbsp;your&nbsp;advices,&nbsp;I&nbsp;have&nbsp;manage&nbsp;to&nbsp;limit&nbsp;all&nbsp;my&nbsp;user&nbsp;except&nbsp;those&nbsp;who&nbsp;had&nbsp;a&nbsp;login&nbsp;starting&nbsp;by&nbsp;cg_*.&lt;/p&gt;<br>
&lt;p&gt;1&nbsp;-&nbsp;annotation&nbsp;of&nbsp;the&nbsp;&quot;cg_*&quot;&nbsp;'s&nbsp;flow&nbsp;:&lt;br&nbsp;/&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;&lt;em&gt;#&nbsp;Comptes&nbsp;generiques&lt;/em&gt;&lt;/span&gt;&lt;br&nbsp;/&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;&lt;em&gt;acl&nbsp;userCgPrefix&nbsp;proxy_auth_regex&nbsp;^cg_&lt;br&nbsp;/&gt;acl&nbsp;markCgGroup&nbsp;annotate_transaction&nbsp;cgUsers=true&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;&lt;em&gt;http_access&nbsp;allow&nbsp;userCgPrefix&nbsp;markCgGroup&nbsp;!all&lt;/em&gt;&lt;/span&gt;&lt;br&nbsp;/&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;&lt;em&gt;http_access&nbsp;allow&nbsp;my_ldap_auth&nbsp;!emeraude&lt;/em&gt;&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;&nbsp;2&nbsp;-&nbsp;fixed&nbsp;limits&nbsp;for&nbsp;all&nbsp;except&nbsp;&quot;cg_*&quot;&nbsp;users&lt;/p&gt;<br>
&lt;p&gt;&lt;em&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;acl&nbsp;cgen&nbsp;note&nbsp;cgUsers&nbsp;true&lt;/span&gt;&lt;/em&gt;&lt;br&nbsp;/&gt;&lt;em&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;acl&nbsp;userrgt&nbsp;src&nbsp;10.0.0.0/8&lt;br&nbsp;/&gt;&lt;/span&gt;&lt;/em&gt;&lt;em&nbsp;style=&quot;font-size:&nbsp;10pt;&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;reply_body_max_size&nbsp;800&nbsp;MB&nbsp;bureau&nbsp;!cgen&nbsp;userrgt&lt;br&nbsp;/&gt;&lt;/span&gt;&lt;/em&gt;&lt;em&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;request_body_max_size&nbsp;5&nbsp;MB&lt;br&nbsp;/&gt;&lt;/span&gt;&lt;/em&gt;&lt;em&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;delay_pools&nbsp;1&lt;br&nbsp;/&gt;&lt;/span&gt;&lt;/em&gt;&lt;em&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;delay_class&nbsp;1&nbsp;4&lt;br&nbsp;/&gt;&lt;/span&gt;&lt;/em&gt;&lt;em&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;delay_access&nbsp;1&nbsp;allow&nbsp;bureau&nbsp;!cgen&nbsp;!emeraude&lt;br&nbsp;/&gt;&lt;/span&gt;&lt;/em&gt;&lt;em&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;x-small;&quot;&gt;delay_parameters&nbsp;1&nbsp;-1/-1&nbsp;-1/-1&nbsp;-1/-1&nbsp;512000/512000&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;<br>
&lt;p&gt;I&nbsp;will&nbsp;make&nbsp;some&nbsp;other&nbsp;tests&nbsp;later&nbsp;on&nbsp;with&nbsp;the&nbsp;&quot;usual&nbsp;way&quot;&nbsp;you&nbsp;also&nbsp;preconised&nbsp;:&lt;br&nbsp;/&gt;&quot;The&nbsp;usual&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;with&nbsp;the&nbsp;authentication&nbsp;systems&nbsp;&quot;group&quot;&nbsp;functionality&nbsp;and&nbsp;a&nbsp;helper&nbsp;to&nbsp;fetch&nbsp;that.&quot;&lt;/p&gt;<br>
&lt;p&gt;Thanks&nbsp;very&nbsp;much&nbsp;to&nbsp;you,&nbsp;David&nbsp;and&nbsp;Eliezer&lt;span&nbsp;style=&quot;font-size:&nbsp;10pt;&quot;&gt;&nbsp;&lt;/span&gt;&lt;/p&gt;<br>
&lt;div&gt;Regards,&lt;/div&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;Eric&nbsp;Perrot&lt;/div&gt;<br>
&lt;p&gt;Le&nbsp;06/09/2022&nbsp;20:46,&nbsp;Amos&nbsp;Jeffries&nbsp;a&nbsp;&eacute;crit&nbsp;:&lt;/p&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding-left:5px;&nbsp;border-left:#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin-left:5px&quot;&gt;<br>
&lt;pre&gt;On&nbsp;6/09/22&nbsp;00:56,&nbsp;PERROT&nbsp;Eric&nbsp;DNUM&nbsp;SDCAST&nbsp;BST&nbsp;SSAIM&nbsp;wrote:&lt;/pre&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding-left:5px;&nbsp;border-left:#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin-left:5px&quot;&gt;Hello,&nbsp;We&nbsp;use&nbsp;directives&nbsp;&quot;reply_body_max_size&quot;,&nbsp;&quot;request_body_max_size&quot;&nbsp;and&nbsp;&quot;delay_access&quot;&nbsp;to&nbsp;limit&nbsp;upload,&nbsp;download&nbsp;and&nbsp;passband&nbsp;in&nbsp;our&nbsp;infra.&lt;/blockquote&gt;<br>
&lt;pre&gt;All&nbsp;of&nbsp;which&nbsp;are&nbsp;&quot;fast&quot;&nbsp;type.&lt;/pre&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding-left:5px;&nbsp;border-left:#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin-left:5px&quot;&gt;This&nbsp;configuration&nbsp;existes&nbsp;since&nbsp;a&nbsp;while,&nbsp;but&nbsp;we&nbsp;have&nbsp;noticed&nbsp;that&nbsp;with&nbsp;squid&nbsp;v4.16,&nbsp;our&nbsp;delay&nbsp;pool&nbsp;didn't&nbsp;react&nbsp;as&nbsp;we&nbsp;wanted&nbsp;anymore.&lt;/blockquote&gt;<br>
&lt;pre&gt;FYI,&nbsp;use&nbsp;of&nbsp;&quot;slow&quot;&nbsp;type&nbsp;ACLs&nbsp;in&nbsp;&quot;fast&quot;&nbsp;type&nbsp;checks&nbsp;is&nbsp;subject&nbsp;to&nbsp;what&nbsp;Squid&nbsp;happens&nbsp;to&nbsp;have&nbsp;in&nbsp;its&nbsp;processing&nbsp;state&nbsp;information&nbsp;and&nbsp;available&nbsp;in&nbsp;caches&nbsp;from&nbsp;previous&nbsp;traffic.<br>
<br>
Even&nbsp;if&nbsp;a&nbsp;config&nbsp;like&nbsp;this&nbsp;*appears*&nbsp;to&nbsp;work,&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;actually&nbsp;working&nbsp;for&nbsp;all&nbsp;transactions.&nbsp;The&nbsp;delicate&nbsp;balance&nbsp;may&nbsp;change&nbsp;at&nbsp;any&nbsp;time.&lt;/pre&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&nbsp;style=&quot;padding-left:5px;&nbsp;border-left:#1010ff&nbsp;2px&nbsp;solid;&nbsp;margin-left:5px&quot;&gt;Can&nbsp;you&nbsp;tell&nbsp;me&nbsp;if&nbsp;what&nbsp;we&nbsp;want&nbsp;to&nbsp;do&nbsp;is&nbsp;still&nbsp;possible?&nbsp;Limiting&nbsp;upload/download/passband&nbsp;for&nbsp;all&nbsp;logged&nbsp;user&nbsp;except&nbsp;those&nbsp;starting&nbsp;by&nbsp;cg_*..?.&lt;/blockquote&gt;<br>
&lt;pre&gt;You&nbsp;need&nbsp;to:<br>
<br>
&nbsp;1)&nbsp;do&nbsp;authentication&nbsp;checks&nbsp;to&nbsp;http_access.<br>
<br>
<br>
<br>
&nbsp;2)&nbsp;make&nbsp;the&nbsp;cg_*&nbsp;accounts&nbsp;part&nbsp;of&nbsp;a&nbsp;&quot;group&quot;.<br>
<br>
&nbsp;The&nbsp;usual&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;with&nbsp;the&nbsp;authentication&nbsp;systems&nbsp;&quot;group&quot;&nbsp;functionality&nbsp;and&nbsp;a&nbsp;helper&nbsp;to&nbsp;fetch&nbsp;that.<br>
<br>
&nbsp;However,&nbsp;in&nbsp;Squid-4+&nbsp;you&nbsp;can&nbsp;also&nbsp;add&nbsp;a&nbsp;temporary&nbsp;&quot;group&quot;&nbsp;label&nbsp;as&nbsp;needed&nbsp;based&nbsp;on&nbsp;other&nbsp;ACL&nbsp;checks&nbsp;(eg&nbsp;the&nbsp;username&nbsp;regex&nbsp;matching)&nbsp;like&nbsp;so:<br>
<br>
&nbsp;&nbsp;&nbsp;acl&nbsp;userCgPrefix&nbsp;proxy_auth_regex&nbsp;^cg_<br>
&nbsp;&nbsp;&nbsp;acl&nbsp;markCgGroup&nbsp;annotate_transaction&nbsp;group=cgUsers<br>
&nbsp;&nbsp;&nbsp;http_access&nbsp;allow&nbsp;userCgPrefix&nbsp;markCgGroup&nbsp;!all<br>
<br>
<br>
3)&nbsp;check&nbsp;the&nbsp;'group'&nbsp;annotation&nbsp;in&nbsp;fast&nbsp;type&nbsp;controls,&nbsp;not&nbsp;the&nbsp;username:<br>
<br>
&nbsp;&nbsp;acl&nbsp;userrgt&nbsp;note&nbsp;group&nbsp;cgUsers<br>
<br>
&nbsp;&nbsp;reply_body_max_size&nbsp;800&nbsp;MB&nbsp;userrgt<br>
&nbsp;&nbsp;deny_access&nbsp;1&nbsp;deny&nbsp;userrgt<br>
<br>
FTR;&nbsp;the&nbsp;above&nbsp;should&nbsp;work&nbsp;on&nbsp;any&nbsp;Squid-4&nbsp;or&nbsp;later.&nbsp;So&nbsp;you&nbsp;can&nbsp;revert&nbsp;to&nbsp;the&nbsp;v4&nbsp;Squid&nbsp;install&nbsp;which&nbsp;was&nbsp;otherwise&nbsp;working&nbsp;for&nbsp;you.<br>
<br>
<br>
HTH<br>
Amos<br>
_______________________________________________<br>
squid-users&nbsp;mailing&nbsp;list<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;Verdana,&nbsp;Geneva,&nbsp;sans-serif;&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;13.3333px;&nbsp;white-space:&nbsp;normal;&quot;&gt;<br>
&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;&lt;/html&gt;<br>

</tt>
