<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=UTF-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Background:&nbsp;we&nbsp;are&nbsp;using&nbsp;Squid&nbsp;internally&nbsp;to&nbsp;replicate&nbsp;customer<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;environments&nbsp;which&nbsp;require&nbsp;proxy&nbsp;transit&nbsp;for&nbsp;most&nbsp;if&nbsp;not&nbsp;all<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HTTP/REST&nbsp;comms,&nbsp;in&nbsp;order&nbsp;to&nbsp;facilitate&nbsp;bug&nbsp;replication&nbsp;and<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev/test&nbsp;of&nbsp;software&nbsp;which&nbsp;must&nbsp;operate&nbsp;in&nbsp;those&nbsp;environments.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;I&nbsp;would&nbsp;like&nbsp;to&nbsp;configure&nbsp;Squid&nbsp;with&nbsp;a&nbsp;set&nbsp;of&nbsp;allow-listed<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domains&nbsp;such&nbsp;that&nbsp;unauthenticated&nbsp;CONNECTs&nbsp;to&nbsp;sites&nbsp;within&nbsp;those<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;domains&nbsp;succeed,&nbsp;_unless_&nbsp;the&nbsp;following&nbsp;conditions&nbsp;are&nbsp;met:&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;if&nbsp;a&nbsp;client&nbsp;preemptively&nbsp;sends&nbsp;a&nbsp;Proxy-Authenticate&nbsp;header<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anyway,&nbsp;without&nbsp;first&nbsp;receiving&nbsp;a&nbsp;407&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;li&gt;_and_&nbsp;that&nbsp;header&nbsp;is&nbsp;invalid&nbsp;(bad&nbsp;username/password,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsupported&nbsp;authN&nbsp;method,&nbsp;&amp;c),&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/li&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/ul&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;...in&nbsp;which&nbsp;case&nbsp;I&nbsp;want&nbsp;the&nbsp;CONNECT&nbsp;to&nbsp;get&nbsp;a&nbsp;standard&nbsp;407<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Is&nbsp;this&nbsp;conditional&nbsp;possible&nbsp;with&nbsp;Squid's&nbsp;ACL&nbsp;structure?&nbsp;I&nbsp;can't<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;see&nbsp;a&nbsp;way&nbsp;to&nbsp;make&nbsp;it&nbsp;happen&nbsp;in&nbsp;Squid&nbsp;3.5&nbsp;running&nbsp;on&nbsp;Amazon&nbsp;linux,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;although&nbsp;I've&nbsp;discovered&nbsp;a&nbsp;couple&nbsp;new&nbsp;ways&nbsp;of&nbsp;generating<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authentication&nbsp;loops.&nbsp;:/&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;   &nbsp;Thanks&nbsp;for&nbsp;any&nbsp;help/pointers, &lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;   &nbsp;   &nbsp;Ole&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;-- &lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Ole&nbsp;Craig&nbsp;|&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:olc@macmillan-craig.net&quot;&gt;olc@macmillan-craig.net&lt;/a&gt;&lt;/p&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;McQuary&nbsp;was&nbsp;far&nbsp;too&nbsp;generous.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/p&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
