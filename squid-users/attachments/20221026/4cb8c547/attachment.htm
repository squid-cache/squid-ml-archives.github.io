<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;all,&lt;br&gt;&lt;br&gt;Thanks&nbsp;for&nbsp;the&nbsp;replies.&lt;div&gt;&lt;br&gt;I&nbsp;have&nbsp;included&nbsp;the&nbsp;requested&nbsp;output&nbsp;from&nbsp;tcpdump&nbsp;below:&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; tcpdump&nbsp;-A&nbsp;-s&nbsp;0&nbsp;-ni&nbsp;enp4s0&nbsp;&quot;host&nbsp;159.203.14.9&nbsp;and&nbsp;(((ip[2:2]&nbsp;-&nbsp;((ip[0]&amp;0xf)&lt;&lt;2))&nbsp;-&nbsp;((tcp[12]&amp;&lt;br&gt;0xf0)&gt;&gt;2))&nbsp;!=&nbsp;0)&quot;&lt;/div&gt;&lt;div&gt;tcpdump:&nbsp;verbose&nbsp;output&nbsp;suppressed,&nbsp;use&nbsp;-v[v]...&nbsp;for&nbsp;full&nbsp;protocol&nbsp;decode&lt;br&gt;listening&nbsp;on&nbsp;enp4s0,&nbsp;link-type&nbsp;EN10MB&nbsp;(Ethernet),&nbsp;snapshot&nbsp;length&nbsp;262144&nbsp;bytes&lt;/div&gt;&lt;div&gt;&lt;br&gt;01:40:17.310479&nbsp;IP&nbsp;10.0.160.10.43426&nbsp;&gt;&nbsp;159.203.14.9.1996:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;2955630477:2955630939,&nbsp;ack&nbsp;2382737005,&nbsp;win&nbsp;502,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;3000375654&nbsp;ecr&nbsp;1932743995],&nbsp;length&nbsp;462&lt;br&gt;E....:@.?.7.&lt;br&gt;..&lt;br&gt;...&nbsp; &nbsp; &nbsp;.....+W....m....Y......&lt;br&gt;...fs3U;GET&nbsp;&lt;a&nbsp;href=&quot;http://nintendo.com/&quot;&gt;http://nintendo.com/&lt;/a&gt;&nbsp;HTTP/1.1&lt;br&gt;User-Agent:&nbsp;Mozilla/5.0&nbsp;(Windows&nbsp;NT&nbsp;10.0;&nbsp;Win64;&nbsp;x64;&nbsp;rv:106.0)&nbsp;Gecko/20100101&nbsp;Firefox/106.0&lt;br&gt;Accept:&nbsp;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&lt;br&gt;Accept-Language:&nbsp;en-GB,en;q=0.5&lt;br&gt;Accept-Encoding:&nbsp;gzip,&nbsp;deflate&lt;br&gt;Upgrade-Insecure-Requests:&nbsp;1&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://nintendo.com&quot;&gt;nintendo.com&lt;/a&gt;&lt;br&gt;Via:&nbsp;1.1&nbsp;dce3749b9671&nbsp;(squid/5.6)&lt;br&gt;X-Forwarded-For:&nbsp;10.0.130.210&lt;br&gt;Cache-Control:&nbsp;max-age=259200&lt;br&gt;Connection:&nbsp;keep-alive&lt;br&gt;&lt;br&gt;&lt;br&gt;01:40:18.957475&nbsp;IP&nbsp;159.203.14.9.1996&nbsp;&gt;&nbsp;10.0.160.10.43426:&nbsp;Flags&nbsp;[P.],&nbsp;seq&nbsp;1:1466,&nbsp;ack&nbsp;462,&nbsp;win&nbsp;114,&nbsp;options&nbsp;[nop,nop,TS&nbsp;val&nbsp;1932744407&nbsp;ecr&nbsp;3000375654],&nbsp;length&nbsp;1465&lt;br&gt;E....@@.3......&lt;br&gt;..&lt;br&gt;.......m.+Y[...r]......&lt;br&gt;s3V....fHTTP/1.1&nbsp;200&nbsp;OK&lt;br&gt;x-powered-by:&nbsp;Express&lt;br&gt;content-type:&nbsp;text/html;&nbsp;charset=iso-8859-1&lt;br&gt;transfer-encoding:&lt;br&gt;date:&nbsp;Wed,&nbsp;26&nbsp;Oct&nbsp;2022&nbsp;00:40:20&nbsp;GMT&lt;br&gt;connection:&nbsp;close&lt;br&gt;&lt;br&gt;&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//IETF//DTD&nbsp;HTML&nbsp;2.0//EN&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;br&gt;&lt;!--&nbsp;this&nbsp;automatically&nbsp;loads&nbsp;the&nbsp;hallway&nbsp;after&nbsp;20&nbsp;seconds&nbsp;--&gt;&lt;br&gt;&lt;meta&nbsp;http-equiv=&quot;refresh&quot;&nbsp;content=&quot;20;&nbsp;url=&lt;a&nbsp;href=&quot;http://nintendo.com//./hallway/index.html&quot;&gt;http://nintendo.com//./hallway/index.html&lt;/a&gt;&quot;&gt;&lt;br&gt;&lt;title&gt;Nintendo&nbsp;Power&nbsp;Source&lt;/title&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Tue,&nbsp;Oct&nbsp;25,&nbsp;2022&nbsp;at&nbsp;2:08&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;10/23/22&nbsp;20:36,&nbsp;Matthew&nbsp;H&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;using&nbsp;Squid&nbsp;to&nbsp;proxy&nbsp;HTTP&nbsp;requests&nbsp;to&nbsp;another&nbsp;proxy.&nbsp;I&nbsp;can&nbsp;see&nbsp;squid&nbsp;&lt;br&gt;<br>
&gt;&nbsp;sending&nbsp;the&nbsp;request&nbsp;to&nbsp;the&nbsp;parent&nbsp;and&nbsp;getting&nbsp;a&nbsp;response,&nbsp;but&nbsp;it&nbsp;sends&nbsp;&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;client&nbsp;that&nbsp;initiated&nbsp;the&nbsp;request&nbsp;a&nbsp;502&nbsp;Bad&nbsp;Gateway&nbsp;response.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;closer&nbsp;inspection&nbsp;it&nbsp;appears&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;is&nbsp;sending&nbsp;an&nbsp;&lt;br&gt;<br>
&gt;&nbsp;empty transfer-encoding&nbsp;header,&nbsp;and&nbsp;this&nbsp;is&nbsp;causing&nbsp;Squid&nbsp;to&nbsp;send&nbsp;a&nbsp;502.&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Do&nbsp;you&nbsp;know&nbsp;whether&nbsp;the&nbsp;response&nbsp;body&nbsp;was&nbsp;using&nbsp;chunked&nbsp;(or&nbsp;any&nbsp;other&nbsp;&lt;br&gt;<br>
non-identity)&nbsp;encoding?&nbsp;I&nbsp;have&nbsp;already&nbsp;added&nbsp;your&nbsp;case&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;&lt;br&gt;<br>
known&nbsp;rejected&nbsp;responses[1],&nbsp;but&nbsp;it&nbsp;would&nbsp;be&nbsp;good&nbsp;to&nbsp;update&nbsp;that&nbsp;with&nbsp;&lt;br&gt;<br>
the&nbsp;information&nbsp;on&nbsp;the&nbsp;actual&nbsp;response&nbsp;encoding.&lt;br&gt;<br>
&lt;br&gt;<br>
[1]&nbsp;&lt;a&nbsp;href=&quot;https://github.com/squid-cache/squid/pull/702#issuecomment-762459132&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/squid-cache/squid/pull/702#issuecomment-762459132&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;the&nbsp;very&nbsp;first&nbsp;bytes&nbsp;of&nbsp;the&nbsp;response&nbsp;are&nbsp;&quot;&lt;html&quot;&nbsp;or&nbsp;similar,&nbsp;then&nbsp;no&nbsp;&lt;br&gt;<br>
encoding&nbsp;was&nbsp;probably&nbsp;applied.&nbsp;If&nbsp;you&nbsp;see&nbsp;what&nbsp;can&nbsp;be&nbsp;interpreted&nbsp;as&nbsp;a&nbsp;&lt;br&gt;<br>
small&nbsp;hex&nbsp;number&nbsp;followed&nbsp;by&nbsp;a&nbsp;new&nbsp;line,&nbsp;then&nbsp;chunked&nbsp;encoding&nbsp;was&nbsp;&lt;br&gt;<br>
probably&nbsp;applied&nbsp;(at&nbsp;least).&nbsp;If&nbsp;you&nbsp;cannot&nbsp;tell,&nbsp;or&nbsp;are&nbsp;not&nbsp;sure,&nbsp;feel&nbsp;&lt;br&gt;<br>
free&nbsp;to&nbsp;share&nbsp;the&nbsp;response&nbsp;packet&nbsp;in&nbsp;libpcap&nbsp;format,&nbsp;captured&nbsp;with&nbsp;&lt;br&gt;<br>
wireshark&nbsp;or&nbsp;&quot;tcpdump&nbsp;-s0&quot;.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;2022/10/24&nbsp;00:23:59.106|&nbsp;ctx:&nbsp;enter&nbsp;level&nbsp; 0:&nbsp;&#39;&lt;a&nbsp;href=&quot;http://nintendo.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://nintendo.com/&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://nintendo.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://nintendo.com/&lt;/a&gt;&gt;&#39;&lt;br&gt;<br>
&gt;&nbsp;2022/10/24&nbsp;00:23:59.106|&nbsp;11,3|&nbsp;http.cc(666)&nbsp;processReplyHeader:&nbsp;&lt;br&gt;<br>
&gt;&nbsp;processReplyHeader:&nbsp;key&nbsp;&#39;19010000000000000C00000000000000&#39;&lt;br&gt;<br>
&gt;&nbsp;2022/10/24&nbsp;00:23:59.106|&nbsp;11,2|&nbsp;http.cc(720)&nbsp;processReplyHeader:&nbsp;HTTP&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Server&nbsp;conn294&nbsp;local=&lt;a&nbsp;href=&quot;http://172.25.0.3:57802&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;172.25.0.3:57802&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://172.25.0.3:57802/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://172.25.0.3:57802/&lt;/a&gt;&gt; remote=&lt;a&nbsp;href=&quot;http://159.203.14.9:1996&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;159.203.14.9:1996&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://159.203.14.9:1996/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://159.203.14.9:1996/&lt;/a&gt;&gt; FIRSTUP_PARENT&nbsp;FD&nbsp;26&nbsp;flags=1&lt;br&gt;<br>
&gt;&nbsp;2022/10/24&nbsp;00:23:59.106|&nbsp;11,2|&nbsp;http.cc(721)&nbsp;processReplyHeader:&nbsp;HTTP&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Server&nbsp;RESPONSE:&lt;br&gt;<br>
&gt;&nbsp;---------&lt;br&gt;<br>
&gt;&nbsp;HTTP/1.1&nbsp;200&nbsp;OK&lt;br&gt;<br>
&gt;&nbsp;x-powered-by:&nbsp;Express&lt;br&gt;<br>
&gt;&nbsp;content-type:&nbsp;text/html;&nbsp;charset=iso-8859-1&lt;br&gt;<br>
&gt;&nbsp;transfer-encoding:&lt;br&gt;<br>
&gt;&nbsp;date:&nbsp;Mon,&nbsp;24&nbsp;Oct&nbsp;2022&nbsp;00:23:57&nbsp;GMT&lt;br&gt;<br>
&gt;&nbsp;connection:&nbsp;close&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;----------&lt;br&gt;<br>
&gt;&nbsp;2022/10/24&nbsp;00:23:59.106|&nbsp;55,3|&nbsp;HttpHeader.cc(882)&nbsp;getList:&nbsp;empty&nbsp;list&nbsp;&lt;br&gt;<br>
&gt;&nbsp;header:&nbsp;Transfer-Encoding(Transfer-Encoding[63])&lt;br&gt;<br>
&gt;&nbsp;2022/10/24&nbsp;00:23:59.106|&nbsp;55,2|&nbsp;HttpHeader.cc(559)&nbsp;parse:&nbsp;WARNING:&nbsp;&lt;br&gt;<br>
&gt;&nbsp;unsupported&nbsp;Transfer-Encoding&nbsp;used&nbsp;by&nbsp;client:&lt;br&gt;<br>
&gt;&nbsp;2022/10/24&nbsp;00:23:59.106|&nbsp;ctx:&nbsp;exit&nbsp;level&nbsp; 0&lt;br&gt;<br>
&gt;&nbsp;2022/10/24&nbsp;00:23:59.106|&nbsp;20,3|&nbsp;store.cc(1673)&nbsp;reset:&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://nintendo.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://nintendo.com/&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://nintendo.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://nintendo.com/&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;2022/10/24&nbsp;00:23:59.107|&nbsp;17,3|&nbsp;FwdState.cc(492)&nbsp;fail:&nbsp;ERR_INVALID_RESP&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&quot;Bad&nbsp;Gateway&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://nintendo.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://nintendo.com/&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://nintendo.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://nintendo.com/&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;2022/10/24&nbsp;00:23:59.107|&nbsp;17,3|&nbsp;FwdState.cc(533)&nbsp;unregister:&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://nintendo.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://nintendo.com/&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://nintendo.com/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://nintendo.com/&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
