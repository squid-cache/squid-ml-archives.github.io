<tt>
&lt;div&nbsp;dir=&quot;auto&quot;&gt;Wow&nbsp;thanks&nbsp;Amos&nbsp;so&nbsp;much&nbsp;for&nbsp;this,&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;You&nbsp;think&nbsp;if&nbsp;I&nbsp;build&nbsp;it&nbsp;on&nbsp;rocky&nbsp;Linux,&nbsp;it&nbsp;would&nbsp;be&nbsp;easier?&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Thu,&nbsp;17&nbsp;Nov&nbsp;2022,&nbsp;06:07&nbsp;Amos&nbsp;Jeffries,&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;On&nbsp;16/11/2022&nbsp;6:31&nbsp;am,&nbsp;robert&nbsp;k&nbsp;Wild&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;hi&nbsp;all,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;atm&nbsp;i&nbsp;have&nbsp;written&nbsp;a&nbsp;script,&nbsp;once&nbsp;you&nbsp;have&nbsp;built&nbsp;a&nbsp;centos&nbsp;7&nbsp;VM,&nbsp;you&nbsp;&lt;br&gt;<br>
&gt;&nbsp;just&nbsp;run&nbsp;the&nbsp;script&nbsp;and&nbsp;after&nbsp;the&nbsp;reboot&nbsp;its&nbsp;a&nbsp;complete&nbsp;running&nbsp;&lt;br&gt;<br>
&gt;&nbsp;squidclamAV&nbsp;server&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;i&#39;m&nbsp;going&nbsp;to&nbsp;be&nbsp;moving&nbsp;the&nbsp;script&nbsp;to&nbsp;a&nbsp;ubuntu&nbsp;server&nbsp;as&nbsp;centos&nbsp;7&nbsp;is&nbsp;&lt;br&gt;<br>
&gt;&nbsp;dead&nbsp;now&nbsp;(as&nbsp;i&nbsp;run&nbsp;clamAV&nbsp;on&nbsp;it,&nbsp;clamAV&nbsp;will&nbsp;stop&nbsp;getting&nbsp;virus&nbsp;&lt;br&gt;<br>
&gt;&nbsp;definitions&nbsp;2024&nbsp;as&nbsp;i&nbsp;use&nbsp;this&nbsp;for&nbsp;virus&nbsp;scanning&nbsp;of&nbsp;internet&nbsp;packets)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;just&nbsp;want&nbsp;to&nbsp;know&nbsp;what&nbsp;lines&nbsp;i&nbsp;need&nbsp;to&nbsp;adjust&nbsp;to&nbsp;work&nbsp;with&nbsp;ubuntu&nbsp;&lt;br&gt;<br>
&gt;&nbsp;instead&nbsp;of&nbsp;centos,&nbsp;obviously&nbsp;i&nbsp;know&nbsp;instead&nbsp;of&nbsp;yum&nbsp;install....&nbsp;its&nbsp;apt&nbsp;&lt;br&gt;<br>
&gt;&nbsp;install&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;comments&nbsp;below&nbsp;assume&nbsp;that&nbsp;you&nbsp;want&nbsp;to&nbsp;keep&nbsp;the&nbsp;exact&nbsp;versions&nbsp;as-is&nbsp;&lt;br&gt;<br>
and&nbsp;custom&nbsp;build.&lt;br&gt;<br>
&lt;br&gt;<br>
Otherwise,&nbsp;if&nbsp;you&nbsp;are&nbsp;okay&nbsp;following&nbsp;Ubuntu&#39;s&nbsp;official&nbsp;packages&nbsp;and&nbsp;&lt;br&gt;<br>
security&nbsp;fixes&nbsp;things&nbsp;could&nbsp;be&nbsp;a&nbsp;lot&nbsp;different&nbsp;(and&nbsp;simpler).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;heres&nbsp;my&nbsp;long&nbsp;script&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;#!/bin/bash&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#this&nbsp;script&nbsp;will&nbsp;download/install&nbsp;and&nbsp;configure&nbsp;the&nbsp;following&nbsp;packages&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#squid&nbsp;-&nbsp;proxy&nbsp;server&lt;br&gt;<br>
&gt;&nbsp;#squid&nbsp;ssl&nbsp;bump&nbsp;-&nbsp;intercept&nbsp;HTTPS&nbsp;traffic&lt;br&gt;<br>
&gt;&nbsp;#clamAV&nbsp;-&nbsp;antivirus&nbsp;engine&nbsp;inc&nbsp;trojans,viruses,malware&lt;br&gt;<br>
&gt;&nbsp;#c-icap&nbsp;-&nbsp;icap&nbsp;server&lt;br&gt;<br>
&gt;&nbsp;#squidclamav&nbsp;-&nbsp;that&nbsp;integrates&nbsp;all&nbsp;the&nbsp;above&nbsp;in&nbsp;squid&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;may&nbsp;not&nbsp;be&nbsp;aware&nbsp;squidclamav&nbsp;has&nbsp;been&nbsp;replaced&nbsp;with&nbsp;eCAP&nbsp;ClamAV&nbsp;module:&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;https://www.e-cap.org/downloads/&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://www.e-cap.org/downloads/&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Ubuntu&nbsp;provides&nbsp;libecap&nbsp;package&nbsp;and&nbsp;Squid&nbsp;has&nbsp;support&nbsp;auto-enabled&nbsp;for&nbsp;it.&lt;br&gt;<br>
So&nbsp;all&nbsp;you&nbsp;should&nbsp;need&nbsp;to&nbsp;do&nbsp;is&nbsp;build&nbsp;the&nbsp;ecap-clamav&nbsp;adaptor&nbsp;and&nbsp;&lt;br&gt;<br>
configure&nbsp;it&nbsp;for&nbsp;use.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;#whitelist&nbsp;URL&#39;s&lt;br&gt;<br>
&gt;&nbsp;#deny&nbsp;MIME&nbsp;types&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#on&nbsp;the&nbsp;PROD&nbsp;host&nbsp;you&nbsp;only&nbsp;need&nbsp;squid&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#first&nbsp;things&nbsp;first&nbsp;lets&nbsp;disable&nbsp;firewalld&nbsp;and&nbsp;SElinux&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;systemctl&nbsp;stop&nbsp;firewalld&lt;br&gt;<br>
&gt;&nbsp;systemctl&nbsp;disable&nbsp;firewalld&lt;br&gt;<br>
&gt;&nbsp;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;&nbsp;/etc/selinux/config&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#squid&nbsp;packages&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;yum&nbsp;install&nbsp;-y&nbsp;epel-release&nbsp;screen&nbsp;rsync&nbsp;net-tools&nbsp;ethtool&nbsp;swaks&nbsp;sed&nbsp;&lt;br&gt;<br>
&gt;&nbsp;tar&nbsp;zip&nbsp;unzip&nbsp;curl&nbsp;telnet&nbsp;openssl&nbsp;openssl-devel&nbsp;bzip2-devel&nbsp;libarchive&nbsp;&lt;br&gt;<br>
&gt;&nbsp;libarchive-devel&nbsp;perl&nbsp;perl-Data-Dumper&nbsp;gcc&nbsp;gcc-c++&nbsp;binutils&nbsp;autoconf&nbsp;&lt;br&gt;<br>
&gt;&nbsp;automake&nbsp;make&nbsp;sudo&nbsp;wget&nbsp;libxml2-devel&nbsp;libcap-devel&nbsp;libtool-ltdl-devel&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&lt;br&gt;<br>
Drop&nbsp;&quot;epel-release&quot;&nbsp;as&nbsp;irrelevant&nbsp;on&nbsp;Ubuntu.&lt;br&gt;<br>
&lt;br&gt;<br>
Ubuntu&nbsp;developer&nbsp;packages&nbsp;have&nbsp;&quot;-dev&quot;&nbsp;suffix&nbsp;instead&nbsp;of&nbsp;&quot;-devel&quot;.&nbsp;So&nbsp;all&nbsp;&lt;br&gt;<br>
those&nbsp;should&nbsp;change.&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;get&nbsp;access&nbsp;to&nbsp;simpler&nbsp;source&nbsp;building&nbsp;I&nbsp;recommend&nbsp;altering&nbsp;the&nbsp;apt&nbsp;&lt;br&gt;<br>
configuration&nbsp;like&nbsp;so:&lt;br&gt;<br>
&lt;br&gt;<br>
    &nbsp;sudo&nbsp;sed&nbsp;--in-place&nbsp;-E&nbsp;&#39;s/#&nbsp;(deb-src.*updates&nbsp;main)/ &nbsp;\1/g&#39;&nbsp;&lt;br&gt;<br>
/etc/apt/sources.list&lt;br&gt;<br>
    &nbsp;sudo&nbsp;apt-get&nbsp;--quiet=2&nbsp;update&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
There&nbsp;are&nbsp;some&nbsp;trivial&nbsp;package&nbsp;naming&nbsp;differences.&nbsp;When&nbsp;apt&nbsp;complains&nbsp;&lt;br&gt;<br>
about&nbsp;not&nbsp;finding&nbsp;a&nbsp;package&nbsp;you&nbsp;can&nbsp;use&lt;br&gt;<br>
&lt;&lt;a&nbsp;href=&quot;https://packages.ubuntu.com/search&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://packages.ubuntu.com/search&lt;/a&gt;&gt;&nbsp;to&nbsp;search&nbsp;for&nbsp;the&nbsp;Ubuntu&nbsp;naming&nbsp;&lt;br&gt;<br>
and/or&nbsp;any&nbsp;alternatives.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Many&nbsp;of&nbsp;those&nbsp;are&nbsp;not&nbsp;related&nbsp;to&nbsp;Squid&nbsp;in&nbsp;any&nbsp;way.&nbsp;Perhapse&nbsp;separate&nbsp;&lt;br&gt;<br>
them&nbsp;into&nbsp;a&nbsp;different&nbsp;install&nbsp;command?&lt;br&gt;<br>
&lt;br&gt;<br>
After&nbsp;the&nbsp;above&nbsp;deb-src&nbsp;change&nbsp;the&nbsp;packages&nbsp;needed&nbsp;to&nbsp;build&nbsp;Squid&nbsp;for&nbsp;&lt;br&gt;<br>
Ubuntu&nbsp;can&nbsp;be&nbsp;installed&nbsp;like&nbsp;so:&lt;br&gt;<br>
&lt;br&gt;<br>
    &nbsp;sudo&nbsp;apt-get&nbsp;--quiet=2&nbsp;build-dep&nbsp;squid&lt;br&gt;<br>
&lt;br&gt;<br>
Similar&nbsp;commands&nbsp;also&nbsp;for&nbsp;clamav,&nbsp;c-icap&nbsp;any&nbsp;others&nbsp;which&nbsp;Ubuntu&nbsp;&lt;br&gt;<br>
provides&nbsp;packages&nbsp;for.&lt;br&gt;<br>
&lt;br&gt;<br>
After&nbsp;that&nbsp;build-dep&nbsp;command&nbsp;you&nbsp;only&nbsp;need&nbsp;to&nbsp;install&nbsp;dependencies&nbsp;if&nbsp;&lt;br&gt;<br>
the&nbsp;Ubuntu&nbsp;package&nbsp;lacks&nbsp;support.&lt;br&gt;<br>
For&nbsp;example,&nbsp;Ubuntu&nbsp;older&nbsp;than&nbsp;21.10&nbsp;lack&nbsp;openssl&nbsp;natively,&nbsp;so&nbsp;&quot;apt&nbsp;&lt;br&gt;<br>
install&nbsp;libssl-dev&quot;&nbsp;may&nbsp;be&nbsp;needed&nbsp;specially.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;#clamAV&nbsp;packages&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;yum&nbsp;install&nbsp;-y&nbsp;clamav-server&nbsp;clamav-data&nbsp;clamav-update&nbsp;&lt;br&gt;<br>
&gt;&nbsp;clamav-filesystem&nbsp;clamav&nbsp;clamav-scanner-systemd&nbsp;clamav-devel&nbsp;&lt;br&gt;<br>
&gt;&nbsp;clamav-lib&nbsp;clamav-server-systemd&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;#download&nbsp;and&nbsp;compile&nbsp;from&nbsp;source&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;cd&nbsp;/tmp&lt;br&gt;<br>
&gt;&nbsp;wget&nbsp;&lt;a&nbsp;href=&quot;http://www.squid-cache.org/Versions/v4/squid-4.17.tar.gz&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.squid-cache.org/Versions/v4/squid-4.17.tar.gz&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;wget&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://sourceforge.net/projects/c-icap/files/c-icap/0.5.x/c_icap-0.5.10.tar.gz&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://sourceforge.net/projects/c-icap/files/c-icap/0.5.x/c_icap-0.5.10.tar.gz&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--no-check-certificate&lt;br&gt;<br>
&gt;&nbsp;wget&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://sourceforge.net/projects/c-icap/files/c-icap-modules/0.5.x/c_icap_modules-0.5.5.tar.gz&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://sourceforge.net/projects/c-icap/files/c-icap-modules/0.5.x/c_icap_modules-0.5.5.tar.gz&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--no-check-certificate&lt;br&gt;<br>
&gt;&nbsp;wget&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://sourceforge.net/projects/squidclamav/files/squidclamav/7.1/squidclamav-7.1.tar.gz&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://sourceforge.net/projects/squidclamav/files/squidclamav/7.1/squidclamav-7.1.tar.gz&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--no-check-certificate&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;for&nbsp;f&nbsp;in&nbsp;*.tar.gz;&nbsp;do&nbsp;tar&nbsp;xf&nbsp;&quot;$f&quot;;&nbsp;done&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;cd&nbsp;/tmp/squid-4.17&lt;br&gt;<br>
&gt;&nbsp;./configure&nbsp;--with-openssl&nbsp;--enable-ssl-crtd&nbsp;--enable-icap-client&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--enable-http-violations&nbsp;&amp;&amp;&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;prefix&nbsp;can&nbsp;be&nbsp;a&nbsp;bit&nbsp;different&nbsp;on&nbsp;Debian/Ubuntu.&nbsp;To&nbsp;ensure&nbsp;it&nbsp;is&nbsp;&lt;br&gt;<br>
right&nbsp;add&nbsp;--prefix=/usr/local&nbsp;to&nbsp;the&nbsp;above&nbsp;options.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;cd&nbsp;/tmp/c_icap-0.5.10&lt;br&gt;<br>
&gt;&nbsp;./configure&nbsp;&#39;CXXFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&nbsp;&#39;CFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--without-bdb&nbsp;--prefix=/usr/local&nbsp;&amp;&amp;&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;cd&nbsp;/tmp/squidclamav-7.1&lt;br&gt;<br>
&gt;&nbsp;./configure&nbsp;&#39;CXXFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&nbsp;&#39;CFLAGS=-O2&nbsp;-m64&nbsp;-pipe&#39;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--with-c-icap=/usr/local&nbsp;--with-libarchive&nbsp;&amp;&amp;&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;cd&nbsp;/tmp/c_icap_modules-0.5.5&lt;br&gt;<br>
&gt;&nbsp;./configure&nbsp;&#39;CFLAGS=-O3&nbsp;-m64&nbsp;-pipe&#39;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&#39;CPPFLAGS=-I/usr/local/clamav/include&#39;&nbsp;&#39;LDFLAGS=-L/usr/local/lib&nbsp;&lt;br&gt;<br>
&gt;&nbsp;-L/usr/local/clamav/lib/&#39;&nbsp;&amp;&amp;&nbsp;make&nbsp;&amp;&amp;&nbsp;make&nbsp;install&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#creating&nbsp;shortcuts&nbsp;and&nbsp;copying&nbsp;files&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;cp&nbsp;-f&nbsp;/usr/local/squid/etc/squid.conf&nbsp;/usr/local/squid/etc/squid.conf.orig&lt;br&gt;<br>
&gt;&nbsp;cp&nbsp;-f&nbsp;/usr/local/etc/c-icap.conf&nbsp;/usr/local/etc/c-icap.conf.orig&lt;br&gt;<br>
&gt;&nbsp;cp&nbsp;-f&nbsp;/usr/local/etc/squidclamav.conf&nbsp;/usr/local/etc/squidclamav.conf.orig&lt;br&gt;<br>
&gt;&nbsp;cp&nbsp;-f&nbsp;/usr/local/etc/clamav_mod.conf&nbsp;/usr/local/etc/clamav_mod.conf.orig&lt;br&gt;<br>
&gt;&nbsp;cp&nbsp;-f&nbsp;/usr/local/etc/virus_scan.conf&nbsp;/usr/local/etc/virus_scan.conf.orig&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/usr/local/squid/etc/squid.conf&nbsp;/etc&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/usr/local/etc/c-icap.conf&nbsp;/etc&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/usr/local/etc/squidclamav.conf&nbsp;/etc&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/usr/local/etc/clamav_mod.conf&nbsp;/etc&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/usr/local/etc/virus_scan.conf&nbsp;/etc&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;mkdir&nbsp;-p&nbsp;/usr/local/clamav/share/clamav&lt;br&gt;<br>
&gt;&nbsp;ln&nbsp;-s&nbsp;/var/lib/clamav&nbsp;/usr/local/clamav/share/clamav&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#tmpfiles&nbsp;for&nbsp;run&nbsp;files&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;d&nbsp;/var/run/c-icap&nbsp;0755&nbsp;root&nbsp;root&nbsp;-&quot;&nbsp;&gt;&gt;&nbsp;/etc/tmpfiles.d/c-icap.conf&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;d&nbsp;/var/run/clamav&nbsp;0755&nbsp;root&nbsp;root&nbsp;-&quot;&nbsp;&gt;&gt;&nbsp;/etc/tmpfiles.d/clamav.conf&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#original&nbsp;squid&nbsp;config&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;sed&nbsp;-i&nbsp;&#39;/http_port&nbsp;3128/d&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;<br>
&gt;&nbsp;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%http_access&nbsp;deny&nbsp;!Safe_ports%#http_access&nbsp;deny&nbsp;&lt;br&gt;<br>
&gt;&nbsp;!Safe_ports%g&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;<br>
&gt;&nbsp;sed&nbsp;-i&nbsp;-e&nbsp;&#39;s%http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports%#http_access&nbsp;deny&nbsp;&lt;br&gt;<br>
&gt;&nbsp;CONNECT&nbsp;!SSL_ports%g&#39;&nbsp;/usr/local/squid/etc/squid.conf&lt;br&gt;<br>
&lt;br&gt;<br>
Reason?&nbsp;this&nbsp;opens&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;security&nbsp;vulnerabilities.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Modern&nbsp;Squid&nbsp;have&nbsp;an&nbsp;&quot;include&quot;&nbsp;directive&nbsp;to&nbsp;import&nbsp;extra&nbsp;squid.conf&nbsp;&lt;br&gt;<br>
rules&nbsp;from&nbsp;other&nbsp;files&nbsp;and/or&nbsp;directories.&lt;br&gt;<br>
I&nbsp;recommend&nbsp;adding&nbsp;this&nbsp;one&nbsp;line&nbsp;to&nbsp;squid.conf&nbsp;under&nbsp;where&nbsp;it&nbsp;says&nbsp;&lt;br&gt;<br>
&quot;|INSERT&nbsp;YOUR&nbsp;OWN&nbsp;RULE(S)&nbsp;HERE&nbsp;TO&nbsp;ALLOW&nbsp;ACCESS&nbsp;FROM&nbsp;YOUR&nbsp;CLIENTS&quot;|:&lt;br&gt;<br>
&lt;br&gt;<br>
|include&nbsp;/etc/squid/conf.d/*.conf|&lt;br&gt;<br>
&lt;br&gt;<br>
then&nbsp;placing&nbsp;all&nbsp;your&nbsp;custom&nbsp;Squid&nbsp;files&nbsp;in&nbsp;that&nbsp;conf.d&nbsp;directory.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;#create&nbsp;URL,&nbsp;MIME&nbsp;and&nbsp;public&nbsp;key&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;#eicar&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;.&lt;a&nbsp;href=&quot;http://eicar.org&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;eicar.org&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://eicar.org&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://eicar.org&lt;/a&gt;&gt;&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/urlwhite.txt&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;&lt;a&nbsp;href=&quot;http://updater.maxon.net/server_test&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://updater.maxon.net/server_test&lt;/a&gt;&quot;&nbsp;&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;/usr/local/squid/etc/urlspecial.txt&lt;br&gt;<br>
&gt;&nbsp;#&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;application/octet-stream&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/mimedeny.txt&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;application/x-msi&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/mimedeny.txt&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;application/zip&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/mimedeny.txt&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;application/x-7z-compressed&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/mimedeny.txt&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;application/vnd.ms-cab-compressed&quot;&nbsp;&gt;&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;/usr/local/squid/etc/mimedeny.txt&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;application/x-msdownload&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/mimedeny.txt&lt;br&gt;<br>
&gt;&nbsp;echo&nbsp;&quot;application/x-iso9660-image&quot;&nbsp;&gt;&gt;&nbsp;/usr/local/squid/etc/mimedeny.txt&lt;br&gt;<br>
&lt;br&gt;<br>
FWIW:&nbsp;squid&nbsp;config&nbsp;files&nbsp;are&nbsp;all&nbsp;agnostic&nbsp;to&nbsp;whitespace&nbsp;indentation.&nbsp;So&nbsp;&lt;br&gt;<br>
you&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;improve&nbsp;script&nbsp;readability&nbsp;like&nbsp;this:&lt;br&gt;<br>
&lt;br&gt;<br>
  echo&nbsp;&quot;&lt;br&gt;<br>
   &nbsp;blah&lt;br&gt;<br>
   &nbsp;blah&lt;br&gt;<br>
   &nbsp;blah&lt;br&gt;<br>
   &nbsp;blah&lt;br&gt;<br>
&quot;&nbsp;&gt;&gt;&nbsp;path/to/file&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Also,&nbsp;I&nbsp;see&nbsp;that&nbsp;you&nbsp;are&nbsp;adding&nbsp;systemd&nbsp;integration&nbsp;for&nbsp;the&nbsp;other&nbsp;software.&lt;br&gt;<br>
There&nbsp;is&nbsp;a&nbsp;file&nbsp;in&nbsp;squid&nbsp;tarball&nbsp;at&nbsp;tools/systemd/squid.service&nbsp;that&nbsp;can&nbsp;&lt;br&gt;<br>
be&nbsp;installed&nbsp;to&nbsp;add&nbsp;that.&lt;br&gt;<br>
You&nbsp;will&nbsp;need&nbsp;to&nbsp;adjust&nbsp;the&nbsp;binary&nbsp;paths&nbsp;inside&nbsp;it&nbsp;to&nbsp;your&nbsp;custom&nbsp;&lt;br&gt;<br>
/usr/local&nbsp;ones.&lt;br&gt;<br>
&lt;br&gt;<br>
Also,&nbsp;consider&nbsp;using&nbsp;logrotate&nbsp;package&nbsp;to&nbsp;manage&nbsp;the&nbsp;log&nbsp;files&nbsp;instead&nbsp;&lt;br&gt;<br>
of&nbsp;cron.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&nbsp;rel=&quot;noreferrer&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&nbsp;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
