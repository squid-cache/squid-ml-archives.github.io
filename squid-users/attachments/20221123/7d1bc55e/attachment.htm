<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Alex,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;all&nbsp;the&nbsp;details.&nbsp;I&nbsp;will&nbsp;build&nbsp;a&nbsp;new&nbsp;squid&nbsp;image&nbsp;off&nbsp;master/v6&nbsp;to&nbsp;check&nbsp;for&nbsp;the&nbsp;memory&nbsp;leak&nbsp;with&nbsp;test&nbsp;traffic.&lt;/div&gt;&lt;div&gt;Regarding&nbsp;the&nbsp;TLS&nbsp;session&nbsp;cache,&nbsp;I&nbsp;will&nbsp;try&nbsp;setting&nbsp;it&nbsp;to&nbsp;100MB.&nbsp;Are&nbsp;there&nbsp;any&nbsp;stats&nbsp;exposed&nbsp;from&nbsp;the&nbsp;tls&nbsp;session&nbsp;cache&nbsp;that&nbsp;can&nbsp;be&nbsp;monitored&nbsp;to&nbsp;study&nbsp;the&nbsp;session&nbsp;cache&nbsp;usage&nbsp;with&nbsp;our&nbsp;traffic&nbsp;patterns?&nbsp;Would&nbsp;those&nbsp;be&nbsp;accessible&nbsp;via&nbsp;the &lt;span&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;font-size:13px&quot;&gt;squid-internal-mgr&nbsp;endpoint?&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;font-family:&quot;Helvetica&nbsp;Neue&quot;;font-size:13px&quot;&gt;Thanks&lt;/span&gt;&lt;/div&gt;<br>
<br>
<br>
<br>
<br>
<br>
&lt;div&gt;Praveen &lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Tue,&nbsp;Nov&nbsp;22,&nbsp;2022&nbsp;at&nbsp;7:58&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;11/22/22&nbsp;21:06,&nbsp;Praveen&nbsp;Ponakanti&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Do&nbsp;we&nbsp;have&nbsp;a&nbsp;recent&nbsp;squid&nbsp;ver&nbsp;6&nbsp;snapshot&nbsp;build&nbsp;available&nbsp;for&nbsp;testing?&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
Sorry,&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;the&nbsp;exact&nbsp;answer&nbsp;to&nbsp;your&nbsp;question.&nbsp;One&nbsp;can&nbsp;&lt;br&gt;<br>
certainly&nbsp;build&nbsp;master/v6&nbsp;from&nbsp;git&nbsp;sources,&nbsp;of&nbsp;course.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;following&nbsp;config&nbsp;knobs&nbsp;were&nbsp;tried&nbsp;and&nbsp;did&nbsp;not&nbsp;make&nbsp;much&nbsp;of&nbsp;a&nbsp;&lt;br&gt;<br>
&gt;&nbsp;difference&nbsp;with&nbsp;respect&nbsp;to&nbsp;concurrent&nbsp;outbound&nbsp;TLS&nbsp;sessions&nbsp;across&nbsp;the&nbsp;&lt;br&gt;<br>
&gt;&nbsp;workers.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;can&nbsp;only&nbsp;speculate&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;Squid&nbsp;bug&nbsp;that&nbsp;prevents&nbsp;workers&nbsp;&lt;br&gt;<br>
from&nbsp;using&nbsp;(or&nbsp;sharing)&nbsp;the&nbsp;TLS&nbsp;session&nbsp;cache&nbsp;OR&nbsp;your&nbsp;traffic&nbsp;patterns&nbsp;&lt;br&gt;<br>
do&nbsp;not&nbsp;allow&nbsp;(much)&nbsp;sharing&nbsp;OR&nbsp;your&nbsp;TLS&nbsp;session&nbsp;cache&nbsp;is&nbsp;too&nbsp;small&nbsp;for&nbsp;&lt;br&gt;<br>
those&nbsp;traffic&nbsp;patterns.&nbsp;Lot&#39;s&nbsp;of&nbsp;possibilities&nbsp;here!&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;docs&nbsp;say&nbsp;the&nbsp;default&nbsp;sslproxy_session_cache_size&nbsp;is&nbsp;2&nbsp;MB,&nbsp;&lt;br&gt;<br>
&gt;&nbsp;how&nbsp;high&nbsp;can&nbsp;we&nbsp;go?&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;have&nbsp;not&nbsp;tested&nbsp;this,&nbsp;but,&nbsp;bugs&nbsp;notwithstanding,&nbsp;I&nbsp;would&nbsp;expect&nbsp;you&nbsp;to&nbsp;&lt;br&gt;<br>
be&nbsp;able&nbsp;to&nbsp;go&nbsp;as&nbsp;high&nbsp;as&nbsp;the&nbsp;maximum&nbsp;shared&nbsp;memory&nbsp;segment&nbsp;size&nbsp;in&nbsp;your&nbsp;&lt;br&gt;<br>
environment&nbsp;(e.g.,&nbsp;see&nbsp;sysctl&nbsp;kernel.shmax).&nbsp;The&nbsp;entire&nbsp;cache&nbsp;must&nbsp;fit&nbsp;&lt;br&gt;<br>
into&nbsp;a&nbsp;single&nbsp;shared&nbsp;memory&nbsp;segment&nbsp;IIRC.&nbsp;It&nbsp;certainly&nbsp;does&nbsp;not&nbsp;hurt&nbsp;to&nbsp;&lt;br&gt;<br>
try&nbsp;100&nbsp;MB&nbsp;if&nbsp;you&nbsp;already&nbsp;tried&nbsp;10&nbsp;MB.&nbsp;Squid&nbsp;should&nbsp;complain&nbsp;if&nbsp;it&nbsp;&lt;br&gt;<br>
cannot&nbsp;allocate&nbsp;a&nbsp;segment&nbsp;of&nbsp;the&nbsp;specified&nbsp;size.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Are&nbsp;there&nbsp;any&nbsp;other&nbsp;knobs&nbsp;we&nbsp;can&nbsp;try&nbsp;to&nbsp;improve&nbsp;&lt;br&gt;<br>
&gt;&nbsp;session&nbsp;reuse&nbsp;for&nbsp;HTTPS&nbsp;reqs&nbsp;?&nbsp;(without&nbsp;enabling&nbsp;squid&nbsp;cache)&lt;br&gt;<br>
&lt;br&gt;<br>
FWIW,&nbsp;I&nbsp;would&nbsp;try&nbsp;to&nbsp;understand&nbsp;_why_&nbsp;sessions&nbsp;are&nbsp;not&nbsp;shared&nbsp;(enough)&nbsp;&lt;br&gt;<br>
in&nbsp;the&nbsp;first&nbsp;place,&nbsp;especially&nbsp;if&nbsp;increasing&nbsp;sslproxy_session_cache_size&nbsp;&lt;br&gt;<br>
value&nbsp;does&nbsp;not&nbsp;result&nbsp;in&nbsp;session&nbsp;cache&nbsp;hit&nbsp;ratio&nbsp;increase&nbsp;while&nbsp;there&nbsp;&lt;br&gt;<br>
are&nbsp;still&nbsp;many&nbsp;false&nbsp;cache&nbsp;misses.&nbsp;I&nbsp;do&nbsp;not&nbsp;know&nbsp;whether&nbsp;anybody&nbsp;is&nbsp;&lt;br&gt;<br>
paying&nbsp;a&nbsp;lot&nbsp;of&nbsp;attention&nbsp;to&nbsp;that&nbsp;cache&nbsp;in&nbsp;production,&nbsp;but&nbsp;the&nbsp;&lt;br&gt;<br>
corresponding&nbsp;Squid&nbsp;code&nbsp;is&nbsp;not&nbsp;tested&nbsp;by&nbsp;the&nbsp;Squid&nbsp;Project&nbsp;CI&nbsp;(yet?).&lt;br&gt;<br>
&lt;br&gt;<br>
Also,&nbsp;there&nbsp;are&nbsp;different&nbsp;kinds&nbsp;of&nbsp;TLS&nbsp;session&nbsp;reuse.&nbsp;It&nbsp;is&nbsp;possible&nbsp;&lt;br&gt;<br>
that&nbsp;the&nbsp;sessions&nbsp;you&nbsp;want&nbsp;to&nbsp;reuse&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;the&nbsp;Squid&nbsp;&lt;br&gt;<br>
session&nbsp;cache.&nbsp;Unfortunately,&nbsp;I&nbsp;do&nbsp;not&nbsp;remember&nbsp;enough&nbsp;details&nbsp;to&nbsp;tell&nbsp;&lt;br&gt;<br>
you&nbsp;more,&nbsp;but&nbsp;one&nbsp;can&nbsp;set&nbsp;up&nbsp;a&nbsp;controlled&nbsp;test&nbsp;and&nbsp;see&nbsp;what&nbsp;is&nbsp;actually&nbsp;&lt;br&gt;<br>
going&nbsp;on.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;sslproxy_session_cache_size&nbsp;10&nbsp;MB&lt;br&gt;<br>
&gt;&nbsp;tls_outgoing_options&nbsp;options=NO_TICKET&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;Agree,&nbsp;it&nbsp;might&nbsp;not&nbsp;make&nbsp;sense&nbsp;to&nbsp;increase&nbsp;the&nbsp;complexity&nbsp;with&nbsp;sharing&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;socket&nbsp;among&nbsp;the&nbsp;workers.&nbsp;Was&nbsp;thinking&nbsp;more&nbsp;on&nbsp;the&nbsp;lines&nbsp;of&nbsp;a&nbsp;hashmap&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;that&nbsp;the&nbsp;coordinator&nbsp;could&nbsp;use&nbsp;to&nbsp;pick&nbsp;workers&nbsp;that&nbsp;already&nbsp;have&nbsp;a&nbsp;TCP&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;connection&nbsp;to&nbsp;the&nbsp;destination&nbsp;being&nbsp;requested,&nbsp;instead&nbsp;of&nbsp;having&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &gt;&nbsp;workers&nbsp;themselves&nbsp;share&nbsp;connection&nbsp;details.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Coordinator&nbsp;does&nbsp;not&nbsp;receive/see&nbsp;regular&nbsp;HTTP&nbsp;traffic.&nbsp;If&nbsp;we&nbsp;start&lt;br&gt;<br>
&gt; &nbsp; &nbsp; routing&nbsp;HTTP&nbsp;transactions&nbsp;through&nbsp;that&nbsp;process,&nbsp;it&nbsp;may&nbsp;become&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; bottleneck&nbsp;itself&nbsp;_and_&nbsp;will&nbsp;introduce&nbsp;additional&nbsp;overheads&nbsp;for&nbsp;passing&lt;br&gt;<br>
&gt; &nbsp; &nbsp; descriptors&nbsp;to&nbsp;workers.&nbsp;From&nbsp;performance&nbsp;point&nbsp;of&nbsp;view,&nbsp;the&nbsp;model&nbsp;with&lt;br&gt;<br>
&gt; &nbsp; &nbsp; one&nbsp;&quot;routing&quot;&nbsp;task&nbsp;doling&nbsp;work&nbsp;to&nbsp;workers&nbsp;works&nbsp;best&nbsp;(and&nbsp;is&nbsp;commonly&lt;br&gt;<br>
&gt; &nbsp; &nbsp; used)&nbsp;in&nbsp;threaded&nbsp;applications,&nbsp;but&nbsp;Squid&nbsp;is&nbsp;not&nbsp;threaded&nbsp;at&nbsp;that&nbsp;level.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Most&nbsp;of&nbsp;the&nbsp;TCP&nbsp;connections&nbsp;are&nbsp;for&nbsp;HTTPS&nbsp;reqs,&nbsp;w/o&nbsp;TLS&lt;br&gt;<br>
&gt; &nbsp; &nbsp; termination&nbsp;at&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;the&nbsp;squid.&nbsp;Does&nbsp;squid&nbsp;currently&nbsp;support&nbsp;a&nbsp;TLS&nbsp;session&nbsp;cache&nbsp;?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Yes,&nbsp;there&nbsp;is&nbsp;some&nbsp;support&nbsp;for&nbsp;worker-specific&nbsp;TLS&nbsp;session&nbsp;caching,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; with&lt;br&gt;<br>
&gt; &nbsp; &nbsp; directives&nbsp;like&nbsp;sslproxy_session_cache_size,&nbsp;tls_outgoing_options&lt;br&gt;<br>
&gt; &nbsp; &nbsp; options=NO_TICKET&nbsp;(for&nbsp;outgoing&nbsp;sessions&nbsp;IIRC)&nbsp;and&nbsp;https_port&lt;br&gt;<br>
&gt; &nbsp; &nbsp; sslflags=NO_SESSION_REUSE&nbsp;and&nbsp;https_port&nbsp;sslcontext&nbsp;(for&nbsp;incoming&lt;br&gt;<br>
&gt; &nbsp; &nbsp; sessions).&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; HTH,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; If&nbsp;you&nbsp;are&nbsp;dealing&nbsp;with&nbsp;TLS&nbsp;sessions&nbsp;as&nbsp;well,&nbsp;then&nbsp;we&nbsp;should&lt;br&gt;<br>
&gt; &nbsp; &nbsp; add&nbsp;a&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; shared&nbsp;memory&nbsp;TLS&nbsp;session&nbsp;cache&nbsp;that&nbsp;all&nbsp;workers&nbsp;can&nbsp;tap&nbsp;into.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Cheers,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;On&nbsp;Tue,&nbsp;Jun&nbsp;21,&nbsp;2022&nbsp;at&nbsp;2:11&nbsp;PM&nbsp;Alex&nbsp;Rousskov&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; On&nbsp;6/19/22&nbsp;12:48,&nbsp;Praveen&nbsp;Ponakanti&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;What&nbsp;is&nbsp;the&nbsp;process&nbsp;to&nbsp;have&nbsp;this&nbsp;code&nbsp;patch&lt;br&gt;<br>
&gt; &nbsp; &nbsp; upstreamed&nbsp;for&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; future&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; squid&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;versions?&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; In&nbsp;short,&nbsp;just&nbsp;post&nbsp;a&nbsp;quality&nbsp;pull&nbsp;request&nbsp;on&nbsp;GitHub&lt;br&gt;<br>
&gt; &nbsp; &nbsp; (or&nbsp;find&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; somebody&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; who&nbsp;can&nbsp;guide&nbsp;your&nbsp;code&nbsp;towards&nbsp;official&nbsp;acceptance&lt;br&gt;<br>
&gt; &nbsp; &nbsp; for&nbsp;you).&nbsp;For&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; details,&nbsp;please&nbsp;see&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/MergeProcedure&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/MergeProcedure&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/MergeProcedure&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/MergeProcedure&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/MergeProcedure&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/MergeProcedure&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/MergeProcedure&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/MergeProcedure&lt;/a&gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/MergeProcedure&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/MergeProcedure&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/MergeProcedure&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/MergeProcedure&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/MergeProcedure&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/MergeProcedure&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/MergeProcedure&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/MergeProcedure&lt;/a&gt;&gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Thank&nbsp;you,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;On&nbsp;Fri,&nbsp;May&nbsp;20,&nbsp;2022&nbsp;at&nbsp;9:31&nbsp;PM&nbsp;Amos&nbsp;Jeffries&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; On&nbsp;20/05/22&nbsp;19:44,&nbsp;Praveen&nbsp;Ponakanti&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Hi&nbsp;Alex,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Thanks&nbsp;for&nbsp;going&nbsp;through&nbsp;several&nbsp;steps&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; help&nbsp;mitigate&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; src&nbsp;port&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;exhaustion.&nbsp;We&nbsp;are&nbsp;looking&nbsp;to&nbsp;achieve&lt;br&gt;<br>
&gt; &nbsp; &nbsp; 400-500%&nbsp;more&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;concurrent connections&nbsp;if&nbsp;we&nbsp;could&nbsp;:)&nbsp;as&lt;br&gt;<br>
&gt; &nbsp; &nbsp; there&nbsp;is&nbsp;a&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; significant buffer&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;on&nbsp;the&nbsp;available&nbsp;CPU.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Then&nbsp;you&nbsp;require&nbsp;at&nbsp;least&nbsp;4,&nbsp;maybe&nbsp;5,&nbsp;IP&lt;br&gt;<br>
&gt; &nbsp; &nbsp; addresses&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; handle&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; that&nbsp;many&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; concurrent&nbsp;connections&nbsp;with&nbsp;Squid.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;We&nbsp;would&nbsp;like&nbsp;to&nbsp;investigate&nbsp;going&nbsp;beyond&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; ephemeral&nbsp;port&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; range&nbsp;for&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;some&nbsp;specific&nbsp;destination&nbsp;IP:PORT&nbsp;addresses.&nbsp;For&lt;br&gt;<br>
&gt; &nbsp; &nbsp; that&nbsp;it&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; appears&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; squid&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;does&nbsp;not&nbsp;round-robin&nbsp;requests&nbsp;if&nbsp;we&nbsp;use&nbsp;multiple&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; tcp_outgoing_addresses.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;We&nbsp;could&nbsp;use&nbsp;ACL’s&nbsp;to&nbsp;pick&nbsp;a&nbsp;different&nbsp;outbound&nbsp;IP&lt;br&gt;<br>
&gt; &nbsp; &nbsp; based&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; on&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; clients&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;source&nbsp;IP,&nbsp;however&nbsp;that&nbsp;is&nbsp;not&nbsp;very&nbsp;ideal&nbsp;in&nbsp;our&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; environment&nbsp;as&nbsp;our&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;clients&nbsp;aren’t&nbsp;always&nbsp;equally&nbsp;split&nbsp;by&nbsp;subnet.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; However,&nbsp;if&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; we&nbsp;could&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;split&nbsp;by&nbsp;the&nbsp;client’s&nbsp;source&nbsp;port&nbsp;that&nbsp;might&nbsp;help&lt;br&gt;<br>
&gt; &nbsp; &nbsp; achieve&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; this.&nbsp;For&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;example&nbsp;something&nbsp;like:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;acl&nbsp;pool1&nbsp;clientport&nbsp;0-32768&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;acl&nbsp;pool2&nbsp;clientport&nbsp;32769-65536&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;tcp_outgoing_address&nbsp;10.1.0.1&nbsp;pool1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;tcp_outgoing_address&nbsp;10.1.0.2&nbsp;pool2&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Squid&#39;s&nbsp;ACLs&nbsp;currently&nbsp;do&nbsp;not&nbsp;allow&nbsp;filtering&nbsp;by&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; client&#39;s&nbsp;source&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;port.&nbsp;We&nbsp;could&nbsp;look&nbsp;into&nbsp;a&nbsp;separate&nbsp;patch&nbsp;to&nbsp;add&nbsp;this&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; functionality&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;squid’s&nbsp;ACL&nbsp;code&nbsp;if&nbsp;that&nbsp;makes&nbsp;sense.&nbsp;Or&nbsp;is&nbsp;there&nbsp;a&lt;br&gt;<br>
&gt; &nbsp; &nbsp; better&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; way&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;achieve&nbsp;this?&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Thanks&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Praveen&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;The&nbsp;option&nbsp;to&nbsp;use&nbsp;multiple&nbsp;tcp_outoing_addresses&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; appears&nbsp;to&nbsp;be&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; promising&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;along&nbsp;with&nbsp;some&nbsp;tweaks&nbsp;to&nbsp;the&nbsp;TCP&nbsp;timeouts.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; I&nbsp;guess&nbsp;we&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; could&nbsp;use&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; ACLs&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;pick&nbsp;a&nbsp;different&nbsp;outbound&nbsp;IP&nbsp;based&nbsp;on&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; requesting&nbsp;client&#39;s&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; prefix.&nbsp;We&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;had&nbsp;not&nbsp;considered&nbsp;that&nbsp;option&nbsp;as&nbsp;the&nbsp;ephemeral&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; ports&nbsp;were&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; no&nbsp;longer&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;available to&nbsp;other&nbsp;applications&nbsp;when&nbsp;squid&lt;br&gt;<br>
&gt; &nbsp; &nbsp; uses&nbsp;most&nbsp;of&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; them&nbsp;with&nbsp;a&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;single&nbsp;outbound&nbsp;IP&nbsp;configured.&nbsp;We&nbsp;are&nbsp;also&lt;br&gt;<br>
&gt; &nbsp; &nbsp; looking&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; modify&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; code&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;use&nbsp;the&nbsp;IP_BIND_ADDRESS_NO_PORT&nbsp;sockopt&nbsp;as&nbsp;that&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; could&nbsp;help&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; delay&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; port&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;assignment&nbsp;with&nbsp;the&nbsp;bind()&nbsp;call&nbsp;on&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; outbound&nbsp;TCP&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; sessions&nbsp;(to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;hopefully&nbsp;allow&nbsp;access&nbsp;to&nbsp;the&nbsp;4-tuple&nbsp;on&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; socket).&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Patches&nbsp;welcome.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; However,&nbsp;please&nbsp;be&nbsp;aware&nbsp;that&nbsp;use&nbsp;of&nbsp;the&nbsp;4-tuple&nbsp;is&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; often&nbsp;no&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; different&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; from&nbsp;the&nbsp;3-tuple&nbsp;since&nbsp;the&nbsp;dst-port&nbsp;is&lt;br&gt;<br>
&gt; &nbsp; &nbsp; typically&nbsp;identical&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; for&nbsp;all&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; outgoing&nbsp;traffic&nbsp;to&nbsp;a&nbsp;given&nbsp;dst-IP.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Cheers&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; Amos&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
