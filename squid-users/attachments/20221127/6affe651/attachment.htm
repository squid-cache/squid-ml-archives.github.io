<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Amos.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;advice.&nbsp;I&nbsp;applied&nbsp;the&nbsp;instructionts&nbsp;that&nbsp;you&nbsp;have&nbsp;sent&nbsp;it&nbsp;to&nbsp;me&nbsp;in&nbsp;this&nbsp;link: &lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect&quot;&gt;https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect&lt;/a&gt; and&nbsp;the &lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute&quot;&gt;https://wiki.squid-cache.org/ConfigExamples/Intercept/IptablesPolicyRoute&lt;/a&gt;,&nbsp;the&nbsp;case&nbsp;of:&nbsp;&quot;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-family:Arial,&quot;Lucida&nbsp;Grande&quot;,sans-serif;font-size:1.1em&quot;&gt;When&nbsp;Squid&nbsp;is&nbsp;Internal&nbsp;amongst&nbsp;clients&quot;&nbsp;and&nbsp;the&nbsp;section:  &lt;/span&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-family:Arial,&quot;Lucida&nbsp;Grande&quot;,sans-serif;font-size:1.3em&quot;&gt;Routing&nbsp;Setup.&nbsp;Now&nbsp;I&nbsp;can&nbsp;see&nbsp;the&nbsp;squid&nbsp;is&nbsp;intercepting&nbsp;the&nbsp;traffic&nbsp;however,&nbsp;it&nbsp;is&nbsp;not&nbsp;applying&nbsp;my&nbsp;policies:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-family:Arial,&quot;Lucida&nbsp;Grande&quot;,sans-serif;font-size:1.3em&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;http_access&nbsp;deny&nbsp;cliente_linux&nbsp;sitios2&lt;br&gt;http_access&nbsp;deny&nbsp;cliente_windows&nbsp;sitios1&lt;br&gt;http_access&nbsp;allow&nbsp;mi_red&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&quot;sitios2&quot;=facebook&lt;/div&gt;&lt;div&gt;&lt;div&gt;&quot;sitios1&quot;=youtube&lt;/div&gt;&lt;div&gt; these&nbsp;policies&nbsp;work&nbsp;when&nbsp;I&nbsp;set&nbsp;up&nbsp;manually&nbsp;the&nbsp;proxy.&nbsp;Do&nbsp;you&nbsp;have&nbsp;any&nbsp;idea&nbsp;of&nbsp;how&nbsp;to&nbsp;troubleshoot&nbsp;this?&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;help&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Wed,&nbsp;Nov&nbsp;16,&nbsp;2022&nbsp;at&nbsp;11:35&nbsp;PM&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;17/11/2022&nbsp;9:14&nbsp;am,&nbsp;Lola&nbsp;Lo&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;guys.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Could&nbsp;you&nbsp;please&nbsp;send&nbsp;a&nbsp;tutorial&nbsp;or&nbsp;any&nbsp;good&nbsp;guidance&nbsp;to&nbsp;implement &nbsp;&lt;br&gt;<br>
&gt;&nbsp;squid&nbsp;on&nbsp;transparent&nbsp;mode&nbsp;on&nbsp;centos&nbsp;9&nbsp;with&nbsp;iptables.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;configuration&nbsp;details&nbsp;for&nbsp;what&nbsp;you&nbsp;appear&nbsp;to&nbsp;be&nbsp;trying&nbsp;to&nbsp;configure&nbsp;&lt;br&gt;<br>
are&nbsp;here:&lt;br&gt;<br>
  &lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/ConfigExamples/Intercept/LinuxRedirect&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
My&nbsp;comments&nbsp;below&nbsp;relate&nbsp;to&nbsp;how&nbsp;your&nbsp;attempt&nbsp;differs&nbsp;and&nbsp;how&nbsp;to&nbsp;fix.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;configured&nbsp;squid.conf&nbsp;with&nbsp;this&nbsp;parameters:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;ens192:&nbsp;172.31.168.28,&nbsp;internet&nbsp;interface&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;ens224:&nbsp;192.168.1.10,&nbsp;LAN&nbsp;interface&nbsp;(private&nbsp;network)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;Mis&nbsp;ACLs&nbsp;#&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;mi_red&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.0/24&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://192.168.1.0/24&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;cliente_linux&nbsp;src&nbsp;192.168.1.20&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;cliente_windows&nbsp;src&nbsp;192.168.1.30&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;sitios1&nbsp;url_regex&nbsp;&quot;/etc/squid/listas/sitios1&quot;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;sitios2&nbsp;url_regex&nbsp;&quot;/etc/squid/listas/sitios2&quot;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;Squid&nbsp;normally&nbsp;listens&nbsp;to&nbsp;port&nbsp;3128&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3128&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;8080&nbsp;transparent&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Firstly,&nbsp;use&nbsp;&quot;intercept&quot;&nbsp;instead&nbsp;of&nbsp;&quot;transparent&quot;&nbsp;with&nbsp;modern&nbsp;Squid.&lt;br&gt;<br>
&lt;br&gt;<br>
Secondly,&nbsp;remember&nbsp;that&nbsp;only&nbsp;port&nbsp;8080&nbsp;is&nbsp;setup&nbsp;to&nbsp;receive&nbsp;intercepted&nbsp;&lt;br&gt;<br>
traffic.&nbsp;Port&nbsp;3128&nbsp;still&nbsp;receives&nbsp;normal&nbsp;forward-proxy&nbsp;traffic.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;want&nbsp;the&nbsp;“deny&nbsp;all”&nbsp;rule&nbsp;get&nbsp;applied&nbsp;to&nbsp;test&nbsp;the&nbsp;client&nbsp;using&nbsp;the&nbsp;proxy&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;have&nbsp;not&nbsp;shown&nbsp;any&nbsp;http_access&nbsp;lines&nbsp;from&nbsp;your&nbsp;config.&nbsp;There&nbsp;is&nbsp;a&nbsp;&lt;br&gt;<br>
clear&nbsp;bug&nbsp;in&nbsp;your&nbsp;NAT&nbsp;which&nbsp;explains&nbsp;the&nbsp;behaviour&nbsp;so&nbsp;I&nbsp;will&nbsp;assume&nbsp;that&nbsp;&lt;br&gt;<br>
the&nbsp;squid.conf&nbsp;policy&nbsp;does&nbsp;what&nbsp;you&nbsp;want.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;iptables&nbsp;is&nbsp;configured&nbsp;as&nbsp;follows:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;#!/bin/bash&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;##&nbsp;NAT&nbsp;server&nbsp;configuration&nbsp;##&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;sysctl&nbsp;-w&nbsp;net.ipv4.ip_forward=1&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;sysctl&nbsp;-p&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-X&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-F&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-X&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-F&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-I&nbsp;INPUT&nbsp;-m&nbsp;state&nbsp;--state&nbsp;RELATED,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-I&nbsp;FORWARD-m&nbsp;state&nbsp;--state&nbsp;RELATED,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-I&nbsp;POSTROUTING&nbsp;-o&nbsp;ens192&nbsp;-j&nbsp;MASQUERADE&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Why&nbsp;is&nbsp;this&nbsp;a&nbsp;different&nbsp;script?&lt;br&gt;<br>
Ideally&nbsp;the&nbsp;firewall&nbsp;rules&nbsp;should&nbsp;be&nbsp;as&nbsp;atomic&nbsp;as&nbsp;possible&nbsp;to&nbsp;avoid&nbsp;&lt;br&gt;<br>
connections&nbsp;being&nbsp;setup&nbsp;with&nbsp;only&nbsp;part&nbsp;of&nbsp;the&nbsp;rules&nbsp;applied.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;#!/bin/bash&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;##&nbsp;proxy&nbsp;server&nbsp;configuration&nbsp;##&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;###&nbsp;Accepting&nbsp;traffic&nbsp;for&nbsp;the&nbsp;ports:&nbsp;3128&nbsp;and&nbsp;8080##&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-A&nbsp;INPUT&nbsp;-s&nbsp;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.0/24&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://192.168.1.0/24&lt;/a&gt;&gt;&nbsp;-p&nbsp;tcp&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--dport&nbsp;3128&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;3128&nbsp;-j&nbsp;DROP&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Do&nbsp;not&nbsp;accept&nbsp;traffic&nbsp;directly&nbsp;to&nbsp;the&nbsp;port&nbsp;8080.&nbsp;Also&nbsp;Squid&nbsp;does&nbsp;not&nbsp;&lt;br&gt;<br>
make&nbsp;outbound&nbsp;connections&nbsp;from&nbsp;its&nbsp;listening&nbsp;ports.&lt;br&gt;<br>
So&nbsp;these&nbsp;...&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-d&nbsp;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.0/24&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://192.168.1.0/24&lt;/a&gt;&gt;&nbsp;-p&nbsp;tcp&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--sport&nbsp;3128&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-p&nbsp;tcp&nbsp;--sport&nbsp;3128&nbsp;-j&nbsp;DROP&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-A&nbsp;INPUT&nbsp;-s&nbsp;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.0/24&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://192.168.1.0/24&lt;/a&gt;&gt;&nbsp;-p&nbsp;tcp&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--dport&nbsp;8080&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;8080&nbsp;-j&nbsp;DROP&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-d&nbsp;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.0/24&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://192.168.1.0/24&lt;/a&gt;&gt;&nbsp;-p&nbsp;tcp&nbsp;&lt;br&gt;<br>
&gt;&nbsp;--sport&nbsp;8080&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-p&nbsp;tcp&nbsp;--sport&nbsp;8080&nbsp;-j&nbsp;DROP&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
...&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; iptables&nbsp;-t&nbsp;mangle&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;8080&nbsp;-j&nbsp;DROP&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;`###&nbsp;Accepting&nbsp;traffic&nbsp;for&nbsp;the&nbsp;ports:&nbsp;3128&nbsp;and&nbsp;8080##&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;POSTROUTING&nbsp;-o&nbsp;ens192&nbsp;-j&nbsp;MASQUERADE&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;are&nbsp;missing&nbsp;a&nbsp;rule&nbsp;to&nbsp;allow&nbsp;Squid&nbsp;outbound&nbsp;traffic&nbsp;to&nbsp;avoid&nbsp;the&nbsp;NAT.&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;192.168.1.10&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;ACCEPT&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.0/24&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://192.168.1.0/24&lt;/a&gt;&gt;&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;8080&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-s&nbsp;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.0/24&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://192.168.1.0/24&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://192.168.1.0/24&lt;/a&gt;&gt;&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;8080&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
Port&nbsp;8080&nbsp;in&nbsp;your&nbsp;squid.conf&nbsp;can&nbsp;only&nbsp;handle&nbsp;port&nbsp;80&nbsp;traffic&nbsp;syntax.&lt;br&gt;<br>
&lt;br&gt;<br>
Port&nbsp;443&nbsp;is&nbsp;a&nbsp;more&nbsp;tricky&nbsp;situation.&nbsp;I&nbsp;recommend&nbsp;removing&nbsp;that&nbsp;until&nbsp;you&nbsp;&lt;br&gt;<br>
have&nbsp;the&nbsp;port&nbsp;80&nbsp;working.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;But&nbsp;I&nbsp;got&nbsp;this&nbsp;error:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;1668381894.7460&nbsp;192.168.1.20&nbsp;NONE_NONE/000&nbsp;0&nbsp;-&nbsp;&lt;br&gt;<br>
&gt;&nbsp;error:transaction-end-before-headers&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;1668381967.8000&nbsp;192.168.1.20&nbsp;NONE_NONE/400&nbsp;3690&nbsp;-&nbsp;&lt;br&gt;<br>
&gt;&nbsp;error:invalid-request&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
This&nbsp;is&nbsp;likely&nbsp;from&nbsp;the&nbsp;missing&nbsp;NAT&nbsp;rule&nbsp;allowing&nbsp;Squid&nbsp;outbound.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;the&nbsp;above&nbsp;changes&nbsp;do&nbsp;not&nbsp;fix&nbsp;everything&nbsp;make&nbsp;sure&nbsp;that&nbsp;you&nbsp;test&nbsp;&lt;br&gt;<br>
exactly&nbsp;what&nbsp;the&nbsp;real&nbsp;clients&nbsp;will&nbsp;be&nbsp;doing.&nbsp;Specifically&nbsp;that&nbsp;they&nbsp;are&nbsp;&lt;br&gt;<br>
making&nbsp;contact&nbsp;to&nbsp;servers&nbsp;on&nbsp;port&nbsp;80&nbsp;or&nbsp;directly&nbsp;to&nbsp;Squid&nbsp;port&nbsp;3128.&nbsp;&lt;br&gt;<br>
They&nbsp;know&nbsp;*nothing*&nbsp;about&nbsp;port&nbsp;8080&nbsp;existence&nbsp;so&nbsp;have&nbsp;no&nbsp;reason&nbsp;to&nbsp;send&nbsp;&lt;br&gt;<br>
anything&nbsp;that&nbsp;way&nbsp;directly.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH&lt;br&gt;<br>
Amos&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
