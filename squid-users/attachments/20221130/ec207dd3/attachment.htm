<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi&nbsp;again!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;the&nbsp;info!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Log&nbsp;with&nbsp;error&nbsp;code&nbsp;and&nbsp;error&nbsp;detail&nbsp;at&nbsp;the&nbsp;end,&nbsp;both&nbsp;&quot;-&quot;:&lt;br&gt;&lt;/div&gt;&lt;div&gt;1669794718.051&nbsp;INTERNAL_IP&nbsp;&lt;b&gt;TCP_TUNNEL/500&lt;/b&gt;&nbsp;&lt;a&nbsp;href=&quot;http://arsenal.us-west-2.amazonaws.com&quot;&gt;arsenal.us-west-2.amazonaws.com&lt;/a&gt;&nbsp;splice&nbsp;/CN=&lt;a&nbsp;href=&quot;http://arsenal.us-west-2.amazonaws.com&quot;&gt;arsenal.us-west-2.amazonaws.com&lt;/a&gt;&nbsp;54.240.254.131&lt;b&gt;&nbsp;-&nbsp;-&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;cache.log&nbsp;with&nbsp;ALL,1&nbsp;does&nbsp;not&nbsp;look&nbsp;to&nbsp;share&nbsp;a&nbsp;lot,&nbsp;in&nbsp;fact&nbsp;I&nbsp;don´t&nbsp;see&nbsp;any&nbsp;messages&nbsp;referencing&nbsp;this&nbsp;transaction:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;22/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Current&nbsp;Directory&nbsp;is&nbsp;/&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Creating&nbsp;missing&nbsp;swap&nbsp;directories&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;No&nbsp;cache_dir&nbsp;stores&nbsp;are&nbsp;configured.&lt;br&gt;2022/11/30&nbsp;07:51:39|&nbsp;Removing&nbsp;PID&nbsp;file&nbsp;(/run/squid.pid)&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Current&nbsp;Directory&nbsp;is&nbsp;/&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Starting&nbsp;Squid&nbsp;Cache&nbsp;version&nbsp;5.7&nbsp;for&nbsp;x86_64-pc-linux-gnu...&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Service&nbsp;Name:&nbsp;squid&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Process&nbsp;ID&nbsp;64694&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Process&nbsp;Roles:&nbsp;worker&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;With&nbsp;1024&nbsp;file&nbsp;descriptors&nbsp;available&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Initializing&nbsp;IP&nbsp;Cache...&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;DNS&nbsp;Socket&nbsp;created&nbsp;at&nbsp;[::],&nbsp;FD&nbsp;9&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;DNS&nbsp;Socket&nbsp;created&nbsp;at&nbsp;0.0.0.0,&nbsp;FD&nbsp;10&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Adding&nbsp;nameserver&nbsp;127.0.0.53&nbsp;from&nbsp;/etc/resolv.conf&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Adding&nbsp;domain&nbsp;dev.ops.mitekcloud.local&nbsp;from&nbsp;/etc/resolv.conf&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;helperOpenServers:&nbsp;Starting&nbsp;5/32&nbsp;&#39;security_file_certgen&#39;&nbsp;processes&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Logfile:&nbsp;opening&nbsp;log&nbsp;daemon:/var/log/squid/custom.log&lt;br&gt;2022/11/30&nbsp;07:51:39&nbsp;kid1|&nbsp;Logfile&nbsp;Daemon:&nbsp;opening&nbsp;log&nbsp;/var/log/squid/custom.log&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Local&nbsp;cache&nbsp;digest&nbsp;enabled;&nbsp;rebuild/rewrite&nbsp;every&nbsp;3600/3600&nbsp;sec&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Store&nbsp;logging&nbsp;disabled&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Swap&nbsp;maxSize&nbsp;0&nbsp;+&nbsp;262144&nbsp;KB,&nbsp;estimated&nbsp;20164&nbsp;objects&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Target&nbsp;number&nbsp;of&nbsp;buckets:&nbsp;1008&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Using&nbsp;8192&nbsp;Store&nbsp;buckets&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Max&nbsp;Mem&nbsp; size:&nbsp;262144&nbsp;KB&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Max&nbsp;Swap&nbsp;size:&nbsp;0&nbsp;KB&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Using&nbsp;Least&nbsp;Load&nbsp;store&nbsp;dir&nbsp;selection&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Current&nbsp;Directory&nbsp;is&nbsp;/&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Finished&nbsp;loading&nbsp;MIME&nbsp;types&nbsp;and&nbsp;icons.&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;HTCP&nbsp;Disabled.&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Pinger&nbsp;socket&nbsp;opened&nbsp;on&nbsp;FD&nbsp;27&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Squid&nbsp;plugin&nbsp;modules&nbsp;loaded:&nbsp;0&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Accepting&nbsp;HTTP&nbsp;Socket&nbsp;connections&nbsp;at&nbsp;conn13&nbsp;local=[::]:3128&nbsp;remote=[::]&nbsp;FD&nbsp;23&nbsp;flags=9&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Accepting&nbsp;NAT&nbsp;intercepted&nbsp;HTTP&nbsp;Socket&nbsp;connections&nbsp;at&nbsp;conn15&nbsp;local=[::]:3129&nbsp;remote=[::]&nbsp;FD&nbsp;24&nbsp;flags=41&lt;br&gt;2022/11/30&nbsp;07:51:40&nbsp;kid1|&nbsp;Accepting&nbsp;NAT&nbsp;intercepted&nbsp;SSL&nbsp;bumped&nbsp;HTTPS&nbsp;Socket&nbsp;connections&nbsp;at&nbsp;conn17&nbsp;local=[::]:3130&nbsp;remote=[::]&nbsp;FD&nbsp;25&nbsp;flags=41&lt;br&gt;2022/11/30&nbsp;07:51:40|&nbsp;pinger:&nbsp;Initialising&nbsp;ICMP&nbsp;pinger&nbsp;...&lt;br&gt;2022/11/30&nbsp;07:51:40|&nbsp;pinger:&nbsp;ICMP&nbsp;socket&nbsp;opened.&lt;br&gt;2022/11/30&nbsp;07:51:40|&nbsp;pinger:&nbsp;ICMPv6&nbsp;socket&nbsp;opened&lt;br&gt;2022/11/30&nbsp;07:51:41&nbsp;kid1|&nbsp;storeLateRelease:&nbsp;released&nbsp;0&nbsp;objects&lt;br&gt;2022/11/30&nbsp;07:52:09&nbsp;kid1|&nbsp;Preparing&nbsp;for&nbsp;shutdown&nbsp;after&nbsp;3&nbsp;requests&lt;/div&gt;&lt;div&gt;...&nbsp;Starts&nbsp;ending&nbsp;the&nbsp;connections&nbsp;for&nbsp;shutdown,&nbsp;ends&nbsp;with&nbsp;next&nbsp;message...&lt;/div&gt;&lt;div&gt;&lt;b&gt;2022/11/30&nbsp;07:52:40&nbsp;kid1|&nbsp;Squid&nbsp;Cache&nbsp;(Version&nbsp;5.7):&nbsp;Exiting&nbsp;normally.&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;checked&nbsp;with&nbsp;further&nbsp;log&nbsp;levels&nbsp;but&nbsp;it&nbsp;outputs&nbsp;a&nbsp;lot&nbsp;of&nbsp;data&nbsp;(I&nbsp;know&nbsp;this&nbsp;one&nbsp;is&nbsp;not&nbsp;for&nbsp;admins,&nbsp;I&nbsp;wanted&nbsp;to&nbsp;try&nbsp;to&nbsp;sent&nbsp;only&nbsp;the&nbsp;relevant&nbsp;logs&nbsp;since&nbsp;those&nbsp;aws&nbsp;agents&nbsp;do&nbsp;several&nbsp;calls&nbsp;and&nbsp;I&nbsp;was&nbsp;not&nbsp;to&nbsp;only&nbsp;record&nbsp;one&nbsp;transaction).&nbsp;Also&nbsp;if&nbsp;I&nbsp;needed,&nbsp;this&nbsp;is&nbsp;shared&nbsp;as&nbsp;an&nbsp;attachment?&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance!&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;El&nbsp;mar,&nbsp;29&nbsp;nov&nbsp;2022&nbsp;a&nbsp;las&nbsp;21:52,&nbsp;Gabriel&nbsp;Vilariño&nbsp;(&lt;&lt;a&nbsp;href=&quot;mailto:gvilarino6@gmail.com&quot;&gt;gvilarino6@gmail.com&lt;/a&gt;&gt;)&nbsp;escribió:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Thanks&nbsp;Alex!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Here&nbsp;are&nbsp;the&nbsp;fixed&nbsp;logs:&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;1669726977.734&nbsp;INTERNAL_CLIENT_IP&nbsp;TCP_TUNNEL/500&nbsp;&lt;a&nbsp;href=&quot;http://arsenal.us-west-2.amazonaws.com&quot;&nbsp;target=&quot;_blank&quot;&gt;arsenal.us-west-2.amazonaws.com&lt;/a&gt;&nbsp;splice&nbsp;/CN=&lt;a&nbsp;href=&quot;http://arsenal.us-west-2.amazonaws.com&quot;&nbsp;target=&quot;_blank&quot;&gt;arsenal.us-west-2.amazonaws.com&lt;/a&gt;&nbsp;54.240.251.223&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif&quot;&gt;As&nbsp;you&nbsp;can&nbsp;see,&nbsp;the&nbsp;destination&nbsp;is&nbsp;an&nbsp;aws&nbsp;service,&nbsp;more&nbsp;interesting,&nbsp;it&nbsp;effectively&nbsp;&lt;b&gt;logs&nbsp;the&nbsp;splice&lt;/b&gt;&nbsp;action!&nbsp;That´s&nbsp;why&nbsp;I&nbsp;though&nbsp;it&nbsp;was&nbsp;letting&nbsp;the&nbsp;traffic&nbsp;go&nbsp;trough.&nbsp;Also&nbsp;the&nbsp;debug&nbsp;logs&nbsp;fr&lt;/span&gt;om&nbsp;SSL&nbsp;show&nbsp;this:&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;2022/11/29&nbsp;10:32:38.943&nbsp;kid1|&nbsp;83,5|&nbsp;PeekingPeerConnector.cc(273)&nbsp;&lt;b&gt;startTunneling:&nbsp;will&nbsp;tunnel&nbsp;instead&nbsp;of&nbsp;negotiating&nbsp;TLS&lt;/b&gt;&nbsp;&nbsp;#&nbsp;Last&nbsp;line&nbsp;from&nbsp;previously&nbsp;attached&nbsp;logs&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;br&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif&quot;&gt;As&nbsp;far&nbsp;as&nbsp;I&nbsp;know&nbsp;this&nbsp;means&nbsp;&lt;b&gt;is&nbsp;getting&nbsp;to&nbsp;the&nbsp;TCP_TUNNEL,&nbsp;at&nbsp;that&nbsp;point&nbsp;it&nbsp;can&nbsp;not&nbsp;know&nbsp;anything&nbsp;about&nbsp;the&nbsp;internal&nbsp;status&nbsp;on&nbsp;the&nbsp;connection&nbsp;between&nbsp;client&nbsp;and&nbsp;host&lt;/b&gt;.&nbsp;If&nbsp;not,&nbsp;&lt;b&gt;where&nbsp;I&nbsp;should&nbsp;be&nbsp;looking&nbsp;for&nbsp;this&nbsp;error?&nbsp;&lt;/b&gt;Should&nbsp;try&nbsp;to&nbsp;review&nbsp;further&nbsp;the&nbsp;debug&nbsp;ssl&nbsp;logs&nbsp;to&nbsp;se&nbsp;if&nbsp;I&nbsp;fend&nbsp;something&nbsp;more&nbsp;useful?&nbsp;Maybe&nbsp;tcpdump?&nbsp;This&nbsp;could&nbsp;be&nbsp;just&nbsp;the&nbsp;end&nbsp;service&nbsp;failing&nbsp;on&nbsp;the&nbsp;request?&nbsp;Or&nbsp;is&nbsp;an&nbsp;error&nbsp;between&nbsp;Squid&nbsp;and&nbsp;the&nbsp;end&nbsp;sever?&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif&quot;&gt;If&nbsp;I&nbsp;understand&nbsp;right&nbsp;the&nbsp;request&nbsp;that&nbsp;fails&nbsp;is&nbsp;the&nbsp;fake&nbsp;connect&nbsp;and&nbsp;I&nbsp;need&nbsp;to&nbsp;understand&nbsp;why.&nbsp;Also&nbsp;note&nbsp;almost&nbsp;same&nbsp;config&nbsp;logged&nbsp;this&nbsp;as&nbsp;TCP_TUNNEL/200&nbsp;on&nbsp;version&nbsp;3.5.&lt;/span&gt;&nbsp;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif&quot;&gt;But&nbsp;as&nbsp;said&nbsp;before,&nbsp;I&nbsp;really&nbsp;not&nbsp;sure&nbsp;how&nbsp;to&nbsp;check,&nbsp;since&nbsp;that&nbsp;service&nbsp;is&nbsp;just&nbsp;an&nbsp;agent&nbsp;installed&nbsp;on&nbsp;some&nbsp;aws&nbsp;machines&nbsp;and&nbsp;don´t&nbsp;know&nbsp;how&nbsp;to&nbsp;reproduce&nbsp;this&nbsp;behavior.&nbsp;&lt;/span&gt;&lt;br&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;font-family:arial,sans-serif&quot;&gt;Thanks&nbsp;again!&nbsp;Hope&nbsp;I&nbsp;answered&nbsp;fine&nbsp;since&nbsp;I&nbsp;didn´t&nbsp;get&nbsp;the&nbsp;answer&nbsp;email.&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;El&nbsp;mar,&nbsp;29&nbsp;nov&nbsp;2022&nbsp;a&nbsp;las&nbsp;14:06,&nbsp;Gabriel&nbsp;Vilariño&nbsp;(&lt;&lt;a&nbsp;href=&quot;mailto:gvilarino6@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;gvilarino6@gmail.com&lt;/a&gt;&gt;)&nbsp;escribió:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Just&nbsp;got&nbsp;it&nbsp;solved.&nbsp;Was&nbsp;caused&nbsp;because&nbsp;of&nbsp;checking&nbsp;default&nbsp;access.log.&nbsp;Using&nbsp;a&nbsp;new&nbsp;file&nbsp;solves&nbsp;all&nbsp;the&nbsp;problems.&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;in&nbsp;this&nbsp;context,&nbsp;what&nbsp;means&nbsp;TCP_TUNNEL/500?&nbsp;is&nbsp;it&nbsp;because&nbsp;the&nbsp;TLS&nbsp;handshake?&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;know&nbsp;if&nbsp;it&nbsp;is&nbsp;tunneling&nbsp;correctly&nbsp;or&nbsp;is&nbsp;having&nbsp;some&nbsp;trouble&nbsp;(not&nbsp;easy&nbsp;to&nbsp;test&nbsp;right&nbsp;now).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;El&nbsp;mar,&nbsp;29&nbsp;nov&nbsp;2022&nbsp;a&nbsp;las&nbsp;13:16,&nbsp;Gabriel&nbsp;Vilariño&nbsp;(&lt;&lt;a&nbsp;href=&quot;mailto:gvilarino6@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;gvilarino6@gmail.com&lt;/a&gt;&gt;)&nbsp;escribió:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi&nbsp;there,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;am&nbsp;setting&nbsp;up&nbsp;an&nbsp;HTTP/HTTPS&nbsp;transparent&nbsp;proxy,&nbsp;meaning&nbsp;the&nbsp;clients&nbsp;not&nbsp;need&nbsp;any&nbsp;certificates&nbsp;for&nbsp;using&nbsp;the&nbsp;proxy.&nbsp;This&nbsp;works&nbsp;fine&nbsp;on&nbsp;version&nbsp;3.5&nbsp;of&nbsp;Squid,&nbsp;however&nbsp;after&nbsp;upgrading&nbsp;to&nbsp;5.7&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;logs&nbsp;change:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1669723133.174&nbsp; &nbsp;8037&nbsp;10.184.19.220&nbsp;TCP_TUNNEL/500&nbsp;6207&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://54.240.253.128:443&quot;&nbsp;target=&quot;_blank&quot;&gt;54.240.253.128:443&lt;/a&gt;&nbsp;-&nbsp;ORIGINAL_DST/&lt;a&nbsp;href=&quot;http://54.240.253.128&quot;&nbsp;target=&quot;_blank&quot;&gt;54.240.253.128&lt;/a&gt;&nbsp;-&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Directive:&nbsp;logformat&nbsp;squid&nbsp;%ts.%03tu&nbsp;%&gt;a&nbsp;%Ss/%03&gt;Hs&nbsp;%ssl::&gt;sni&nbsp;%ssl::bump_mode&nbsp;ssl::&gt;cert_subject&nbsp;%&lt;ru&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;On&nbsp;version&nbsp;3.5&nbsp;we&nbsp;were&nbsp;obtaining&nbsp;the&nbsp;domain&nbsp;name&nbsp;(an&nbsp;aws&nbsp;service)&nbsp;in&nbsp;the&nbsp;place&nbsp;of&nbsp;ORIGINAL_DST.&nbsp;Also&nbsp;now&nbsp;we&nbsp;are&nbsp;not&nbsp;seeing&nbsp;any&nbsp;information&nbsp;about&nbsp;the&nbsp;bump_mode&nbsp;in&nbsp;no&nbsp;one&nbsp;of&nbsp;the&nbsp;connections&nbsp;while&nbsp;before&nbsp;we&nbsp;were&nbsp;seeing&nbsp;it.&nbsp;One&nbsp;could&nbsp;trough&nbsp;that&nbsp;it&nbsp;could&nbsp;be&nbsp;because&nbsp;of&nbsp;the&nbsp;/500&nbsp;message,&nbsp;however&nbsp;on&nbsp;a&nbsp;200&nbsp;one&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;http://docs.ansble.com&quot;&nbsp;target=&quot;_blank&quot;&gt;docs.ansble.com&lt;/a&gt;&nbsp;it&nbsp;also&nbsp;don´t&nbsp;show&nbsp;any&nbsp;data&nbsp;on&nbsp;the&nbsp;sni&nbsp;field:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1669723513.363&nbsp; &nbsp; 332&nbsp;10.184.19.220&nbsp;TCP_TUNNEL/200&nbsp;38192&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://104.26.0.234:443&quot;&nbsp;target=&quot;_blank&quot;&gt;104.26.0.234:443&lt;/a&gt;&nbsp;-&nbsp;ORIGINAL_DST/&lt;a&nbsp;href=&quot;http://104.26.0.234&quot;&nbsp;target=&quot;_blank&quot;&gt;104.26.0.234&lt;/a&gt;&nbsp;-&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also&nbsp;the&nbsp;500&nbsp;looks&nbsp;to&nbsp;come&nbsp;from&nbsp;the&nbsp;squid&nbsp;not&nbsp;understanding&nbsp;something&nbsp;on&nbsp;the&nbsp;SSL&nbsp;negotiation:&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;&lt;span&gt;2022/11/29&nbsp;10:32:38.943&nbsp;kid1|&nbsp;83,4|&nbsp;support.cc(248)&nbsp;check_domain:&nbsp;Verifying&nbsp;server&nbsp;domain&nbsp;&lt;a&nbsp;href=&quot;http://arsenal.us-west-2.amazonaws.com&quot;&nbsp;target=&quot;_blank&quot;&gt;arsenal.us-west-2.amazonaws.com&lt;/a&gt;&nbsp;to&nbsp;certificate&nbsp;name/subjectAltName&nbsp;&lt;a&nbsp;href=&quot;http://arsenal.us-west-2.amazonaws.com&quot;&nbsp;target=&quot;_blank&quot;&gt;arsenal.us-west-2.amazonaws.com&lt;/a&gt;<br>
&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;2022/11/29&nbsp;10:32:38.943&nbsp;kid1|&nbsp;83,5|&nbsp;bio.cc(136)&nbsp;read:&nbsp;FD&nbsp;28&nbsp;read&nbsp;347&nbsp;&lt;=&nbsp;65535<br>
&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;2022/11/29&nbsp;10:32:38.943&nbsp;kid1|&nbsp;83,5|&nbsp;Io.cc(91)&nbsp;Handshake:&nbsp;-1/0&nbsp;for&nbsp;TLS&nbsp;connection&nbsp;0x558453168970&nbsp;over&nbsp;conn99&nbsp;local=SQUID-INTERNAL-IP:44264&nbsp;remote=&lt;a&nbsp;href=&quot;http://54.240.251.223:443&quot;&nbsp;target=&quot;_blank&quot;&gt;54.240.251.223:443&lt;/a&gt;&nbsp;ORIGINAL_DST&nbsp;FD&nbsp;28&nbsp;flags=1<br>
&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;2022/11/29&nbsp;10:32:38.943&nbsp;kid1|&nbsp;83,2|&nbsp;PeerConnector.cc(256)&nbsp;handleNegotiationResult:&nbsp;ERROR:&nbsp;failure&nbsp;while&nbsp;establishing&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;FD:&nbsp;280x558452b68980*1<br>
&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;2022/11/29&nbsp;10:32:38.943&nbsp;kid1|&nbsp;83,5|&nbsp;NegotiationHistory.cc(85)&nbsp;retrieveNegotiatedInfo:&nbsp;SSL&nbsp;connection&nbsp;info&nbsp;on&nbsp;FD&nbsp;28&nbsp;SSL&nbsp;version&nbsp;NONE/0.0&nbsp;negotiated&nbsp;cipher&nbsp;<br>
&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;2022/11/29&nbsp;10:32:38.943&nbsp;kid1|&nbsp;83,5|&nbsp;PeekingPeerConnector.cc(84)&nbsp;checkForPeekAndSpliceMatched:&nbsp;Will&nbsp;check&nbsp;for&nbsp;peek&nbsp;and&nbsp;splice&nbsp;on&nbsp;FD&nbsp;28<br>
&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;2022/11/29&nbsp;10:32:38.943&nbsp;kid1|&nbsp;83,5|&nbsp;PeekingPeerConnector.cc(395)&nbsp;serverCertificateVerified:&nbsp;HTTPS&nbsp;server&nbsp;CN:&nbsp;&lt;a&nbsp;href=&quot;http://arsenal.us-west-2.amazonaws.com&quot;&nbsp;target=&quot;_blank&quot;&gt;arsenal.us-west-2.amazonaws.com&lt;/a&gt;&nbsp;bumped:&nbsp;conn99&nbsp;local=SQUID-INTERNAL-IP:44264&nbsp;remote=&lt;a&nbsp;href=&quot;http://54.240.251.223:443&quot;&nbsp;target=&quot;_blank&quot;&gt;54.240.251.223:443&lt;/a&gt;&nbsp;ORIGINAL_DST&nbsp;FD&nbsp;28&nbsp;flags=1<br>
&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;code&nbsp;style=&quot;white-space:pre-wrap&quot;&gt;2022/11/29&nbsp;10:32:38.943&nbsp;kid1|&nbsp;83,5|&nbsp;PeekingPeerConnector.cc(273)&nbsp;startTunneling:&nbsp;will&nbsp;tunnel&nbsp;instead&nbsp;of&nbsp;negotiating&nbsp;TLS&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;is&nbsp;clear&nbsp;that&nbsp;in&nbsp;creates&nbsp;the&nbsp;tunnel&nbsp;so&nbsp;the&nbsp;500&nbsp;probably&nbsp;is&nbsp;that&nbsp;error?&nbsp;Why&nbsp;the&nbsp;bump/sni&nbsp;messages&nbsp;never&nbsp;log&nbsp;anything&nbsp;(according&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/SslPeekAndSplice&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/Features/SslPeekAndSplice&lt;/a&gt;&nbsp;they&nbsp;should&nbsp;log&nbsp;splice&nbsp;not&nbsp;-).&nbsp;This&nbsp;is&nbsp;the&nbsp;config&nbsp;for&nbsp;bumping:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;br&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;br&gt;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;....&nbsp;http&nbsp;rules&nbsp;...&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;acl&nbsp;allowed_https_sites&nbsp;ssl::server_name_regex&nbsp;&quot;/etc/squid/whitelist.txt&quot;&lt;br&gt;ssl_bump&nbsp;peek&nbsp;step2&nbsp;allowed_https_sites&lt;br&gt;ssl_bump&nbsp;splice&nbsp;step3&nbsp;allowed_https_sites&lt;br&gt;ssl_bump&nbsp;terminate&nbsp;step2&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Ip&nbsp;tables&nbsp;simply&nbsp;redirect:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;3129&lt;/div&gt;&lt;div&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;3130&nbsp;#&nbsp;https&nbsp;port&nbsp;on&nbsp;squid:&nbsp;https_port&nbsp;3130&nbsp;intercept&nbsp;ssl-bump&nbsp;cert=/etc/squid/ssl/dummy.pem&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;in&nbsp;advance,&nbsp;i&nbsp;have&nbsp;been&nbsp;trying&nbsp;this&nbsp;for&nbsp;a&nbsp;week&nbsp;now&nbsp;reading&nbsp;a&nbsp;lot&nbsp;of&nbsp;posts&nbsp;but&nbsp;not&nbsp;luck...&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
