<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;My&nbsp;setup&nbsp;is&nbsp;Gateway&nbsp;plus&nbsp;Webserver (Nginx)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;running&nbsp;transparent-ssl&nbsp;and&nbsp;this&nbsp;is&nbsp;my&nbsp;iptables&nbsp;config&nbsp;- &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#!/bin/sh&lt;br&gt;#&nbsp;squid&nbsp;server&nbsp;IP&lt;br&gt;SQUID_SERVER=&quot;192.168.0.8&quot;&lt;br&gt;&lt;br&gt;#&nbsp;Interface&nbsp;connected&nbsp;to&nbsp;Internet&lt;br&gt;INTERNET=&quot;eth0&quot;&lt;br&gt;&lt;br&gt;#&nbsp;Interface&nbsp;connected&nbsp;to&nbsp;LAN&lt;br&gt;LAN_IN=&quot;eth1&quot;&lt;br&gt;&lt;br&gt;#&nbsp;Squid&nbsp;port&lt;br&gt;SQUID_PORT=&quot;3129&quot;&lt;br&gt;SQUID_PORTS=&quot;3130&quot;&lt;br&gt;&lt;br&gt;#Allowing&nbsp;All&nbsp;Incoming&nbsp;HTTP&nbsp;and&nbsp;HTTPS&lt;br&gt;iptables&nbsp;-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;multiport&nbsp;--dports&nbsp;80,443&nbsp;-m&nbsp;conntrack&nbsp;--ctstate&nbsp;NEW,ESTABLISHED&nbsp;-j&nbsp;ACCEPT&lt;br&gt;iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-p&nbsp;tcp&nbsp;-m&nbsp;multiport&nbsp;--dports&nbsp;80,443&nbsp;-m&nbsp;conntrack&nbsp;--ctstate&nbsp;ESTABLISHED&nbsp;-j&nbsp;ACCEPT&lt;br&gt;&lt;br&gt;#Allow&nbsp;outbound&nbsp;DNS&lt;br&gt;iptables&nbsp;-A&nbsp;INPUT&nbsp;-p&nbsp;udp&nbsp;--source-port&nbsp;53&nbsp;-j&nbsp;ACCEPT&lt;br&gt;#iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-p&nbsp;udp&nbsp;-o&nbsp;eth0&nbsp;--dport&nbsp;53&nbsp;-j&nbsp;ACCEPT&lt;br&gt;#iptables&nbsp;-A&nbsp;INPUT&nbsp;-p&nbsp;udp&nbsp;-i&nbsp;eth0&nbsp;--sport&nbsp;53&nbsp;-j&nbsp;ACCEPT&lt;br&gt;&lt;br&gt;#&nbsp;Allow&nbsp;UDP,&nbsp;DNS&nbsp;and&nbsp;Passive&nbsp;FTP&lt;br&gt;iptables&nbsp;-A&nbsp;INPUT&nbsp;-i&nbsp;$INTERNET&nbsp;-m&nbsp;state&nbsp;--state&nbsp;ESTABLISHED,RELATED&nbsp;-j&nbsp;ACCEPT&lt;br&gt;&lt;br&gt;#&nbsp;unlimited&nbsp;access&nbsp;to&nbsp;LAN&lt;br&gt;iptables&nbsp;-A&nbsp;INPUT&nbsp;-i&nbsp;$LAN_IN&nbsp;-j&nbsp;ACCEPT&lt;br&gt;iptables&nbsp;-A&nbsp;OUTPUT&nbsp;-o&nbsp;$LAN_IN&nbsp;-j&nbsp;ACCEPT&lt;br&gt;&lt;br&gt;#&nbsp;DNAT&nbsp;port&nbsp;80&nbsp;request&nbsp;comming&nbsp;from&nbsp;LAN&nbsp;systems&nbsp;to&nbsp;squid&nbsp;3129&nbsp;($SQUID_PORT)&nbsp;aka&nbsp;transparent&nbsp;proxy&nbsp;(http)&lt;br&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-i&nbsp;$LAN_IN&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;DNAT&nbsp;--to&nbsp;$SQUID_SERVER:$SQUID_PORT&lt;br&gt;&lt;br&gt;#&nbsp;DNAT&nbsp;port&nbsp;443&nbsp;request&nbsp;comming&nbsp;from&nbsp;LAN&nbsp;systems&nbsp;to&nbsp;squid&nbsp;3130&nbsp;($SQUID_PORTS)&nbsp;aka&nbsp;transparent&nbsp;proxy&nbsp;(https)&lt;br&gt;iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-i&nbsp;$LAN_IN&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;443&nbsp;-j&nbsp;DNAT&nbsp;--to&nbsp;$SQUID_SERVER:$SQUID_PORTS&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;With&nbsp;the&nbsp;above&nbsp;settings,&nbsp;I&nbsp;can&nbsp;access&nbsp;my&nbsp;webserver in&nbsp;local&nbsp;(192.168.0.8)&nbsp;but&nbsp;when&nbsp;outside&nbsp;(12.345.45.23)&nbsp;it&nbsp;refuses. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Is&nbsp;it&nbsp;my&nbsp;setting&nbsp;on&nbsp;squid&nbsp;or&nbsp;iptables&nbsp;that&nbsp;is&nbsp;causing&nbsp;the&nbsp;conflict?&nbsp;and&nbsp;how&nbsp;do&nbsp;i&nbsp;resolve&nbsp;it,&nbsp;please?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
