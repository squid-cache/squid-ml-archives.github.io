<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello&nbsp;Amos,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;recommendations.&lt;/div&gt;&lt;div&gt;I&nbsp;modified negotiate_wrapper_auth&nbsp;to&nbsp;parse&nbsp;NTLM&nbsp;tokens&nbsp;and&nbsp;to&nbsp;set&nbsp;the&nbsp;user&nbsp;attribute&nbsp;in&nbsp;AV-pairs, &lt;/div&gt;&lt;div&gt;so&nbsp;now&nbsp;I&nbsp;can&nbsp;configure&nbsp;the&nbsp;desired&nbsp;logging&nbsp;using&nbsp;acl&nbsp;note-type.  &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;I&nbsp;also&nbsp;have&nbsp;BASIC&nbsp;authentication&nbsp;type&nbsp;users.&lt;/div&gt;&lt;div&gt;Usernames&nbsp;of&nbsp;those&nbsp;users&nbsp;are&nbsp;known&nbsp;to&nbsp;the&nbsp;squid&nbsp;even&nbsp;if&nbsp;they&nbsp;type&nbsp;wrong&nbsp;passwords,&nbsp;but  the&nbsp;user-attribute&nbsp;is&nbsp;not&nbsp;set&nbsp;in&nbsp;the&nbsp;note-list&nbsp;in&nbsp;such&nbsp;transactions.&lt;/div&gt;&lt;div&gt;Should&nbsp;I&nbsp;write&nbsp;a&nbsp;new&nbsp;wrapper&nbsp;script&nbsp;for&nbsp;the&nbsp;BASIC-authentication&nbsp;to&nbsp;set&nbsp;the&nbsp;user-attribute,&nbsp;or&nbsp;I&nbsp;can&nbsp;check&nbsp;if&nbsp;the&nbsp;username&nbsp;is&nbsp;known&nbsp;without&nbsp;using&nbsp;wrapper?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;general&nbsp;idea&nbsp;is&nbsp;to&nbsp;log&nbsp;wrong&nbsp;authentication&nbsp;attempts&nbsp;to&nbsp;find&nbsp;the&nbsp;sources&nbsp;if&nbsp;user&nbsp;accounts&nbsp;are&nbsp;blocked&nbsp;in&nbsp;AD.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&gt;&nbsp;But&nbsp;I&nbsp;recommend&lt;/span&gt;&lt;br&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&gt;&nbsp;just&nbsp;upgrading&nbsp;your&nbsp;systems&nbsp;to&nbsp;Kerberos&nbsp;which&nbsp;will&nbsp;avoid&nbsp;a&nbsp;lot&nbsp;of&lt;/span&gt;&lt;br&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(80,0,80)&quot;&gt;&gt;&nbsp;these&nbsp;complications&nbsp;entirely.&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;have&nbsp;many&nbsp;linux-users&nbsp;whose&nbsp;software&nbsp;can&#39;t&nbsp;perform&nbsp;Kerberos&nbsp;proxy&nbsp;authentication,&nbsp;they&nbsp;can&nbsp;just&nbsp;NTLM,&nbsp;or&nbsp;even&nbsp;BASIC&nbsp;(or&nbsp;they&nbsp;can&#39;t&nbsp;work&nbsp;through&nbsp;http-proxy&nbsp;at&nbsp;all,&nbsp;but&nbsp;we&nbsp;configure&nbsp;them&nbsp;to&nbsp;use&nbsp;cntlm&nbsp;or&nbsp;proxifier).&nbsp;So&nbsp;we&nbsp;cannot&nbsp;refuse&nbsp;NTLM&nbsp;and&nbsp;BASIC&nbsp;proxy-authentications.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Kind&nbsp;regards,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; Ankor.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;пт,&nbsp;17&nbsp;февр.&nbsp;2023&nbsp;г.&nbsp;в&nbsp;23:20,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;18/02/2023&nbsp;7:29&nbsp;am,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;17/02/2023&nbsp;7:29&nbsp;pm,&nbsp;Andrey&nbsp;K&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&nbsp;Hello,&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;disable&nbsp;logging&nbsp;of&nbsp;407-errors,&nbsp;except&nbsp;when&nbsp;the&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;username&nbsp;is&nbsp;known.&lt;br&gt;<br>
&gt;&gt;&nbsp;Is&nbsp;it&nbsp;possible&nbsp;to&nbsp;configure?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Assuming&nbsp;that&nbsp;you&nbsp;have&nbsp;the&nbsp;wrapper&nbsp;script&nbsp;from&nbsp;your&nbsp;previous&nbsp;request&nbsp;&lt;br&gt;<br>
&gt;&nbsp;about&nbsp;always&nbsp;logging&nbsp;usernames&nbsp;you&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;use&nbsp;a&nbsp;note&nbsp;type&nbsp;&lt;br&gt;<br>
&gt;&nbsp;ACL&nbsp;like&nbsp;so:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp; acl&nbsp;knownUser&nbsp;note&nbsp;user&lt;br&gt;<br>
&gt;&nbsp; access_log&nbsp;...&nbsp;on-error=drop&nbsp;http-407&nbsp;!knownUser&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;have&nbsp;now&nbsp;the&nbsp;log&nbsp;configured:&lt;br&gt;<br>
&gt;&gt;&nbsp;acl&nbsp;http-407&nbsp;http_status&nbsp;407&lt;br&gt;<br>
&gt;&gt;&nbsp;access_log&nbsp;daemon:/var/log/squid/access.log&nbsp;logformat=extended-squid&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;on-error=drop&nbsp;!http-407&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;But&nbsp;I&nbsp;would&nbsp;also&nbsp;like&nbsp;to&nbsp;see&nbsp;authentication&nbsp;errors&nbsp;when&nbsp;a&nbsp;user&nbsp;types&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;the&nbsp;wrong&nbsp;password&nbsp;(the&nbsp;username&nbsp;is&nbsp;known&nbsp;in&nbsp;these&nbsp;cases).&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;With&nbsp;most&nbsp;HTTP&nbsp;authentication&nbsp;you&nbsp;could&nbsp;rely&nbsp;on&nbsp;all&nbsp;407&nbsp;meaning&nbsp;bad&nbsp;or&nbsp;&lt;br&gt;<br>
&gt;&nbsp;unknown&nbsp;credentials.&nbsp;But&nbsp;NTLM&nbsp;(ab)uses&nbsp;that&nbsp;code&nbsp;for&nbsp;its&nbsp;handshake&nbsp;&lt;br&gt;<br>
&gt;&nbsp;type-2&nbsp;response,&nbsp;so&nbsp;you&nbsp;one&nbsp;distinguish&nbsp;a&nbsp;failed&nbsp;from&nbsp;an&nbsp;incomplete&nbsp;&lt;br&gt;<br>
&gt;&nbsp;authentication.&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;was&nbsp;meant&nbsp;to&nbsp;say&nbsp;&quot;so&nbsp;one&nbsp;cannot&nbsp;distinguish&nbsp;a&nbsp;failed&nbsp;from&nbsp;an&nbsp;&lt;br&gt;<br>
incomplete&nbsp;authentication.&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;At&nbsp;this&nbsp;point&nbsp;you&nbsp;are&nbsp;already&nbsp;wrapping&nbsp;and&nbsp;re-writing&nbsp;most&nbsp;of&nbsp;the&nbsp;&lt;br&gt;<br>
&gt;&nbsp;NTLM-&gt;Squid&nbsp;helper&nbsp;traffic.&nbsp;You&nbsp;could&nbsp;adjust&nbsp;the&nbsp;challenge&nbsp;to&nbsp;also&nbsp;use&nbsp;&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;current&nbsp;helper&nbsp;syntax&nbsp;with&nbsp;a&nbsp;custom&nbsp;note&nbsp;to&nbsp;log.&nbsp;But&nbsp;I&nbsp;recommend&nbsp;&lt;br&gt;<br>
&gt;&nbsp;just&nbsp;upgrading&nbsp;your&nbsp;systems&nbsp;to&nbsp;Kerberos&nbsp;which&nbsp;will&nbsp;avoid&nbsp;a&nbsp;lot&nbsp;of&nbsp;&lt;br&gt;<br>
&gt;&nbsp;these&nbsp;complications&nbsp;entirely.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Cheers&lt;br&gt;<br>
&gt;&nbsp;Amos&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
