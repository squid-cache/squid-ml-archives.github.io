<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello! &lt;br&gt;Yes! &lt;br&gt;Thank&nbsp;you! &lt;br&gt;&lt;br&gt;&lt;br&gt;One&nbsp;more&nbsp;question&nbsp;pls: &lt;br&gt;&lt;br&gt;For&nbsp;example&nbsp;I&nbsp;have&nbsp;five&nbsp;of&nbsp;cache_peers&nbsp;and&nbsp;ACL&nbsp;associated &nbsp;with&nbsp;some&nbsp;cache&nbsp;peer.&lt;br&gt;As&nbsp;you&nbsp;know&nbsp;-&nbsp;I&nbsp;used&nbsp;the&nbsp;my&nbsp;external&nbsp;ACL&nbsp;script&nbsp;and&nbsp;now&nbsp;I&nbsp;can&nbsp;put&nbsp;the&nbsp;policy&nbsp;to&nbsp;answer&nbsp;fo&nbsp;my&nbsp;script&nbsp;and&nbsp;squid&nbsp;will&nbsp;get&nbsp;an&nbsp;answer&nbsp;and&nbsp;used&nbsp;the&nbsp;correct&nbsp;ACL&nbsp;for&nbsp;username. &lt;br&gt;For&nbsp;example&nbsp;answer&nbsp;is &nbsp;&quot;OK &nbsp;proxy=peer1&quot; &nbsp;and&nbsp;user&nbsp;will&nbsp;be&nbsp;used&nbsp;the&nbsp;cache_peer1,&nbsp;or&nbsp;if&nbsp;&quot;OK&nbsp;proxy=all&quot;&nbsp;and&nbsp;user&nbsp;will&nbsp;go&nbsp;over&nbsp;all&nbsp;of&nbsp;cache_peers&nbsp;by&nbsp;round-robin.&lt;br&gt;All&nbsp;works&nbsp;well. &lt;br&gt;But&nbsp;how&nbsp;I&nbsp;can&nbsp;put&nbsp;something like&nbsp;a&nbsp;list&nbsp;of&nbsp;ACL&nbsp;for&nbsp;user&nbsp;? &nbsp;for&nbsp;example &nbsp;I&nbsp;want&nbsp;that&nbsp;some one&nbsp;user&nbsp;can go&nbsp;over&nbsp;peer1&nbsp;and&nbsp;peer3&nbsp;only,&nbsp;by&nbsp;round&nbsp;robin,&nbsp;but&nbsp;will&nbsp;be&nbsp;denied over&nbsp;peer2.&nbsp;peer4,&nbsp;peer5.&nbsp;Of&nbsp;course&nbsp;better using&nbsp;external&nbsp;ACL&nbsp;(as&nbsp;DB&nbsp;).&nbsp;What do&nbsp;you&nbsp;think? &lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;пн,&nbsp;24&nbsp;апр.&nbsp;2023 г.&nbsp;в&nbsp;18:07,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;4/23/23&nbsp;14:28,&nbsp;Alexeyяр&nbsp;Gruzdov&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;One&nbsp;more&nbsp;may&nbsp;be&nbsp;last&nbsp;thing: &nbsp;-&nbsp;I&nbsp;found&nbsp;the&nbsp;strange&nbsp;behavior &nbsp;-&nbsp;if&nbsp;I&nbsp;make&nbsp;&lt;br&gt;<br>
&gt;&nbsp;changes&nbsp;at&nbsp;my&nbsp;ext&nbsp;ACL&nbsp;script&nbsp;(its&nbsp;python&nbsp;)&nbsp;and&nbsp;then&nbsp;&quot;squid&nbsp;-k&nbsp;&lt;br&gt;<br>
&gt;&nbsp;reconfigure&quot; &nbsp;then&nbsp;I&nbsp;can&nbsp;see&nbsp;that&nbsp;my&nbsp;script&nbsp;appears in&nbsp;the&nbsp;&quot;TOP&quot;&nbsp;of&nbsp;&lt;br&gt;<br>
&gt;&nbsp;process&nbsp;and&nbsp;loads&nbsp;CPU&nbsp;to&nbsp;100%&lt;br&gt;<br>
&lt;br&gt;<br>
Check&nbsp;how&nbsp;your&nbsp;ACL&nbsp;script&nbsp;reacts&nbsp;to&nbsp;stdin&nbsp;closure/EOF.&nbsp;The&nbsp;script&nbsp;should&nbsp;&lt;br&gt;<br>
quit&nbsp;but&nbsp;probably&nbsp;does&nbsp;not.&nbsp;Same&nbsp;for&nbsp;any&nbsp;stdin&nbsp;reading&nbsp;errors.&nbsp;On&nbsp;EOF,&nbsp;&lt;br&gt;<br>
the&nbsp;script&nbsp;should&nbsp;use&nbsp;exit&nbsp;code&nbsp;zero.&nbsp;All&nbsp;these&nbsp;things&nbsp;are&nbsp;easy&nbsp;to&nbsp;test&nbsp;&lt;br&gt;<br>
on&nbsp;the&nbsp;command&nbsp;line&nbsp;(without&nbsp;Squid).&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;вс,&nbsp;23&nbsp;апр.&nbsp;2023 г.&nbsp;в&nbsp;16:36,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&nbsp;target=&quot;_blank&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&gt;:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; On&nbsp;23/04/2023&nbsp;5:27&nbsp;pm,&nbsp;Alexeyяр&nbsp;Gruzdov&nbsp;wrote:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Hello&nbsp;Guys!&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Thank&nbsp;you&nbsp;very&nbsp;much!&nbsp;For&nbsp;now&nbsp;all&nbsp;works&nbsp;like&nbsp;I&nbsp;needed!&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;But&nbsp;I&nbsp;have&nbsp;an&nbsp;one&nbsp;more&nbsp; questions&nbsp;about&nbsp;how&nbsp;I&nbsp;could&nbsp;to&nbsp;use&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; kv-pair:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; ...&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;and&nbsp;then&nbsp;ACL&nbsp;with&nbsp;“note&nbsp;proxy&nbsp;all&nbsp;“&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;But&nbsp;how&nbsp;the&nbsp;kv-pair&nbsp;must&nbsp;to&nbsp;be&nbsp;looked&nbsp;for&nbsp;this&nbsp;my&nbsp;tag&nbsp;?&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;I&nbsp;have&nbsp;tried&nbsp;to&nbsp;get&nbsp;answer&nbsp;from&nbsp;my&nbsp;ext&nbsp;script&nbsp;like&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;“OK”&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;“proxy=all”&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;But&nbsp;looks&nbsp;like&nbsp;it’s&nbsp;not&nbsp;correct&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; This&nbsp;part&nbsp;of&nbsp;the&nbsp;instructions&nbsp;were&nbsp;missed:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/AddonHelpers#helper-protocols&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/Features/AddonHelpers#helper-protocols&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/Features/AddonHelpers#helper-protocols&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/Features/AddonHelpers#helper-protocols&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &quot;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; For&nbsp;every&nbsp;line&nbsp;sent&nbsp;by&nbsp;Squid&nbsp;exactly&nbsp;one&nbsp;line&nbsp;is&nbsp;expected&nbsp;back.&nbsp;Some&lt;br&gt;<br>
&gt; &nbsp; &nbsp; script&nbsp;language&nbsp;such&nbsp;as&nbsp;perl&nbsp;and&nbsp;python&nbsp;need&nbsp;to&nbsp;be&nbsp;careful&nbsp;about&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; number&nbsp;of&nbsp;newlines&nbsp;in&nbsp;their&nbsp;output.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; If&nbsp;your&nbsp;helper&nbsp;received&nbsp;something&nbsp;like&nbsp;this&nbsp;(with&nbsp;concurrency&lt;br&gt;<br>
&gt; &nbsp; &nbsp; channel-id&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &quot;1&quot;):&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;  &quot;1&nbsp;bob&nbsp;192.0.2.1&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; It&nbsp;should&nbsp;produce&nbsp;a&nbsp;line&nbsp;like:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;  &nbsp;&quot;1&nbsp;OK&nbsp;proxy=all&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; If&nbsp;no&nbsp;concurrency&nbsp;channel-id&nbsp;is&nbsp;received,&nbsp;then&nbsp;output&nbsp;is&nbsp;the&nbsp;same&nbsp;but&lt;br&gt;<br>
&gt; &nbsp; &nbsp; without&nbsp;sending&nbsp;channel-id&nbsp;back&nbsp;and&nbsp;MUST&nbsp;be&nbsp;sent&nbsp;in&nbsp;same&nbsp;order&nbsp;as&lt;br&gt;<br>
&gt; &nbsp; &nbsp; received.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; I&nbsp;do&nbsp;recommend&nbsp;using&nbsp;concurrency.&nbsp;It&nbsp;can&nbsp;help&nbsp;further&nbsp;debug&nbsp;issues&nbsp;with&lt;br&gt;<br>
&gt; &nbsp; &nbsp; helpers&nbsp;responding&nbsp;incorrectly.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; HTH&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Amos&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; _______________________________________________&lt;br&gt;<br>
&gt; &nbsp; &nbsp; squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
