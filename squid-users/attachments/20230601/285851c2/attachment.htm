<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello,&nbsp;Alex,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;the&nbsp;help.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&gt;&nbsp;The&nbsp;next&nbsp;step&nbsp;I&nbsp;would&nbsp;recommend&nbsp;is&nbsp;to&nbsp;study&nbsp;the&nbsp;very&nbsp;first&nbsp;cache&nbsp;miss&lt;br&gt;&gt;&nbsp;_after_&nbsp;the&nbsp;500&nbsp;or&nbsp;200&nbsp;concurrent&nbsp;threads&nbsp;test.&nbsp;Doing&nbsp;so&nbsp;may&nbsp;shed&nbsp;light&lt;br&gt;&gt;&nbsp;on&nbsp;why&nbsp;Squid&nbsp;is&nbsp;refusing&nbsp;to&nbsp;serve&nbsp;that&nbsp;(presumably&nbsp;cached)&nbsp;object&nbsp;from&lt;br&gt;&gt;&nbsp;the&nbsp;cache.&nbsp;I&nbsp;suspect&nbsp;that&nbsp;the&nbsp;object&nbsp;was&nbsp;marked&nbsp;for&nbsp;deletion&nbsp;earlier,&lt;br&gt;&gt;&nbsp;but&nbsp;we&nbsp;should&nbsp;check&nbsp;before&nbsp;spending&nbsp;more&nbsp;time&nbsp;on&nbsp;more&nbsp;complex&nbsp;triage&nbsp;of&lt;br&gt;&gt;&nbsp;concurrent&nbsp;cases.&nbsp;If&nbsp;you&nbsp;can&nbsp;share&nbsp;a&nbsp;(link&nbsp;to)&nbsp;compressed&nbsp;ALL,9&lt;br&gt;&gt;&nbsp;cache.log&nbsp;from&nbsp;that&nbsp;single&nbsp;transaction&nbsp;against&nbsp;Squid&nbsp;v6,&nbsp;I&nbsp;may&nbsp;be&nbsp;able&lt;br&gt;&gt;&nbsp;to&nbsp;help&nbsp;you&nbsp;with&nbsp;that&nbsp;step.&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;cleared&nbsp;the&nbsp;rock&nbsp;cache,&nbsp;changed&nbsp;the&nbsp;squid.conf&nbsp;(added&nbsp;debug_options&nbsp;ALL,9),&nbsp;restarted&nbsp;the&nbsp;squid,&nbsp;ran&nbsp;a&nbsp;test&nbsp;with&nbsp;500&nbsp;concurrent&nbsp;threads,&nbsp;and&nbsp;dumped&nbsp;the&nbsp;rock&nbsp;cache&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;the&nbsp;URL&nbsp;is&nbsp;there:&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;$VAR1&nbsp;=&nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;1&#39;&nbsp;=&gt;&nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;URL&#39;&nbsp;=&gt;&nbsp;&#39;&lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&#39;,&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;KEY_MD5&#39;&nbsp;=&gt;&nbsp;&#39;e5eb10f0ab7d84ff9d3fd1e5a6d3eb9c&#39;,&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;OBJSIZE&#39;&nbsp;=&gt;&nbsp;446985,&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;STD_LFS&#39;&nbsp;=&gt;&nbsp;{&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;lastref&#39;&nbsp;=&gt;&nbsp;&#39;Thu&nbsp;Jun&nbsp; 1&nbsp;11:29:01&nbsp;2023&#39;,&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;timestamp&#39;&nbsp;=&gt;&nbsp;&#39;Thu&nbsp;Jun&nbsp; 1&nbsp;11:29:01&nbsp;2023&#39;,&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;expires&#39;&nbsp;=&gt;&nbsp;&#39;Thu&nbsp;Jun&nbsp; 1&nbsp;17:29:01&nbsp;2023&#39;,&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;refcount&#39;&nbsp;=&gt;&nbsp;3,&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;flags&#39;&nbsp;=&gt;&nbsp;&#39;0x4004&#39;,&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;swap_file_sz&#39;&nbsp;=&gt;&nbsp;0,&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;lastmod&#39;&nbsp;=&gt;&nbsp;&#39;Wed&nbsp;Jun&nbsp;29&nbsp;16:09:14&nbsp;2016&#39;&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;VERSION&#39;&nbsp;=&gt;&nbsp;&#39;Thu&nbsp;Jun&nbsp; 1&nbsp;11:29:01&nbsp;2023&#39;&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt; &nbsp; &nbsp; &nbsp; &nbsp;};&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Then&nbsp;cleared&nbsp;the&nbsp;cache.log&nbsp;to&nbsp;have&nbsp;only&nbsp;a&nbsp;single&nbsp;transaction&nbsp;in&nbsp;the&nbsp;logs,&nbsp;and&nbsp;finally&nbsp;ran&nbsp;curl.&lt;/div&gt;&lt;div&gt;Log&nbsp;file&nbsp;is&nbsp;uploaded&nbsp;to &lt;a&nbsp;href=&quot;https://drive.google.com/file/d/1uwbBVjWeDEHI95B6ArPZr5_pqkCr_h9P/view?usp=sharing&quot;&gt;https://drive.google.com/file/d/1uwbBVjWeDEHI95B6ArPZr5_pqkCr_h9P/view?usp=sharing&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;There&nbsp;are&nbsp;records&nbsp;in&nbsp;the&nbsp;log:&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;20,3|&nbsp;Controller.cc(429)&nbsp;peek:&nbsp;E5EB10F0AB7D84FF9D3FD1E5A6D3EB9C&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;54,5|&nbsp;StoreMap.cc(443)&nbsp;openForReading:&nbsp;opening&nbsp;entry&nbsp;with&nbsp;key&nbsp;E5EB10F0AB7D84FF9D3FD1E5A6D3EB9C&nbsp;for&nbsp;reading&nbsp;transients_map&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;54,5|&nbsp;StoreMap.cc(455)&nbsp;openForReadingAt:&nbsp;opening&nbsp;entry&nbsp;11138&nbsp;for&nbsp;reading&nbsp;transients_map&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;54,7|&nbsp;StoreMap.cc(467)&nbsp;openForReadingAt:&nbsp;cannot&nbsp;open&nbsp;empty&nbsp;entry&nbsp;11138&nbsp;for&nbsp;reading&nbsp;transients_map&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;54,5|&nbsp;StoreMap.cc(443)&nbsp;openForReading:&nbsp;opening&nbsp;entry&nbsp;with&nbsp;key&nbsp;E5EB10F0AB7D84FF9D3FD1E5A6D3EB9C&nbsp;for&nbsp;reading&nbsp;cache_mem_map&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;54,5|&nbsp;StoreMap.cc(455)&nbsp;openForReadingAt:&nbsp;opening&nbsp;entry&nbsp;11138&nbsp;for&nbsp;reading&nbsp;cache_mem_map&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;54,7|&nbsp;StoreMap.cc(474)&nbsp;openForReadingAt:&nbsp;cannot&nbsp;open&nbsp;marked&nbsp;entry&nbsp;11138&nbsp;for&nbsp;reading&nbsp;cache_mem_map&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;54,5|&nbsp;StoreMap.cc(443)&nbsp;openForReading:&nbsp;opening&nbsp;entry&nbsp;with&nbsp;key&nbsp;E5EB10F0AB7D84FF9D3FD1E5A6D3EB9C&nbsp;for&nbsp;reading&nbsp;/data/squid.user/cache_map&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;54,5|&nbsp;StoreMap.cc(455)&nbsp;openForReadingAt:&nbsp;opening&nbsp;entry&nbsp;719406&nbsp;for&nbsp;reading&nbsp;/data/squid.user/cache_map&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;54,7|&nbsp;StoreMap.cc(474)&nbsp;openForReadingAt:&nbsp;cannot&nbsp;open&nbsp;marked&nbsp;entry&nbsp;719406&nbsp;for&nbsp;reading&nbsp;/data/squid.user/cache_map&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;20,6|&nbsp;Disks.cc(254)&nbsp;get:&nbsp;none&nbsp;of&nbsp;1&nbsp;cache_dirs&nbsp;have&nbsp;E5EB10F0AB7D84FF9D3FD1E5A6D3EB9C&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;20,4|&nbsp;Controller.cc(463)&nbsp;peek:&nbsp;cannot&nbsp;locate&nbsp;E5EB10F0AB7D84FF9D3FD1E5A6D3EB9C&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;85,7|&nbsp;client_side_reply.cc(1626)&nbsp;detailStoreLookup:&nbsp;mismatch&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;85,3|&nbsp;client_side_reply.cc(1561)&nbsp;identifyFoundObject:&nbsp;StoreEntry&nbsp;is&nbsp;NULL&nbsp;-&nbsp; MISS&lt;br&gt;2023/06/01&nbsp;11:30:34.556&nbsp;kid7|&nbsp;83,7|&nbsp;LogTags.cc(57)&nbsp;update:&nbsp;TAG_NONE&nbsp;to&nbsp;TCP_MISS&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;file&nbsp;that&nbsp;squid&nbsp;tried&nbsp;to&nbsp;read &lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;/data/squid.user/cache_map&nbsp;does&nbsp;not&nbsp;exist.&nbsp;I&nbsp;use&nbsp;a&nbsp;cache_dir&nbsp;file&nbsp;&lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;/data/squid.user/cache/rock.&nbsp;I&nbsp;suppose&nbsp;that&nbsp;file &lt;/span&gt;&lt;span&nbsp;style=&quot;font-family:monospace&quot;&gt;/data/squid.user/cache_map &lt;/span&gt;is&nbsp;a&nbsp;virtual&nbsp;entity.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Kind&nbsp;regards, &lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp;Ankor&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;ср,&nbsp;31&nbsp;мая&nbsp;2023 г.&nbsp;в&nbsp;16:43,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;5/31/23&nbsp;02:56,&nbsp;Andrey&nbsp;K&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;Do&nbsp;you&nbsp;get&nbsp;close&nbsp;to&nbsp;100%&nbsp;hit&nbsp;ratio&nbsp;if&nbsp;clients&nbsp;access&nbsp;these&nbsp;URLs&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;sequentially&nbsp;rather&nbsp;than&nbsp;concurrently?&nbsp;If&nbsp;not,&nbsp;then&nbsp;focus&nbsp;on&nbsp;that&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;problem&nbsp;before&nbsp;you&nbsp;open&nbsp;the&nbsp;collapsed&nbsp;forwarding&nbsp;Pandora&nbsp;box.&lt;br&gt;<br>
&gt;&nbsp;When&nbsp;I&nbsp;run&nbsp;curl&nbsp;sequentially like&nbsp;this:&lt;br&gt;<br>
&gt;&nbsp;for&nbsp;i&nbsp;in&nbsp;`seq&nbsp;500`;&nbsp;do&nbsp;curl&nbsp;--tlsv1.2&nbsp;-k&nbsp; &nbsp;--proxy&nbsp;0001vsg01:3131&nbsp; -v&nbsp;&lt;br&gt;<br>
&gt;&nbsp;$URL  &gt;/dev/null&nbsp;2&gt;&amp;1;&nbsp;done&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;get&nbsp;only&nbsp;the&nbsp;first&nbsp;request&nbsp;with&nbsp;a&nbsp;status&nbsp;TCP_MISS and&nbsp;all&nbsp;others&nbsp;with&nbsp;&lt;br&gt;<br>
&gt;&nbsp;TCP_MEM_HIT:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;Cnt&nbsp;Status &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Parent&lt;br&gt;<br>
&gt; &nbsp; &nbsp;499&nbsp;TCP_MEM_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&lt;br&gt;<br>
Excellent.&nbsp;This&nbsp;confirms&nbsp;that&nbsp;your&nbsp;Squid&nbsp;can&nbsp;successfully&nbsp;cache&nbsp;this&nbsp;&lt;br&gt;<br>
object&nbsp;(in&nbsp;memory).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;is&nbsp;interesting&nbsp;to&nbsp;note&nbsp;that&nbsp;on&nbsp;both&nbsp;squid&nbsp;versions&nbsp;if&nbsp;I&nbsp;run&nbsp;a&nbsp;&lt;br&gt;<br>
&gt;&nbsp;separate&nbsp;curl&nbsp;after&nbsp;processing&nbsp;500&nbsp;or&nbsp;200&nbsp;concurrent&nbsp;threads,&nbsp;I&nbsp;get&nbsp;a&nbsp;&lt;br&gt;<br>
&gt;&nbsp;result&nbsp;with&nbsp;the&nbsp;status&nbsp;TCP_MISS/200&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;next&nbsp;step&nbsp;I&nbsp;would&nbsp;recommend&nbsp;is&nbsp;to&nbsp;study&nbsp;the&nbsp;very&nbsp;first&nbsp;cache&nbsp;miss&nbsp;&lt;br&gt;<br>
_after_&nbsp;the&nbsp;500&nbsp;or&nbsp;200&nbsp;concurrent&nbsp;threads&nbsp;test.&nbsp;Doing&nbsp;so&nbsp;may&nbsp;shed&nbsp;light&nbsp;&lt;br&gt;<br>
on&nbsp;why&nbsp;Squid&nbsp;is&nbsp;refusing&nbsp;to&nbsp;serve&nbsp;that&nbsp;(presumably&nbsp;cached)&nbsp;object&nbsp;from&nbsp;&lt;br&gt;<br>
the&nbsp;cache.&nbsp;I&nbsp;suspect&nbsp;that&nbsp;the&nbsp;object&nbsp;was&nbsp;marked&nbsp;for&nbsp;deletion&nbsp;earlier,&nbsp;&lt;br&gt;<br>
but&nbsp;we&nbsp;should&nbsp;check&nbsp;before&nbsp;spending&nbsp;more&nbsp;time&nbsp;on&nbsp;more&nbsp;complex&nbsp;triage&nbsp;of&nbsp;&lt;br&gt;<br>
concurrent&nbsp;cases.&nbsp;If&nbsp;you&nbsp;can&nbsp;share&nbsp;a&nbsp;(link&nbsp;to)&nbsp;compressed&nbsp;ALL,9&nbsp;&lt;br&gt;<br>
cache.log&nbsp;from&nbsp;that&nbsp;single&nbsp;transaction&nbsp;against&nbsp;Squid&nbsp;v6,&nbsp;I&nbsp;may&nbsp;be&nbsp;able&nbsp;&lt;br&gt;<br>
to&nbsp;help&nbsp;you&nbsp;with&nbsp;that&nbsp;step.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;What&nbsp;is&nbsp;your&nbsp;Squid&nbsp;version?&nbsp;Older&nbsp;Squids&nbsp;have&nbsp;more&nbsp;collapsed&nbsp;forwarding&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;bugs&nbsp;than&nbsp;newer&nbsp;ones.&nbsp;I&nbsp;recommend&nbsp;testing&nbsp;with&nbsp;Squid&nbsp;v6&nbsp;or&nbsp;master/v7,&nbsp;at&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;least&nbsp;to&nbsp;confirm&nbsp;that&nbsp;the&nbsp;problem&nbsp;is&nbsp;still&nbsp;present&nbsp;in&nbsp;the&nbsp;latest&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;official&nbsp;code.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;run&nbsp;tests&nbsp;on&nbsp;SQUID&nbsp;5.9.&lt;br&gt;<br>
&gt;&nbsp;We&nbsp;compiled 6.0.2&nbsp;(with&nbsp;disabled&nbsp;delay-pools)&nbsp;and&nbsp;increased&nbsp;memory&nbsp;&lt;br&gt;<br>
&gt;&nbsp;parameters:&lt;br&gt;<br>
&gt; &nbsp; &nbsp;cache_mem&nbsp;2048&nbsp;MB&lt;br&gt;<br>
&gt; &nbsp; &nbsp;maximum_object_size_in_memory&nbsp;10&nbsp;MB&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;complete&nbsp;configuration&nbsp;is&nbsp;shown&nbsp;below.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Now&nbsp;on&nbsp;the&nbsp;version&nbsp;6.0.2&nbsp;we&nbsp;have&nbsp;the&nbsp;next&nbsp;results:&lt;br&gt;<br>
&gt;&nbsp;500&nbsp;threads&nbsp;- &nbsp;Hit&nbsp;ratio&nbsp;3.8%:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp;TCP_CF_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp;TCP_CF_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; 16&nbsp;TCP_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;467&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; 12&nbsp;TCP_SWAPFAIL_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;200&nbsp;threads&nbsp;-&nbsp;6%&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;6&nbsp;TCP_CF_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; 10&nbsp;TCP_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;176&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;8&nbsp;TCP_SWAPFAIL_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;50&nbsp;threads&nbsp;-&nbsp;82%&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; 30&nbsp;TCP_CF_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; 11&nbsp;TCP_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;8&nbsp;TCP_SWAPFAIL_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;results&nbsp;are&nbsp;slightly&nbsp;worse&nbsp;than&nbsp;they&nbsp;were&nbsp;on&nbsp;the&nbsp;version&nbsp;5.9.&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;is&nbsp;interesting&nbsp;to&nbsp;note&nbsp;that&nbsp;on&nbsp;both&nbsp;squid&nbsp;versions&nbsp;if&nbsp;I&nbsp;run&nbsp;a&nbsp;&lt;br&gt;<br>
&gt;&nbsp;separate&nbsp;curl&nbsp;after&nbsp;processing&nbsp;500&nbsp;or&nbsp;200&nbsp;concurrent&nbsp;threads,&nbsp;I&nbsp;get&nbsp;a&nbsp;&lt;br&gt;<br>
&gt;&nbsp;result&nbsp;with&nbsp;the&nbsp;status&nbsp;TCP_MISS/200,&nbsp;although&nbsp;the&nbsp;requested&nbsp;URL&nbsp;is&nbsp;&lt;br&gt;<br>
&gt;&nbsp;already&nbsp;in&nbsp;the&nbsp;rock&nbsp;cache&nbsp;(I&nbsp;can&nbsp;see&nbsp;it&nbsp;in&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;cache&nbsp;&lt;br&gt;<br>
&gt;&nbsp;using&nbsp;the&nbsp;utility&nbsp;I&nbsp;developed&nbsp;&lt;a&nbsp;href=&quot;http://rock_cache_dump.pl&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;rock_cache_dump.pl&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://rock_cache_dump.pl&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://rock_cache_dump.pl&lt;/a&gt;&gt;:&lt;br&gt;<br>
&gt;&nbsp;$VAR1&nbsp;=&nbsp;{&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;1&#39;&nbsp;=&gt;&nbsp;{&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;VERSION&#39;&nbsp;=&gt;&nbsp;&#39;Wed&nbsp;May&nbsp;31&nbsp;09:18:05&nbsp;2023&#39;,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;KEY_MD5&#39;&nbsp;=&gt;&nbsp;&#39;e5eb10f0ab7d84ff9d3fd1e5a6d3eb9c&#39;,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;OBJSIZE&#39;&nbsp;=&gt;&nbsp;446985,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;STD_LFS&#39;&nbsp;=&gt;&nbsp;{&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;lastref&#39;&nbsp;=&gt;&nbsp;&#39;Wed&nbsp;May&nbsp;31&nbsp;09:18:05&nbsp;2023&#39;,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;flags&#39;&nbsp;=&gt;&nbsp;&#39;0x4004&#39;,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;expires&#39;&nbsp;=&gt;&nbsp;&#39;Wed&nbsp;May&nbsp;31&nbsp;15:18:05&nbsp;2023&#39;,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;swap_file_sz&#39;&nbsp;=&gt;&nbsp;0,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;refcount&#39;&nbsp;=&gt;&nbsp;1,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;lastmod&#39;&nbsp;=&gt;&nbsp;&#39;Wed&nbsp;Jun&nbsp;29&nbsp;16:09:14&nbsp;2016&#39;,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;timestamp&#39;&nbsp;=&gt;&nbsp;&#39;Wed&nbsp;May&nbsp;31&nbsp;09:18:05&nbsp;2023&#39;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;URL&#39;&nbsp;=&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&#39;&lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&gt;&#39;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;};&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;).&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;How&nbsp;much&nbsp;RAM&nbsp;does&nbsp;your&nbsp;server&nbsp;have?&nbsp;You&nbsp;are&nbsp;using&nbsp;default&nbsp;256MB&nbsp;memory&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;cache&nbsp;(cache_mem).&nbsp;If&nbsp;you&nbsp;have&nbsp;spare&nbsp;memory,&nbsp;make&nbsp;your&nbsp;memory&nbsp;cache&nbsp;much&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;larger:&nbsp;A&nbsp;rock&nbsp;cache_dir&nbsp;cannot&nbsp;(yet)&nbsp;share&nbsp;the&nbsp;response&nbsp;_while_&nbsp;the&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;response&nbsp;is&nbsp;being&nbsp;written&nbsp;to&nbsp;disk,&nbsp;so&nbsp;relying&nbsp;on&nbsp;cache_dir&nbsp;too&nbsp;much&nbsp;will&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;decrease&nbsp;your&nbsp;hit&nbsp;ratio,&nbsp;especially&nbsp;in&nbsp;a&nbsp;collapsed&nbsp;forwarding&nbsp;&lt;br&gt;<br>
&gt;&nbsp;environment.&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;VM&nbsp;has&nbsp;32&nbsp;GB&nbsp;RAM.&nbsp;I&nbsp;configured&nbsp;cache_mem&nbsp;2048&nbsp;MB&nbsp;on&nbsp;the&nbsp;6.0.2&nbsp;version.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;Is&nbsp;your&nbsp;Squid&nbsp;built&nbsp;with&nbsp;--enable-delay-pools?&nbsp;If&nbsp;yes,&nbsp;TCP_MISS&nbsp;does&nbsp;not&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;necessarily&nbsp;mean&nbsp;a&nbsp;cache&nbsp;miss&nbsp;(an&nbsp;old&nbsp;Squid&nbsp;bug),&nbsp;even&nbsp;if&nbsp;you&nbsp;do&nbsp;not&nbsp;use&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;any&nbsp;delay&nbsp;pools.&lt;br&gt;<br>
&gt;&nbsp;Yes,&nbsp;delay&nbsp;pools&nbsp;on&nbsp;the&nbsp;version&nbsp;5.9&nbsp;were&nbsp;enabled&nbsp;though we&nbsp;don&#39;t&nbsp;use&nbsp;&lt;br&gt;<br>
&gt;&nbsp;them.&nbsp;I&nbsp;disabled&nbsp;this&nbsp;feature&nbsp;on&nbsp;the&nbsp;6.0.2&nbsp;version.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;Since&nbsp;you&nbsp;are&nbsp;trying&nbsp;to&nbsp;cache&nbsp;objects&nbsp;lager&nbsp;than&nbsp;512KB,&nbsp;see&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;maximum_object_size_in_memory.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;configured&nbsp;maximum_object_size_in_memory&nbsp;10&nbsp;MB on&nbsp;the&nbsp;6.0.2&nbsp;version&nbsp;&lt;br&gt;<br>
&gt;&nbsp;(as&nbsp;videochunks&nbsp;are&nbsp;less&nbsp;than&nbsp;7&nbsp;MB).&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;Consider&nbsp;making&nbsp;your&nbsp;test&nbsp;much&nbsp;longer&nbsp;(more&nbsp;sequential&nbsp;requests&nbsp;per&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;client/curl&nbsp;worker),&nbsp;to&nbsp;see&nbsp;whether&nbsp;the&nbsp;cache&nbsp;becomes&nbsp;&quot;stable&quot;&nbsp;after&nbsp;one&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;of&nbsp;the&nbsp;first&nbsp;transactions&nbsp;manages&nbsp;to&nbsp;fully&nbsp;cache&nbsp;the&nbsp;response.&nbsp;This&nbsp;may&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;not&nbsp;help&nbsp;with&nbsp;older&nbsp;Squids,&nbsp;but&nbsp;might&nbsp;help&nbsp;with&nbsp;newer&nbsp;ones.&nbsp;However,&nbsp;you&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;should&nbsp;not&nbsp;test&nbsp;using&nbsp;real&nbsp;origin&nbsp;servers&nbsp;(that&nbsp;you&nbsp;do&nbsp;not&nbsp;control)!&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;don&#39;t&nbsp;have&nbsp;any&nbsp;of&nbsp;my&nbsp;own&nbsp;web&nbsp;servers&nbsp;for&nbsp;tests,&nbsp;so&nbsp;I&nbsp;choose&nbsp;some&nbsp;&lt;br&gt;<br>
&gt;&nbsp;resources&nbsp;on&nbsp;the&nbsp;public&nbsp;internet&nbsp;that&nbsp;have&nbsp;a&nbsp;robust&nbsp;infrastructure.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;will&nbsp;conduct&nbsp;the&nbsp;longer&nbsp;tests&nbsp;next&nbsp;week.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Kind&nbsp;regards,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;Ankor.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*squid.conf*&lt;br&gt;<br>
&gt;&nbsp;workers&nbsp;21&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;sslcrtd_program&nbsp;/data/squid.user/usr/lib/squid/security_file_certgen&nbsp;-s&nbsp;&lt;br&gt;<br>
&gt;&nbsp;/data/squid.user/var/lib/squid/ssl_db&nbsp;-M&nbsp;20MB&lt;br&gt;<br>
&gt;&nbsp;sslcrtd_children&nbsp;21&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;logformat&nbsp;extended-squid&nbsp;%{%Y-%m-%d&nbsp;%H:%M:%S}tl|&nbsp;%6tr&nbsp;%&gt;a&nbsp;&lt;br&gt;<br>
&gt;&nbsp;%Ss/%03&gt;Hs/%&lt;Hs&nbsp;%&lt;st&nbsp;%rm&nbsp;%ru&nbsp;%un&nbsp;%Sh/%&lt;A&nbsp;%mt&nbsp;%ea&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;logfile_rotate&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;access_log&nbsp;daemon:/var/log/squid.user/access.log&nbsp;&lt;br&gt;<br>
&gt;&nbsp;logformat=extended-squid&nbsp;on-error=drop&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;cache_peer&nbsp;parent_proxy&nbsp; parent&nbsp;3128&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;never_direct&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;cachemgr_passwd&nbsp;pass&nbsp;config&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;PURGE&nbsp;method&nbsp;PURGE&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;PURGE&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3131&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;&lt;br&gt;<br>
&gt;&nbsp;dynamic_cert_mem_cache_size=20MB&nbsp;&lt;br&gt;<br>
&gt;&nbsp;tls-cert=/etc/squid.user/sslbump/bump.crt&nbsp;&lt;br&gt;<br>
&gt;&nbsp;tls-key=/etc/squid.user/sslbump/bump.key&lt;br&gt;<br>
&gt;&nbsp;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;step2&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;step3&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;cache_dir&nbsp;rock&nbsp;/data/squid.user/cache&nbsp;20000&nbsp;max-size=12000000&lt;br&gt;<br>
&gt;&nbsp;cache_swap_low&nbsp;85&lt;br&gt;<br>
&gt;&nbsp;cache_swap_high&nbsp;90&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;collapsed_forwarding&nbsp;on&lt;br&gt;<br>
&gt;&nbsp;cache_mem&nbsp;2048&nbsp;MB&lt;br&gt;<br>
&gt;&nbsp;maximum_object_size_in_memory&nbsp;10&nbsp;MB&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;pinger_enable&nbsp;off&lt;br&gt;<br>
&gt;&nbsp;max_filedesc&nbsp;8192&lt;br&gt;<br>
&gt;&nbsp;shutdown_lifetime&nbsp;5&nbsp;seconds&lt;br&gt;<br>
&gt;&nbsp;netdb_filename&nbsp;none&lt;br&gt;<br>
&gt;&nbsp;log_icp_queries&nbsp;off&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;via&nbsp;off&lt;br&gt;<br>
&gt;&nbsp;forwarded_for&nbsp;delete&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;client_request_buffer_max_size&nbsp;100&nbsp;MB&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;coredump_dir&nbsp;/data/squid.user/var/cache/squid&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;пн,&nbsp;29&nbsp;мая&nbsp;2023 г.&nbsp;в&nbsp;23:17,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&gt;:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; On&nbsp;5/29/23&nbsp;10:43,&nbsp;Andrey&nbsp;K&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;We&nbsp;need&nbsp;to&nbsp;configure&nbsp;a&nbsp;dedicated&nbsp;proxy&nbsp;server&nbsp;to&nbsp;provide&nbsp;caching&nbsp;of&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;online&nbsp;video&nbsp;broadcasts&nbsp;in&nbsp;order&nbsp;to&nbsp;reduce&nbsp;the&nbsp;load&nbsp;on&nbsp;the&nbsp;uplink&lt;br&gt;<br>
&gt; &nbsp; &nbsp; proxy.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Hundreds&nbsp;of&nbsp;users&nbsp;will&nbsp;access&nbsp;the&nbsp;same&nbsp;video-chunks&nbsp;simultaneously.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;I&nbsp;developed&nbsp;a&nbsp;simple&nbsp;configuration&nbsp;for&nbsp;the&nbsp;test&nbsp;purposes&nbsp;(it&nbsp;is&lt;br&gt;<br>
&gt; &nbsp; &nbsp; shown&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;below).&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;The&nbsp;*collapsed_forwarding* option&nbsp;is&nbsp;on.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Do&nbsp;you&nbsp;get&nbsp;close&nbsp;to&nbsp;100%&nbsp;hit&nbsp;ratio&nbsp;if&nbsp;clients&nbsp;access&nbsp;these&nbsp;URLs&lt;br&gt;<br>
&gt; &nbsp; &nbsp; sequentially&nbsp;rather&nbsp;than&nbsp;concurrently?&nbsp;If&nbsp;not,&nbsp;then&nbsp;focus&nbsp;on&nbsp;that&lt;br&gt;<br>
&gt; &nbsp; &nbsp; problem&nbsp;before&nbsp;you&nbsp;open&nbsp;the&nbsp;collapsed&nbsp;forwarding&nbsp;Pandora&nbsp;box.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; What&nbsp;is&nbsp;your&nbsp;Squid&nbsp;version?&nbsp;Older&nbsp;Squids&nbsp;have&nbsp;more&nbsp;collapsed&nbsp;forwarding&lt;br&gt;<br>
&gt; &nbsp; &nbsp; bugs&nbsp;than&nbsp;newer&nbsp;ones.&nbsp;I&nbsp;recommend&nbsp;testing&nbsp;with&nbsp;Squid&nbsp;v6&nbsp;or&lt;br&gt;<br>
&gt; &nbsp; &nbsp; master/v7,&nbsp;at&lt;br&gt;<br>
&gt; &nbsp; &nbsp; least&nbsp;to&nbsp;confirm&nbsp;that&nbsp;the&nbsp;problem&nbsp;is&nbsp;still&nbsp;present&nbsp;in&nbsp;the&nbsp;latest&lt;br&gt;<br>
&gt; &nbsp; &nbsp; official&nbsp;code.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; How&nbsp;much&nbsp;RAM&nbsp;does&nbsp;your&nbsp;server&nbsp;have?&nbsp;You&nbsp;are&nbsp;using&nbsp;default&nbsp;256MB&nbsp;memory&lt;br&gt;<br>
&gt; &nbsp; &nbsp; cache&nbsp;(cache_mem).&nbsp;If&nbsp;you&nbsp;have&nbsp;spare&nbsp;memory,&nbsp;make&nbsp;your&nbsp;memory&nbsp;cache&lt;br&gt;<br>
&gt; &nbsp; &nbsp; much&lt;br&gt;<br>
&gt; &nbsp; &nbsp; larger:&nbsp;A&nbsp;rock&nbsp;cache_dir&nbsp;cannot&nbsp;(yet)&nbsp;share&nbsp;the&nbsp;response&nbsp;_while_&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; response&nbsp;is&nbsp;being&nbsp;written&nbsp;to&nbsp;disk,&nbsp;so&nbsp;relying&nbsp;on&nbsp;cache_dir&nbsp;too&nbsp;much&lt;br&gt;<br>
&gt; &nbsp; &nbsp; will&lt;br&gt;<br>
&gt; &nbsp; &nbsp; decrease&nbsp;your&nbsp;hit&nbsp;ratio,&nbsp;especially&nbsp;in&nbsp;a&nbsp;collapsed&nbsp;forwarding&lt;br&gt;<br>
&gt; &nbsp; &nbsp; environment.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Is&nbsp;your&nbsp;Squid&nbsp;built&nbsp;with&nbsp;--enable-delay-pools?&nbsp;If&nbsp;yes,&nbsp;TCP_MISS&nbsp;does&lt;br&gt;<br>
&gt; &nbsp; &nbsp; not&lt;br&gt;<br>
&gt; &nbsp; &nbsp; necessarily&nbsp;mean&nbsp;a&nbsp;cache&nbsp;miss&nbsp;(an&nbsp;old&nbsp;Squid&nbsp;bug),&nbsp;even&nbsp;if&nbsp;you&nbsp;do&nbsp;not&lt;br&gt;<br>
&gt; &nbsp; &nbsp; use&lt;br&gt;<br>
&gt; &nbsp; &nbsp; any&nbsp;delay&nbsp;pools.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Since&nbsp;you&nbsp;are&nbsp;trying&nbsp;to&nbsp;cache&nbsp;objects&nbsp;lager&nbsp;than&nbsp;512KB,&nbsp;see&lt;br&gt;<br>
&gt; &nbsp; &nbsp; maximum_object_size_in_memory.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Consider&nbsp;making&nbsp;your&nbsp;test&nbsp;much&nbsp;longer&nbsp;(more&nbsp;sequential&nbsp;requests&nbsp;per&lt;br&gt;<br>
&gt; &nbsp; &nbsp; client/curl&nbsp;worker),&nbsp;to&nbsp;see&nbsp;whether&nbsp;the&nbsp;cache&nbsp;becomes&nbsp;&quot;stable&quot;&nbsp;after&lt;br&gt;<br>
&gt; &nbsp; &nbsp; one&lt;br&gt;<br>
&gt; &nbsp; &nbsp; of&nbsp;the&nbsp;first&nbsp;transactions&nbsp;manages&nbsp;to&nbsp;fully&nbsp;cache&nbsp;the&nbsp;response.&nbsp;This&nbsp;may&lt;br&gt;<br>
&gt; &nbsp; &nbsp; not&nbsp;help&nbsp;with&nbsp;older&nbsp;Squids,&nbsp;but&nbsp;might&nbsp;help&nbsp;with&nbsp;newer&nbsp;ones.&nbsp;However,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; you&lt;br&gt;<br>
&gt; &nbsp; &nbsp; should&nbsp;not&nbsp;test&nbsp;using&nbsp;real&nbsp;origin&nbsp;servers&nbsp;(that&nbsp;you&nbsp;do&nbsp;not&nbsp;control)!&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Could&nbsp;you&nbsp;clarify&nbsp;if&nbsp;this&nbsp;behavior&nbsp;of&nbsp;my&nbsp;squid&nbsp;is&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;a&nbsp;bug/misconfiguration,&nbsp;or&nbsp;if&nbsp;I&#39;m&nbsp;running&nbsp;into&nbsp;server&nbsp;performance&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;limitations&nbsp;(squid&nbsp;is&nbsp;running&nbsp;on&nbsp;a&nbsp;VM&nbsp;with&nbsp;22&nbsp;cores)?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Most&nbsp;likely,&nbsp;reduction&nbsp;of&nbsp;hit&nbsp;ratio&nbsp;with&nbsp;increase&nbsp;of&nbsp;concurrency&nbsp;is&lt;br&gt;<br>
&gt; &nbsp; &nbsp; _not_&nbsp;a&nbsp;performance&nbsp;limitation.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; HTH,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Alex.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;I&nbsp;selected&nbsp;a&nbsp;couple&nbsp;of&nbsp;cacheable&nbsp;resources&nbsp;in&nbsp;the&nbsp;internet&nbsp;for&lt;br&gt;<br>
&gt; &nbsp; &nbsp; testing:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; -&nbsp;small&nbsp;size&nbsp;(~400&nbsp;KB):&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; -&nbsp;large&nbsp;(~8&nbsp;MB):&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;To&nbsp;test&nbsp;simultaneous&nbsp;connections&nbsp;I&nbsp;am&nbsp;forking&nbsp;curl&nbsp;using&nbsp;a&nbsp;simple&lt;br&gt;<br>
&gt; &nbsp; &nbsp; script&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;(it&nbsp;is&nbsp;also&nbsp;shown&nbsp;below).&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;When&nbsp;I&nbsp;run&nbsp;a&nbsp;test&nbsp;(500&nbsp;curl&nbsp;threads&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia800406.us.archive.org/13/items/romeo-y-julieta-texto-completo/Romeo%20y%20Julieta%20-%20William%20Shakespeare.pdf&lt;/a&gt;&gt;&gt;)&nbsp;I&nbsp;see&nbsp;lots&nbsp;of TCP_MISS/200&nbsp;with FIRSTUP_PARENT/parent_proxy&nbsp;records&nbsp;in&nbsp;the&nbsp;logs.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;A&nbsp;simple&nbsp;analysis&nbsp;shows a&nbsp;low&nbsp;percentage&nbsp;of&nbsp;cache&nbsp;hits:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cat&nbsp;/var/log/squid.user/access.log|&nbsp;grep&nbsp;&#39;2023-05-29&nbsp;14&#39;&nbsp;|&nbsp;grep&lt;br&gt;<br>
&gt; &nbsp; &nbsp; pdf&nbsp; |&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;awk&nbsp;&#39;{print&nbsp;$5&quot;&nbsp;&quot;&nbsp;$10}&#39;&nbsp;|&nbsp;sort&nbsp;|&nbsp;uniq&nbsp;-c&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; 24&nbsp;TCP_CF_MISS/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;457&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; 10&nbsp;TCP_MISS/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp;TCP_SWAPFAIL_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;So&nbsp;the&nbsp;Hit&nbsp;ratio&nbsp;is&nbsp;about&nbsp;(500-457-9)*100/500=6.8%&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Almost&nbsp;the&nbsp;same&nbsp;situation&nbsp;we&nbsp;see&nbsp;when&nbsp;run&nbsp;200&nbsp;threads:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cat&nbsp;/var/log/squid.user/access.log|&nbsp;grep&nbsp;&#39;2023-05-29&nbsp;15:45&#39;&nbsp;|&lt;br&gt;<br>
&gt; &nbsp; &nbsp; grep&nbsp;pdf&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; |&nbsp;awk&nbsp;&#39;{print&nbsp;$5&quot;&nbsp;&quot;&nbsp;$10}&#39;&nbsp;|&nbsp;sort&nbsp;|&nbsp;uniq&nbsp;-c&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; &nbsp;4&nbsp;TCP_CF_MISS/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;140&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; 40&nbsp;TCP_MISS/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; 16&nbsp;TCP_SWAPFAIL_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;This&nbsp;time&nbsp;the&nbsp;Hit&nbsp;ratio&nbsp;is&nbsp;about&nbsp;(200-140-16)*100/500=21%&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;With&nbsp;50&nbsp;threads&nbsp;the&nbsp;Hit&nbsp;ratio&nbsp;is&nbsp;90%:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cat&nbsp;/var/log/squid.user/access.log|&nbsp;grep&nbsp;&#39;2023-05-29&nbsp;15:50&#39;&nbsp;|&lt;br&gt;<br>
&gt; &nbsp; &nbsp; grep&nbsp;pdf&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; |&nbsp;awk&nbsp;&#39;{print&nbsp;$5&quot;&nbsp;&quot;&nbsp;$10}&#39;&nbsp;|&nbsp;sort&nbsp;|&nbsp;uniq&nbsp;-c&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; 27&nbsp;TCP_CF_MISS/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; 18&nbsp;TCP_MISS/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; &nbsp;4&nbsp;TCP_SWAPFAIL_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;I&nbsp;thought&nbsp;that&nbsp;it&nbsp;should&nbsp;always&nbsp;be&nbsp;near&nbsp;99%&nbsp;-&nbsp;only&nbsp;the&nbsp;first&lt;br&gt;<br>
&gt; &nbsp; &nbsp; request&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;an&nbsp;URL&nbsp;should&nbsp;be&nbsp;forwarded&nbsp;to&nbsp;the&nbsp;parent&nbsp;proxy&nbsp;and&nbsp;all&nbsp;subsequent&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;requests&nbsp;should&nbsp;be&nbsp;served&nbsp;from&nbsp;the&nbsp;cache.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;The&nbsp;situation&nbsp;is&nbsp;even&nbsp;worse&nbsp;with&nbsp;downloading&nbsp;a&nbsp;large&nbsp;file:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;500&nbsp;threads&nbsp;(0.4%):&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cat&nbsp;/var/log/squid.user/access.log|&nbsp;grep&nbsp;&#39;2023-05-29&nbsp;17:2&#39;&nbsp;|&nbsp;grep&lt;br&gt;<br>
&gt; &nbsp; &nbsp; pdf&nbsp; |&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;awk&nbsp;&#39;{print&nbsp;$5&quot;&nbsp;&quot;&nbsp;$10}&#39;&nbsp;|&nbsp;sort&nbsp;|&nbsp;uniq&nbsp;-c&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; 10&nbsp;TCP_CF_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp;TCP_CF_MISS/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;488&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;200&nbsp;threads&nbsp;(3%):&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cat&nbsp;/var/log/squid.user/access.log|&nbsp;grep&nbsp;&#39;2023-05-29&nbsp;17:3&#39;&nbsp;|&nbsp;grep&lt;br&gt;<br>
&gt; &nbsp; &nbsp; pdf&nbsp; |&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;awk&nbsp;&#39;{print&nbsp;$5&quot;&nbsp;&quot;&nbsp;$10}&#39;&nbsp;|&nbsp;sort&nbsp;|&nbsp;uniq&nbsp;-c&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp;TCP_CF_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; &nbsp;6&nbsp;TCP_CF_MISS/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp;180&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp;TCP_SWAPFAIL_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;50&nbsp;threads&nbsp;(98%):&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cat&nbsp;/var/log/squid.user/access.log|&nbsp;grep&nbsp;&#39;2023-05-29&nbsp;17:36&#39;&nbsp;|&lt;br&gt;<br>
&gt; &nbsp; &nbsp; grep&nbsp;pdf&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; |&nbsp;awk&nbsp;&#39;{print&nbsp;$5&quot;&nbsp;&quot;&nbsp;$10}&#39;&nbsp;|&nbsp;sort&nbsp;|&nbsp;uniq&nbsp;-c&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; 25&nbsp;TCP_CF_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; 12&nbsp;TCP_CF_MISS/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; 12&nbsp;TCP_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Could&nbsp;you&nbsp;clarify&nbsp;if&nbsp;this&nbsp;behavior&nbsp;of&nbsp;my&nbsp;squid&nbsp;is&nbsp;a&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;bug/misconfiguration,&nbsp;or&nbsp;if&nbsp;I&#39;m&nbsp;running&nbsp;into&nbsp;server&nbsp;performance&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;limitations&nbsp;(squid&nbsp;is&nbsp;running&nbsp;on&nbsp;a&nbsp;VM&nbsp;with&nbsp;22&nbsp;cores)?&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;Kind&nbsp;regards,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; Ankor&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;*squid.conf:*&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;workers&nbsp;21&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;sslcrtd_program&lt;br&gt;<br>
&gt; &nbsp; &nbsp; /data/squid.user/usr/lib/squid/security_file_certgen&nbsp;-s&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;/data/squid.user/var/lib/squid/ssl_db&nbsp;-M&nbsp;20MB&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;sslcrtd_children&nbsp;21&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;logformat&nbsp;extended-squid&nbsp;%{%Y-%m-%d&nbsp;%H:%M:%S}tl|&nbsp;%6tr&nbsp;%&gt;a&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;%Ss/%03&gt;Hs/%&lt;Hs&nbsp;%&lt;st&nbsp;%rm&nbsp;%ru&nbsp;%un&nbsp;%Sh/%&lt;A&nbsp;%mt&nbsp;%ea&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;logfile_rotate&nbsp;0&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;access_log&nbsp;daemon:/var/log/squid.user/access.log&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;logformat=extended-squid&nbsp;on-error=drop&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cache_peer&nbsp;parent_proxy&nbsp; parent&nbsp;3128&nbsp;0&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;never_direct&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cachemgr_passwd&nbsp;pass&nbsp;config&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;acl&nbsp;PURGE&nbsp;method&nbsp;PURGE&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;http_access&nbsp;allow&nbsp;PURGE&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;http_access&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;http_port&nbsp;3131&nbsp;ssl-bump&nbsp;generate-host-certificates=on&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;dynamic_cert_mem_cache_size=20MB&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;tls-cert=/etc/squid.user/sslbump/bump.crt&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;tls-key=/etc/squid.user/sslbump/bump.key&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;sslproxy_cert_error&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;step2&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;step3&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cache_dir&nbsp;rock&nbsp;/data/squid.user/cache&nbsp;20000&nbsp;max-size=12000000&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cache_swap_low&nbsp;85&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;cache_swap_high&nbsp;90&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;*collapsed_forwarding&nbsp;on*&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;pinger_enable&nbsp;off&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;max_filedesc&nbsp;8192&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;shutdown_lifetime&nbsp;5&nbsp;seconds&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;netdb_filename&nbsp;none&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;log_icp_queries&nbsp;off&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;client_request_buffer_max_size&nbsp;100&nbsp;MB&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;via&nbsp;off&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;forwarded_for&nbsp;delete&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;coredump_dir&nbsp;/data/squid.user/var/cache/squid&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;*curl_forker.sh:*&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;#!/bin/sh&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;N=100&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; URL=&lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;if&nbsp;[[&nbsp; -n&nbsp;$1&nbsp;&amp;&amp;&nbsp; $1&nbsp;=~&nbsp;help$&nbsp; ]];&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;then&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; echo&nbsp;&quot;Usage:&nbsp;$0&nbsp;[&lt;cnt&gt;]&nbsp;[&lt;url&gt;]&quot;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; echo&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; echo&nbsp;&quot;Example:&nbsp;$0&nbsp;10&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://ia600601.us.archive.org/10/items/Linux-Journal-2015-01/Linux-Journal-2015-01.pdf&lt;/a&gt;&gt;&gt;&quot;;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; echo&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; exit;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;fi&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;while&nbsp;[[&nbsp;$#&nbsp;-gt&nbsp;0&nbsp;]]&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;do&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp;if&nbsp;[[&nbsp;$1&nbsp;=~&nbsp;^[0-9]+$&nbsp;]]&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp;then&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; N=$1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp;else&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp; &nbsp; URL=$1&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp;fi&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp;shift&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;done&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;echo&nbsp;$URL&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;echo&nbsp;$N&nbsp;threads&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;for&nbsp;i&nbsp;in&nbsp;`seq&nbsp;$N`&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;do&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; &nbsp;nohup&nbsp;curl&nbsp;--tlsv1.2&nbsp;-k&nbsp; &nbsp;--proxy&nbsp;0001vsg01:3131&nbsp; -v&nbsp;$URL&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &gt;/dev/null&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt; &nbsp; 2&gt;&amp;1&nbsp;&amp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;done&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp;&gt;&nbsp;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; _______________________________________________&lt;br&gt;<br>
&gt; &nbsp; &nbsp; squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;mailto:&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &lt;&lt;a&nbsp;href=&quot;http://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
