<tt>
&lt;div&nbsp;dir=&quot;rtl&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;By&nbsp;the&nbsp;help&nbsp;of&nbsp;God.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&#39;m&nbsp;using&nbsp;squid&nbsp;with&nbsp;tproxy&nbsp;including&nbsp;https&nbsp;interception&nbsp;configuration.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;The&nbsp;squid&nbsp;version&nbsp;is:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;$&nbsp;/usr/local/squid/sbin/squid&nbsp;-v&lt;br&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;7.0.0-VCS&lt;br&gt;Service&nbsp;Name:&nbsp;squid&lt;br&gt;&lt;br&gt;This&nbsp;binary&nbsp;uses&nbsp;OpenSSL&nbsp;3.0.2&nbsp;15&nbsp;Mar&nbsp;2022.&nbsp;configure&nbsp;options:&nbsp; &#39;--with-openssl&#39;&nbsp;&#39;--enable-ssl&#39;&nbsp;&#39;--enable-ssl-crtd&#39;&nbsp;&#39;--enable-icap-client&#39;&nbsp;&#39;--enable-linux-netfilter&#39;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;And&nbsp;the&nbsp;tproxy&nbsp;configuration&nbsp;works&nbsp;perfectly&nbsp;using&nbsp;http&nbsp;without&nbsp;ssl,&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;But&nbsp;using&nbsp;ssl&nbsp;I&#39;m&nbsp;getting&nbsp;in&nbsp;browser&nbsp;ssl&nbsp;error&nbsp;&quot;ERR_SSL_PROTOCOL_ERROR&quot;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;And&nbsp;using&nbsp;curl&nbsp;I&nbsp;get&nbsp;the&nbsp;following&nbsp;output:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;$&nbsp;curl&nbsp;-iv &lt;a&nbsp;href=&quot;https://www.google.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://www.google.com&lt;/a&gt; --cert&nbsp;~/myCA.der&lt;br&gt;*&nbsp; &nbsp;Trying&nbsp;172.217.22.68:443...&lt;br&gt;*&nbsp;Connected&nbsp;to &lt;a&nbsp;href=&quot;http://www.google.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;www.google.com&lt;/a&gt; (172.217.22.68)&nbsp;port&nbsp;443&nbsp;(#0)&lt;br&gt;*&nbsp;ALPN,&nbsp;offering&nbsp;h2&lt;br&gt;*&nbsp;ALPN,&nbsp;offering&nbsp;http/1.1&lt;br&gt;*&nbsp;could&nbsp;not&nbsp;load&nbsp;PEM&nbsp;client&nbsp;certificate,&nbsp;OpenSSL&nbsp;error&nbsp;error:0480006C:PEM&nbsp;routines::no&nbsp;start&nbsp;line,&nbsp;(no&nbsp;key&nbsp;found,&nbsp;wrong&nbsp;pass&nbsp;phrase,&nbsp;or&nbsp;wrong&nbsp;file&nbsp;format?)&lt;br&gt;*&nbsp;Closing&nbsp;connection&nbsp;0&lt;br&gt;curl:&nbsp;(58)&nbsp;could&nbsp;not&nbsp;load&nbsp;PEM&nbsp;client&nbsp;certificate,&nbsp;OpenSSL&nbsp;error&nbsp;error:0480006C:PEM&nbsp;routines::no&nbsp;start&nbsp;line,&nbsp;(no&nbsp;key&nbsp;found,&nbsp;wrong&nbsp;pass&nbsp;phrase,&nbsp;or&nbsp;wrong&nbsp;file&nbsp;format?)&lt;div&nbsp;class=&quot;gmail-yj6qo&quot;&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;Squid&#39;s&nbsp;configuration:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3130&quot;&gt;0.0.0.0:3130&lt;/a&gt;&nbsp;tproxy&nbsp;ssl-bump&nbsp;\&lt;br&gt; &nbsp;cert=/usr/local/squid/etc/ssl_cert/myCA.der&nbsp;\&lt;br&gt; &nbsp;key=/usr/local/squid/etc/ssl_cert/myCA.pem&nbsp;\&lt;br&gt; &nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;iptables&nbsp;rule:&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;$&nbsp;sudo&nbsp;iptables&nbsp;-t&nbsp;mangle&nbsp;-L&lt;br&gt;Chain&nbsp;PREROUTING&nbsp;(policy&nbsp;ACCEPT)&lt;br&gt;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br&gt;DIVERT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;socket&lt;br&gt;TPROXY&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:http&nbsp;TPROXY&nbsp;redirect&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3129&quot;&gt;0.0.0.0:3129&lt;/a&gt;&nbsp;mark&nbsp;0x1/0x1&lt;br&gt;TPROXY&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp;dpt:https&nbsp;TPROXY&nbsp;redirect&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3130&quot;&gt;0.0.0.0:3130&lt;/a&gt;&nbsp;mark&nbsp;0x1/0x1&lt;br&gt;&lt;br&gt;Chain&nbsp;INPUT&nbsp;(policy&nbsp;ACCEPT)&lt;br&gt;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br&gt;&lt;br&gt;Chain&nbsp;FORWARD&nbsp;(policy&nbsp;ACCEPT)&lt;br&gt;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br&gt;&lt;br&gt;Chain&nbsp;OUTPUT&nbsp;(policy&nbsp;ACCEPT)&lt;br&gt;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br&gt;&lt;br&gt;Chain&nbsp;POSTROUTING&nbsp;(policy&nbsp;ACCEPT)&lt;br&gt;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br&gt;&lt;br&gt;Chain&nbsp;DIVERT&nbsp;(1&nbsp;references)&lt;br&gt;target&nbsp; &nbsp; &nbsp;prot&nbsp;opt&nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;br&gt;MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MARK&nbsp;set&nbsp;0x1&lt;br&gt;ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;Did&nbsp;I&nbsp;miss&nbsp;something?&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;Thanks,&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail-adL&quot;&gt;Ben&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &lt;/div&gt;&lt;/div&gt;<br>

</tt>
