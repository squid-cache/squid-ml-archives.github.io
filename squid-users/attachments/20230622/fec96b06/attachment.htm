<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello, <br>
<br>
Eliezer,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;for&nbsp;the&nbsp;comment.&lt;/div&gt;&lt;div&gt;I&nbsp;tried&nbsp;squid&nbsp;for&nbsp;this&nbsp;scenario&nbsp;only&nbsp;in&nbsp;the&nbsp;test&nbsp;environment.&lt;/div&gt;&lt;div&gt;I&nbsp;will&nbsp;share&nbsp;the&nbsp;results&nbsp;after&nbsp;conducting&nbsp;a&nbsp;real&nbsp;video&nbsp;broadcast.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Kind regards,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; Ankor&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;пн,&nbsp;12&nbsp;июн.&nbsp;2023 г.&nbsp;в&nbsp;11:08,&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ngtech1ltd@gmail.com&quot;&gt;ngtech1ltd@gmail.com&lt;/a&gt;&gt;:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;Hey&nbsp;Ankor,&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks&nbsp;for&nbsp;sharing&nbsp;the&nbsp;scenario.&lt;br&gt;<br>
At&nbsp;the&nbsp;beginning&nbsp;I&nbsp;was&nbsp;thinking&nbsp;to&nbsp;myself:&nbsp;Why&nbsp;Squid?&nbsp;Is&nbsp;it&nbsp;the&nbsp;best&nbsp;choice&nbsp;for&nbsp;the&nbsp;scenario?&lt;br&gt;<br>
And&nbsp;after&nbsp;walking&nbsp;through&nbsp;my&nbsp;list&nbsp;of&nbsp;caching&nbsp;proxies,&nbsp;including&nbsp;couple&nbsp;I&nbsp;wrote&nbsp;myself&nbsp;I&nbsp;got&nbsp;to&nbsp;the&nbsp;conclusion:&lt;br&gt;<br>
Well..&nbsp;Squid-Cache&nbsp;is&nbsp;simple&nbsp;to&nbsp;use&nbsp;and&nbsp;just&nbsp;works.&lt;br&gt;<br>
Compared&nbsp;to&nbsp;other&nbsp;caching&nbsp;mechanisms&nbsp;squid&nbsp;is&nbsp;so&nbsp;simple&nbsp;to&nbsp;configure&nbsp;and&nbsp;it&nbsp;really&nbsp;leaves&nbsp;dust&lt;br&gt;<br>
behind&nbsp;to&nbsp;all&nbsp;many&nbsp;other&nbsp;cache&nbsp;mechanisms.&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
Eliezer&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
From:&nbsp;squid-users&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users-bounces@lists.squid-cache.org&lt;/a&gt;&gt;&nbsp;On&nbsp;Behalf&nbsp;Of&nbsp;Andrey&nbsp;K&lt;br&gt;<br>
Sent:&nbsp;Tuesday,&nbsp;June&nbsp;6,&nbsp;2023&nbsp;16:08&lt;br&gt;<br>
To:&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&lt;br&gt;<br>
Cc:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[squid-users]&nbsp;Proxy&nbsp;server&nbsp;to&nbsp;support&nbsp;a&nbsp;large&nbsp;number&nbsp;of&nbsp;simultaneous&nbsp;requests&lt;br&gt;<br>
&lt;br&gt;<br>
Hello,&nbsp;Alex,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;have&nbsp;shortened&nbsp;the&nbsp;correspondence&nbsp;because&nbsp;it&nbsp;does&nbsp;not&nbsp;meet&nbsp;the&nbsp;size&nbsp;requirements&nbsp;for&nbsp;the&nbsp;mailing&nbsp;list.&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you&nbsp;so&nbsp;much&nbsp;for&nbsp;your&nbsp;time,&nbsp;the&nbsp;analysis&nbsp;and&nbsp;recommendations.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;disabled&nbsp;the&nbsp;cache_dir&nbsp;and&nbsp;now&nbsp;squid&nbsp;works&nbsp;as&nbsp;expected&nbsp;- &nbsp;there&nbsp;is&nbsp;only&nbsp;one&nbsp;request&nbsp;to&nbsp;the&nbsp;original&nbsp;content&nbsp;server:&lt;br&gt;<br>
-&nbsp;on&nbsp;the&nbsp;small&nbsp;file:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;1&nbsp;NONE_NONE/503/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;4&nbsp;TCP_CF_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
 &nbsp; &nbsp;128&nbsp;TCP_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
 &nbsp; &nbsp;366&nbsp;TCP_MEM_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;1&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&lt;br&gt;<br>
-&nbsp;on&nbsp;the&nbsp;large&nbsp;file:&lt;br&gt;<br>
 &nbsp; &nbsp; 17&nbsp;TCP_CF_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
 &nbsp; &nbsp;482&nbsp;TCP_HIT/200/-&nbsp;HIER_NONE/-&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;1&nbsp;TCP_MISS/200/200&nbsp;FIRSTUP_PARENT/parent_proxy&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;think&nbsp;this&nbsp;configuration&nbsp;is&nbsp;perfect&nbsp;for&nbsp;caching&nbsp;online&nbsp;video&nbsp;broadcasts.&nbsp;Chanks&nbsp;of&nbsp;video&nbsp;are&nbsp;required&nbsp;by&nbsp;clients&nbsp;simultaneously&nbsp;only&nbsp;for&nbsp;a&nbsp;short&nbsp;period&nbsp;of&nbsp;time,&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;need&nbsp;to&nbsp;save&nbsp;them&nbsp;to&nbsp;disk..&lt;br&gt;<br>
As&nbsp;my&nbsp;VM&nbsp;has&nbsp;32&nbsp;GB&nbsp;of&nbsp;RAM,&nbsp;I&nbsp;can&nbsp;configure&nbsp;a&nbsp;sufficient&nbsp;amount&nbsp;of&nbsp;cache_mem,&nbsp;say&nbsp;20000&nbsp;MB&nbsp;to&nbsp;provide&nbsp;caching&nbsp;of&nbsp;video&nbsp;broadcasts.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Kind&nbsp;regards,&lt;br&gt;<br>
 &nbsp; &nbsp; Ankor.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
пн,&nbsp;5&nbsp;июн.&nbsp;2023 г.&nbsp;в&nbsp;17:31,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;mailto:&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;:&lt;br&gt;<br>
On&nbsp;6/2/23&nbsp;03:29,&nbsp;Andrey&nbsp;K&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;Can&nbsp;you&nbsp;repeat&nbsp;this&nbsp;test&nbsp;and&nbsp;share&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;corresponding&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;compressed&nbsp;cache.log,&nbsp;containing&nbsp;those&nbsp;500&nbsp;(or&nbsp;fewer,&nbsp;as&nbsp;long&nbsp;as&nbsp;the&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;problem&nbsp;is&nbsp;reproduced!)&nbsp;concurrent&nbsp;transactions.&nbsp;One&nbsp;or&nbsp;many&nbsp;of&nbsp;those&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;concurrent&nbsp;transactions&nbsp;resulted&nbsp;in&nbsp;the&nbsp;unwanted&nbsp;entry&nbsp;deletion.&nbsp;The&nbsp;log&lt;br&gt;<br>
&gt; &nbsp;&gt;&nbsp;may&nbsp;show&nbsp;what&nbsp;happened&nbsp;in&nbsp;that&nbsp;case.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;cleared&nbsp;the&nbsp;rock&nbsp;cache,&nbsp;set&nbsp;the&nbsp;debug&nbsp;level,&nbsp;restarted&nbsp;squid,&nbsp;cleared&nbsp;&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;cache.log,&nbsp;ran&nbsp;500-threads&nbsp;test,&nbsp;waited&nbsp;for&nbsp;it&nbsp;to&nbsp;finish&nbsp;and&nbsp;&lt;br&gt;<br>
&gt;&nbsp;launched&nbsp;curl&nbsp;to&nbsp;make&nbsp;sure&nbsp;it&nbsp;returned&nbsp;TCP_MISS.&lt;br&gt;<br>
&gt;&nbsp;Then&nbsp;stopped&nbsp;squid&nbsp;to&nbsp;limit&nbsp;the&nbsp;cache.log&nbsp;file.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you&nbsp;for&nbsp;sharing&nbsp;that&nbsp;log!&nbsp;I&nbsp;only&nbsp;had&nbsp;time&nbsp;to&nbsp;study&nbsp;a&nbsp;few&nbsp;misses.&nbsp;&lt;br&gt;<br>
They&nbsp;all&nbsp;stemmed&nbsp;from&nbsp;the&nbsp;same&nbsp;sequence&nbsp;of&nbsp;events:&lt;br&gt;<br>
&lt;br&gt;<br>
1.&nbsp;A&nbsp;collapsed&nbsp;request&nbsp;finds&nbsp;the&nbsp;corresponding&nbsp;entry&nbsp;in&nbsp;the&nbsp;cache.&lt;br&gt;<br>
2.&nbsp;Squid&nbsp;decides&nbsp;that&nbsp;this&nbsp;request&nbsp;should&nbsp;open&nbsp;the&nbsp;disk&nbsp;file.&lt;br&gt;<br>
3.&nbsp;The&nbsp;rock&nbsp;disk&nbsp;entry&nbsp;is&nbsp;still&nbsp;being&nbsp;written&nbsp;(i.e.&nbsp;&quot;swapped&nbsp;out&quot;),&lt;br&gt;<br>
 &nbsp; &nbsp;so&nbsp;the&nbsp;attempt&nbsp;to&nbsp;swap&nbsp;it&nbsp;in&nbsp;fails&nbsp;(TCP_SWAPFAIL_MISS).&lt;br&gt;<br>
4.&nbsp;The&nbsp;request&nbsp;goes&nbsp;to&nbsp;the&nbsp;origin&nbsp;server.&lt;br&gt;<br>
5.&nbsp;The&nbsp;fresh&nbsp;response&nbsp;deletes&nbsp;the&nbsp;existing&nbsp;cached&nbsp;entry.&lt;br&gt;<br>
6.&nbsp;When&nbsp;a&nbsp;subsequent&nbsp;request&nbsp;finds&nbsp;the&nbsp;cached&nbsp;entry&nbsp;marked&nbsp;for&lt;br&gt;<br>
 &nbsp; &nbsp;deletion,&nbsp;it&nbsp;declares&nbsp;a&nbsp;cache&nbsp;miss&nbsp;(TCP_MISS)&nbsp;and&nbsp;goes&nbsp;to&nbsp;step&nbsp;4.&lt;br&gt;<br>
&lt;br&gt;<br>
Disclaimer:&nbsp;The&nbsp;above&nbsp;sequence&nbsp;of&nbsp;events&nbsp;causes&nbsp;misses,&nbsp;but&nbsp;it&nbsp;may&nbsp;not&nbsp;&lt;br&gt;<br>
be&nbsp;the&nbsp;only&nbsp;or&nbsp;even&nbsp;the&nbsp;primary&nbsp;cause.&nbsp;I&nbsp;do&nbsp;not&nbsp;have&nbsp;enough&nbsp;free&nbsp;time&nbsp;to&nbsp;&lt;br&gt;<br>
rule&nbsp;out&nbsp;or&nbsp;confirm&nbsp;other&nbsp;causes&nbsp;(and&nbsp;order&nbsp;them&nbsp;by&nbsp;severity).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Squid&nbsp;can&nbsp;(and&nbsp;should)&nbsp;handle&nbsp;concurrent&nbsp;swapout/swapins&nbsp;better,&nbsp;and&nbsp;we&nbsp;&lt;br&gt;<br>
may&nbsp;be&nbsp;able&nbsp;to&nbsp;estimate&nbsp;that&nbsp;improvement&nbsp;potential&nbsp;for&nbsp;your&nbsp;workload&nbsp;&lt;br&gt;<br>
without&nbsp;significant&nbsp;development,&nbsp;but,&nbsp;for&nbsp;the&nbsp;next&nbsp;step,&nbsp;I&nbsp;suggest&nbsp;&lt;br&gt;<br>
disabling&nbsp;cache_dir&nbsp;and&nbsp;testing&nbsp;whether&nbsp;your&nbsp;get&nbsp;substantially&nbsp;better&nbsp;&lt;br&gt;<br>
results&nbsp;with&nbsp;memory&nbsp;cache&nbsp;alone.&nbsp;Shared&nbsp;memory&nbsp;cache&nbsp;also&nbsp;has&nbsp;periods&nbsp;&lt;br&gt;<br>
where&nbsp;a&nbsp;being-written&nbsp;entry&nbsp;cannot&nbsp;be&nbsp;read,&nbsp;but,&nbsp;compared&nbsp;to&nbsp;the&nbsp;disk&nbsp;&lt;br&gt;<br>
cache,&nbsp;those&nbsp;periods&nbsp;are&nbsp;much&nbsp;shorter&nbsp;IIRC.&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;confirm&nbsp;that&nbsp;&lt;br&gt;<br>
this&nbsp;simplified&nbsp;mode&nbsp;of&nbsp;operation&nbsp;works&nbsp;well&nbsp;for&nbsp;your&nbsp;workload&nbsp;before&nbsp;I&nbsp;&lt;br&gt;<br>
suggest&nbsp;code&nbsp;changes&nbsp;that&nbsp;would&nbsp;rely,&nbsp;in&nbsp;part,&nbsp;on&nbsp;this&nbsp;mode.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
