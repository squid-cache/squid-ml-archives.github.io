<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;have&nbsp;an&nbsp;external&nbsp;ACL&nbsp;that&nbsp;check&nbsp;if&nbsp;users&nbsp;are&nbsp;OVERCUOTE&nbsp;(exceed&nbsp;assigned&nbsp;cuote&nbsp;in&nbsp;MB),&nbsp;on&nbsp;this&nbsp;case&nbsp;those&nbsp;users&nbsp;can&#39;t&nbsp;browser certains&nbsp;domains&nbsp;and&nbsp;sites&nbsp;specified&nbsp;in&nbsp;certain&nbsp;acl&nbsp;(domains_cuote,&nbsp;parcials_domains_cuote,&nbsp;sites_cuote). The&nbsp;problem&nbsp;is&nbsp;that&nbsp;Squid&nbsp;doesn&#39;t&nbsp;interrupt&nbsp;stablished&nbsp;connections&nbsp;for&nbsp;example&nbsp;youtube&nbsp;video&nbsp;play and&nbsp;OVERCUOTE&nbsp;user&nbsp;continue&nbsp;video&nbsp;reproduction&nbsp;until&nbsp; the&nbsp;video&nbsp;it&nbsp;is&nbsp;not&nbsp;finished&nbsp;(I&#39;m&nbsp;not&nbsp;referring&nbsp;to&nbsp;the&nbsp;case&nbsp;of&nbsp;the&nbsp;buffer&nbsp;that&nbsp;the&nbsp;video&nbsp;player&nbsp;managed&nbsp;to&nbsp;load&nbsp;before&nbsp;the&nbsp;user&nbsp;became&nbsp;OVERCUOTE), although&nbsp;the&nbsp;rest&nbsp;of&nbsp;web&nbsp;browsing&nbsp;is&nbsp;limited&nbsp;correctly,&nbsp;and&nbsp;his&nbsp;account&nbsp;is&nbsp;marked&nbsp;as&nbsp;exceeded&nbsp;(OVERCUOTE).&lt;br&gt;&lt;br&gt;I&nbsp;need&nbsp;a&nbsp;delay_pool&nbsp;to&nbsp;OVERCUOTE&nbsp;users&nbsp;for&nbsp;reduce&nbsp;to&nbsp;minimun&nbsp;(for&nbsp;example&nbsp;1Kbit/s)&nbsp;the&nbsp;download&nbsp;rate&nbsp;over&nbsp;specifcs&nbsp;domains&nbsp;and&nbsp;sites&nbsp;until&nbsp;the&nbsp;user&nbsp;cuote&nbsp;will&nbsp;be&nbsp;restablished,&lt;br&gt;For&nbsp;this&nbsp;scenario&nbsp;i&nbsp;have&nbsp;an&nbsp;internet&nbsp;link&nbsp;with&nbsp;only&nbsp;2Mbps&nbsp;(very&nbsp;poor).&lt;br&gt;&lt;br&gt;I&nbsp;need&nbsp;help&nbsp;with&nbsp;possible&nbsp;delay&nbsp;pools&nbsp;config&nbsp;that&nbsp;help&nbsp;me.&nbsp;I&nbsp;don&#39;t&nbsp;understand&nbsp;very&nbsp;well&nbsp;delays_pool&lt;br&gt;&lt;div&gt;The&nbsp;idea&nbsp;is&nbsp;that&nbsp;the&nbsp;delay_pool&nbsp;limits&nbsp;web&nbsp;browsing&nbsp;on&nbsp;the&nbsp;domains&nbsp;and&nbsp;sites&nbsp;specified&nbsp;by&nbsp;the&nbsp;acl&nbsp;for&nbsp;users&nbsp;exceeding&nbsp;the&nbsp;assigned&nbsp;quota.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;##&nbsp;Auth&nbsp;config&lt;br&gt;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib/squid/basic_db_auth&nbsp;--dsn&nbsp;&quot;DBI:mysql:database=squidmgr&quot;&nbsp;--user&nbsp;dbuser&nbsp;--password&nbsp;dbpassword&nbsp;--table&nbsp;&quot;proxy_user&quot;&nbsp;--usercol&nbsp;&quot;squid_user_identifier&quot;&nbsp;--passwdcol&nbsp;&quot;passwd&quot;&nbsp;--cond&nbsp;&quot;enabled&nbsp;=&nbsp;1&quot;&nbsp;--md5&nbsp;--persist&lt;br&gt;auth_param&nbsp;basic&nbsp;children&nbsp;15&nbsp;startup=10&nbsp;idle=1&lt;br&gt;auth_param&nbsp;basic&nbsp;realm&nbsp;Web-Proxy&lt;br&gt;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;30&nbsp;minute&lt;br&gt;auth_param&nbsp;basic&nbsp;casesensitive&nbsp;on&lt;br&gt;authenticate_ip_ttl&nbsp;30&nbsp;minute&lt;br&gt;&lt;br&gt;acl&nbsp;AUTHENTICATED&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;&lt;br&gt;##ACL&nbsp;check&nbsp;if&nbsp;user&nbsp;is&nbsp;cuote&nbsp;exceeded.&nbsp;An&nbsp;external&nbsp;script&nbsp;count&nbsp;users&nbsp;consumption&nbsp;every&nbsp;xx&nbsp;seconds&nbsp;and&nbsp;update&nbsp;database,&nbsp;it&nbsp;work&nbsp;successfull.&lt;br&gt;external_acl_type&nbsp;CHECKOVERCUOTE&nbsp;concurrency=100&nbsp;ttl=3&nbsp;children-max=50&nbsp;children-startup=15&nbsp;children-idle=5&nbsp; %LOGIN&nbsp;/usr/lib/squid/ext_sql_session_acl&nbsp;--dsn&nbsp;&quot;DBI:mysql:database=squidmgr&quot;&nbsp;--user&nbsp;dbuser&nbsp;--password&nbsp;dbpassword&nbsp;--table&nbsp;&quot;proxy_user&quot;&nbsp;--uidcol&nbsp;&quot;squid_user_identifier&quot;&nbsp;--usercol&nbsp;&quot;squid_user_identifier&quot;&nbsp;--cond&nbsp;&quot;overcuote&nbsp;=&nbsp;1&quot;&lt;br&gt;acl&nbsp;OVERCUOTE&nbsp;external&nbsp;CHECKOVERCUOTE&lt;br&gt;&lt;br&gt;##&nbsp;Resources&nbsp;to&nbsp;take&nbsp;in&nbsp;user&nbsp;cuote&lt;br&gt;acl&nbsp;domains_cuote&nbsp;dstdomain&nbsp;&quot;/etc/squid/resources/domains_cuote.db&quot;&lt;br&gt;acl&nbsp;parcials_domains_cuote&nbsp;dstdomain&nbsp;&quot;/etc/squid/resources/parcials_domains_cuote.db&quot;&lt;br&gt;acl&nbsp;sites_cuote&nbsp;url_regex&nbsp;-i&nbsp;&quot;/etc/squid/resources/sites_cuote.db&quot;&lt;br&gt;&lt;br&gt;##&nbsp;RULES&lt;br&gt;http_access&nbsp;allow&nbsp;!domains_cuote&nbsp;!OVERCUOTE&lt;br&gt;http_access&nbsp;allow&nbsp;!parcials_domains_cuote&nbsp;!OVERCUOTE&lt;br&gt;http_access&nbsp;allow&nbsp;!sites_cuote&nbsp;!OVERCUOTE&lt;br&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;CONNECT&nbsp;SSL_ports&nbsp;!domains_cuote&nbsp;!OVERCUOTE&lt;br&gt;http_access&nbsp;allow&nbsp;CONNECT&nbsp;SSL_ports&nbsp;!parcials_domains_cuote&nbsp;!OVERCUOTE&lt;br&gt;http_access&nbsp;allow&nbsp;CONNECT&nbsp;SSL_ports&nbsp;!sites_cuote&nbsp;!OVERCUOTE&lt;br&gt;&lt;br&gt;deny_info&nbsp;&lt;a&nbsp;href=&quot;https://proxy.lan/proxyerrors?type=OVERCUOTE&quot;&gt;https://proxy.lan/proxyerrors?type=OVERCUOTE&lt;/a&gt;&nbsp;CONNECT&nbsp;SSL_ports&nbsp;domains_cuote&nbsp;OVERCUOTE&lt;br&gt;deny_info&nbsp;&lt;a&nbsp;href=&quot;https://proxy.lan/proxyerrors?type=OVERCUOTE&quot;&gt;https://proxy.lan/proxyerrors?type=OVERCUOTE&lt;/a&gt;&nbsp;CONNECT&nbsp;SSL_ports&nbsp;parcials_domains_cuote&nbsp;OVERCUOTE&lt;br&gt;deny_info&nbsp;&lt;a&nbsp;href=&quot;https://proxy.lan/proxyerrors?type=OVERCUOTE&quot;&gt;https://proxy.lan/proxyerrors?type=OVERCUOTE&lt;/a&gt;&nbsp;CONNECT&nbsp;SSL_ports&nbsp;sites_cuote&nbsp;OVERCUOTE&lt;br&gt;&lt;br&gt;deny_info&nbsp;&lt;a&nbsp;href=&quot;http://proxy.lan/proxyerrors?type=OVERCUOTE&quot;&gt;http://proxy.lan/proxyerrors?type=OVERCUOTE&lt;/a&gt;&nbsp;domains_cuote&nbsp;OVERCUOTE&lt;br&gt;deny_info&nbsp;&lt;a&nbsp;href=&quot;http://proxy.lan/proxyerrors?type=OVERCUOTE&quot;&gt;http://proxy.lan/proxyerrors?type=OVERCUOTE&lt;/a&gt;&nbsp;parcials_domains_cuote&nbsp;OVERCUOTE&lt;br&gt;deny_info&nbsp;&lt;a&nbsp;href=&quot;http://proxy.lan/proxyerrors?type=OVERCUOTE&quot;&gt;http://proxy.lan/proxyerrors?type=OVERCUOTE&lt;/a&gt;&nbsp;sites_cuote&nbsp;OVERCUOTE&lt;br&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;AUTHENTICATED&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
