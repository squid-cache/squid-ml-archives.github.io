<tt>
&lt;div&nbsp;dir=&quot;rtl&quot;&gt;&lt;div&gt;ב&quot;ה&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;managed&nbsp;to&nbsp;get&nbsp;the&nbsp;ssl&nbsp;splice&nbsp;configurations&nbsp;to&nbsp;work&nbsp;but&nbsp;when&nbsp;I&#39;m&nbsp;splicing&nbsp;for&nbsp;example:&nbsp;&lt;a&nbsp;href=&quot;http://play.google.com&quot;&gt;play.google.com&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;see&nbsp;in&nbsp;cache&nbsp;log&nbsp;the&nbsp;following:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;2023/08/29&nbsp;22:54:53.688&nbsp;kid1|&nbsp;33,2|&nbsp;client_side.cc(3214)&nbsp;fakeAConnectRequest:&nbsp;fake&nbsp;a&nbsp;CONNECT&nbsp;request&nbsp;to&nbsp;force&nbsp;connState&nbsp;to&nbsp;tunnel&nbsp;for&nbsp;ssl-bump&lt;br&gt;2023/08/29&nbsp;22:54:53.700&nbsp;kid1|&nbsp;33,2|&nbsp;client_side.cc(3214)&nbsp;fakeAConnectRequest:&nbsp;fake&nbsp;a&nbsp;CONNECT&nbsp;request&nbsp;to&nbsp;force&nbsp;connState&nbsp;to&nbsp;tunnel&nbsp;for&nbsp;splice&lt;br&gt;2023/08/29&nbsp;22:54:53&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;Host&nbsp;header&nbsp;forgery&nbsp;detected&nbsp;on&nbsp;conn3362&nbsp;local=&lt;a&nbsp;href=&quot;http://172.217.22.110:443&quot;&gt;172.217.22.110:443&lt;/a&gt;&nbsp;remote=&lt;a&nbsp;href=&quot;http://192.168.26.100:55331&quot;&gt;192.168.26.100:55331&lt;/a&gt;&nbsp;FD&nbsp;540&nbsp;flags=17&nbsp;(local&nbsp;IP&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;domain&nbsp;IP)&lt;br&gt; &nbsp; &nbsp;current&nbsp;master&nbsp;transaction:&nbsp;master2737&lt;br&gt;2023/08/29&nbsp;22:54:53&nbsp;kid1|&nbsp;SECURITY&nbsp;ALERT:&nbsp;on&nbsp;URL:&nbsp;&lt;a&nbsp;href=&quot;http://play.google.com:443&quot;&gt;play.google.com:443&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;The&nbsp;host&nbsp;header&nbsp;forgery&nbsp;issue&nbsp;for&nbsp;&lt;a&nbsp;href=&quot;http://play.google.com&quot;&gt;play.google.com&lt;/a&gt;&nbsp;is&nbsp;observed&nbsp;only&nbsp;for&nbsp;spliced&nbsp;connections,&nbsp;but&nbsp;when&nbsp;this&nbsp;url&nbsp;is&nbsp;bumped&nbsp;I&nbsp;don&#39;t&nbsp;see&nbsp;this&nbsp;error.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Why&nbsp;is&nbsp;splicing&nbsp;making&nbsp;this&nbsp;error?&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;rtl&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;‫בתאריך&nbsp;יום&nbsp;ב׳,&nbsp;28&nbsp;באוג׳&nbsp;2023&nbsp;ב-13:54&nbsp;מאת&nbsp;‪Ben&nbsp;Goz‬‏&nbsp;&lt;‪&lt;a&nbsp;href=&quot;mailto:ben.goz87@gmail.com&quot;&gt;ben.goz87@gmail.com&lt;/a&gt;‬‏&gt;:‬&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;&lt;div&nbsp;dir=&quot;rtl&quot;&gt;ב&quot;ה&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&#39;m&nbsp;using&nbsp;squid&nbsp;version:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;nativ@arachimprodsrv3:/usr/local/squid/etc$&nbsp;/usr/local/squid/sbin/squid&nbsp;-v&lt;br&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;6.1-VCS&lt;br&gt;Service&nbsp;Name:&nbsp;squid&lt;br&gt;&lt;br&gt;This&nbsp;binary&nbsp;uses&nbsp;OpenSSL&nbsp;3.0.2&nbsp;15&nbsp;Mar&nbsp;2022.&nbsp;configure&nbsp;options:&nbsp; &#39;--with-large-files&#39;&nbsp;&#39;--with-openssl&#39;&nbsp;&#39;--enable-ssl&#39;&nbsp;&#39;--enable-ssl-crtd&#39;&nbsp;&#39;--enable-icap-client&#39;&nbsp;&#39;--enable-linux-netfilter&#39;&nbsp;&#39;--disable-ident-lookups&#39;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Configured&nbsp;with&nbsp;ssl_bump&nbsp;and&nbsp;tproxy:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3128&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0:3128&lt;/a&gt;&lt;br&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3129&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0:3129&lt;/a&gt;&nbsp;tproxy&lt;br&gt;https_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3130&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0:3130&lt;/a&gt;&nbsp;tproxy&nbsp;ssl-bump&nbsp;\&lt;br&gt; &nbsp;cert=/usr/local/squid/etc/ssl_cert/myCA.pem&nbsp;\&lt;br&gt; &nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;options=ALL,NO_SSLv3&nbsp;sslflags=NO_DEFAULT_CA&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;And&nbsp;the&nbsp;following&nbsp;configurations:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;acl&nbsp;NoSSLInterceptRegexp_always&nbsp;ssl::server_name&nbsp;&quot;splice.list&quot;&lt;br&gt;always_direct&nbsp;allow&nbsp;all&lt;br&gt;on_unsupported_protocol&nbsp;tunnel&lt;br&gt;acl&nbsp;DiscoverSNIHost&nbsp;at_step&nbsp;SslBump1&lt;br&gt;ssl_bump&nbsp;splice&nbsp;NoSSLInterceptRegexp_always&lt;br&gt;ssl_bump&nbsp;peek&nbsp;DiscoverSNIHost&lt;br&gt;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;the&nbsp;content&nbsp;of&nbsp;the&nbsp;file&nbsp;splice.list:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;.&lt;a&nbsp;href=&quot;http://prog.co.il&quot;&nbsp;target=&quot;_blank&quot;&gt;prog.co.il&lt;/a&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;a&nbsp;href=&quot;http://prog.co.il&quot;&nbsp;target=&quot;_blank&quot;&gt;prog.co.il&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://www.prog.co.il&quot;&nbsp;target=&quot;_blank&quot;&gt;www.prog.co.il&lt;/a&gt;&lt;br&gt;.&lt;a&nbsp;href=&quot;http://shipuzim.info&quot;&nbsp;target=&quot;_blank&quot;&gt;shipuzim.info&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;The&nbsp;tproxy&nbsp;redirections&nbsp;works&nbsp;fine&nbsp;with&nbsp;squid&nbsp;server&nbsp;but&nbsp;unfortunately&nbsp;the&nbsp;urls&nbsp;in&nbsp;splice.list&nbsp;bumped&nbsp;although&nbsp;they&nbsp;should&nbsp;be&nbsp;spliced&nbsp;as&nbsp;seen&nbsp;in&nbsp;the&nbsp;access&nbsp;log:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;1693219853.255&nbsp; &nbsp; 626&nbsp;192.168.28.254&nbsp;TCP_MISS/200&nbsp;64439&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://www.prog.co.il/&quot;&nbsp;target=&quot;_blank&quot;&gt;https://www.prog.co.il/&lt;/a&gt;&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://172.67.196.36&quot;&nbsp;target=&quot;_blank&quot;&gt;172.67.196.36&lt;/a&gt;&nbsp;text/html&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;And&nbsp;I&nbsp;see&nbsp;in&nbsp;the&nbsp;browser&#39;s&nbsp;certificate&nbsp;viewer&nbsp;my&nbsp;squid&nbsp;self&nbsp;signed&nbsp;certificate.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;What&nbsp;am&nbsp;I&nbsp;missing&nbsp;here?&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks,&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Ben&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
