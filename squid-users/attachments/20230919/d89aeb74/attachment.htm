<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello, &lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;had&nbsp;the&nbsp;same&nbsp;crushes.&nbsp;A&nbsp;network&nbsp;dump&nbsp;showed&nbsp;me&nbsp;that&nbsp;crushes&nbsp;occurred when&nbsp;clients&nbsp;tried&nbsp;to&nbsp;access&nbsp;IPv6&nbsp;http-resources.&lt;/div&gt;&lt;div&gt;I&nbsp;blocked&nbsp;these&nbsp;requests&nbsp;at&nbsp;the&nbsp;beginning of&nbsp;the&nbsp;proxy&nbsp;policy.&lt;/div&gt;&lt;div&gt;The&nbsp;following&nbsp;configuration&nbsp;seems&nbsp;to&nbsp;be&nbsp;a&nbsp;workaround&nbsp;for&nbsp;me:&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;acl&nbsp;urldst_ipv6&nbsp;url_regex&nbsp;^http://\[&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;http_access&nbsp;deny&nbsp;urldst_ipv6&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;this&nbsp;workaround&nbsp;is&nbsp;also&nbsp;suitable&nbsp;for&nbsp;https-resources.&nbsp;May&nbsp;be&nbsp;it&nbsp;should&nbsp;be&nbsp;rewritten&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;acl&nbsp;urldst_ipv6_https&nbsp;url_regex&nbsp;^\[&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;http_access&nbsp;deny&nbsp;urldst_ipv6_https&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Kind&nbsp;regards,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; Ankor.&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;чт,&nbsp;14&nbsp;сент.&nbsp;2023 г.&nbsp;в&nbsp;17:12,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;2023-09-14&nbsp;07:02,&nbsp;Flashdown&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Sep&nbsp;14&nbsp;08:55:06&nbsp;vm-myproxy&nbsp;squid[79100]:&nbsp;Squid&nbsp;Parent:&nbsp;squid-2&nbsp;process&nbsp;&lt;br&gt;<br>
&gt;&nbsp;80675&nbsp;exited&nbsp;due&nbsp;to&nbsp;signal&nbsp;6&nbsp;with&nbsp;status&nbsp;0&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;1694674498.411     &nbsp;9&nbsp;**CENSORED_internal_client_IP**&nbsp;TCP_DENIED/407&nbsp;&lt;br&gt;<br>
&gt;&nbsp;4129&nbsp;CONNECT&nbsp;[ff00::]:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;IPv6&nbsp;is&nbsp;disabled&nbsp;via&nbsp;sysctl&nbsp;config&nbsp;&quot;net.ipv6.conf.all.disable_ipv6=1&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Your&nbsp;Squid&nbsp;is&nbsp;most&nbsp;likely&nbsp;suffering&nbsp;(among&nbsp;other&nbsp;v5&nbsp;bugs)&nbsp;from&nbsp;Squid&nbsp;Bug&nbsp;&lt;br&gt;<br>
5154:&nbsp;&lt;a&nbsp;href=&quot;https://bugs.squid-cache.org/show_bug.cgi?id=5154&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugs.squid-cache.org/show_bug.cgi?id=5154&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;confirm,&nbsp;enable&nbsp;core&nbsp;dumps&nbsp;and&nbsp;look&nbsp;for&nbsp;a&nbsp;gdb&nbsp;backtrace&nbsp;sequence&nbsp;&lt;br&gt;<br>
similar&nbsp;to&nbsp;the&nbsp;one&nbsp;posted&nbsp;in&nbsp;the&nbsp;above&nbsp;bug&nbsp;report:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;in&nbsp;__assert_fail&lt;br&gt;<br>
*&nbsp;in&nbsp;Ip::Address::getAddrInfo(addrinfo*&amp;,&nbsp;int)&nbsp;const&lt;br&gt;<br>
*&nbsp;in&nbsp;comm_openex(int,&nbsp;int,&nbsp;Ip::Address&amp;,&nbsp;int,&nbsp;char&nbsp;const*)&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;best&nbsp;known&nbsp;way&nbsp;to&nbsp;prevent&nbsp;bug&nbsp;5154&nbsp;is&nbsp;to&nbsp;enable&nbsp;IPv6&nbsp;support.&nbsp;If&nbsp;&lt;br&gt;<br>
that&nbsp;is&nbsp;not&nbsp;feasible&nbsp;in&nbsp;your&nbsp;environment,&nbsp;then&nbsp;please&nbsp;keep&nbsp;reading.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Squid&nbsp;bug&nbsp;5154&nbsp;has&nbsp;an&nbsp;unofficial&nbsp;but,&nbsp;IMO,&nbsp;correct&nbsp;fix&nbsp;at&nbsp;PR&nbsp;1421:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/squid-cache/squid/pull/1421&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/squid-cache/squid/pull/1421&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;above&nbsp;fix&nbsp;is&nbsp;not&nbsp;trivial&nbsp;and&nbsp;has&nbsp;side&nbsp;effects:&nbsp;For&nbsp;Squids&nbsp;that&nbsp;&lt;br&gt;<br>
cannot&nbsp;handle&nbsp;IPv6&nbsp;(e.g.,&nbsp;because&nbsp;IPv6&nbsp;support&nbsp;was&nbsp;disabled&nbsp;at&nbsp;&lt;br&gt;<br>
./configure&nbsp;time&nbsp;or&nbsp;is&nbsp;unavailable&nbsp;in&nbsp;the&nbsp;deployment&nbsp;environment),&nbsp;the&nbsp;&lt;br&gt;<br>
fix&nbsp;will,&nbsp;in&nbsp;part,&nbsp;reject&nbsp;requests&nbsp;with&nbsp;IPv6&nbsp;addresses&nbsp;in&nbsp;URLs.&nbsp;This&nbsp;&lt;br&gt;<br>
rejection&nbsp;may&nbsp;negatively&nbsp;affect&nbsp;Squids&nbsp;that&nbsp;were&nbsp;&quot;worked&nbsp;OK&quot;&nbsp;by&nbsp;&lt;br&gt;<br>
forwarding&nbsp;such&nbsp;traffic&nbsp;to&nbsp;IPv4&nbsp;ICAP&nbsp;servers&nbsp;and&nbsp;cache_peers&nbsp;(at&nbsp;least).&lt;br&gt;<br>
&lt;br&gt;<br>
PR&nbsp;1421&nbsp;changes&nbsp;cannot&nbsp;be&nbsp;applied&nbsp;to&nbsp;Squid&nbsp;v5&nbsp;&quot;as&nbsp;is&quot;;&nbsp;they&nbsp;have&nbsp;to&nbsp;be&nbsp;&lt;br&gt;<br>
backported.&nbsp;I&nbsp;do&nbsp;not&nbsp;have&nbsp;a&nbsp;backporting&nbsp;patch&nbsp;for&nbsp;virgin&nbsp;Squid&nbsp;v5.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
