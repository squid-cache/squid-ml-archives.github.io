<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello,&nbsp;Flashdown,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;you&nbsp;can&nbsp;see&nbsp;in&nbsp;your&nbsp;access.log,&nbsp;your&nbsp;client&nbsp;tried&nbsp;to&nbsp;connect&nbsp;not&nbsp;to&nbsp;a&nbsp;DNS&nbsp;hostname&nbsp;but&nbsp;directly&nbsp;to&nbsp;IPv6&nbsp;address:&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;40px;border:none;padding:0px&quot;&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;1694674498.411 &nbsp; &nbsp; &nbsp;9&nbsp;**CENSORED_internal_client_IP**&nbsp;TCP_DENIED/407&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;monospace&quot;&gt;4129&nbsp;CONNECT&nbsp;&lt;b&gt;[ff00::]:443&lt;/b&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;/font&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;So,&nbsp;I&nbsp;suppose&nbsp;that&nbsp;your&nbsp;DNS&nbsp;configuration&nbsp;changes&nbsp;will&nbsp;not&nbsp;eliminate&nbsp;the&nbsp;client&nbsp;requests&nbsp;to &lt;b&nbsp;style=&quot;font-family:monospace&quot;&gt;[ff00::]:443&lt;/b&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;I&nbsp;believe that&nbsp;enabling&nbsp;IPv6&nbsp;will&nbsp;prevent&nbsp;your&nbsp;squid&nbsp;crushes.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Kind regards,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; Ankor.&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;вт,&nbsp;19&nbsp;сент.&nbsp;2023 г.&nbsp;в&nbsp;19:04,&nbsp;Flashdown&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:flashdown@data-core.org&quot;&gt;flashdown@data-core.org&lt;/a&gt;&gt;:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;Thank&nbsp;you&nbsp;Alex&nbsp;for&nbsp;confirming&nbsp;this&nbsp;and&nbsp;all&nbsp;the&nbsp;hints&nbsp;given.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;have&nbsp;taken&nbsp;another&nbsp;path&nbsp;to&nbsp;fix&nbsp;this.&nbsp;I&nbsp;have&nbsp;configured&nbsp;the&nbsp;dns&nbsp;&lt;br&gt;<br>
forwarders&nbsp;that&nbsp;squid&nbsp;is&nbsp;configured&nbsp;to&nbsp;use,&nbsp;to&nbsp;not&nbsp;give&nbsp;out&nbsp;any&nbsp;AAAA&nbsp;&lt;br&gt;<br>
responses.&nbsp;After&nbsp;that&nbsp;I&nbsp;have&nbsp;enabled&nbsp;IPv6&nbsp;on&nbsp;this&nbsp;box&nbsp;to&nbsp;completly&nbsp;avoid&nbsp;&lt;br&gt;<br>
this&nbsp;bug.&nbsp;Thank&nbsp;you!&lt;br&gt;<br>
&lt;br&gt;<br>
---&lt;br&gt;<br>
Best&nbsp;regards,&lt;br&gt;<br>
Flashdown&lt;br&gt;<br>
&lt;br&gt;<br>
Am&nbsp;2023-09-14&nbsp;16:11,&nbsp;schrieb&nbsp;Alex&nbsp;Rousskov:&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;2023-09-14&nbsp;07:02,&nbsp;Flashdown&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;Sep&nbsp;14&nbsp;08:55:06&nbsp;vm-myproxy&nbsp;squid[79100]:&nbsp;Squid&nbsp;Parent:&nbsp;squid-2&nbsp;process&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;80675&nbsp;exited&nbsp;due&nbsp;to&nbsp;signal&nbsp;6&nbsp;with&nbsp;status&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;1694674498.411     &nbsp;9&nbsp;**CENSORED_internal_client_IP**&nbsp;TCP_DENIED/407&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;4129&nbsp;CONNECT&nbsp;[ff00::]:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;IPv6&nbsp;is&nbsp;disabled&nbsp;via&nbsp;sysctl&nbsp;config&nbsp;&quot;net.ipv6.conf.all.disable_ipv6=1&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Your&nbsp;Squid&nbsp;is&nbsp;most&nbsp;likely&nbsp;suffering&nbsp;(among&nbsp;other&nbsp;v5&nbsp;bugs)&nbsp;from&nbsp;Squid&lt;br&gt;<br>
&gt;&nbsp;Bug&nbsp;5154:&nbsp;&lt;a&nbsp;href=&quot;https://bugs.squid-cache.org/show_bug.cgi?id=5154&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://bugs.squid-cache.org/show_bug.cgi?id=5154&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;To&nbsp;confirm,&nbsp;enable&nbsp;core&nbsp;dumps&nbsp;and&nbsp;look&nbsp;for&nbsp;a&nbsp;gdb&nbsp;backtrace&nbsp;sequence&lt;br&gt;<br>
&gt;&nbsp;similar&nbsp;to&nbsp;the&nbsp;one&nbsp;posted&nbsp;in&nbsp;the&nbsp;above&nbsp;bug&nbsp;report:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*&nbsp;in&nbsp;__assert_fail&lt;br&gt;<br>
&gt;&nbsp;*&nbsp;in&nbsp;Ip::Address::getAddrInfo(addrinfo*&amp;,&nbsp;int)&nbsp;const&lt;br&gt;<br>
&gt;&nbsp;*&nbsp;in&nbsp;comm_openex(int,&nbsp;int,&nbsp;Ip::Address&amp;,&nbsp;int,&nbsp;char&nbsp;const*)&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;best&nbsp;known&nbsp;way&nbsp;to&nbsp;prevent&nbsp;bug&nbsp;5154&nbsp;is&nbsp;to&nbsp;enable&nbsp;IPv6&nbsp;support.&nbsp;If&lt;br&gt;<br>
&gt;&nbsp;that&nbsp;is&nbsp;not&nbsp;feasible&nbsp;in&nbsp;your&nbsp;environment,&nbsp;then&nbsp;please&nbsp;keep&nbsp;reading.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Squid&nbsp;bug&nbsp;5154&nbsp;has&nbsp;an&nbsp;unofficial&nbsp;but,&nbsp;IMO,&nbsp;correct&nbsp;fix&nbsp;at&nbsp;PR&nbsp;1421:&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://github.com/squid-cache/squid/pull/1421&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/squid-cache/squid/pull/1421&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;above&nbsp;fix&nbsp;is&nbsp;not&nbsp;trivial&nbsp;and&nbsp;has&nbsp;side&nbsp;effects:&nbsp;For&nbsp;Squids&nbsp;that&lt;br&gt;<br>
&gt;&nbsp;cannot&nbsp;handle&nbsp;IPv6&nbsp;(e.g.,&nbsp;because&nbsp;IPv6&nbsp;support&nbsp;was&nbsp;disabled&nbsp;at&lt;br&gt;<br>
&gt;&nbsp;./configure&nbsp;time&nbsp;or&nbsp;is&nbsp;unavailable&nbsp;in&nbsp;the&nbsp;deployment&nbsp;environment),&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;fix&nbsp;will,&nbsp;in&nbsp;part,&nbsp;reject&nbsp;requests&nbsp;with&nbsp;IPv6&nbsp;addresses&nbsp;in&nbsp;URLs.&nbsp;This&lt;br&gt;<br>
&gt;&nbsp;rejection&nbsp;may&nbsp;negatively&nbsp;affect&nbsp;Squids&nbsp;that&nbsp;were&nbsp;&quot;worked&nbsp;OK&quot;&nbsp;by&lt;br&gt;<br>
&gt;&nbsp;forwarding&nbsp;such&nbsp;traffic&nbsp;to&nbsp;IPv4&nbsp;ICAP&nbsp;servers&nbsp;and&nbsp;cache_peers&nbsp;(at&lt;br&gt;<br>
&gt;&nbsp;least).&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;PR&nbsp;1421&nbsp;changes&nbsp;cannot&nbsp;be&nbsp;applied&nbsp;to&nbsp;Squid&nbsp;v5&nbsp;&quot;as&nbsp;is&quot;;&nbsp;they&nbsp;have&nbsp;to&nbsp;be&lt;br&gt;<br>
&gt;&nbsp;backported.&nbsp;I&nbsp;do&nbsp;not&nbsp;have&nbsp;a&nbsp;backporting&nbsp;patch&nbsp;for&nbsp;virgin&nbsp;Squid&nbsp;v5.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;HTH,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Alex.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
