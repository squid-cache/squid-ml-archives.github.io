<tt>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=GB18030&quot;&gt;&lt;pre&nbsp;class=&quot;tw-data-text&nbsp;tw-text-large&nbsp;tw-ta&quot;&nbsp;data-placeholder=&quot;翻译&quot;&nbsp;id=&quot;tw-target-text&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;unicode-bidi:&nbsp;isolate;&nbsp;line-height:&nbsp;36px;&nbsp;background-color:&nbsp;rgb(248,&nbsp;249,&nbsp;250);&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;2px&nbsp;0.14em&nbsp;2px&nbsp;0px;&nbsp;position:&nbsp;relative;&nbsp;margin-top:&nbsp;-2px;&nbsp;margin-bottom:&nbsp;-2px;&nbsp;resize:&nbsp;none;&nbsp;overflow:&nbsp;hidden;&nbsp;width:&nbsp;270px;&quot;&gt;&lt;font&nbsp;color=&quot;#202124&quot;&nbsp;face=&quot;Verdana&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;28px;&quot;&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;detailed&nbsp;answer.&nbsp;<br>
As&nbsp;you&nbsp;said,&nbsp;Squid&nbsp;does&nbsp;not&nbsp;support&nbsp;rewrite-url&nbsp;after&nbsp;ssl-bumped.<br>
but&nbsp;I&nbsp;don't&nbsp;understand&nbsp;why&nbsp;it&nbsp;is&nbsp;designed&nbsp;this&nbsp;way.<br>
If&nbsp;I&nbsp;want&nbsp;to&nbsp;modify&nbsp;the&nbsp;ssl-bumped&nbsp;returned&nbsp;content,&nbsp;not&nbsp;through&nbsp;302,307&nbsp;http&nbsp;redirect&nbsp;url?&nbsp;<br>
can&nbsp;I&nbsp;use&nbsp;ecap&nbsp;or&nbsp;other&nbsp;methods&nbsp;to&nbsp;achieve&nbsp;it?&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;12px;font-family:&nbsp;Arial&nbsp;Narrow;padding:2px&nbsp;0&nbsp;2px&nbsp;0;&quot;&gt;------------------&nbsp;原始邮件&nbsp;------------------&lt;/div&gt;&lt;div&nbsp;style=&quot;font-size:&nbsp;12px;background:#efefef;padding:8px;&quot;&gt;&lt;div&gt;&lt;b&gt;发件人:&lt;/b&gt;&nbsp;&quot;Alex&nbsp;Rousskov&quot;&lt;rousskov@measurement-factory.com&gt;;&nbsp;&lt;/div&gt;&lt;div&gt;&lt;b&gt;发送时间:&lt;/b&gt;&nbsp;2023年9月21日(星期四)&nbsp;凌晨0:57&lt;/div&gt;&lt;div&gt;&lt;b&gt;收件人:&lt;/b&gt;&nbsp;&quot;squid-users&quot;&lt;squid-users@lists.squid-cache.org&gt;;&nbsp;&lt;/div&gt;&lt;div&gt;&lt;b&gt;主题:&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;ssl-bump&nbsp;peek&nbsp;and&nbsp;select&nbsp;pinned&nbsp;destination&nbsp;failed&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;On&nbsp;2023-09-20&nbsp;04:17,&nbsp;linfengfeiye&nbsp;wrote:&lt;br&gt;&gt;&nbsp;Hi,&nbsp;what&nbsp;does&nbsp;&quot;PeerSelector186&nbsp;found&nbsp;pinned,&nbsp;destination&quot;&nbsp;that&nbsp;appears&nbsp;&lt;br&gt;&gt;&nbsp;in&nbsp;the&nbsp;Squid&nbsp;log&nbsp;mean?&lt;br&gt;&lt;br&gt;Please&nbsp;note&nbsp;that&nbsp;Squid&nbsp;debugging&nbsp;logs&nbsp;(cache.log&nbsp;at&nbsp;level&nbsp;3&nbsp;and&nbsp;above)&nbsp;&lt;br&gt;are&nbsp;for&nbsp;developer&nbsp;use.&nbsp;This&nbsp;mailing&nbsp;list&nbsp;is&nbsp;not.&nbsp;In&nbsp;triage,&nbsp;I&nbsp;recommend&nbsp;&lt;br&gt;focusing&nbsp;on&nbsp;access.log,&nbsp;non-debugging&nbsp;cache.log,&nbsp;and&nbsp;other&nbsp;admin-focused&nbsp;&lt;br&gt;resources&nbsp;while&nbsp;leaving&nbsp;debug&nbsp;log&nbsp;analysis&nbsp;to&nbsp;Squid&nbsp;developers.&lt;br&gt;&lt;br&gt;&lt;br&gt;Roughly&nbsp;speaking,&nbsp;the&nbsp;logging&nbsp;message&nbsp;you&nbsp;are&nbsp;asking&nbsp;about&nbsp;means&nbsp;that&nbsp;&lt;br&gt;Squid&nbsp;code&nbsp;tasked&nbsp;with&nbsp;selecting&nbsp;where&nbsp;to&nbsp;forward&nbsp;the&nbsp;request&nbsp;found&nbsp;a&nbsp;&lt;br&gt;previously&nbsp;opened&nbsp;Squid-to-server&nbsp;connection&nbsp;that&nbsp;was&nbsp;assigned&nbsp;(i.e.,&nbsp;&lt;br&gt;&quot;pinned&quot;)&nbsp;to&nbsp;the&nbsp;client-to-Squid&nbsp;connection&nbsp;on&nbsp;which&nbsp;that&nbsp;request&nbsp;was&nbsp;&lt;br&gt;received.&nbsp;In&nbsp;most&nbsp;cases,&nbsp;that&nbsp;connection&nbsp;will&nbsp;be&nbsp;used&nbsp;for&nbsp;that&nbsp;request.&lt;br&gt;&lt;br&gt;In&nbsp;SslBump&nbsp;context,&nbsp;a&nbsp;Squid-to-server&nbsp;TCP&nbsp;connection&nbsp;gets&nbsp;pinned&nbsp;to&nbsp;the&nbsp;&lt;br&gt;corresponding&nbsp;client-to-Squid&nbsp;TCP&nbsp;connection&nbsp;because&nbsp;that&nbsp;&lt;br&gt;Squid-to-server&nbsp;TLS&nbsp;connection&nbsp;uses&nbsp;TLS&nbsp;settings&nbsp;specific&nbsp;to&nbsp;that&nbsp;client&nbsp;&lt;br&gt;and&nbsp;vice&nbsp;versa.&nbsp;Pinning&nbsp;minimizes&nbsp;surprises/changes&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;that&nbsp;&lt;br&gt;are&nbsp;not&nbsp;expected&nbsp;to&nbsp;be&nbsp;bumped.&nbsp;It&nbsp;also&nbsp;creates&nbsp;various&nbsp;problems.&lt;br&gt;&lt;br&gt;&lt;br&gt;&gt;&nbsp;The&nbsp;destination&nbsp;address&nbsp;&lt;a&nbsp;href=&quot;https://my.local.web&quot;&nbsp;rel=&quot;noopener&quot;&nbsp;target=&quot;_blank&quot;&gt;https://my.local.web&lt;/a&gt;&nbsp;in&nbsp;this&nbsp;log&nbsp;is&nbsp;returned&nbsp;by&nbsp;&lt;br&gt;&gt;&nbsp;URL-Rewrite,&nbsp;rewrite-url=&lt;a&nbsp;href=&quot;https://my.local.web,&quot;&nbsp;rel=&quot;noopener&quot;&nbsp;target=&quot;_blank&quot;&gt;https://my.local.web,&lt;/a&gt;&nbsp;which&nbsp;is&nbsp;a&nbsp;local&nbsp;web&nbsp;&lt;br&gt;&gt;&nbsp;service&nbsp;of&nbsp;mine.But&nbsp;it&nbsp;failed&nbsp;directly&nbsp;after&nbsp;peer_select.&nbsp;I&nbsp;think&nbsp;this&nbsp;&lt;br&gt;&gt;&nbsp;should&nbsp;be&nbsp;related&nbsp;to&nbsp;ssl-bump.&lt;br&gt;&lt;br&gt;AFAICT,&nbsp;without&nbsp;significant&nbsp;Squid&nbsp;code&nbsp;adjustments,&nbsp;one&nbsp;cannot&nbsp;rewrite&nbsp;&lt;br&gt;destinations&nbsp;of&nbsp;bumped&nbsp;requests&nbsp;because&nbsp;rewritten&nbsp;requests&nbsp;will&nbsp;still&nbsp;be&nbsp;&lt;br&gt;assigned&nbsp;the&nbsp;old&nbsp;pinned&nbsp;Squid-to-server&nbsp;connections&nbsp;despite&nbsp;request&nbsp;&lt;br&gt;destination&nbsp;changes.&lt;br&gt;&lt;br&gt;&lt;br&gt;&gt;&nbsp;My&nbsp;decryption&nbsp;configuration&nbsp;is&nbsp;roughly&nbsp;as&nbsp;&lt;br&gt;&gt;&nbsp;follows.&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;The&nbsp;strange&nbsp;thing&nbsp;is&nbsp;that&nbsp;as&nbsp;long&nbsp;as&nbsp;I&nbsp;comment&nbsp;these&nbsp;two&nbsp;lines,&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;#acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;&gt;&nbsp;#ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;&nbsp;&nbsp;the&nbsp;pinned&nbsp;destination&nbsp;disappears&nbsp;and&nbsp;the&nbsp;access&nbsp;is&nbsp;successful,why?&lt;br&gt;&lt;br&gt;Roughly&nbsp;speaking,&nbsp;without&nbsp;SslBump&nbsp;(and&nbsp;certain&nbsp;other&nbsp;special&nbsp;cases),&nbsp;&lt;br&gt;there&nbsp;is&nbsp;no&nbsp;need&nbsp;to&nbsp;pin&nbsp;connections&nbsp;and&nbsp;there&nbsp;is&nbsp;no&nbsp;URL&nbsp;rewriting&nbsp;(for&nbsp;&lt;br&gt;encrypted&nbsp;requests).&lt;br&gt;&lt;br&gt;&lt;br&gt;HTH,&lt;br&gt;&lt;br&gt;Alex.&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&gt;&nbsp;##follows&nbsp;is&nbsp;ssl-bump&nbsp;config################&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;http_port&nbsp;3126&nbsp;intercept&lt;br&gt;&gt;&nbsp;https_port&nbsp;3129&nbsp;intercept&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;&lt;br&gt;&gt;&nbsp;options=NO_SSLv3&nbsp;tls-min-version=1.2&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;&lt;br&gt;&gt;&nbsp;tls-cert=/os/usr/local/proxy/etc/cert.pem&lt;br&gt;&gt;&nbsp;http_port&nbsp;3128&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;options=NO_SSLv3&nbsp;&lt;br&gt;&gt;&nbsp;tls-min-version=1.2&nbsp;dynamic_cert_mem_cache_size=4MB&nbsp;&lt;br&gt;&gt;&nbsp;tls-cert=/usr/local/proxy/etc/cert.pem&lt;br&gt;&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;&gt;&nbsp;sslcrtd_program&nbsp;/os/usr/local/proxy/libexec/security_file_certgen&nbsp;-s&nbsp;&lt;br&gt;&gt;&nbsp;/usr/local/proxy/var/lib/ssl_db&nbsp;-M&nbsp;4MB&lt;br&gt;&gt;&nbsp;sslcrtd_children&nbsp;5&lt;br&gt;&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;br&gt;&gt;&nbsp;ssl_bump&nbsp;splice&nbsp;white_list&lt;br&gt;&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;bump_domain&lt;br&gt;&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;&gt;&nbsp;http_access&nbsp;allow&nbsp;all&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;&lt;br&gt;&gt;&nbsp;_______________________________________________&lt;br&gt;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;rel=&quot;noopener&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;&gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noopener&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;rel=&quot;noopener&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noopener&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;&lt;style&nbsp;type=&quot;text/css&quot;&gt;.qmbox&nbsp;style,&nbsp;.qmbox&nbsp;script,&nbsp;.qmbox&nbsp;head,&nbsp;.qmbox&nbsp;link,&nbsp;.qmbox&nbsp;meta&nbsp;{display:&nbsp;none&nbsp;!important;}&lt;/style&gt;
</tt>
