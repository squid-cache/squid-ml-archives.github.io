<tt>
&lt;div&nbsp;dir=&quot;rtl&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;By&nbsp;the&nbsp;help&nbsp;of&nbsp;God.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;This&nbsp;is&nbsp;basically&nbsp;the&nbsp;network&nbsp;topology&nbsp;that&nbsp;I&#39;m&nbsp;using:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt; adsl&nbsp;&lt;--&gt;&nbsp;vrf&nbsp;&lt;--&gt;&nbsp;&lt;eth1&gt;&nbsp;[squid/icap&nbsp;machine]&nbsp;&lt;eth0&gt;&nbsp;&lt;--&gt;&nbsp;vrf&nbsp;&lt;--&gt;&nbsp;&lt;internet&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;When&nbsp;traffic&nbsp;goes&nbsp;via&nbsp;squid&nbsp;I&nbsp;see&nbsp;that&nbsp;eth1&nbsp;(The&nbsp;one&nbsp;closes&nbsp;to&nbsp;adsl&nbsp;users)&nbsp;is&nbsp;very&nbsp;high&nbsp;this&nbsp;is&nbsp;from&nbsp;sar&nbsp;output:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Average:&nbsp; &nbsp; &nbsp; &nbsp; IFACE&nbsp; &nbsp;rxpck/s&nbsp; &nbsp;txpck/s&nbsp; &nbsp; rxkB/s&nbsp; &nbsp; txkB/s&nbsp; &nbsp;rxcmp/s&nbsp; &nbsp;txcmp/s&nbsp; rxmcst/s&nbsp; &nbsp;%ifutil&lt;br&gt;Average:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lo&nbsp; &nbsp;4191.83&nbsp; &nbsp;4191.83&nbsp; 16976.00&nbsp; 16976.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&lt;br&gt;Average:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;eth0&nbsp; &nbsp;2921.48&nbsp; &nbsp;1224.57&nbsp; &nbsp;3432.46&nbsp; &nbsp; 485.77&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.28&lt;br&gt;Average:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;eth1&nbsp; &nbsp;7558.70&nbsp; 11544.74&nbsp; &nbsp; 920.91&nbsp; &lt;b&gt;14447.44&lt;/b&gt;&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 1.18&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;When&nbsp;traffic&nbsp;doesn&#39;t&nbsp;go&nbsp;via&nbsp;squid&nbsp;this&nbsp;is&nbsp;the&nbsp;output:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Average:&nbsp; &nbsp; &nbsp; &nbsp; IFACE&nbsp; &nbsp;rxpck/s&nbsp; &nbsp;txpck/s&nbsp; &nbsp; rxkB/s&nbsp; &nbsp; txkB/s&nbsp; &nbsp;rxcmp/s&nbsp; &nbsp;txcmp/s&nbsp; rxmcst/s&nbsp; &nbsp;%ifutil&lt;br&gt;Average:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lo&nbsp; &nbsp; &nbsp;19.10&nbsp; &nbsp; &nbsp;19.10&nbsp; &nbsp; &nbsp; 2.25&nbsp; &nbsp; &nbsp; 2.25&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&lt;br&gt;Average:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;eth0&nbsp; &nbsp;3666.40&nbsp; &nbsp;2133.70&nbsp; &nbsp;4608.70&nbsp; &nbsp; 409.59&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.38&lt;br&gt;Average:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;eth1&nbsp; &nbsp;2213.40&nbsp; &nbsp;3741.10&nbsp; &nbsp; 424.38&nbsp; &nbsp;&lt;b&gt;4613.08&lt;/b&gt;&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.00&nbsp; &nbsp; &nbsp; 0.38&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&#39;m&nbsp;can&#39;t&nbsp;tell&nbsp;for&nbsp;sure&nbsp;that&nbsp;this&nbsp;is&nbsp;related&nbsp;but&nbsp;I&nbsp;saw&nbsp;several&nbsp;times&nbsp;the&nbsp;kernel&nbsp;prints:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;TCP:&nbsp;out&nbsp;of&nbsp;memory&nbsp;--&nbsp;consider&nbsp;tuning&nbsp;tcp_mem&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;The&nbsp;squid&nbsp;version&nbsp;I&#39;m&nbsp;using&nbsp;is:&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;/usr/local/squid/sbin/squid&nbsp;-v&lt;br&gt;Squid&nbsp;Cache:&nbsp;Version&nbsp;6.5-VCS&lt;br&gt;Service&nbsp;Name:&nbsp;squid&lt;br&gt;&lt;br&gt;This&nbsp;binary&nbsp;uses&nbsp;OpenSSL&nbsp;3.0.2&nbsp;15&nbsp;Mar&nbsp;2022.&nbsp;configure&nbsp;options:&nbsp; &#39;--with-large-files&#39;&nbsp;&#39;--with-openssl&#39;&nbsp;&#39;--enable-ssl&#39;&nbsp;&#39;--enable-ssl-crtd&#39;&nbsp;&#39;--enable-icap-client&#39;&nbsp;&#39;--enable-linux-netfilter&#39;&nbsp;&#39;--disable-ident-lookups&#39;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;And&nbsp;I&nbsp;turned&nbsp;off&nbsp;persistence&nbsp;from&nbsp;client,&nbsp;icap&nbsp;and&nbsp;server&nbsp;sessions.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;What&nbsp;could&nbsp;be&nbsp;the&nbsp;problem?&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks,&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Ben &lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
