<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&nbsp;thanks&nbsp;so&nbsp;much&nbsp;for&nbsp;the&nbsp;detailed&nbsp;response. &nbsp;I&nbsp;chose&nbsp;to&nbsp;test&nbsp;option&nbsp;2&nbsp;from&nbsp;your&nbsp;recommendations&nbsp;as&nbsp;I&nbsp;am&nbsp;new&nbsp;to&nbsp;squid&nbsp;and&nbsp;I&nbsp;do&nbsp;not&nbsp;understand&nbsp;how&nbsp;to&nbsp;set&nbsp;it&nbsp;up&nbsp;as&nbsp;a&nbsp;reverse&nbsp;proxy&nbsp;anyway. &nbsp;I&nbsp;made&nbsp;the&nbsp;change&nbsp;to&nbsp;my&nbsp;squid.conf&nbsp;:&lt;div&gt;&lt;span&nbsp;id=&quot;gmail-docs-internal-guid-f15790a3-7fff-1caa-077b-f79846f5189a&quot;&gt;&lt;p&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;#ssl_bump&nbsp;peek&nbsp;step1 &lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;ssl_bump&nbsp;bump&nbsp;step1&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;ssl_bump&nbsp;bump&nbsp;all&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:small&quot;&gt;This&nbsp;made&nbsp;it&nbsp;work&nbsp;-&nbsp;which&nbsp;is&nbsp;great&nbsp;news. &nbsp; My&nbsp;curl&nbsp;requests&nbsp;now&nbsp;are&nbsp;satisfied&nbsp;by&nbsp;the&nbsp;cache&nbsp;when&nbsp;the&nbsp;pc&nbsp;is&nbsp;offline!&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:small&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:small&quot;&gt;I&nbsp;do&nbsp;have&nbsp;1&nbsp;followup&nbsp;question&nbsp;which&nbsp;I&nbsp;think&nbsp;is&nbsp;unrelated,&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;etiquette demands&nbsp;I&nbsp;create&nbsp;a&nbsp;new&nbsp;post&nbsp;for&nbsp;this.  &lt;/span&gt;&lt;/span&gt;&lt;span&nbsp;style=&quot;background-color:transparent&quot;&gt;When&nbsp;I&nbsp;test&nbsp;using&nbsp;chromium browser,&nbsp;chromium&nbsp;sends&nbsp;&lt;/span&gt;OPTION&nbsp;requests&lt;span&nbsp;style=&quot;background-color:transparent&quot;&gt;&nbsp;-&nbsp;which&nbsp;I&nbsp;think&nbsp;is&nbsp;something&nbsp;to&nbsp;do&nbsp;with&nbsp;CORS. &nbsp; These&nbsp;always&nbsp;cause&nbsp;cache&nbsp;&lt;/span&gt;MISS &lt;span&nbsp;style=&quot;background-color:transparent&quot;&gt;&nbsp;from&nbsp;squid,..&nbsp;I&nbsp;think&nbsp;because&nbsp;the&nbsp;return&nbsp;code&nbsp;is&nbsp;204...?&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:small&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;1705669236.776&nbsp; &nbsp; 113&nbsp;::1&nbsp;TCP_MISS/204&nbsp;680&nbsp;OPTIONS&nbsp;&lt;a&nbsp;href=&quot;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&quot;&gt;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&lt;/a&gt;&nbsp;-&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://3.135.146.17&quot;&gt;3.135.146.17&lt;/a&gt;&nbsp;application/json&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:Arial,Helvetica,sans-serif;font-size:small&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;span&nbsp;style=&quot;font-size:8pt;font-family:Consolas,sans-serif;color:rgb(0,0,0);background-color:transparent;font-variant-numeric:normal;font-variant-east-asian:normal;font-variant-alternates:normal;vertical-align:baseline&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;I&nbsp;can&nbsp;prevent&nbsp;my&nbsp;chromium&nbsp;instance&nbsp;from&nbsp;making&nbsp;these&nbsp;(pointless?)&nbsp;OPTIONS&nbsp;calls&nbsp;using&nbsp;the&nbsp;following&nbsp;args,&nbsp;but&nbsp;I&nbsp;would&nbsp;rather&nbsp;not&nbsp;have&nbsp;to&nbsp;do&nbsp;this.&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;--disable-web-security  --disable-features=IsolateOrigins,site-per-process&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;Any&nbsp;way&nbsp;I&nbsp;can&nbsp;get&nbsp;squid&nbsp;to&nbsp;cache&nbsp;these&nbsp;calls?&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;Thanks&nbsp;again&nbsp;and&nbsp;all&nbsp;the&nbsp;best,&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;Robin&lt;/p&gt;&lt;p&nbsp;style=&quot;line-height:1.38;margin-top:0pt;margin-bottom:0pt&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;/span&gt;&lt;br&nbsp;class=&quot;gmail-Apple-interchange-newline&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Thu,&nbsp;18&nbsp;Jan&nbsp;2024&nbsp;at&nbsp;16:03,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&nbsp;target=&quot;_blank&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;2024-01-18&nbsp;09:53,&nbsp;Robin&nbsp;Carlisle&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;expectation/hope&nbsp;is&nbsp;that&nbsp;squid&nbsp;would&nbsp;return&nbsp;the&nbsp;cached&nbsp;object&nbsp;on&lt;br&gt;<br>
&gt;&nbsp;any&nbsp;network&nbsp;failure&nbsp;in&nbsp;between&nbsp;ubuntu-pc&nbsp;and&nbsp;the&nbsp;AWS&nbsp;endpoint&nbsp;-&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;continue&nbsp;to&nbsp;return&nbsp;this&nbsp;cached&nbsp;object&nbsp;forever. &nbsp; Is&nbsp;this&nbsp;something&lt;br&gt;<br>
&gt;&nbsp;squid&nbsp;can&nbsp;do?&nbsp;It&nbsp;would&nbsp;seem&nbsp;that&nbsp;offline_mode&nbsp;should&nbsp;do&nbsp;this?&lt;br&gt;<br>
&lt;br&gt;<br>
Yes&nbsp;and&nbsp;yes.&nbsp;The&nbsp;reason&nbsp;you&nbsp;are&nbsp;getting&nbsp;errors&nbsp;are&nbsp;not&nbsp;related&nbsp;to&nbsp;cache&nbsp;&lt;br&gt;<br>
hits&nbsp;or&nbsp;misses.&nbsp;Those&nbsp;errors&nbsp;happen&nbsp;_before_&nbsp;Squid&nbsp;gets&nbsp;the&nbsp;requested&nbsp;&lt;br&gt;<br>
resource&nbsp;URL&nbsp;and&nbsp;looks&nbsp;up&nbsp;that&nbsp;resource&nbsp;in&nbsp;Squid&nbsp;cache.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;all&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;get&nbsp;that&nbsp;URL&nbsp;(in&nbsp;your&nbsp;configuration),&nbsp;Squid&nbsp;must&nbsp;bump&nbsp;the&nbsp;connection.&nbsp;&lt;br&gt;<br>
To&nbsp;bump&nbsp;the&nbsp;connection&nbsp;at&nbsp;step2,&nbsp;Squid&nbsp;must&nbsp;contact&nbsp;the&nbsp;origin&nbsp;server.&nbsp;&lt;br&gt;<br>
When&nbsp;the&nbsp;cable&nbsp;is&nbsp;unplugged,&nbsp;Squid&nbsp;obviously&nbsp;cannot&nbsp;do&nbsp;that:&nbsp;The&nbsp;attempt&nbsp;&lt;br&gt;<br>
to&nbsp;open&nbsp;a&nbsp;Squid-AWS&nbsp;connection&nbsp;fails.&lt;br&gt;<br>
&lt;br&gt;<br>
 &gt;&nbsp;.../200&nbsp;0&nbsp;CONNECT&nbsp;&lt;a&nbsp;href=&quot;http://stuff.amazonaws.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;stuff.amazonaws.com:443&lt;/a&gt;&nbsp;-&nbsp;HIER_DIRECT&lt;br&gt;<br>
 &gt;&nbsp;.../503&nbsp;4087&nbsp;GET&nbsp;&lt;a&nbsp;href=&quot;https://stuff.amazonaws.com/api/.&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://stuff.amazonaws.com/api/.&lt;/a&gt;..&nbsp;-&nbsp;HIER_NONE&lt;br&gt;<br>
&lt;br&gt;<br>
Squid&nbsp;reports&nbsp;bumping&nbsp;errors&nbsp;to&nbsp;the&nbsp;client&nbsp;using&nbsp;HTTP&nbsp;responses.&nbsp;To&nbsp;do&nbsp;&lt;br&gt;<br>
that,&nbsp;Squid&nbsp;remembers&nbsp;the&nbsp;error&nbsp;response,&nbsp;bumps&nbsp;the&nbsp;client&nbsp;connection,&nbsp;&lt;br&gt;<br>
receives&nbsp;GET&nbsp;from&nbsp;the&nbsp;client&nbsp;on&nbsp;that&nbsp;bumped&nbsp;connection,&nbsp;and&nbsp;sends&nbsp;that&nbsp;&lt;br&gt;<br>
error&nbsp;response&nbsp;to&nbsp;the&nbsp;client.&nbsp;This&nbsp;is&nbsp;why&nbsp;you&nbsp;see&nbsp;both&nbsp;CONNECT/200&nbsp;and&nbsp;&lt;br&gt;<br>
GET/503&nbsp;access.log&nbsp;records.&nbsp;Note&nbsp;that&nbsp;Squid&nbsp;does&nbsp;not&nbsp;check&nbsp;whether&nbsp;the&nbsp;&lt;br&gt;<br>
received&nbsp;GET&nbsp;request&nbsp;would&nbsp;have&nbsp;been&nbsp;a&nbsp;cache&nbsp;hit&nbsp;in&nbsp;this&nbsp;case&nbsp;--&nbsp;the&nbsp;&lt;br&gt;<br>
response&nbsp;to&nbsp;that&nbsp;request&nbsp;has&nbsp;been&nbsp;preordained&nbsp;by&nbsp;the&nbsp;earlier&nbsp;bumping&nbsp;&lt;br&gt;<br>
failure.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Solution&nbsp;candidates&nbsp;to&nbsp;consider&nbsp;include:&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Stop&nbsp;bumping:&nbsp;https_port&nbsp;443&nbsp;cert=/etc/squid/stuff.pem&lt;br&gt;<br>
&lt;br&gt;<br>
Configure&nbsp;Squid&nbsp;as&nbsp;(a&nbsp;reverse&nbsp;HTTPS&nbsp;proxy&nbsp;for)&nbsp;the&nbsp;AWS&nbsp;service.&nbsp;Use&nbsp;&lt;br&gt;<br>
https_port.&nbsp;No&nbsp;SslBump&nbsp;rules/options!&nbsp;The&nbsp;client&nbsp;would&nbsp;think&nbsp;that&nbsp;it&nbsp;is&nbsp;&lt;br&gt;<br>
sending&nbsp;HTTPS&nbsp;requests&nbsp;directly&nbsp;to&nbsp;the&nbsp;service.&nbsp;Squid&nbsp;will&nbsp;forward&nbsp;&lt;br&gt;<br>
client&nbsp;requests&nbsp;to&nbsp;the&nbsp;service.&nbsp;If&nbsp;this&nbsp;works&nbsp;(and&nbsp;I&nbsp;do&nbsp;not&nbsp;have&nbsp;enough&nbsp;&lt;br&gt;<br>
information&nbsp;to&nbsp;know&nbsp;that&nbsp;this&nbsp;will&nbsp;work&nbsp;in&nbsp;your&nbsp;specific&nbsp;environment),&nbsp;&lt;br&gt;<br>
then&nbsp;you&nbsp;will&nbsp;get&nbsp;a&nbsp;much&nbsp;simpler&nbsp;setup.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Bump&nbsp;at&nbsp;step1,&nbsp;before&nbsp;Squid&nbsp;contacts&nbsp;AWS:&nbsp;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
Bugs&nbsp;notwithstanding,&nbsp;there&nbsp;will&nbsp;be&nbsp;no&nbsp;Squid-AWS&nbsp;connection&nbsp;for&nbsp;cache&nbsp;&lt;br&gt;<br>
hits.&nbsp;The&nbsp;resulting&nbsp;certificate&nbsp;will&nbsp;not&nbsp;be&nbsp;based&nbsp;on&nbsp;AWS&nbsp;service&nbsp;info,&nbsp;&lt;br&gt;<br>
but&nbsp;it&nbsp;looks&nbsp;like&nbsp;your&nbsp;client&nbsp;is&nbsp;ignorant&nbsp;enough&nbsp;to&nbsp;ignore&nbsp;related&nbsp;&lt;br&gt;<br>
certificate&nbsp;problems.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Hi,&nbsp;Hoping&nbsp;someone&nbsp;can&nbsp;help&nbsp;me&nbsp;with&nbsp;this&nbsp;issue&nbsp;that&nbsp;I&nbsp;have&nbsp;been&nbsp;&lt;br&gt;<br>
&gt;&nbsp;struggling&nbsp;with&nbsp;for&nbsp;days&nbsp;now.&nbsp; &nbsp;I&nbsp;am&nbsp;setting&nbsp;up&nbsp;squid&nbsp;on&nbsp;an&nbsp;ubuntu&nbsp;PC&nbsp;to&nbsp;&lt;br&gt;<br>
&gt;&nbsp;forward&nbsp;HTTPS&nbsp;requests&nbsp;to&nbsp;an&nbsp;API&nbsp;and&nbsp;an&nbsp;s3&nbsp;bucket&nbsp;under&nbsp;my&nbsp;control&nbsp;on&nbsp;&lt;br&gt;<br>
&gt;&nbsp;amazon&nbsp;AWS. &nbsp;The&nbsp;reason&nbsp;I&nbsp;am&nbsp;setting&nbsp;up&nbsp;the&nbsp;proxy&nbsp;is&nbsp;two-fold...&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;1)&nbsp;To&nbsp;reduce&nbsp;costs&nbsp;from&nbsp;AWS.&lt;br&gt;<br>
&gt;&nbsp;2)&nbsp;To&nbsp;provide&nbsp;content&nbsp;to&nbsp;the&nbsp;client&nbsp;on&nbsp;the&nbsp;ubuntu&nbsp;PC&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;&lt;br&gt;<br>
&gt;&nbsp;networking&nbsp;issue&nbsp;somewhere&nbsp;in&nbsp;between&nbsp;the&nbsp;ubuntu&nbsp;PC&nbsp;and&nbsp;AWS.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Item&nbsp;1&nbsp;is&nbsp;going&nbsp;well&nbsp;so&nbsp;far.&nbsp; &nbsp;Item&nbsp;2&nbsp;is&nbsp;not&nbsp;going&nbsp;well.&nbsp; &nbsp;Setup&nbsp;details&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;squid&nbsp;-&nbsp;setup&nbsp;cache&nbsp;folder*&lt;br&gt;<br>
&gt;&nbsp;mkdir&nbsp;-p&nbsp;/var/cache/squid&lt;br&gt;<br>
&gt;&nbsp;chown&nbsp;-R&nbsp;proxy:proxy&nbsp; /var/cache/squid&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;ssl&nbsp;-&nbsp;generate&nbsp;key*&lt;br&gt;<br>
&gt;&nbsp;apt&nbsp;--yes&nbsp;install&nbsp;squid-openssl&nbsp;libnss3-tools&lt;br&gt;<br>
&gt;&nbsp;openssl&nbsp;req&nbsp;-new&nbsp;-newkey&nbsp;rsa:2048&nbsp;-days&nbsp;365&nbsp;-nodes&nbsp;-x509&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp;-subj&nbsp;&quot;/C=US/ST=Denial/L=Springfield/O=Dis/CN=&lt;a&nbsp;href=&quot;http://www.example.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;www.example.com&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://www.example.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.example.com&lt;/a&gt;&gt;&quot;&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp;-keyout&nbsp;/etc/squid/stuff.pem&nbsp;-out&nbsp;/etc/squid/stuff.pem&lt;br&gt;<br>
&gt;&nbsp;chown&nbsp;root:proxy&nbsp;/etc/squid/stuff.pem&lt;br&gt;<br>
&gt;&nbsp;chmod&nbsp;644&nbsp; /etc/squid/stuff.pem&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;ssl&nbsp;-&nbsp;ssl&nbsp;DB*&lt;br&gt;<br>
&gt;&nbsp;mkdir&nbsp;-p&nbsp;/var/lib/squid&lt;br&gt;<br>
&gt;&nbsp;rm&nbsp;-rf&nbsp;/var/lib/squid/ssl_db&lt;br&gt;<br>
&gt;&nbsp;/usr/lib/squid/security_file_certgen&nbsp;-c&nbsp;-s&nbsp;/var/lib/squid/ssl_db&nbsp;-M&nbsp;4MB&lt;br&gt;<br>
&gt;&nbsp;chown&nbsp;-R&nbsp;proxy:proxy&nbsp;/var/lib/squid/ssl_db&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;/etc/squid/squid.conf&nbsp;:*&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;to_aws&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://amazonaws.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;amazonaws.com&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://amazonaws.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://amazonaws.com&lt;/a&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;from_local&nbsp;src&nbsp;localhost&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;to_aws&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;from_local&lt;br&gt;<br>
&gt;&nbsp;cache&nbsp;allow&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;cache_dir&nbsp;ufs&nbsp;/var/cache/squid&nbsp;1024&nbsp;16&nbsp;256&lt;br&gt;<br>
&gt;&nbsp;offline_mode&nbsp;on&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3129&nbsp;ssl-bump&nbsp;cert=/etc/squid/stuff.pem&nbsp;&lt;br&gt;<br>
&gt;&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=4MB&lt;br&gt;<br>
&gt;&nbsp;sslcrtd_program&nbsp;/usr/lib/squid/security_file_certgen&nbsp;-s&nbsp;&lt;br&gt;<br>
&gt;&nbsp;/var/lib/squid/ssl_db&nbsp;-M&nbsp;4MB&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;peek&nbsp;step1&lt;br&gt;<br>
&gt;&nbsp;ssl_bump&nbsp;bump&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;sslproxy_cert_error&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;cache_store_log&nbsp;stdio:/var/log/squid/store.log&lt;br&gt;<br>
&gt;&nbsp;logfile_rotate&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;/usr/bin/proxy-test&nbsp;:*&lt;br&gt;<br>
&gt;&nbsp;#!/bin/bash&lt;br&gt;<br>
&gt;&nbsp;curl&nbsp;--proxy&nbsp;&lt;a&nbsp;href=&quot;http://localhost:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://localhost:3129&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://localhost:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://localhost:3129&lt;/a&gt;&gt;&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp;--cacert&nbsp;/etc/squid/stuff.pem&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp;-v&nbsp;&quot;&lt;a&nbsp;href=&quot;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&lt;/a&gt;&gt;&quot;&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp;-H&nbsp;&quot;Authorization:&nbsp;token&nbsp;MYTOKEN&quot;&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp;-H&nbsp;&quot;Content-Type:&nbsp;application/json&quot;&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &nbsp;--output&nbsp;&quot;/tmp/stuff.json&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;When&nbsp;network&nbsp;connectivity&nbsp;is&nbsp;GOOD,&nbsp;everything&nbsp;works&nbsp;well&nbsp;and&nbsp;I&nbsp;get&nbsp;cache&nbsp;&lt;br&gt;<br>
&gt;&nbsp;HITS&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;/var/log/squid/access.log*&lt;br&gt;<br>
&gt;&nbsp;1705587538.837&nbsp; &nbsp; 238&nbsp;127.0.0.1&nbsp;NONE_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://stuff.amazonaws.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;stuff.amazonaws.com:443&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://stuff.amazonaws.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://stuff.amazonaws.com:443&lt;/a&gt;&gt;&nbsp;-&nbsp;&lt;br&gt;<br>
&gt;&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://3.136.246.238&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;3.136.246.238&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://3.136.246.238&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://3.136.246.238&lt;/a&gt;&gt;&nbsp;-&lt;br&gt;<br>
&gt;&nbsp;1705587538.838&nbsp; &nbsp; &nbsp; 0&nbsp;127.0.0.1&nbsp;TCP_MEM_HIT/200&nbsp;32818&nbsp;GET&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&lt;/a&gt;&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;&lt;br&gt;<br>
&gt;&nbsp;application/json&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;extract&nbsp;from&nbsp;/usr/bin/proxy-test&nbsp;output*&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;HTTP/1.1&nbsp;200&nbsp;OK&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Date:&nbsp;Thu,&nbsp;18&nbsp;Jan&nbsp;2024&nbsp;13:38:01&nbsp;GMT&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Content-Type:&nbsp;application/json&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Content-Length:&nbsp;32187&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;x-amzn-RequestId:&nbsp;8afba80e-6df7-4d5b-a34b-a70bd9b54380&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Last-Modified:&nbsp;2024-01-03T11:23:19.000Z&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Access-Control-Allow-Origin:&nbsp;*&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;x-amz-apigw-id:&nbsp;RvN1CF2_iYcEokA=&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Cache-Control:&nbsp;max-age=2147483648,public,stale-if-error&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;ETag:&nbsp;&quot;53896156c4e8e26933188a092c4e40f1&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;X-Amzn-Trace-Id:&nbsp;Root=1-65a929b9-3bd3285934151c1a2495481a&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Age:&nbsp;2578&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Warning:&nbsp;110&nbsp;squid/5.7&nbsp;&quot;Response&nbsp;is&nbsp;stale&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;X-Cache:&nbsp;HIT&nbsp;from&nbsp;ubuntu-pc&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;X-Cache-Lookup:&nbsp;HIT&nbsp;from&nbsp;ubuntu-pc:3129&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Via:&nbsp;1.1&nbsp;ubuntu-pc&nbsp;(squid/5.7)&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Connection:&nbsp;keep-alive&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;When&nbsp;network&nbsp;connectivity&nbsp;is&nbsp;BAD,&nbsp;I&nbsp;get&nbsp;errors&nbsp;and&nbsp;a&nbsp;cache&nbsp;MISS.&nbsp; &nbsp;In&nbsp;&lt;br&gt;<br>
&gt;&nbsp;this&nbsp;test&nbsp;case&nbsp;I&nbsp;unplugged&nbsp;the&nbsp;ethernet&nbsp;cable&nbsp;from&nbsp;the&nbsp;back&nbsp;on&nbsp;the&nbsp;&lt;br&gt;<br>
&gt;&nbsp;ubuntu-pc&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;/var/log/squid/access.log*&lt;br&gt;<br>
&gt;&nbsp;1705588717.420&nbsp; &nbsp; &nbsp;11&nbsp;127.0.0.1&nbsp;NONE_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://stuff.amazonaws.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;stuff.amazonaws.com:443&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://stuff.amazonaws.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://stuff.amazonaws.com:443&lt;/a&gt;&gt;&nbsp;-&nbsp;&lt;br&gt;<br>
&gt;&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://3.135.162.228&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;3.135.162.228&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://3.135.162.228&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://3.135.162.228&lt;/a&gt;&gt;&nbsp;-&lt;br&gt;<br>
&gt;&nbsp;1705588717.420&nbsp; &nbsp; &nbsp; 0&nbsp;127.0.0.1&nbsp;NONE_NONE/503&nbsp;4087&nbsp;GET&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&lt;/a&gt;&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;&lt;br&gt;<br>
&gt;&nbsp;text/html&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;extract&nbsp;from&nbsp;/usr/bin/proxy-test&nbsp;output*&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;HTTP/1.1&nbsp;503&nbsp;Service&nbsp;Unavailable&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Server:&nbsp;squid/5.7&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Mime-Version:&nbsp;1.0&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Date:&nbsp;Thu,&nbsp;18&nbsp;Jan&nbsp;2024&nbsp;14:38:37&nbsp;GMT&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Content-Type:&nbsp;text/html;charset=utf-8&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Content-Length:&nbsp;3692&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;X-Squid-Error:&nbsp;ERR_CONNECT_FAIL&nbsp;101&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Vary:&nbsp;Accept-Language&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Content-Language:&nbsp;en&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;X-Cache:&nbsp;MISS&nbsp;from&nbsp;ubuntu-pc&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;X-Cache-Lookup:&nbsp;NONE&nbsp;from&nbsp;ubuntu-pc:3129&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Via:&nbsp;1.1&nbsp;ubuntu-pc&nbsp;(squid/5.7)&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Connection:&nbsp;close&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;also&nbsp;seen&nbsp;it&nbsp;error&nbsp;in&nbsp;a&nbsp;different&nbsp;way&nbsp;with&nbsp;a&nbsp;502&nbsp;but&nbsp;with&nbsp;the&nbsp;&lt;br&gt;<br>
&gt;&nbsp;same&nbsp;ultimate&nbsp;result.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;expectation/hope&nbsp;is&nbsp;that&nbsp;squid&nbsp;would&nbsp;return&nbsp;the&nbsp;cached&nbsp;object&nbsp;on&nbsp;any&nbsp;&lt;br&gt;<br>
&gt;&nbsp;network&nbsp;failure&nbsp;in&nbsp;between&nbsp;ubuntu-pc&nbsp;and&nbsp;the&nbsp;AWS&nbsp;endpoint&nbsp;-&nbsp;and&nbsp;continue&nbsp;&lt;br&gt;<br>
&gt;&nbsp;to&nbsp;return&nbsp;this&nbsp;cached&nbsp;object&nbsp;forever. &nbsp; Is&nbsp;this&nbsp;something&nbsp;squid&nbsp;can&nbsp;do?&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp;It&nbsp;would&nbsp;seem&nbsp;that&nbsp;offline_mode&nbsp;should&nbsp;do&nbsp;this?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Hope&nbsp;you&nbsp;can&nbsp;help,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Robin&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
