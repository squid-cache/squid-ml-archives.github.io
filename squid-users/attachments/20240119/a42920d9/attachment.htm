<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Thanks&nbsp;for&nbsp;the&nbsp;explanations&nbsp;Amos,&nbsp;much&nbsp;appreciated.&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Thu,&nbsp;18&nbsp;Jan&nbsp;2024&nbsp;at&nbsp;16:24,&nbsp;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;19/01/24&nbsp;03:53,&nbsp;Robin&nbsp;Carlisle&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi,&nbsp;Hoping&nbsp;someone&nbsp;can&nbsp;help&nbsp;me&nbsp;with&nbsp;this&nbsp;issue&nbsp;that&nbsp;I&nbsp;have&nbsp;been&nbsp;&lt;br&gt;<br>
&gt;&nbsp;struggling&nbsp;with&nbsp;for&nbsp;days&nbsp;now.&nbsp; &nbsp;I&nbsp;am&nbsp;setting&nbsp;up&nbsp;squid&nbsp;on&nbsp;an&nbsp;ubuntu&nbsp;PC&nbsp;to&nbsp;&lt;br&gt;<br>
&gt;&nbsp;forward&nbsp;HTTPS&nbsp;requests&nbsp;to&nbsp;an&nbsp;API&nbsp;and&nbsp;an&nbsp;s3&nbsp;bucket&nbsp;under&nbsp;my&nbsp;control&nbsp;on&nbsp;&lt;br&gt;<br>
&gt;&nbsp;amazon&nbsp;AWS. &nbsp;The&nbsp;reason&nbsp;I&nbsp;am&nbsp;setting&nbsp;up&nbsp;the&nbsp;proxy&nbsp;is&nbsp;two-fold...&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;1)&nbsp;To&nbsp;reduce&nbsp;costs&nbsp;from&nbsp;AWS.&lt;br&gt;<br>
&gt;&nbsp;2)&nbsp;To&nbsp;provide&nbsp;content&nbsp;to&nbsp;the&nbsp;client&nbsp;on&nbsp;the&nbsp;ubuntu&nbsp;PC&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;&lt;br&gt;<br>
&gt;&nbsp;networking&nbsp;issue&nbsp;somewhere&nbsp;in&nbsp;between&nbsp;the&nbsp;ubuntu&nbsp;PC&nbsp;and&nbsp;AWS.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Item&nbsp;1&nbsp;is&nbsp;going&nbsp;well&nbsp;so&nbsp;far.&nbsp; &nbsp;Item&nbsp;2&nbsp;is&nbsp;not&nbsp;going&nbsp;well.&nbsp; &nbsp;Setup&nbsp;details&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
...&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;When&nbsp;network&nbsp;connectivity&nbsp;is&nbsp;BAD,&nbsp;I&nbsp;get&nbsp;errors&nbsp;and&nbsp;a&nbsp;cache&nbsp;MISS.&nbsp; &nbsp;In&nbsp;&lt;br&gt;<br>
&gt;&nbsp;this&nbsp;test&nbsp;case&nbsp;I&nbsp;unplugged&nbsp;the&nbsp;ethernet&nbsp;cable&nbsp;from&nbsp;the&nbsp;back&nbsp;on&nbsp;the&nbsp;&lt;br&gt;<br>
&gt;&nbsp;ubuntu-pc&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;/var/log/squid/access.log*&lt;br&gt;<br>
&gt;&nbsp;1705588717.420&nbsp; &nbsp; &nbsp;11&nbsp;127.0.0.1&nbsp;NONE_NONE/200&nbsp;0&nbsp;CONNECT&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;http://stuff.amazonaws.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;stuff.amazonaws.com:443&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://stuff.amazonaws.com:443&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://stuff.amazonaws.com:443&lt;/a&gt;&gt;&nbsp;-&nbsp;&lt;br&gt;<br>
&gt;&nbsp;HIER_DIRECT/&lt;a&nbsp;href=&quot;http://3.135.162.228&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;3.135.162.228&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://3.135.162.228&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://3.135.162.228&lt;/a&gt;&gt;&nbsp;-&lt;br&gt;<br>
&gt;&nbsp;1705588717.420&nbsp; &nbsp; &nbsp; 0&nbsp;127.0.0.1&nbsp;NONE_NONE/503&nbsp;4087&nbsp;GET&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&lt;/a&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://stuff.amazonaws.com/api/v1/stuff/stuff.json&lt;/a&gt;&gt;&nbsp;-&nbsp;HIER_NONE/-&nbsp;&lt;br&gt;<br>
&gt;&nbsp;text/html&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*#&nbsp;extract&nbsp;from&nbsp;/usr/bin/proxy-test&nbsp;output*&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;HTTP/1.1&nbsp;503&nbsp;Service&nbsp;Unavailable&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Server:&nbsp;squid/5.7&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Mime-Version:&nbsp;1.0&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Date:&nbsp;Thu,&nbsp;18&nbsp;Jan&nbsp;2024&nbsp;14:38:37&nbsp;GMT&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Content-Type:&nbsp;text/html;charset=utf-8&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Content-Length:&nbsp;3692&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;X-Squid-Error:&nbsp;ERR_CONNECT_FAIL&nbsp;101&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Vary:&nbsp;Accept-Language&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Content-Language:&nbsp;en&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;X-Cache:&nbsp;MISS&nbsp;from&nbsp;ubuntu-pc&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;X-Cache-Lookup:&nbsp;NONE&nbsp;from&nbsp;ubuntu-pc:3129&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Via:&nbsp;1.1&nbsp;ubuntu-pc&nbsp;(squid/5.7)&lt;br&gt;<br>
&gt;&nbsp;&lt;&nbsp;Connection:&nbsp;close&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;also&nbsp;seen&nbsp;it&nbsp;error&nbsp;in&nbsp;a&nbsp;different&nbsp;way&nbsp;with&nbsp;a&nbsp;502&nbsp;but&nbsp;with&nbsp;the&nbsp;&lt;br&gt;<br>
&gt;&nbsp;same&nbsp;ultimate&nbsp;result.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;expectation/hope&nbsp;is&nbsp;that&nbsp;squid&nbsp;would&nbsp;return&nbsp;the&nbsp;cached&nbsp;object&nbsp;on&nbsp;any&nbsp;&lt;br&gt;<br>
&gt;&nbsp;network&nbsp;failure&nbsp;in&nbsp;between&nbsp;ubuntu-pc&nbsp;and&nbsp;the&nbsp;AWS&nbsp;endpoint&nbsp;-&nbsp;and&nbsp;continue&nbsp;&lt;br&gt;<br>
&gt;&nbsp;to&nbsp;return&nbsp;this&nbsp;cached&nbsp;object&nbsp;forever. &nbsp; Is&nbsp;this&nbsp;something&nbsp;squid&nbsp;can&nbsp;do?&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp;It&nbsp;would&nbsp;seem&nbsp;that&nbsp;offline_mode&nbsp;should&nbsp;do&nbsp;this?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
FYI, &nbsp;offline_mode&nbsp;is&nbsp;not&nbsp;a&nbsp;guarantee&nbsp;that&nbsp;a&nbsp;URL&nbsp;will&nbsp;always&nbsp;HIT.&nbsp;It&nbsp;is&nbsp;&lt;br&gt;<br>
simply&nbsp;a&nbsp;form&nbsp;of&nbsp;&quot;greedy&quot;&nbsp;caching&nbsp;-&nbsp;where&nbsp;Squid&nbsp;will&nbsp;take&nbsp;actions&nbsp;to&nbsp;&lt;br&gt;<br>
ensure&nbsp;that&nbsp;full-size&nbsp;objects&nbsp;are&nbsp;fetched&nbsp;whenever&nbsp;it&nbsp;lacks&nbsp;one,&nbsp;and&nbsp;&lt;br&gt;<br>
serve&nbsp;things&nbsp;as&nbsp;stale&nbsp;HITs&nbsp;when&nbsp;a)&nbsp;it&nbsp;is&nbsp;not&nbsp;specifically&nbsp;prohibited,&nbsp;&lt;br&gt;<br>
and&nbsp;b)&nbsp;a&nbsp;refresh/fetch&nbsp;is&nbsp;not&nbsp;working.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;URL&nbsp;you&nbsp;are&nbsp;testing&nbsp;with&nbsp;should&nbsp;meet&nbsp;your&nbsp;expected&nbsp;behaviour&nbsp;due&nbsp;to&nbsp;&lt;br&gt;<br>
the&nbsp;&quot;Cache-Control:&nbsp;public,&nbsp;stale-of-error&quot;&nbsp;header&nbsp;alone.&lt;br&gt;<br>
 &nbsp; Regardless&nbsp;of&nbsp;offline_mode&nbsp;configuration.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;said,&nbsp;getting&nbsp;a&nbsp;5xx&nbsp;response&nbsp;when&nbsp;there&nbsp;is&nbsp;an&nbsp;object&nbsp;already&nbsp;in&nbsp;&lt;br&gt;<br>
cache&nbsp;seems&nbsp;like&nbsp;something&nbsp;is&nbsp;buggy&nbsp;to&nbsp;me.&lt;br&gt;<br>
&lt;br&gt;<br>
A&nbsp;high&nbsp;level&nbsp;cache.log&nbsp;will&nbsp;be&nbsp;needed&nbsp;to&nbsp;figure&nbsp;out&nbsp;what&nbsp;is&nbsp;going&nbsp;on&nbsp;&lt;br&gt;<br>
(see&nbsp;&lt;a&nbsp;href=&quot;https://wiki.squid-cache.org/SquidFaq/BugReporting#full-debug-output&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://wiki.squid-cache.org/SquidFaq/BugReporting#full-debug-output&lt;/a&gt;).&lt;br&gt;<br>
Be&nbsp;aware&nbsp;this&nbsp;list&nbsp;does&nbsp;not&nbsp;permit&nbsp;large&nbsp;posts&nbsp;so&nbsp;please&nbsp;provide&nbsp;a&nbsp;link&nbsp;&lt;br&gt;<br>
to&nbsp;download&nbsp;in&nbsp;your&nbsp;reply&nbsp;not&nbsp;attachment.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Cheers&lt;br&gt;<br>
Amos&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
