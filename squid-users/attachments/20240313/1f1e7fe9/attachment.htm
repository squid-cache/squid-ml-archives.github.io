<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;I&nbsp;would&nbsp;certainly&nbsp;be&nbsp;willing&nbsp;to&nbsp;give&nbsp;it&nbsp;a&nbsp;shot,&nbsp;yes!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Jason&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2&quot;&gt;&lt;br&gt;&lt;table&nbsp;style=&quot;border-top:1px&nbsp;solid&nbsp;#d3d4de&quot;&gt;&lt;tr&gt;&lt;td&nbsp;style=&quot;width:55px;padding-top:13px&quot;&gt;&lt;a&nbsp;href=&quot;https://www.avast.com/sig-email?utm_medium=email&amp;utm_source=link&amp;utm_campaign=sig-email&amp;utm_content=webmail&quot;&nbsp;target=&quot;_blank&quot;&gt;&lt;img&nbsp;src=&quot;https://s-install.avcdn.net/ipm/preview/icons/icon-envelope-tick-round-orange-animated-no-repeat-v1.gif&quot;&nbsp;alt=&quot;&quot;&nbsp;width=&quot;46&quot;&nbsp;height=&quot;29&quot;&nbsp;style=&quot;width:&nbsp;46px;&nbsp;height:&nbsp;29px;&quot;&gt;&lt;/a&gt;&lt;/td&gt;&lt;td&nbsp;style=&quot;width:470px;padding-top:12px;color:#41424e;font-size:13px;font-family:Arial,Helvetica,sans-serif;line-height:18px&quot;&gt;Virus-free.&lt;a&nbsp;href=&quot;https://www.avast.com/sig-email?utm_medium=email&amp;utm_source=link&amp;utm_campaign=sig-email&amp;utm_content=webmail&quot;&nbsp;target=&quot;_blank&quot;&nbsp;style=&quot;color:#4453ea&quot;&gt;www.avast.com&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;a&nbsp;href=&quot;#DAB4FAD8-2DD7-40BB-A1B8-4E2AA1F9FDF2&quot;&nbsp;width=&quot;1&quot;&nbsp;height=&quot;1&quot;&gt;&lt;/a&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Wed,&nbsp;Mar&nbsp;13,&nbsp;2024&nbsp;at&nbsp;4:38 AM&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:ngtech1ltd@gmail.com&quot;&gt;ngtech1ltd@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;Hey&nbsp;Jason,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;can&nbsp;try&nbsp;to&nbsp;build&nbsp;Squid&nbsp;6.8&nbsp;for&nbsp;RHEL&nbsp;9,&nbsp;would&nbsp;this&nbsp;help&nbsp;you&nbsp;to&nbsp;test&nbsp;it&nbsp;as&nbsp;a&nbsp;solution?&lt;br&gt;<br>
&lt;br&gt;<br>
Eliezer&lt;br&gt;<br>
&lt;br&gt;<br>
From:&nbsp;squid-users&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid-users-bounces@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users-bounces@lists.squid-cache.org&lt;/a&gt;&gt;&nbsp;On&nbsp;Behalf&nbsp;Of&nbsp;Jason&nbsp;Marshall&lt;br&gt;<br>
Sent:&nbsp;Wednesday,&nbsp;March&nbsp;6,&nbsp;2024&nbsp;4:49&nbsp;PM&lt;br&gt;<br>
To:&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
Subject:&nbsp;[squid-users]&nbsp;Recommended&nbsp;squid&nbsp;settings&nbsp;when&nbsp;using&nbsp;IPS-based&nbsp;domain&nbsp;blocking&lt;br&gt;<br>
&lt;br&gt;<br>
Good&nbsp;morning,&lt;br&gt;<br>
&lt;br&gt;<br>
We&nbsp;have&nbsp;been&nbsp;using&nbsp;squid&nbsp;(version&nbsp;squid-5.5-6.el9_3.5)&nbsp;under&nbsp;RHEL9&nbsp;as&nbsp;a&nbsp;simple&nbsp;pass-through&nbsp;proxy&nbsp;without&nbsp;issue&nbsp;for&nbsp;the&nbsp;past&nbsp;month&nbsp;or&nbsp;so.&nbsp;Recently&nbsp;our&nbsp;security&nbsp;team&nbsp;implemented&nbsp;an&nbsp;IPS&nbsp;product&nbsp;that&nbsp;intercepts&nbsp;domain&nbsp;names&nbsp;known&nbsp;to&nbsp;be&nbsp;associated&nbsp;with&nbsp;malware&nbsp;and&nbsp;ransomware&nbsp;command&nbsp;and&nbsp;control.&nbsp;Once&nbsp;this&nbsp;was&nbsp;in&nbsp;place,&nbsp;we&nbsp;started&nbsp;having&nbsp;issues&nbsp;with&nbsp;the&nbsp;behavior&nbsp;of&nbsp;squid.&lt;br&gt;<br>
&lt;br&gt;<br>
Through&nbsp;some&nbsp;troubleshooting,&nbsp;it&nbsp;appears&nbsp;that&nbsp;what&nbsp;is&nbsp;happening&nbsp;is&nbsp;that&nbsp;that&nbsp;when&nbsp;a&nbsp;user&#39;s&nbsp;machine&nbsp;make&nbsp;a&nbsp;request&nbsp;through&nbsp;squid&nbsp;for&nbsp;one&nbsp;of&nbsp;these&nbsp;bad&nbsp;domains,&nbsp;the&nbsp;request&nbsp;is&nbsp;dropped&nbsp;by&nbsp;the&nbsp;IPS,&nbsp;squid&nbsp;waits&nbsp;for&nbsp;the&nbsp;DNS&nbsp;timeout,&nbsp;and&nbsp;then&nbsp;all&nbsp;requests&nbsp;made&nbsp;to&nbsp;squid&nbsp;after&nbsp;that&nbsp;result&nbsp;in&nbsp;NONE_NONE/500&nbsp;errors,&nbsp;and&nbsp;it&nbsp;never&nbsp;seems&nbsp;to&nbsp;recover&nbsp;until&nbsp;we&nbsp;do&nbsp;a&nbsp;restart&nbsp;or&nbsp;reload&nbsp;of&nbsp;the&nbsp;service.&lt;br&gt;<br>
&lt;br&gt;<br>
Initially&nbsp;the&nbsp;dns_timeout&nbsp;was&nbsp;set&nbsp;for&nbsp;30&nbsp;seconds.&nbsp;I&nbsp;reduced&nbsp;this,&nbsp;thinking&nbsp;that&nbsp;perhaps&nbsp;requests&nbsp;were&nbsp;building&nbsp;up&nbsp;or&nbsp;something&nbsp;along&nbsp;those&nbsp;lines.&nbsp;I&nbsp;set&nbsp;it&nbsp;to&nbsp;5&nbsp;seconds,&nbsp;but&nbsp;that&nbsp;just&nbsp;got&nbsp;us&nbsp;to&nbsp;a&nbsp;failure&nbsp;state&nbsp;faster.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;also&nbsp;found&nbsp;the&nbsp;negative_dns_ttl&nbsp;setting&nbsp;and&nbsp;thought&nbsp;it&nbsp;might&nbsp;be&nbsp;having&nbsp;an&nbsp;effect,&nbsp;but&nbsp;setting&nbsp;this&nbsp;to&nbsp;0&nbsp;seconds&nbsp;resulted&nbsp;in&nbsp;no&nbsp;change&nbsp;to&nbsp;the&nbsp;behavior.&lt;br&gt;<br>
&lt;br&gt;<br>
Are&nbsp;there&nbsp;any&nbsp;configuration&nbsp;tips&nbsp;that&nbsp;anyone&nbsp;can&nbsp;provide&nbsp;that&nbsp;might&nbsp;work&nbsp;better&nbsp;with&nbsp;dropped/intercepted&nbsp;DNS&nbsp;requests?&nbsp;My&nbsp;current&nbsp;configuration&nbsp;is&nbsp;included&nbsp;here:&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;0.0.0.1-0.255.255.255 &nbsp;#&nbsp;RFC&nbsp;1122&nbsp;&quot;this&quot;&nbsp;network&nbsp;(LAN)&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://10.0.0.0/8&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://10.0.0.0/8&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;RFC&nbsp;1918&nbsp;local&nbsp;private&nbsp;network&nbsp;(LAN)&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://100.64.0.0/10&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://100.64.0.0/10&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;RFC&nbsp;6598&nbsp;shared&nbsp;address&nbsp;space&nbsp;(CGN)&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://169.254.0.0/16&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://169.254.0.0/16&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;RFC&nbsp;3927&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://172.16.0.0/12&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://172.16.0.0/12&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;RFC&nbsp;1918&nbsp;local&nbsp;private&nbsp;network&nbsp;(LAN)&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/16&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://192.168.0.0/16&lt;/a&gt; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;RFC&nbsp;1918&nbsp;local&nbsp;private&nbsp;network&nbsp;(LAN)&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;br&gt;<br>
acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;<br>
&lt;br&gt;<br>
acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;http&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;443 &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp;https&lt;br&gt;<br>
acl&nbsp;Safe_ports&nbsp;port&nbsp;9191 &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp;papercut&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;manager&lt;br&gt;<br>
&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localnet&lt;br&gt;<br>
http_access&nbsp;allow&nbsp;localhost&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
http_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3128&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://0.0.0.0:3128&lt;/a&gt;&lt;br&gt;<br>
http_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3129&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://0.0.0.0:3129&lt;/a&gt;&lt;br&gt;<br>
cache&nbsp;deny&nbsp;all&lt;br&gt;<br>
coredump_dir&nbsp;/var/spool/squid&lt;br&gt;<br>
refresh_pattern&nbsp;^ftp: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1440 &nbsp; &nbsp;20% &nbsp; &nbsp; 10080&lt;br&gt;<br>
refresh_pattern&nbsp;^gopher: &nbsp; &nbsp; &nbsp; &nbsp;1440 &nbsp; &nbsp;0% &nbsp; &nbsp; &nbsp;1440&lt;br&gt;<br>
refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0 &nbsp; &nbsp; 0% &nbsp; &nbsp; &nbsp;0&lt;br&gt;<br>
refresh_pattern&nbsp;. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; &nbsp; 20% &nbsp; &nbsp; 4320&lt;br&gt;<br>
debug_options&nbsp;rotate=1&nbsp;ALL,2&lt;br&gt;<br>
negative_dns_ttl&nbsp;0&nbsp;seconds&lt;br&gt;<br>
dns_timeout&nbsp;5&nbsp;seconds&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you&nbsp;for&nbsp;any&nbsp;help&nbsp;that&nbsp;you&nbsp;can&nbsp;provide.&lt;br&gt;<br>
&lt;br&gt;<br>
Jason&nbsp;Marshall&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
