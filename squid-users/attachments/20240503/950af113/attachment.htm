<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi&nbsp;Amos,&nbsp;thank&nbsp;you&nbsp;for&nbsp;your&nbsp;reply.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&gt;What&nbsp;your&nbsp;&quot;for&nbsp;example,...&quot;&nbsp;describes&nbsp;is&nbsp;Transparent&nbsp;Proxy&nbsp;(TPROXY).&lt;br&gt;&gt;However,&nbsp;what&nbsp;you&nbsp;have&nbsp;in&nbsp;the&nbsp;config&nbsp;below&nbsp;is&nbsp;very&nbsp;different.&nbsp;The&nbsp;IP&nbsp;the&lt;br&gt;&gt;client&nbsp;is&nbsp;connected&nbsp;**to**&nbsp;(not&nbsp;&quot;from&quot;)&nbsp;is&nbsp;being&nbsp;pinned&nbsp;on&nbsp;outgoing&lt;br&gt;&gt;connections.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Sorry&nbsp;for&nbsp;the&nbsp;misunderstanding.&nbsp;Maybe&nbsp;I&nbsp;wasn&#39;t&nbsp;clear&nbsp;with&nbsp;my&nbsp;wording.&nbsp;I&nbsp;only&nbsp;need&nbsp;to&nbsp;create&nbsp;a&nbsp;proxy&nbsp;instance&nbsp;where&nbsp;the&nbsp;IPv6&nbsp;address&nbsp;that&nbsp;client&nbsp;uses&nbsp;to&nbsp;connect&nbsp;to&nbsp;Squid,&nbsp;is&nbsp;used&nbsp;by&nbsp;Squid&nbsp;to&nbsp;connect&nbsp;to&nbsp;remote&nbsp;locations.&nbsp;In&nbsp;this&nbsp;setup,&nbsp;server&nbsp;running&nbsp;Squid&nbsp;has&nbsp;around&nbsp;50k&nbsp;IPv6&nbsp;addresses&nbsp;assigned&nbsp;to&nbsp;it&nbsp;and&nbsp;client&nbsp;is&nbsp;expected&nbsp;to&nbsp;connect&nbsp;to&nbsp;Squid&nbsp;proxy&nbsp;with&nbsp;50k&nbsp;different&nbsp;IPv6&nbsp;addresses&nbsp;of&nbsp;the&nbsp;Squid&nbsp;and&nbsp;Squid&nbsp;should&nbsp;always&nbsp;use&nbsp;the&nbsp;IP&nbsp;address&nbsp;client&nbsp;connects&nbsp;to&nbsp;it&nbsp;as&nbsp;outgoing&nbsp;address.&nbsp;I&#39;m&nbsp;not&nbsp;sure&nbsp;if&nbsp;I&nbsp;explained&nbsp;that&nbsp;well.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;if&nbsp;client&nbsp;connects&nbsp;to&nbsp;Squid&nbsp;proxy&nbsp;by&nbsp;the&nbsp;address&nbsp;of&nbsp;Squid&nbsp;let&#39;s&nbsp;say&nbsp;is&nbsp;feef:1234::1,&nbsp;Squid&nbsp;should&nbsp;use&nbsp;that&nbsp;IP&nbsp;for&nbsp;outgoing&nbsp;connections.&nbsp;That&#39;s&nbsp;not&nbsp;transparent&nbsp;proxy&nbsp;TPROXY&nbsp;because&nbsp;client&nbsp;and&nbsp;proxy&nbsp;is&nbsp;on&nbsp;different&nbsp;networks&nbsp;in&nbsp;this&nbsp;setup.&nbsp;Just&nbsp;like&nbsp;ordinary&nbsp;HTTP&nbsp;proxies.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&gt;The&nbsp;FLOW_CONTROL_ERROR&nbsp;is&nbsp;not&nbsp;something&nbsp;produced&nbsp;by&nbsp;Squid.&nbsp;Likely&nbsp;it&lt;br&gt;&gt;comes&nbsp;from&nbsp;the&nbsp;TCP&nbsp;stack&nbsp;and/or&nbsp;OS&nbsp;routing&nbsp;system.&lt;br&gt;&lt;/div&gt;&lt;div&gt;Client&nbsp;connects&nbsp;to&nbsp;Squid&nbsp;by&nbsp;a&nbsp;script&nbsp;written&nbsp;in&nbsp;Golang.&nbsp;Thats&nbsp;where&nbsp;they&nbsp;get&nbsp;that&nbsp;error.&nbsp;On&nbsp;the&nbsp;Squid&#39;s&nbsp;access.log,&nbsp;I&nbsp;can&nbsp;see&nbsp;that&nbsp;error&nbsp;as&nbsp;TCP_TUNNEL_ABORTED/200&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&gt;Some&nbsp;improvements&nbsp;highlighted&nbsp;inline&nbsp;below.&lt;br&gt;&gt;Nothing&nbsp;stands&nbsp;out&nbsp;to&nbsp;me&nbsp;as&nbsp;being&nbsp;related&nbsp;to&nbsp;your&nbsp;issues.&lt;/div&gt;&lt;div&gt;Thank&nbsp;you,&nbsp;I&#39;ll&nbsp;fix&nbsp;them&nbsp;however&nbsp;I&nbsp;don&#39;t&nbsp;think&nbsp;this&nbsp;issue&nbsp;is&nbsp;any&nbsp;related&nbsp;to&nbsp;the&nbsp;config.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&gt;Any&nbsp;particular&nbsp;reason&nbsp;not&nbsp;to&nbsp;use&nbsp;the&nbsp;registered&nbsp;port&nbsp;3128&nbsp;?&lt;br&gt;&gt;(Not&nbsp;important,&nbsp;just&nbsp;wondering.)&lt;/div&gt;&lt;div&gt;My&nbsp;client&nbsp;wants&nbsp;to&nbsp;prevent&nbsp;proxies&nbsp;from&nbsp;being&nbsp;detected&nbsp;by&nbsp;bots&nbsp;so&nbsp;we&nbsp;picked&nbsp;a&nbsp;different&nbsp;port&nbsp;number&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;the&nbsp;one&nbsp;I&nbsp;shared&nbsp;here.&nbsp;I&nbsp;edited&nbsp;numbers&nbsp;and&nbsp;addresses&nbsp;from&nbsp;the&nbsp;config&nbsp;before&nbsp;sharing&nbsp;it&nbsp;here.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&gt;I/we&nbsp;will&nbsp;need&nbsp;to&nbsp;see&nbsp;the&nbsp;PCAP&nbsp;trace&nbsp;along&nbsp;with&nbsp;a&nbsp;cache.log&nbsp;generated&lt;br&gt;&gt;using&nbsp;&quot;debug_options&nbsp;ALL,6&quot;&nbsp;to&nbsp;confirm&nbsp;a&nbsp;bug&nbsp;or&nbsp;identify&nbsp;other&nbsp;breakage&lt;br&gt;&gt;though.&lt;/div&gt;&lt;div&gt;Interestingly,&nbsp;debug_options&nbsp;ALL&nbsp;does&nbsp;not&nbsp;log&nbsp;anything&nbsp;related&nbsp;to&nbsp;this&nbsp;issue&nbsp;to&nbsp;cache.log.&nbsp;That&nbsp;left&nbsp;me&nbsp;very&nbsp;confused&nbsp;about&nbsp;this&nbsp;problem.&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;I&#39;m&nbsp;currently&nbsp;sending&nbsp;you&nbsp;the&nbsp;PCAP&nbsp;file.&nbsp;It&#39;s&nbsp;being&nbsp;uploaded.&nbsp;I&nbsp;would&nbsp;be&nbsp;appreciated&nbsp;if&nbsp;you&nbsp;can&nbsp;take&nbsp;a&nbsp;look&nbsp;at&nbsp;it.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;Amos&nbsp;Jeffries&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:squid3@treenet.co.nz&quot;&gt;squid3@treenet.co.nz&lt;/a&gt;&gt;,&nbsp;3&nbsp;May&nbsp;2024&nbsp;Cum,&nbsp;19:31&nbsp;tarihinde&nbsp;şunu&nbsp;yazdı:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;4/05/24&nbsp;02:29,&nbsp;Emre&nbsp;Oksum&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi&nbsp;everyone,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;having&nbsp;a&nbsp;issue&nbsp;with&nbsp;Squid&nbsp;Cache&nbsp;4.10&nbsp;which&nbsp;I&nbsp;cannot&nbsp;fix&nbsp;for&nbsp;weeks&nbsp;&lt;br&gt;<br>
&gt;&nbsp;now&nbsp;and&nbsp;kinda&nbsp;lost&nbsp;at&nbsp;the&nbsp;moment.&nbsp;I&nbsp;will&nbsp;be&nbsp;appreciated&nbsp;if&nbsp;someone&nbsp;can&nbsp;&lt;br&gt;<br>
&gt;&nbsp;guide&nbsp;me&nbsp;through&nbsp;the&nbsp;issue&nbsp;I&#39;m&nbsp;having.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;need&nbsp;to&nbsp;create&nbsp;a&nbsp;IPv6&nbsp;HTTP&nbsp;proxy&nbsp;which&nbsp;should&nbsp;match&nbsp;the&nbsp;entry&nbsp;address&nbsp;&lt;br&gt;<br>
&gt;&nbsp;to&nbsp;outgoing&nbsp;TCP&nbsp;address.&nbsp;For&nbsp;example,&nbsp;if&nbsp;user&nbsp;is&nbsp;connecting&nbsp;from&nbsp;&lt;br&gt;<br>
&gt;&nbsp;fe80:abcd::1&nbsp;it&nbsp;should&nbsp;exit&nbsp;the&nbsp;HTTP&nbsp;proxy&nbsp;from&nbsp;the&nbsp;same&nbsp;address.&nbsp;We&nbsp;got&nbsp;&lt;br&gt;<br>
&gt;&nbsp;like&nbsp;50k&nbsp;addresses&nbsp;like&nbsp;this&nbsp;at&nbsp;the&nbsp;moment.&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;your&nbsp;&quot;for&nbsp;example,...&quot;&nbsp;describes&nbsp;is&nbsp;Transparent&nbsp;Proxy&nbsp;(TPROXY).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
However,&nbsp;what&nbsp;you&nbsp;have&nbsp;in&nbsp;the&nbsp;config&nbsp;below&nbsp;is&nbsp;very&nbsp;different.&nbsp;The&nbsp;IP&nbsp;the&nbsp;&lt;br&gt;<br>
client&nbsp;is&nbsp;connected&nbsp;**to**&nbsp;(not&nbsp;&quot;from&quot;)&nbsp;is&nbsp;being&nbsp;pinned&nbsp;on&nbsp;outgoing&nbsp;&lt;br&gt;<br>
connections.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;issue&nbsp;is,&nbsp;client&nbsp;connecting&nbsp;to&nbsp;the&nbsp;proxy&nbsp;is&nbsp;receiving&nbsp;&quot;EOF&quot;&nbsp;or&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&quot;FLOW_CONTROL_ERROR&quot;&nbsp;on&nbsp;their&nbsp;side.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;FLOW_CONTROL_ERROR&nbsp;is&nbsp;not&nbsp;something&nbsp;produced&nbsp;by&nbsp;Squid.&nbsp;Likely&nbsp;it&nbsp;&lt;br&gt;<br>
comes&nbsp;from&nbsp;the&nbsp;TCP&nbsp;stack&nbsp;and/or&nbsp;OS&nbsp;routing&nbsp;system.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;EOF&nbsp;may&nbsp;be&nbsp;coming&nbsp;from&nbsp;either&nbsp;Squid&nbsp;or&nbsp;the&nbsp;OS.&nbsp;It&nbsp;also&nbsp;may&nbsp;be&nbsp;&lt;br&gt;<br>
perfectly&nbsp;normal&nbsp;for&nbsp;the&nbsp;circumstances,&nbsp;or&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;an&nbsp;error&nbsp;&lt;br&gt;<br>
elsewhere.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;solve&nbsp;will&nbsp;require&nbsp;identifying&nbsp;exactly&nbsp;what&nbsp;is&nbsp;sending&nbsp;those&nbsp;signals,&nbsp;&lt;br&gt;<br>
and&nbsp;why.&nbsp;Since&nbsp;they&nbsp;are&nbsp;signals&nbsp;going&nbsp;to&nbsp;the&nbsp;client,&nbsp;focus&nbsp;on&nbsp;the&nbsp;&lt;br&gt;<br>
client-&gt;Squid&nbsp;connections&nbsp;(not&nbsp;the&nbsp;Squid-&gt;server&nbsp;ones&nbsp;you&nbsp;talk&nbsp;about&nbsp;&lt;br&gt;<br>
testing&nbsp;below).&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;When&nbsp;I&nbsp;test&nbsp;connection&nbsp;by&nbsp;connecting&nbsp;&lt;br&gt;<br>
&gt;&nbsp;to&nbsp;&lt;a&nbsp;href=&quot;http://whatismyip.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;whatismyip.com&lt;/a&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;http://whatismyip.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;http://whatismyip.com&lt;/a&gt;&gt;&nbsp;everything&nbsp;works&nbsp;fine&nbsp;and&nbsp;&lt;br&gt;<br>
&gt;&nbsp;entry&nbsp;IP&nbsp;always&nbsp;matches&nbsp;with&nbsp;outgoing&nbsp;IP&nbsp;for&nbsp;each&nbsp;of&nbsp;the&nbsp;50k&nbsp;addresses.&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Client&nbsp;tells&nbsp;me&nbsp;this&nbsp;problem&nbsp;occurs&nbsp;both&nbsp;at&nbsp;GET&nbsp;and&nbsp;POST&nbsp;requests&nbsp;with&nbsp;&lt;br&gt;<br>
&gt;&nbsp;around&nbsp;10&nbsp;MB&nbsp;of&nbsp;data.&lt;br&gt;<br>
&lt;br&gt;<br>
Well,&nbsp;you&nbsp;are&nbsp;trying&nbsp;to&nbsp;manually&nbsp;force&nbsp;certain&nbsp;flow&nbsp;patterns&nbsp;that&nbsp;&lt;br&gt;<br>
prohibit&nbsp;or&nbsp;break&nbsp;some&nbsp;major&nbsp;HTTP&nbsp;performance&nbsp;features.&nbsp;Some&nbsp;problems&nbsp;&lt;br&gt;<br>
are&nbsp;to&nbsp;be&nbsp;expected.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;issues&nbsp;which&nbsp;I&nbsp;expect&nbsp;to&nbsp;occur&nbsp;in&nbsp;your&nbsp;proxy&nbsp;would&nbsp;not&nbsp;show&nbsp;up&nbsp;in&nbsp;a&nbsp;&lt;br&gt;<br>
trivial&nbsp;outgoing-IP&nbsp;or&nbsp;connectivity&nbsp;test.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;initially&nbsp;thought&nbsp;that&nbsp;could&nbsp;be&nbsp;related&nbsp;to&nbsp;server&nbsp;resources&nbsp;being&nbsp;&lt;br&gt;<br>
&gt;&nbsp;drained&nbsp;but&nbsp;upon&nbsp;inspecting&nbsp;server&nbsp;resource&nbsp;usage,&nbsp;Squid&nbsp;isn&#39;t&nbsp;even&nbsp;&lt;br&gt;<br>
&gt;&nbsp;topping&nbsp;at&nbsp;100%&nbsp;CPU&nbsp;or&nbsp;RAM&nbsp;anytime&nbsp;so&nbsp;not&nbsp;that.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
IMO,&nbsp;&quot;FLOW_CONTROL_ERROR&quot;&nbsp;is&nbsp;likely&nbsp;related&nbsp;to&nbsp;quantity&nbsp;of&nbsp;traffic&nbsp;&lt;br&gt;<br>
flooding&nbsp;through&nbsp;the&nbsp;proxy&nbsp;to&nbsp;specific&nbsp;origin&nbsp;servers.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;concept&nbsp;you&nbsp;are&nbsp;implementing&nbsp;of&nbsp;the&nbsp;outgoing&nbsp;TCP&nbsp;connection&nbsp;having&nbsp;&lt;br&gt;<br>
the&nbsp;same&nbsp;IP&nbsp;as&nbsp;the&nbsp;incoming&nbsp;connection&nbsp;reduces&nbsp;the&nbsp;available&nbsp;TCP&nbsp;sockets&nbsp;&lt;br&gt;<br>
by&nbsp;25%.&nbsp;Prohibiting&nbsp;the&nbsp;OS&nbsp;from&nbsp;allocating&nbsp;ports&nbsp;on&nbsp;otherwise&nbsp;unused&nbsp;&lt;br&gt;<br>
outgoing&nbsp;addresses&nbsp;when&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;My&nbsp;Squid.conf&nbsp;is&nbsp;like&nbsp;this&nbsp;at&nbsp;the&nbsp;moment:&lt;br&gt;<br>
&lt;br&gt;<br>
Some&nbsp;improvements&nbsp;highlighted&nbsp;inline&nbsp;below.&lt;br&gt;<br>
Nothing&nbsp;stands&nbsp;out&nbsp;to&nbsp;me&nbsp;as&nbsp;being&nbsp;related&nbsp;to&nbsp;your&nbsp;issues.&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib/squid/basic_ncsa_auth&nbsp;/etc/squid/passwd&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;auth_users&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;allow&nbsp;auth_users&lt;br&gt;<br>
&gt;&nbsp;http_access&nbsp;deny&nbsp;!auth_users&lt;br&gt;<br>
&lt;br&gt;<br>
Above&nbsp;two&nbsp;lines&nbsp;are&nbsp;backwards.&nbsp;Deny&nbsp;first,&nbsp;then&nbsp;allow.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;cache&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;dns_nameservers&nbsp;&lt;nameservers&nbsp;here&gt;&lt;br&gt;<br>
&gt;&nbsp;dns_v4_first&nbsp;off&lt;br&gt;<br>
&gt;&nbsp;via&nbsp;off&lt;br&gt;<br>
&gt;&nbsp;forwarded_for&nbsp;delete&lt;br&gt;<br>
&gt;&nbsp;follow_x_forwarded_for&nbsp;deny&nbsp;all&lt;br&gt;<br>
&gt;&nbsp;server_persistent_connections&nbsp;off&lt;br&gt;<br>
&lt;br&gt;<br>
*If*&nbsp;the&nbsp;issue&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;congestion&nbsp;on&nbsp;Squid-&gt;server&nbsp;connections&lt;br&gt;<br>
enabling&nbsp;this&nbsp;might&nbsp;be&nbsp;worthwhile.&nbsp;Otherwise&nbsp;it&nbsp;should&nbsp;be&nbsp;fine.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;max_filedesc&nbsp;1048576&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;remove&nbsp;that&nbsp;line.&nbsp;&quot;max_filedesc&quot;&nbsp;was&nbsp;a&nbsp;RedHat&nbsp;hack&nbsp;from&nbsp;20+&nbsp;&lt;br&gt;<br>
years&nbsp;ago&nbsp;when&nbsp;the&nbsp;feature&nbsp;was&nbsp;experimental.&lt;br&gt;<br>
&lt;br&gt;<br>
Any&nbsp;value&nbsp;you&nbsp;set&nbsp;on&nbsp;the&nbsp;line&nbsp;above,&nbsp;will&nbsp;be&nbsp;erased&nbsp;and&nbsp;replaced&nbsp;by&nbsp;the&nbsp;&lt;br&gt;<br>
line&nbsp;below:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;max_filedescriptors&nbsp;1048576&lt;br&gt;<br>
&gt;&nbsp;workers&nbsp;8&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;[::0]:1182&lt;br&gt;<br>
&lt;br&gt;<br>
Above&nbsp;is&nbsp;just&nbsp;a&nbsp;complicated&nbsp;way&nbsp;to&nbsp;write:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;http_port&nbsp;1182&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Any&nbsp;particular&nbsp;reason&nbsp;not&nbsp;to&nbsp;use&nbsp;the&nbsp;registered&nbsp;port&nbsp;3128&nbsp;?&lt;br&gt;<br>
(Not&nbsp;important,&nbsp;just&nbsp;wondering.)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;binding1&nbsp;myip&nbsp;fe80:abcd::1&lt;br&gt;<br>
&gt;&nbsp;tcp_outgoing_address&nbsp;fe80:abcd::1&nbsp;binding1&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;binding2&nbsp;myip&nbsp;fe80:abcd::2&lt;br&gt;<br>
&gt;&nbsp;tcp_outgoing_address&nbsp;fe80:abcd::2&nbsp;binding2&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;binding3&nbsp;myip&nbsp;fe80:abcd::3&lt;br&gt;<br>
&gt;&nbsp;tcp_outgoing_address&nbsp;fe80:abcd::3&nbsp;binding3&lt;br&gt;<br>
&gt;&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;...&lt;br&gt;<br>
&gt;&nbsp;access_log&nbsp;/var/log/squid/access.log&nbsp;squid&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;cache_store_log&nbsp;none&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;erase&nbsp;this&nbsp;line.&lt;br&gt;<br>
This&nbsp;is&nbsp;default&nbsp;setting.&nbsp;No&nbsp;need&nbsp;to&nbsp;manually&nbsp;set&nbsp;it.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;cache&nbsp;deny&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;erase&nbsp;this&nbsp;line.&lt;br&gt;<br>
This&nbsp;&quot;cache&nbsp;deny&nbsp;all&quot;&nbsp;exists&nbsp;earlier&nbsp;in&nbsp;the&nbsp;config.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&#39;ve&nbsp;tried&nbsp;to&nbsp;get&nbsp;a&nbsp;PCAP&nbsp;file&nbsp;and&nbsp;realized&nbsp;when&nbsp;client&nbsp;tries&nbsp;to&nbsp;connect&nbsp;&lt;br&gt;<br>
&gt;&nbsp;with&nbsp;a&nbsp;new&nbsp;IPv6&nbsp;address,&nbsp;Squid&nbsp;is&nbsp;not&nbsp;trying&nbsp;to&nbsp;open&nbsp;a&nbsp;new&nbsp;connection&nbsp;&lt;br&gt;<br>
&gt;&nbsp;instead&nbsp;tries&nbsp;to&nbsp;resume&nbsp;a&nbsp;previously&nbsp;opened&nbsp;one&nbsp;on&nbsp;a&nbsp;different&nbsp;outgoing&nbsp;&lt;br&gt;<br>
&gt;&nbsp;IPv6&nbsp;address.&lt;br&gt;<br>
&lt;br&gt;<br>
Can&nbsp;you&nbsp;provide&nbsp;the&nbsp;trace&nbsp;demonstrating&nbsp;that&nbsp;issue?&lt;br&gt;<br>
&lt;br&gt;<br>
Although,&nbsp;as&nbsp;noted&nbsp;earlier&nbsp;your&nbsp;problems&nbsp;are&nbsp;apparently&nbsp;on&nbsp;the&nbsp;client&nbsp;&lt;br&gt;<br>
connections.&nbsp;This&nbsp;is&nbsp;about&nbsp;server&nbsp;connections&nbsp;behaviour.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;set&nbsp;server_persistent_connections&nbsp;off&nbsp;which&nbsp;should&nbsp;have&nbsp;&lt;br&gt;<br>
&gt;&nbsp;disabled&nbsp;this&nbsp;behavior&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;same.&lt;br&gt;<br>
&lt;br&gt;<br>
Nod.&nbsp;Yes&nbsp;that&nbsp;should&nbsp;forbid&nbsp;re-use&nbsp;of&nbsp;connections.&lt;br&gt;<br>
&lt;br&gt;<br>
I/we&nbsp;will&nbsp;need&nbsp;to&nbsp;see&nbsp;the&nbsp;PCAP&nbsp;trace&nbsp;along&nbsp;with&nbsp;a&nbsp;cache.log&nbsp;generated&nbsp;&lt;br&gt;<br>
using&nbsp;&quot;debug_options&nbsp;ALL,6&quot;&nbsp;to&nbsp;confirm&nbsp;a&nbsp;bug&nbsp;or&nbsp;identify&nbsp;other&nbsp;breakage&nbsp;&lt;br&gt;<br>
though.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;tried&nbsp;using&nbsp;a&nbsp;newer&nbsp;&lt;br&gt;<br>
&gt;&nbsp;version&nbsp;of&nbsp;Squid&nbsp;but&nbsp;it&nbsp;behaved&nbsp;differently&nbsp;and&nbsp;did&nbsp;not&nbsp;follow&nbsp;my&nbsp;&lt;br&gt;<br>
&gt;&nbsp;outgoing&nbsp;address&nbsp;specifications&nbsp;and&nbsp;kept&nbsp;connecting&nbsp;on&nbsp;IPv4.&lt;br&gt;<br>
&lt;br&gt;<br>
That&nbsp;would&nbsp;seem&nbsp;to&nbsp;indicate&nbsp;that&nbsp;your&nbsp;IPv4&nbsp;connectivity&nbsp;is&nbsp;better&nbsp;than&nbsp;&lt;br&gt;<br>
your&nbsp;IPv6&nbsp;connectivity.&nbsp;Later&nbsp;Squid&nbsp;use&nbsp;various&nbsp;&quot;Happy&nbsp;Eyeballs&quot;&nbsp;&lt;br&gt;<br>
implementations&nbsp;for&nbsp;the&nbsp;server&nbsp;selection.&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;usually&nbsp;work&nbsp;around&nbsp;this&nbsp;by&nbsp;configuring&nbsp;the&nbsp;DNS&nbsp;server&nbsp;specified&nbsp;&lt;br&gt;<br>
by&nbsp;dns_nameservers&nbsp;to&nbsp;only&nbsp;deliver&nbsp;IPv6&nbsp;results&nbsp;when&nbsp;a&nbsp;mixed&nbsp;set&nbsp;are&nbsp;&lt;br&gt;<br>
available.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH&lt;br&gt;<br>
Amos&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
