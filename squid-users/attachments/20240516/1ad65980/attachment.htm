<tt>
&lt;html&gt;&lt;body&gt;&lt;div&nbsp;id=&quot;nine_body_n18f819-92ad1&quot;&nbsp;class=&quot;nine_body&nbsp;mceEditable&quot;&nbsp;dir=&quot;auto&quot;&nbsp;style=&quot;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&nbsp;font-size:&nbsp;12.0pt;&nbsp;line-height:&nbsp;1.3;&nbsp;color:&nbsp;#1f497d;&quot;&gt;&lt;div&nbsp;class=&quot;nine-pg&quot;&nbsp;dir=&quot;auto&quot;&gt;Hi&nbsp;Alex &lt;/div&gt;&lt;div&nbsp;class=&quot;nine-pg&quot;&nbsp;dir=&quot;auto&quot;&gt;Has&nbsp;I&nbsp;explain,&nbsp;by&nbsp;default&nbsp;I&nbsp;set&nbsp;those&nbsp;directives&nbsp;to&nbsp;off&nbsp;to&nbsp;avoid&nbsp;high&nbsp;cpu&nbsp;consumption. &lt;/div&gt;&lt;div&nbsp;class=&quot;nine-pg&quot;&nbsp;dir=&quot;auto&quot;&gt;My&nbsp;doubt&nbsp;is&nbsp;enabling&nbsp;persistent&nbsp;connection&nbsp;will&nbsp;help&nbsp;squid&nbsp;to&nbsp;process&nbsp;the&nbsp;request&nbsp;more&nbsp;efficiently&nbsp;and&nbsp;gain&nbsp;more&nbsp;performance&nbsp;or&nbsp;not. &lt;/div&gt;&lt;div&nbsp;class=&quot;nine-pg&quot;&nbsp;dir=&quot;auto&quot;&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;nine-pg&quot;&nbsp;dir=&quot;auto&quot;&gt;Best&nbsp;regards &lt;/div&gt;&lt;div&nbsp;class=&quot;nine-pg&nbsp;blank&nbsp;sign&quot;&nbsp;dir=&quot;auto&quot;&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;div&nbsp;id=&quot;nine-sign-n18f819-92ad1&quot;&nbsp;class=&quot;nine_signature&quot;&nbsp;dir=&quot;auto&quot;&gt;&lt;div&nbsp;class=&quot;nine-pg&quot;&nbsp;dir=&quot;auto&quot;&gt;Sent&nbsp;from&nbsp;&lt;a&nbsp;style=&quot;text-decoration:&nbsp;none;&nbsp;color:&nbsp;#009bdf;&quot;&nbsp;href=&quot;http://www.9folders.com/&quot;&gt;Nine&lt;/a&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;nine-pg&nbsp;blank&nbsp;msg&quot;&nbsp;dir=&quot;auto&quot;&gt;&lt;br&nbsp;/&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;quoted_output_body&quot;&gt;&lt;div&nbsp;id=&quot;quoted_header_n18f819-92ad1&quot;&nbsp;class=&quot;quoted_header_editor&nbsp;fold&quot;&nbsp;dir=&quot;auto&quot;&gt;&lt;hr&nbsp;style=&quot;border:&nbsp;none;&nbsp;height:&nbsp;1px;&nbsp;color:&nbsp;#e1e1e1;&nbsp;background-color:&nbsp;#e1e1e1;&quot;&nbsp;/&gt;&lt;div&nbsp;dir=&quot;auto&quot;&nbsp;style=&quot;border:&nbsp;none;&nbsp;padding:&nbsp;3.0pt&nbsp;0cm&nbsp;0cm&nbsp;0cm;&quot;&gt;&lt;span&nbsp;style=&quot;font-size:&nbsp;11.0pt;&nbsp;font-family:&nbsp;Calibri,&nbsp;Arial,&nbsp;Helvetica,&nbsp;sans-serif;&quot;&gt;&lt;b&gt;De:&lt;/b&gt;&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;rousskov@measurement-factory.com&gt;&lt;br&nbsp;/&gt;&lt;b&gt;Enviado:&lt;/b&gt;&nbsp;quinta-feira,&nbsp;16&nbsp;de&nbsp;maio&nbsp;de&nbsp;2024&nbsp;14:56&lt;br&nbsp;/&gt;&lt;b&gt;Para:&lt;/b&gt;&nbsp;squid-users@lists.squid-cache.org&lt;br&nbsp;/&gt;&lt;b&gt;Assunto&lt;/b&gt;&nbsp;Re:&nbsp;[squid-users]&nbsp;Tune&nbsp;Squid&nbsp;proxy&nbsp;to&nbsp;handle&nbsp;90k&nbsp;connection&lt;br&nbsp;/&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&nbsp;type='attribution'&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&lt;br&gt;&lt;br&gt;&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;Zarafa&nbsp;HTML&nbsp;builder&nbsp;1.0&quot;&gt;<br>
&lt;TITLE&gt;&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;!--&nbsp;Converted&nbsp;from&nbsp;text/plain&nbsp;format&nbsp;--&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;STYLE=&quot;font-family:&nbsp;courier&quot;&nbsp;SIZE=2&gt;<br>
On&nbsp;2024-05-15&nbsp;19:02,&nbsp;Andre&nbsp;Bolinhas&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;To&nbsp;handle&nbsp;this&nbsp;amount&nbsp;of&nbsp;traffic&nbsp;should&nbsp;I&nbsp;enable&nbsp;&lt;br&gt;<br>
&gt;&nbsp;client_persistent_connections&nbsp;and&nbsp;server_persistent_connections&nbsp;or&nbsp;is&nbsp;it&nbsp;&lt;br&gt;<br>
&gt;&nbsp;better&nbsp;to&nbsp;keep&nbsp;it&nbsp;disable?&lt;br&gt;<br>
&lt;br&gt;<br>
As&nbsp;Jonathan&nbsp;has&nbsp;already&nbsp;mentioned,&nbsp;the&nbsp;question&nbsp;is&nbsp;misleading&nbsp;because&nbsp;&lt;br&gt;<br>
these&nbsp;directives&nbsp;default&nbsp;to&nbsp;&quot;on&quot;&nbsp;--&nbsp;persistent&nbsp;connections&nbsp;are&nbsp;enabled&nbsp;&lt;br&gt;<br>
by&nbsp;default.&nbsp;Modern&nbsp;HTTP&nbsp;specs&nbsp;enable&nbsp;them&nbsp;by&nbsp;default&nbsp;as&nbsp;well.&lt;br&gt;<br>
&lt;br&gt;<br>
Since&nbsp;you&nbsp;do&nbsp;not&nbsp;know&nbsp;whether&nbsp;persistent&nbsp;connections&nbsp;are&nbsp;harmful&nbsp;in&nbsp;your&nbsp;&lt;br&gt;<br>
particular&nbsp;deployment&nbsp;environments,&nbsp;remove&nbsp;those&nbsp;two&nbsp;directives&nbsp;from&nbsp;&lt;br&gt;<br>
your&nbsp;Squid&nbsp;configuration&nbsp;files&nbsp;(effectively&nbsp;enabling&nbsp;persistent&nbsp;&lt;br&gt;<br>
connection&nbsp;use).&nbsp;There&nbsp;are&nbsp;always&nbsp;exceptions,&nbsp;but&nbsp;in&nbsp;the&nbsp;vast&nbsp;majority&nbsp;&lt;br&gt;<br>
of&nbsp;cases,&nbsp;not&nbsp;specifying&nbsp;those&nbsp;directives&nbsp;is&nbsp;the&nbsp;best&nbsp;first&nbsp;step.&lt;br&gt;<br>
&lt;br&gt;<br>
If&nbsp;you&nbsp;want&nbsp;to&nbsp;research&nbsp;whether&nbsp;persistent&nbsp;connections&nbsp;are&nbsp;harmful&nbsp;in&nbsp;&lt;br&gt;<br>
your&nbsp;environments,&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;define&nbsp;performance&nbsp;metrics&nbsp;and&nbsp;&lt;br&gt;<br>
experiment&nbsp;with&nbsp;all&nbsp;four&nbsp;different&nbsp;combinations&nbsp;across&nbsp;the&nbsp;two&nbsp;boolean&nbsp;&lt;br&gt;<br>
directives&nbsp;(at&nbsp;least&nbsp;--&nbsp;there&nbsp;are&nbsp;more&nbsp;directives&nbsp;that&nbsp;affect&nbsp;connection&nbsp;&lt;br&gt;<br>
persistency).&nbsp;Doing&nbsp;this&nbsp;kind&nbsp;of&nbsp;research&nbsp;right&nbsp;is&nbsp;difficult!&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;Best&nbsp;regards&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;31/01/2022&nbsp;14:52,&nbsp;Eliezer&nbsp;Croitoru&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Hey&nbsp;Andre,&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;*would&nbsp;not&nbsp;*recommend&nbsp;on&nbsp;5.x&nbsp;yet&nbsp;since&nbsp;there&nbsp;are&nbsp;couple&nbsp;bugs&nbsp;which&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;are&nbsp;blocking&nbsp;it&nbsp;to&nbsp;be&nbsp;used&nbsp;as&nbsp;stable.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;believe&nbsp;that&nbsp;your&nbsp;current&nbsp;setup&nbsp;is&nbsp;pretty&nbsp;good.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;The&nbsp;only&nbsp;thing&nbsp;which&nbsp;might&nbsp;affect&nbsp;the&nbsp;system&nbsp;is&nbsp;the&nbsp;authentication&nbsp;and&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;ACLs.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;As&nbsp;long&nbsp;these&nbsp;ACL&nbsp;rules&nbsp;are&nbsp;static&nbsp;it&nbsp;should&nbsp;not&nbsp;affect&nbsp;too&nbsp;much&nbsp;on&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;the&nbsp;operation,&nbsp;however,&lt;br&gt;<br>
&gt;&gt;&nbsp;When&nbsp;adding&nbsp;external&nbsp;authentication&nbsp;and&nbsp;external&nbsp;helpers&nbsp;for&nbsp;other&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;things&nbsp;it&rsquo;s&nbsp;possible&nbsp;to&nbsp;see&nbsp;some&nbsp;slowdown&nbsp;in&nbsp;specific&nbsp;scenarios.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;credentials&nbsp;and&nbsp;the&nbsp;ACLs&nbsp;will&nbsp;be&nbsp;fast&nbsp;enough&nbsp;it&nbsp;is&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;expected&nbsp;to&nbsp;work&nbsp;fast&nbsp;but&nbsp;only&nbsp;testing&nbsp;will&nbsp;prove&nbsp;how&nbsp;the&nbsp;real&nbsp;world&nbsp;usage&lt;br&gt;<br>
&gt;&gt;&nbsp;will&nbsp;affect&nbsp;the&nbsp;service.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;believe&nbsp;that&nbsp;5&nbsp;workers&nbsp;is&nbsp;enough&nbsp;and&nbsp;also&nbsp;take&nbsp;into&nbsp;account&nbsp;that&nbsp;the&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;external&nbsp;helpers&nbsp;would&nbsp;also&nbsp;require&nbsp;CPU&nbsp;so&nbsp;don&rsquo;t&nbsp;rush&nbsp;into&lt;br&gt;<br>
&gt;&gt;&nbsp;changing&nbsp;the&nbsp;workers&nbsp;amount&nbsp;just&nbsp;yet.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;All&nbsp;The&nbsp;Bests,&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Eliezer&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;----&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Eliezer&nbsp;Croitoru&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;NgTech,&nbsp;Tech&nbsp;Support&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Mobile:&nbsp;+972-5-28704261&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Email:&nbsp;ngtech1ltd@gmail.com&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;*From:*&nbsp;Andr&eacute;&nbsp;Bolinhas&nbsp;&lt;andre.bolinhas@articatech.com&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;*Sent:*&nbsp;Monday,&nbsp;January&nbsp;31,&nbsp;2022&nbsp;15:47&lt;br&gt;<br>
&gt;&gt;&nbsp;*To:*&nbsp;'NgTech&nbsp;LTD'&nbsp;&lt;ngtech1ltd@gmail.com&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;*Cc:*&nbsp;'Squid&nbsp;Users'&nbsp;&lt;squid-users@lists.squid-cache.org&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;*Subject:*&nbsp;RE:&nbsp;[squid-users]&nbsp;Tune&nbsp;Squid&nbsp;proxy&nbsp;to&nbsp;handle&nbsp;90k&nbsp;connection&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Hi&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;will&nbsp;not&nbsp;use&nbsp;cache&nbsp;in&nbsp;this&nbsp;project.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Yes,&nbsp;I&nbsp;will&nbsp;need&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;ACL&nbsp;(based&nbsp;on&nbsp;Domain,&nbsp;AD&nbsp;user,&nbsp;Headers,&nbsp;User&nbsp;Agent&hellip;)&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;Authentication&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;SSL&nbsp;bump&nbsp;just&nbsp;for&nbsp;one&nbsp;domain.&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;DNS&nbsp;resolution&nbsp;(I&nbsp;will&nbsp;use&nbsp;Unbound&nbsp;DNS&nbsp;service&nbsp;for&nbsp;this)&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Also,&nbsp;I&nbsp;will&nbsp;divide&nbsp;the&nbsp;traffic&nbsp;between&nbsp;two&nbsp;Squid&nbsp;box&nbsp;instead&nbsp;just&nbsp;one.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;So&nbsp;each&nbsp;box&nbsp;will&nbsp;handle&nbsp;around&nbsp;50k&nbsp;request.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Each&nbsp;box&nbsp;have:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;CPU(s)&nbsp;16&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;Threads&nbsp;per&nbsp;code&nbsp;2&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;Cores&nbsp;per&nbsp;socket&nbsp;8&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;Sockets&nbsp;1&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;Inter&nbsp;Xeron&nbsp;Silver&nbsp;4208&nbsp;&nbsp;@&nbsp;2.10GHz&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;96GB&nbsp;Ram&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;*&nbsp;1TB&nbsp;raid-0&nbsp;SSD&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;At&nbsp;this&nbsp;time&nbsp;I&nbsp;have&nbsp;5&nbsp;workers&nbsp;on&nbsp;each&nbsp;Squid&nbsp;box&nbsp;and&nbsp;the&nbsp;Squid&nbsp;version&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;is&nbsp;4.17,&nbsp;do&nbsp;you&nbsp;recommend&nbsp;more&nbsp;workers&nbsp;or&nbsp;upgrade&nbsp;the&nbsp;squid&nbsp;version&nbsp;to&nbsp;5?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Best&nbsp;regards&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;*De:*NgTech&nbsp;LTD&nbsp;&lt;ngtech1ltd@gmail.com&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;*Enviada:*&nbsp;31&nbsp;de&nbsp;janeiro&nbsp;de&nbsp;2022&nbsp;04:59&lt;br&gt;<br>
&gt;&gt;&nbsp;*Para:*&nbsp;Andr&eacute;&nbsp;Bolinhas&nbsp;&lt;andre.bolinhas@articatech.com&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;*Cc:*&nbsp;Squid&nbsp;Users&nbsp;&lt;squid-users@lists.squid-cache.org&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;*Assunto:*&nbsp;Re:&nbsp;[squid-users]&nbsp;Tune&nbsp;Squid&nbsp;proxy&nbsp;to&nbsp;handle&nbsp;90k&nbsp;connection&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;would&nbsp;recommend&nbsp;you&nbsp;to&nbsp;start&nbsp;with&nbsp;0&nbsp;caching.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;However,&nbsp;for&nbsp;choosing&nbsp;the&nbsp;right&nbsp;solution&nbsp;you&nbsp;must&nbsp;give&nbsp;more&nbsp;details.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;For&nbsp;example&nbsp;there&nbsp;is&nbsp;an&nbsp;IBM&nbsp;reasearch&nbsp;that&nbsp;prooved&nbsp;that&nbsp;for&nbsp;about&nbsp;90k&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;connections&nbsp;you&nbsp;can&nbsp;use&nbsp;vm's&nbsp;ontop&nbsp;of&nbsp;such&nbsp;hardware&nbsp;with&nbsp;apache&nbsp;web&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;server.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;If&nbsp;you&nbsp;do&nbsp;have&nbsp;the&nbsp;set&nbsp;of&nbsp;the&nbsp;other&nbsp;requirements&nbsp;from&nbsp;the&nbsp;proxy&nbsp;else&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;then&nbsp;the&nbsp;90k&nbsp;requests&nbsp;it&nbsp;would&nbsp;be&nbsp;wise&nbsp;to&nbsp;mention&nbsp;them.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Do&nbsp;you&nbsp;need&nbsp;any&nbsp;specific&nbsp;acls?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Do&nbsp;you&nbsp;need&nbsp;authentication?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;etc..&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;For&nbsp;a&nbsp;simple&nbsp;forward&nbsp;proxy&nbsp;I&nbsp;would&nbsp;suggest&nbsp;to&nbsp;use&nbsp;a&nbsp;simpler&nbsp;solution&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;and&nbsp;if&nbsp;possible&nbsp;to&nbsp;not&nbsp;log&nbsp;anything&nbsp;as&nbsp;a&nbsp;starter&nbsp;point.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Any&nbsp;local&nbsp;disk&nbsp;i/o&nbsp;will&nbsp;slow&nbsp;down&nbsp;the&nbsp;machine.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;About&nbsp;the&nbsp;url&nbsp;categorization,&nbsp;I&nbsp;do&nbsp;not&nbsp;have&nbsp;experience&nbsp;with&nbsp;ufdbguard&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;on&nbsp;such&nbsp;scale&nbsp;but&nbsp;it&nbsp;would&nbsp;be&nbsp;pretty&nbsp;heavy&nbsp;for&nbsp;any&nbsp;software&nbsp;to&nbsp;handle&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;90k&nbsp;rps...&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;It's&nbsp;doable&nbsp;to&nbsp;implement&nbsp;such&nbsp;setup&nbsp;but&nbsp;will&nbsp;require&nbsp;testing.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Will&nbsp;you&nbsp;use&nbsp;ssl&nbsp;bump&nbsp;in&nbsp;this&nbsp;setup?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;If&nbsp;I&nbsp;will&nbsp;have&nbsp;all&nbsp;the&nbsp;technical&nbsp;and&nbsp;specs/requirements&nbsp;details&nbsp;I&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;might&nbsp;be&nbsp;able&nbsp;to&nbsp;suggest&nbsp;better&nbsp;then&nbsp;now.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Take&nbsp;into&nbsp;account&nbsp;that&nbsp;each&nbsp;squid&nbsp;worker&nbsp;can&nbsp;handle&nbsp;about&nbsp;3k&nbsp;rps&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;tops(with&nbsp;my&nbsp;experience)&nbsp;and&nbsp;it's&nbsp;a&nbsp;juggling&nbsp;between&nbsp;two&nbsp;sides&nbsp;so...&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;3k&nbsp;is&nbsp;really&nbsp;3k+3k+external_acls+dns...&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;I&nbsp;believe&nbsp;that&nbsp;in&nbsp;this&nbsp;case&nbsp;an&nbsp;example&nbsp;of&nbsp;configuration&nbsp;from&nbsp;the&nbsp;squid&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;developers&nbsp;might&nbsp;be&nbsp;usefull.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;Eliezer&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;בתאריך&nbsp;יום&nbsp;ג׳,&nbsp;25&nbsp;בינו׳&nbsp;2022,&nbsp;18:42,&nbsp;מאתAndr&eacute;&nbsp;Bolinhas&nbsp;&lt;br&gt;<br>
&gt;&gt;&nbsp;&rlm;&lt;andre.bolinhas@articatech.com&gt;:&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Any&nbsp;tip&nbsp;about&nbsp;my&nbsp;last&nbsp;comment?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----Mensagem&nbsp;original-----&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;De:&nbsp;Andr&eacute;&nbsp;Bolinhas&nbsp;&lt;andre.bolinhas@articatech.com&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enviada:&nbsp;21&nbsp;de&nbsp;janeiro&nbsp;de&nbsp;2022&nbsp;16:36&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Para:&nbsp;'Amos&nbsp;Jeffries'&nbsp;&lt;squid3@treenet.co.nz&gt;;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assunto:&nbsp;RE:&nbsp;[squid-users]&nbsp;Tune&nbsp;Squid&nbsp;proxy&nbsp;to&nbsp;handle&nbsp;90k&nbsp;connection&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thanks&nbsp;Amos&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Yes,&nbsp;you&nbsp;are&nbsp;right,&nbsp;I&nbsp;will&nbsp;put&nbsp;a&nbsp;second&nbsp;box&nbsp;with&nbsp;HaProxy&nbsp;in&nbsp;front&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;balance&nbsp;the&nbsp;traffic.&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;About&nbsp;the&nbsp;sockets&nbsp;I&nbsp;can't&nbsp;double&nbsp;it&nbsp;because&nbsp;is&nbsp;a&nbsp;physical&nbsp;machine,&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;you&nbsp;think&nbsp;disable&nbsp;hyperthreading&nbsp;from&nbsp;bios&nbsp;will&nbsp;help,&nbsp;because&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;have&nbsp;other&nbsp;services&nbsp;inside&nbsp;the&nbsp;box&nbsp;that&nbsp;works&nbsp;in&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multi-threading,&nbsp;like&nbsp;unbound&nbsp;DNS?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;more&nbsp;a&nbsp;few&nbsp;questions:&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&ordm;&nbsp;The&nbsp;server&nbsp;have&nbsp;92Gb&nbsp;of&nbsp;Ram,&nbsp;do&nbsp;you&nbsp;think&nbsp;that&nbsp;is&nbsp;needed&nbsp;that&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adding&nbsp;swap&nbsp;will&nbsp;help&nbsp;squid&nbsp;performance?&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&ordm;&nbsp;Right&nbsp;now&nbsp;we&nbsp;are&nbsp;using&nbsp;squid&nbsp;4.17&nbsp;did&nbsp;you&nbsp;recommend&nbsp;upgrade&nbsp;or&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;downgrade&nbsp;to&nbsp;any&nbsp;specific&nbsp;version?&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3&ordm;&nbsp;We&nbsp;need&nbsp;categorization,&nbsp;for&nbsp;this&nbsp;we&nbsp;are&nbsp;using&nbsp;an&nbsp;external&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;helper&nbsp;to&nbsp;achieve&nbsp;it,&nbsp;do&nbsp;you&nbsp;recommend&nbsp;use&nbsp;this&nbsp;approach&nbsp;with&nbsp;ACL&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;move&nbsp;to&nbsp;some&nbsp;kind&nbsp;of&nbsp;ufdbguard&nbsp;service?&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Best&nbsp;regards&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----Mensagem&nbsp;original-----&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;De:&nbsp;squid-users&nbsp;&lt;squid-users-bounces@lists.squid-cache.org&gt;&nbsp;Em&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nome&nbsp;De&nbsp;Amos&nbsp;Jeffries&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enviada:&nbsp;21&nbsp;de&nbsp;janeiro&nbsp;de&nbsp;2022&nbsp;16:05&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Para:&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assunto:&nbsp;Re:&nbsp;[squid-users]&nbsp;Tune&nbsp;Squid&nbsp;proxy&nbsp;to&nbsp;handle&nbsp;90k&nbsp;connection&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sorry&nbsp;for&nbsp;the&nbsp;slow&nbsp;reply.&nbsp;Responses&nbsp;inline.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;14/01/22&nbsp;05:44,&nbsp;Andr&eacute;&nbsp;Bolinhas&nbsp;wrote:&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;Hi&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;~80k&nbsp;request&nbsp;per&nbsp;second&nbsp;&nbsp;10k&nbsp;users&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Test&nbsp;this,&nbsp;but&nbsp;you&nbsp;may&nbsp;need&nbsp;a&nbsp;second&nbsp;machine&nbsp;to&nbsp;achieve&nbsp;the&nbsp;full&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;80k&nbsp;RPS.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Latest&nbsp;Squid&nbsp;do&nbsp;not&nbsp;have&nbsp;any&nbsp;details&nbsp;analysis,&nbsp;but&nbsp;older&nbsp;Squid-3.5&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;were&nbsp;only&nbsp;achieving&nbsp;&gt;15k&nbsp;RPS&nbsp;under&nbsp;lab&nbsp;conditions,&nbsp;more&nbsp;likely&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expect&nbsp;under&nbsp;10k&nbsp;RPS/worker&nbsp;on&nbsp;real&nbsp;traffic.&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;means&nbsp;(IME)&nbsp;this&nbsp;machine&nbsp;is&nbsp;quite&nbsp;likely&nbsp;to&nbsp;hit&nbsp;its&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;capacity&nbsp;somewhere&nbsp;under&nbsp;70k&nbsp;RPS.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;CPU&nbsp;info:&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;CPU(s)&nbsp;16&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;Threads&nbsp;per&nbsp;code&nbsp;2&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;Cores&nbsp;per&nbsp;socket&nbsp;8&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;With&nbsp;this&nbsp;CPU&nbsp;you&nbsp;will&nbsp;be&nbsp;able&nbsp;to&nbsp;run&nbsp;7&nbsp;workers.&nbsp;Setup&nbsp;affinity&nbsp;of&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;one&nbsp;core&nbsp;per&nbsp;worker&nbsp;(the&nbsp;&quot;kidN&quot;&nbsp;processes&nbsp;of&nbsp;Squid).&nbsp;Leaving&nbsp;one&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;core&nbsp;to&nbsp;the&nbsp;OS&nbsp;and&nbsp;additional&nbsp;processing&nbsp;needs&nbsp;-&nbsp;this&nbsp;matters&nbsp;at&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;peak&nbsp;loading.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CPU&nbsp;&quot;threads&quot;&nbsp;tend&nbsp;not&nbsp;to&nbsp;be&nbsp;useful&nbsp;for&nbsp;Squid.&nbsp;Under&nbsp;high&nbsp;loads&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Squid&nbsp;workers&nbsp;will&nbsp;consume&nbsp;all&nbsp;available&nbsp;cycles&nbsp;on&nbsp;their&nbsp;core,&nbsp;not&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;leaving&nbsp;any&nbsp;for&nbsp;the&nbsp;fancy&nbsp;&quot;thread&quot;&nbsp;core&nbsp;sharing&nbsp;features&nbsp;to&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pretend&nbsp;there&nbsp;is&nbsp;another&nbsp;core&nbsp;available.&nbsp;YMMV.&nbsp;One&nbsp;of&nbsp;the&nbsp;tests&nbsp;to&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;when&nbsp;tuning&nbsp;is&nbsp;to&nbsp;turn&nbsp;off&nbsp;the&nbsp;CPU&nbsp;hyperthreading&nbsp;and&nbsp;see&nbsp;what&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;effect&nbsp;it&nbsp;has&nbsp;(if&nbsp;any).&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;Sockets&nbsp;1&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&nbsp;Inter&nbsp;Xeron&nbsp;Silver&nbsp;4208&nbsp;&nbsp;@&nbsp;2.10GHz&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Okay.&nbsp;Doable,&nbsp;but&nbsp;for&nbsp;best&nbsp;performance&nbsp;you&nbsp;want&nbsp;as&nbsp;high&nbsp;GHz&nbsp;rating&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;the&nbsp;cores&nbsp;as&nbsp;your&nbsp;budget&nbsp;can&nbsp;afford.&nbsp;The&nbsp;amount&nbsp;of&nbsp;&quot;lag&quot;&nbsp;Squid&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adds&nbsp;to&nbsp;traffic&nbsp;and&nbsp;RPS&nbsp;performance/parallelism&nbsp;directly&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;correlates&nbsp;with&nbsp;how&nbsp;fast&nbsp;the&nbsp;CPU&nbsp;core&nbsp;can&nbsp;run&nbsp;cycles.&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HTH&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Amos&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://lists.squid-cache.org/listinfo/squid-users&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&gt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://lists.squid-cache.org/listinfo/squid-users&lt;br&gt;<br>
&gt;&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&gt;&nbsp;https://lists.squid-cache.org/listinfo/squid-users&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
squid-users@lists.squid-cache.org&lt;br&gt;<br>
https://lists.squid-cache.org/listinfo/squid-users&lt;br&gt;<br>
&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;/BODY&gt;&lt;/HTML&gt;
</tt>
