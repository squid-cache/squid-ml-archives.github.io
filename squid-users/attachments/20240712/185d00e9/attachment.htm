<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;class=&quot;yahoo-style-wrap&quot;&nbsp;style=&quot;font-family:Helvetica&nbsp;Neue,&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;font-size:16px;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;Hello,&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&nbsp;&nbsp;&nbsp;apologies&nbsp;in&nbsp;advance&nbsp;for&nbsp;the&nbsp;silly&nbsp;question.&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;We&nbsp;are&nbsp;having&nbsp;some&nbsp;stability&nbsp;issues&nbsp;with&nbsp;our&nbsp;squid&nbsp;farms&nbsp;after&nbsp;a&nbsp;recent&nbsp;upgrade&nbsp;from&nbsp;Centos/Squid&nbsp;3.5.x&nbsp;to&nbsp;Ubuntu/Squid&nbsp;5.7/6.9.&nbsp;I&nbsp;wonder&nbsp;if&nbsp;anyone&nbsp;here&nbsp;has&nbsp;seen&nbsp;something&nbsp;similar,&nbsp;and&nbsp;might&nbsp;have&nbsp;some&nbsp;suggestion&nbsp;about&nbsp;what&nbsp;we&nbsp;are&nbsp;obviously&nbsp;missing?&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;In&nbsp;short,&nbsp;after&nbsp;running&nbsp;for&nbsp;a&nbsp;certain&nbsp;period&nbsp;the&nbsp;servers&nbsp;run&nbsp;out&nbsp;of&nbsp;file&nbsp;descriptors.&nbsp;We&nbsp;see&nbsp;a&nbsp;slowly&nbsp;growing&nbsp;number&nbsp;of&nbsp;TCP&nbsp;or&nbsp;TCPv6&nbsp;socket&nbsp;handles,&nbsp;that&nbsp;eventually&nbsp;hits&nbsp;the&nbsp;configured&nbsp;maximum.&nbsp;The&nbsp;handles&nbsp;do&nbsp;not&nbsp;get&nbsp;released&nbsp;until&nbsp;after&nbsp;squid&nbsp;is&nbsp;restarted&nbsp;(-k&nbsp;restart)&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;16px;&quot;&gt;It&nbsp;is&nbsp;somewhat&nbsp;similar&nbsp;to&nbsp;what&nbsp;reported&nbsp;under&nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;https://access.redhat.com/solutions/3362211&quot;&nbsp;style=&quot;color:&nbsp;rgb(25,&nbsp;106,&nbsp;212);&nbsp;text-decoration-line:&nbsp;underline;&nbsp;font-family:&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;16px;&quot;&nbsp;rel=&quot;nofollow&quot;&nbsp;target=&quot;_blank&quot;&gt;https://access.redhat.com/solutions/3362211&lt;/a&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;16px;&quot;&gt;&nbsp;.&nbsp;They&nbsp;state&nbsp;that&nbsp;&nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;ul&gt;&lt;li&gt;&lt;i&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;37,&nbsp;37);&nbsp;font-family:&nbsp;&quot;Red&nbsp;Hat&nbsp;Text&quot;,&nbsp;RedHatText,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Arial,&nbsp;sans-serif;&quot;&gt;If&nbsp;an&nbsp;application&nbsp;fails&nbsp;to&nbsp;&lt;code&nbsp;style=&quot;font-family:&nbsp;Consolas,&nbsp;Monaco,&nbsp;&quot;Andale&nbsp;Mono&quot;,&nbsp;monospace;&nbsp;font-size:&nbsp;14.4px;&nbsp;background-color:&nbsp;rgb(245,&nbsp;245,&nbsp;245);&nbsp;border-radius:&nbsp;0px;&quot;&gt;close()&lt;/code&gt;&nbsp;it's&nbsp;socket&nbsp;descriptors&nbsp;and&nbsp;continues&nbsp;to&nbsp;allocate&nbsp;new&nbsp;sockets&nbsp;then&nbsp;it&nbsp;can&nbsp;use&nbsp;up&nbsp;all&nbsp;the&nbsp;system&nbsp;memory&nbsp;on&nbsp;TCP(v6)&nbsp;slab&nbsp;objects.&lt;/i&gt;&lt;/li&gt;&lt;li&gt;&lt;i&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;37,&nbsp;37);&nbsp;font-family:&nbsp;&quot;Red&nbsp;Hat&nbsp;Text&quot;,&nbsp;RedHatText,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Arial,&nbsp;sans-serif;&quot;&gt;Note&nbsp;some&nbsp;of&nbsp;these&nbsp;sockets&nbsp;will&nbsp;not&nbsp;show&nbsp;up&nbsp;in&nbsp;&lt;code&nbsp;style=&quot;font-family:&nbsp;Consolas,&nbsp;Monaco,&nbsp;&quot;Andale&nbsp;Mono&quot;,&nbsp;monospace;&nbsp;font-size:&nbsp;14.4px;&nbsp;background-color:&nbsp;rgb(245,&nbsp;245,&nbsp;245);&nbsp;border-radius:&nbsp;0px;&quot;&gt;/proc/net/sockstat(6)&lt;/code&gt;.&nbsp;Sockets&nbsp;that&nbsp;still&nbsp;have&nbsp;a&nbsp;file&nbsp;descriptor&nbsp;but&nbsp;are&nbsp;in&nbsp;the&nbsp;&lt;code&nbsp;style=&quot;font-family:&nbsp;Consolas,&nbsp;Monaco,&nbsp;&quot;Andale&nbsp;Mono&quot;,&nbsp;monospace;&nbsp;font-size:&nbsp;14.4px;&nbsp;background-color:&nbsp;rgb(245,&nbsp;245,&nbsp;245);&nbsp;border-radius:&nbsp;0px;&quot;&gt;TCP_CLOSE&lt;/code&gt;&nbsp;state&nbsp;will&nbsp;consume&nbsp;a&nbsp;slab&nbsp;object.&nbsp;But&nbsp;will&nbsp;not&nbsp;be&nbsp;accounted&nbsp;for&nbsp;in&nbsp;&lt;code&nbsp;style=&quot;font-family:&nbsp;Consolas,&nbsp;Monaco,&nbsp;&quot;Andale&nbsp;Mono&quot;,&nbsp;monospace;&nbsp;font-size:&nbsp;14.4px;&nbsp;background-color:&nbsp;rgb(245,&nbsp;245,&nbsp;245);&nbsp;border-radius:&nbsp;0px;&quot;&gt;/proc/net/sockstat(6)&lt;/code&gt;&nbsp;or&nbsp;&quot;ss&quot;&nbsp;or&nbsp;&quot;netstat&quot;.&lt;/i&gt;&lt;/li&gt;&lt;li&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;37,&nbsp;37);&nbsp;font-family:&nbsp;&quot;Red&nbsp;Hat&nbsp;Text&quot;,&nbsp;RedHatText,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-style:&nbsp;italic;&quot;&gt;It&nbsp;can&nbsp;be&nbsp;determined&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;application&nbsp;sockets&nbsp;leak,&nbsp;by&nbsp;stopping&nbsp;the&nbsp;application&nbsp;processes&nbsp;that&nbsp;are&nbsp;consuming&nbsp;sockets.&nbsp;If&nbsp;the&nbsp;slab&nbsp;objects&nbsp;in&nbsp;&lt;/span&gt;&lt;code&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;37,&nbsp;37);&nbsp;font-style:&nbsp;italic;&nbsp;font-variant-ligatures:&nbsp;;&nbsp;font-variant-caps:&nbsp;;&nbsp;font-weight:&nbsp;;&nbsp;font-family:&nbsp;Consolas,&nbsp;Monaco,&nbsp;&quot;Andale&nbsp;Mono&quot;,&nbsp;monospace;&nbsp;font-size:&nbsp;14.4px;&nbsp;background-color:&nbsp;rgb(245,&nbsp;245,&nbsp;245);&nbsp;border-radius:&nbsp;0px;&quot;&gt;/proc/slabinfo&lt;/code&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;37,&nbsp;37);&nbsp;font-family:&nbsp;&quot;Red&nbsp;Hat&nbsp;Text&quot;,&nbsp;RedHatText,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-style:&nbsp;italic;&quot;&gt;&nbsp;are&nbsp;freed&nbsp;then&nbsp;the&nbsp;application&nbsp;is&nbsp;responsible.&nbsp;As&nbsp;that&nbsp;means&nbsp;that&nbsp;destructor&nbsp;routines&nbsp;have&nbsp;found&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;to&nbsp;sockets&nbsp;in&nbsp;the&nbsp;process.&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;i&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;37,&nbsp;37);&nbsp;font-family:&nbsp;&quot;Red&nbsp;Hat&nbsp;Text&quot;,&nbsp;RedHatText,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Arial,&nbsp;sans-serif;&quot;&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;i&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;37,&nbsp;37);&nbsp;font-family:&nbsp;&quot;Red&nbsp;Hat&nbsp;Text&quot;,&nbsp;RedHatText,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Arial,&nbsp;sans-serif;&quot;&gt;&lt;span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;16px;&quot;&gt;&quot;&lt;/span&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;&nbsp;font-size:&nbsp;16px;&quot;&gt;&lt;i&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;37,&nbsp;37);&nbsp;font-family:&nbsp;&quot;Red&nbsp;Hat&nbsp;Text&quot;,&nbsp;RedHatText,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Arial,&nbsp;sans-serif;&quot;&gt;This&nbsp;is&nbsp;most&nbsp;likely&nbsp;to&nbsp;be&nbsp;a&nbsp;case&nbsp;of&nbsp;the&nbsp;application&nbsp;not&nbsp;handling&nbsp;error&nbsp;conditions&nbsp;correctly&nbsp;and&nbsp;not&nbsp;calling&nbsp;&lt;/span&gt;&lt;code&nbsp;style=&quot;font-family:&nbsp;Consolas,&nbsp;Monaco,&nbsp;&quot;Andale&nbsp;Mono&quot;,&nbsp;monospace;&nbsp;font-size:&nbsp;14.4px;&nbsp;color:&nbsp;rgb(37,&nbsp;37,&nbsp;37);&nbsp;background-color:&nbsp;rgb(245,&nbsp;245,&nbsp;245);&nbsp;border-radius:&nbsp;0px;&quot;&gt;close()&lt;/code&gt;&lt;span&nbsp;style=&quot;color:&nbsp;rgb(37,&nbsp;37,&nbsp;37);&nbsp;font-family:&nbsp;&quot;Red&nbsp;Hat&nbsp;Text&quot;,&nbsp;RedHatText,&nbsp;&quot;Helvetica&nbsp;Neue&quot;,&nbsp;Arial,&nbsp;sans-serif;&quot;&gt;&nbsp;to&nbsp;free&nbsp;the&nbsp;FD&nbsp;and&nbsp;socket.&quot;&lt;/span&gt;&lt;/i&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/i&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;For&nbsp;example,&nbsp;on&nbsp;a&nbsp;server&nbsp;with&nbsp;squid&nbsp;5.7,&nbsp;unmodified&nbsp;package:&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;list&nbsp;of&nbsp;open&nbsp;files;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;lsof&nbsp;|wc&nbsp;-l&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;56963&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&nbsp;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;of&nbsp;which&nbsp;35K&nbsp;in&nbsp;TCPv6:&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;lsof&nbsp;|grep&nbsp;proxy&nbsp;|grep&nbsp;TCPv6&nbsp;|wc&nbsp;-l&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;35301&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;under&nbsp;/proc&nbsp;I&nbsp;see&nbsp;less&nbsp;objects&lt;br&gt;&lt;span&nbsp;style=&quot;font-family:&nbsp;&quot;lucida&nbsp;console&quot;,&nbsp;sans-serif;&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;cat&nbsp;&nbsp;/proc/net/tcp6&nbsp;|wc&nbsp;-l&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;3095&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;b&lt;/font&gt;ut&nbsp;the&nbsp;number&nbsp;of&nbsp;objects&nbsp;in&nbsp;the&nbsp;slabs&nbsp;is&nbsp;high&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;cat&nbsp;/proc/slabinfo&nbsp;|grep&nbsp;TCPv6&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&nbsp;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;MPTCPv6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;2048&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;tw_sock_TCPv6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1155&nbsp;&nbsp;&nbsp;1155&nbsp;&nbsp;&nbsp;&nbsp;248&nbsp;&nbsp;&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;35&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;request_sock_TCPv6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;304&nbsp;&nbsp;&nbsp;26&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;TCPv6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;38519&nbsp;&nbsp;38519&lt;/b&gt;&nbsp;&nbsp;&nbsp;2432&nbsp;&nbsp;&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;2963&nbsp;&nbsp;&nbsp;2963&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;I&nbsp;have&nbsp;35K&nbsp;of&nbsp;lines&nbsp;like&nbsp;this&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;lsof&nbsp;|grep&nbsp;proxy&nbsp;|grep&nbsp;TCPv6&nbsp;|more&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;squid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1049&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy&nbsp;&nbsp;&nbsp;13u&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0t0&nbsp;&nbsp;&nbsp;&nbsp;5428173&nbsp;protocol:&nbsp;TCPv6&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;squid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1049&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy&nbsp;&nbsp;&nbsp;14u&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0t0&nbsp;&nbsp;&nbsp;27941608&nbsp;protocol:&nbsp;TCPv6&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;squid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1049&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy&nbsp;&nbsp;&nbsp;24u&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0t0&nbsp;&nbsp;&nbsp;45124047&nbsp;protocol:&nbsp;TCPv6&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;squid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1049&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proxy&nbsp;&nbsp;&nbsp;25u&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sock&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0t0&nbsp;&nbsp;&nbsp;50689821&nbsp;protocol:&nbsp;TCPv6&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;...&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;We&nbsp;thought&nbsp;maybe&nbsp;this&nbsp;is&nbsp;a&nbsp;weird&nbsp;IPv6&nbsp;thing,&nbsp;as&nbsp;we&nbsp;only&nbsp;route&nbsp;IPv4,&nbsp;so&nbsp;we&nbsp;compiled&nbsp;a&nbsp;more&nbsp;recent&nbsp;version&nbsp;of&nbsp;squid&nbsp;with&nbsp;no&nbsp;v6&nbsp;support.&nbsp;The&nbsp;thing&nbsp;just&nbsp;moved&nbsp;to&nbsp;TCP4..&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;16px;&quot;&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;lsof&nbsp;|wc&nbsp;-l&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;16px;&quot;&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;120313&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;cat&nbsp;/proc/slabinfo&nbsp;|grep&nbsp;TCP&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;MPTCPv6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;2048&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;tw_sock_TCPv6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;248&nbsp;&nbsp;&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;request_sock_TCPv6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;304&nbsp;&nbsp;&nbsp;26&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;TCPv6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;208&nbsp;&nbsp;&nbsp;&nbsp;208&nbsp;&nbsp;&nbsp;2432&nbsp;&nbsp;&nbsp;13&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;MPTCP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;1856&nbsp;&nbsp;&nbsp;17&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;tw_sock_TCP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5577&nbsp;&nbsp;&nbsp;5577&nbsp;&nbsp;&nbsp;&nbsp;248&nbsp;&nbsp;&nbsp;33&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;&nbsp;169&nbsp;&nbsp;&nbsp;&nbsp;169&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;request_sock_TCP&nbsp;&nbsp;&nbsp;&nbsp;1898&nbsp;&nbsp;&nbsp;2002&nbsp;&nbsp;&nbsp;&nbsp;304&nbsp;&nbsp;&nbsp;26&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;77&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;77&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;TCP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;102452&nbsp;113274&nbsp;&nbsp;&lt;/b&gt;&nbsp;2240&nbsp;&nbsp;&nbsp;14&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;:&nbsp;tunables&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;:&nbsp;slabdata&nbsp;&nbsp;&nbsp;8091&nbsp;&nbsp;&nbsp;8091&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;cat&nbsp;/proc/net/tcp&nbsp;|wc&nbsp;-l&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;255&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;After&nbsp;restarting&nbsp;squid&nbsp;the&nbsp;slab&nbsp;objects&nbsp;are&nbsp;released&nbsp;and&nbsp;the&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;drop&nbsp;to&nbsp;a&nbsp;reasonable&nbsp;value.&nbsp;This&nbsp;further&nbsp;suggests&nbsp;it&nbsp;is&nbsp;squid&nbsp;hanging&nbsp;on&nbsp;to&nbsp;these&nbsp;FDs.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;lsof&nbsp;|grep&nbsp;proxy&nbsp;|wc&nbsp;-l&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font&nbsp;face=&quot;lucida&nbsp;console,&nbsp;sans-serif&quot;&gt;1221&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;Any&nbsp;suggestion?&nbsp;I&nbsp;guess&nbsp;it's&nbsp;something&nbsp;blatantly&nbsp;obvious,&nbsp;but&nbsp;it's&nbsp;a&nbsp;couple&nbsp;of&nbsp;days&nbsp;we&nbsp;look&nbsp;at&nbsp;this&nbsp;and&nbsp;we're&nbsp;not&nbsp;going&nbsp;anywhere...&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;Thanks&nbsp;again&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
