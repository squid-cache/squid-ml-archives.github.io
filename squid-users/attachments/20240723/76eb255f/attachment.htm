<tt>
&lt;div&nbsp;dir='auto'&gt;&lt;div&gt;Hi,&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;the&nbsp;problem&nbsp;is&nbsp;difficult.&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;Squid&nbsp;starts,&nbsp;shows&nbsp;a&nbsp;segmentation&nbsp;fault&nbsp;and&nbsp;continues&nbsp;working&nbsp;normally.&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;Squid&nbsp;forks&nbsp;a&nbsp;worker&nbsp;child&nbsp;and&nbsp;probably&nbsp;this&nbsp;child&nbsp;works,&nbsp;but&nbsp;the&nbsp;parent&nbsp;process&nbsp;dies&nbsp;with&nbsp;segmentation&nbsp;fault.&nbsp;There&nbsp;is&nbsp;no&nbsp;sign&nbsp;of&nbsp;this&nbsp;segmention&nbsp;fault&nbsp;in&nbsp;the&nbsp;cache&nbsp;log.&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;Only&nbsp;this&nbsp;failure&nbsp;(permission&nbsp;denied)&nbsp;of&nbsp;setresuid&nbsp;(setresuid(-1,0,-1)&nbsp;in&nbsp;tools.cc).&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;The&nbsp;segmentation&nbsp;fault&nbsp;occurs&nbsp;even&nbsp;when&nbsp;calling&nbsp;squid&nbsp;-k&nbsp;parse.&nbsp;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;Should&nbsp;i&nbsp;try&nbsp;to&nbsp;produce&nbsp;a&nbsp;coredump&nbsp;of&nbsp;a&nbsp;squid&nbsp;-k&nbsp;parse&nbsp;run?&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;I'm&nbsp;no&nbsp;freebsd&nbsp;guy.&nbsp;Maybe&nbsp;the&nbsp;problem&nbsp;lies&nbsp;in&nbsp;a&nbsp;different&nbsp;implementation&nbsp;of&nbsp;setresuid&nbsp;in&nbsp;freebsd&nbsp;(compared&nbsp;to&nbsp;Linux).&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;Thanks&nbsp;for&nbsp;trying&nbsp;to&nbsp;help&nbsp;me&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;dir=&quot;auto&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;elided-text&quot;&nbsp;dir=&quot;auto&quot;&gt;Am&nbsp;23.07.2024&nbsp;09:03&nbsp;schrieb&nbsp;Francesco&nbsp;Chemolli&nbsp;&lt;gkinkie@gmail.com&gt;:&lt;br&nbsp;type=&quot;attribution&quot;&gt;&lt;blockquote&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;0.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;&lt;p&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Anton,&lt;br&gt;<br>
&nbsp;&nbsp;no,&nbsp;segmentation&nbsp;fault&nbsp;shouldn't&nbsp;happen&nbsp;at&nbsp;any&nbsp;time.&lt;br&gt;<br>
Could&nbsp;you&nbsp;try&nbsp;to&nbsp;follow&nbsp;the&nbsp;instructions&nbsp;at&lt;br&gt;<br>
https://wiki.squid-cache.org/SquidFaq/BugReporting#crashes-and-core-dumps&lt;br&gt;<br>
&nbsp;?&lt;br&gt;<br>
What&nbsp;are&nbsp;the&nbsp;last&nbsp;lines&nbsp;in&nbsp;the&nbsp;cache.log&nbsp;when&nbsp;the&nbsp;segmentation&nbsp;fault&nbsp;happens?&lt;br&gt;<br>
Thanks&lt;/p&gt;<br>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Tue,&nbsp;Jul&nbsp;23,&nbsp;2024&nbsp;at&nbsp;3:12â€¯AM&nbsp;Anton&nbsp;Kornexl&nbsp;&lt;anton.kornexl@miex.cc&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Hello,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;tested&nbsp;the&nbsp;two&nbsp;installations&nbsp;further&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Opnsense&nbsp;23.x&nbsp;with&nbsp;squid&nbsp;6.6&nbsp;on&nbsp;freebsd&nbsp;13.2-Release-p9&nbsp;produces&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;same&nbsp;segmentation&nbsp;fault,&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;popup&nbsp;as&nbsp;red&nbsp;window&nbsp;in&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;dashboard.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;set&nbsp;&quot;debug_options&nbsp;ALL,5&quot;&nbsp;in&nbsp;squid.conf:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;found&nbsp;the&nbsp;following&nbsp;lines&nbsp;in&nbsp;cache.log&nbsp;(grep&nbsp;_suid&nbsp;cache.log)&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.186&nbsp;kid1|&nbsp;21,3|&nbsp;tools.cc(625)&nbsp;enter_suid:&lt;br&gt;<br>
&gt;&nbsp;enter_suid:&nbsp;PID&nbsp;29145&nbsp;taking&nbsp;root&nbsp;privileges&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.186&nbsp;kid1|&nbsp;21,31&nbsp;tools.cc(629)&nbsp;enter_suid:&lt;br&gt;<br>
&gt;&nbsp;enter_suid:&nbsp;setresuid&nbsp;failed:&nbsp;(1)&nbsp;Operation&nbsp;not&nbsp;permitted&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.186&nbsp;kid1|&nbsp;21,3|&nbsp;tools.cc(561)&nbsp;leave&nbsp;suid:&nbsp;leave&lt;br&gt;<br>
&gt;&nbsp;suid:&nbsp;PID&nbsp;29145&nbsp;called&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.187&nbsp;kid1|&nbsp;21,31&nbsp;tools.cc(625)&nbsp;enter_suid:&lt;br&gt;<br>
&gt;&nbsp;enter_suid:&nbsp;PID&nbsp;29145&nbsp;taking&nbsp;root&nbsp;privileges&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.187&nbsp;kid1|&nbsp;21,3|&nbsp;tools.cc(629)&nbsp;enter_suid:&lt;br&gt;<br>
&gt;&nbsp;enter_suid:&nbsp;setresuid&nbsp;failed:&nbsp;(1)&nbsp;Operation&nbsp;not&nbsp;permitted&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.187&nbsp;kid1|&nbsp;21,31&nbsp;tools.cc(561)&nbsp;leave_suid:&nbsp;leave&lt;br&gt;<br>
&gt;&nbsp;suid:&nbsp;PID&nbsp;29145&nbsp;called&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.187&nbsp;kid1|&nbsp;21,31&nbsp;tools.cc(625)&nbsp;enter_suid:&lt;br&gt;<br>
&gt;&nbsp;enter_suid:&nbsp;PID&nbsp;29145&nbsp;taking&nbsp;root&nbsp;privileges&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.187&nbsp;kid1l&nbsp;21,31&nbsp;tools.cc(629)&nbsp;enter_suid:&lt;br&gt;<br>
&gt;&nbsp;enter_suid:&nbsp;setresuid&nbsp;failed:&nbsp;(1)&nbsp;Operation&nbsp;not&nbsp;permitted&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.187&nbsp;kid1|&nbsp;21,31&nbsp;tools.cc(561)&nbsp;leave_suid:&nbsp;leave&lt;br&gt;<br>
&gt;&nbsp;suid:&nbsp;PID&nbsp;29145&nbsp;called&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.187&nbsp;kid1l&nbsp;21,31&nbsp;tools.cc(561)&nbsp;leave_suid:&lt;br&gt;<br>
&gt;&nbsp;leave_suid:&nbsp;PID&nbsp;29648&nbsp;called&lt;br&gt;<br>
&gt;&nbsp;2024/07/22&nbsp;17:26:52.187&nbsp;kid1l&nbsp;21,31&nbsp;tools.cc(651)&nbsp;no_suid:&nbsp;no_suid:&nbsp;PID&lt;br&gt;<br>
&gt;&nbsp;29648&nbsp;giving&nbsp;up&nbsp;root&nbsp;privileges&nbsp;forever&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;maybe&nbsp;this&nbsp;is&nbsp;the&nbsp;cause&nbsp;of&nbsp;the&nbsp;&quot;segmentation&nbsp;fault&quot;.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;difference&nbsp;between&nbsp;the&nbsp;installations&nbsp;23.x&nbsp;and&nbsp;24.x&nbsp;is&nbsp;the&nbsp;alerting&lt;br&gt;<br>
&gt;&nbsp;of&nbsp;this&nbsp;segmentaion&nbsp;fault&nbsp;in&nbsp;the&nbsp;dashboard&nbsp;of&nbsp;opnsense.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;But&nbsp;what&nbsp;ist&nbsp;the&nbsp;cause&nbsp;of&nbsp;this&nbsp;&quot;Operation&nbsp;not&nbsp;permitted&quot;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;yours&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Anton&nbsp;Kornexl&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Am&nbsp;22.07.2024&nbsp;um&nbsp;11:03&nbsp;schrieb&nbsp;Anton&nbsp;Kornexl:&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;&nbsp;Hello&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;i&nbsp;try&nbsp;to&nbsp;use&nbsp;squid&nbsp;(6.10)&nbsp;&nbsp;with&nbsp;opnsense&nbsp;24.x&nbsp;on&nbsp;freebsd&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;13-2-Release-p11.&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;It&nbsp;produces&nbsp;a&nbsp;&quot;segmentation&nbsp;fault&quot;&nbsp;at&nbsp;start&nbsp;and&nbsp;restart&nbsp;but&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;process&nbsp;runs.&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;The&nbsp;&quot;segmentation&nbsp;fault&quot;&nbsp;occurs&nbsp;even&nbsp;with&nbsp;squid&nbsp;-k&nbsp;parse.&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;A&nbsp;&quot;service&nbsp;squid&nbsp;reload&quot;&nbsp;runs&nbsp;OK,&nbsp;but&nbsp;a&nbsp;&quot;service&nbsp;squid&nbsp;restart&quot;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;produces&nbsp;this&nbsp;Segmentation&nbsp;fault.&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;The&nbsp;problem&nbsp;did&nbsp;not&nbsp;exist&nbsp;with&nbsp;opnsense&nbsp;23.x&nbsp;and&nbsp;an&nbsp;older&nbsp;squid.&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;How&nbsp;can&nbsp;I&nbsp;debug&nbsp;this&nbsp;error&nbsp;probably&nbsp;in&nbsp;the&nbsp;parse&nbsp;part?&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;yours&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;Anton&nbsp;Kornexl&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&gt;&nbsp;&gt;&nbsp;https://lists.squid-cache.org/listinfo/squid-users&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&gt;&nbsp;https://lists.squid-cache.org/listinfo/squid-users&lt;br&gt;&lt;br&gt;&lt;/p&gt;<br>
&lt;p&nbsp;dir=&quot;ltr&quot;&gt;--&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Francesco&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
squid-users@lists.squid-cache.org&lt;br&gt;<br>
https://lists.squid-cache.org/listinfo/squid-users&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
</tt>
