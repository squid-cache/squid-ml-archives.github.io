<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;<br>
&lt;span&nbsp;class=&quot;gmail-HwtZe&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;class=&quot;gmail-jCAhz&nbsp;gmail-ChMk0b&quot;&gt;&lt;span&nbsp;class=&quot;gmail-ryNqvb&quot;&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;clarification.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail-HwtZe&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;class=&quot;gmail-jCAhz&nbsp;gmail-ChMk0b&quot;&gt;&lt;span&nbsp;class=&quot;gmail-ryNqvb&quot;&gt;But&nbsp;could&nbsp;you&nbsp;please&nbsp;explain&nbsp;in&nbsp;more&nbsp;detail&nbsp;and&nbsp;in&nbsp;my&nbsp;case&nbsp;what&nbsp;needs&nbsp;to&nbsp;be&nbsp;added&nbsp;to&nbsp;&quot;strengthen&nbsp;and&nbsp;ensure&quot;&nbsp;the&nbsp;operation&nbsp;of&nbsp;my&nbsp;solution?&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;gmail-HwtZe&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;class=&quot;gmail-jCAhz&nbsp;gmail-ChMk0b&quot;&gt;&lt;span&nbsp;class=&quot;gmail-ryNqvb&quot;&gt;The&nbsp;quote&nbsp;from&nbsp;the&nbsp;file&nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;<br>
squid.conf.documented&nbsp;&lt;span&nbsp;class=&quot;gmail-HwtZe&quot;&nbsp;lang=&quot;en&quot;&gt;&lt;span&nbsp;class=&quot;gmail-jCAhz&nbsp;gmail-ChMk0b&quot;&gt;&lt;span&nbsp;class=&quot;gmail-ryNqvb&quot;&gt;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;to&nbsp;me.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;<br>
<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; #&nbsp;First,&nbsp;mark&nbsp;transactions&nbsp;accepted&nbsp;after&nbsp;aclX&nbsp;matched&lt;br&gt;#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; acl&nbsp;markSpecial&nbsp;annotate_transaction&nbsp;special=true&lt;br&gt;#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; http_access&nbsp;allow&nbsp;acl001&lt;br&gt;#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; ...&lt;br&gt;#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; http_access&nbsp;deny&nbsp;acl100&lt;br&gt;#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; http_access&nbsp;allow&nbsp;aclX&nbsp;markSpecial&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&nbsp;gmail_quote_container&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;вс,&nbsp;22&nbsp;дек.&nbsp;2024 г.&nbsp;в&nbsp;22:47,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;2024-12-22&nbsp;08:13,&nbsp;A.&nbsp;Pechenin&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;reason&nbsp;and&nbsp;solution&nbsp;were&nbsp;not&nbsp;simple&nbsp;and&nbsp;obvious&nbsp;at&nbsp;first&nbsp;glance.&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;have&nbsp;two&nbsp;providers&nbsp;accessing&nbsp;the&nbsp;gateway,&nbsp;the&nbsp;main&nbsp;and&nbsp;backup&nbsp;&lt;br&gt;<br>
&gt;&nbsp;channels,&nbsp;and&nbsp;automatic&nbsp;switching&nbsp;is&nbsp;configured&nbsp;when&nbsp;the&nbsp;connection&nbsp;on&nbsp;&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;main&nbsp;channel&nbsp;is&nbsp;lost.&lt;br&gt;<br>
&gt;&nbsp;To&nbsp;check,&nbsp;I&nbsp;switched&nbsp;the&nbsp;proxy&nbsp;server&nbsp;to&nbsp;the&nbsp;second&nbsp;channel&nbsp;and&nbsp;the&nbsp;&lt;br&gt;<br>
&gt;&nbsp;problem&nbsp;with&nbsp;partial&nbsp;unavailability&nbsp;of&nbsp;Google&nbsp;services&nbsp;was&nbsp;solved.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;returned&nbsp;it&nbsp;back,&nbsp;used&nbsp;a&nbsp;simple&nbsp;formula&nbsp;in&nbsp;the&nbsp;configuration&nbsp;file&nbsp;with&nbsp;&lt;br&gt;<br>
&gt;&nbsp;subsequent&nbsp;partial&nbsp;adjustment&nbsp;of&nbsp;ipfw.&lt;br&gt;<br>
&lt;br&gt;<br>
Glad&nbsp;you&nbsp;found&nbsp;a&nbsp;solution!&nbsp;Diagnosing&nbsp;problems&nbsp;related&nbsp;to&nbsp;CONNECT&nbsp;&lt;br&gt;<br>
tunnels&nbsp;is&nbsp;difficult&nbsp;because&nbsp;Squid&nbsp;(playing&nbsp;a&nbsp;role&nbsp;of&nbsp;a&nbsp;dumb&nbsp;TCP&nbsp;relay)&nbsp;&lt;br&gt;<br>
is&nbsp;often&nbsp;unaware&nbsp;of&nbsp;problems&nbsp;experienced&nbsp;by&nbsp;clients&nbsp;and&nbsp;origin&nbsp;servers.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;#&nbsp;Google&nbsp;via&nbsp;ISP2&lt;br&gt;<br>
&gt;&nbsp;acl&nbsp;google&nbsp;dstdomain&nbsp;.&lt;a&nbsp;href=&quot;http://google.com&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;google.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;tcp_outgoing_address&nbsp;REAL_IP_ISP2&nbsp;google&lt;br&gt;<br>
&lt;br&gt;<br>
Please&nbsp;note&nbsp;that&nbsp;the&nbsp;above&nbsp;configuration&nbsp;usually&nbsp;&quot;works&quot;&nbsp;but&nbsp;is&nbsp;&lt;br&gt;<br>
unreliable&nbsp;and&nbsp;unsupported:&nbsp;tcp_outgoing_address&nbsp;directive&nbsp;does&nbsp;not&nbsp;&lt;br&gt;<br>
support&nbsp;slow&nbsp;ACLs&nbsp;and&nbsp;your&nbsp;ACL&nbsp;named&nbsp;google&nbsp;is&nbsp;a&nbsp;slow&nbsp;ACL.&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;a&nbsp;more&nbsp;reliable&nbsp;solution,&nbsp;consider&nbsp;annotating&nbsp;google-matching&nbsp;&lt;br&gt;<br>
transaction&nbsp;at&nbsp;http_access&nbsp;check&nbsp;time&nbsp;and&nbsp;then&nbsp;using&nbsp;those&nbsp;annotations&nbsp;&lt;br&gt;<br>
at&nbsp;tcp_outgoing_address&nbsp;check&nbsp;time.&nbsp;For&nbsp;a&nbsp;somewhat&nbsp;related&nbsp;example,&nbsp;look&nbsp;&lt;br&gt;<br>
for&nbsp;&quot;markSpecial&quot;&nbsp;in&nbsp;squid.conf.documented&nbsp;or&nbsp;search&nbsp;this&nbsp;mailing&nbsp;list&nbsp;&lt;br&gt;<br>
archives&nbsp;for&nbsp;annotate_transaction&nbsp;discussions.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;сб,&nbsp;21&nbsp;дек.&nbsp;2024 г.&nbsp;в&nbsp;20:26,&nbsp;A.&nbsp;Pechenin&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:alexmrrc@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;alexmrrc@gmail.com&lt;/a&gt;&gt;:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; This&nbsp;week,&nbsp;when&nbsp;connecting&nbsp;users&nbsp;through&nbsp;a&nbsp;proxy&nbsp;server,&nbsp;some&nbsp;Google&lt;br&gt;<br>
&gt; &nbsp; &nbsp; services&nbsp;became&nbsp;inaccessible,&nbsp;such&nbsp;as&nbsp;Calendar,&nbsp;Translator,&nbsp;user&lt;br&gt;<br>
&gt; &nbsp; &nbsp; profile.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; When&nbsp;clicking&nbsp;on&nbsp;the&nbsp;services&nbsp;section&nbsp;in&nbsp;the&nbsp;browser&nbsp;on&nbsp;the&nbsp;Google&lt;br&gt;<br>
&gt; &nbsp; &nbsp; portal,&nbsp;the&nbsp;page&nbsp;does&nbsp;not&nbsp;open&nbsp;and&nbsp;then&nbsp;a&nbsp;connection&nbsp;error&nbsp;is&lt;br&gt;<br>
&gt; &nbsp; &nbsp; displayed.&nbsp;When&nbsp;directly&nbsp;going&nbsp;to&nbsp;the&nbsp;calendar&nbsp;section,&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; connection&nbsp;also&nbsp;hangs&nbsp;for&nbsp;a&nbsp;long&nbsp;time&nbsp;without&nbsp;loading&nbsp;the&nbsp;page.&nbsp;At&lt;br&gt;<br>
&gt; &nbsp; &nbsp; the&nbsp;same&nbsp;time,&nbsp;the&nbsp;Google&nbsp;home&nbsp;page,&nbsp;mail,&nbsp;search&nbsp;work.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Transparent&nbsp;proxying&nbsp;is&nbsp;not&nbsp;used.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Viewing&nbsp;the&nbsp;proxy&nbsp;server&nbsp;logs&nbsp;did&nbsp;not&nbsp;add&nbsp;any&nbsp;understanding,&nbsp;all&lt;br&gt;<br>
&gt; &nbsp; &nbsp; requests&nbsp;are&nbsp;processed&nbsp;correctly&nbsp;and&nbsp;no&nbsp;errors&nbsp;or&nbsp;prohibitions&nbsp;are&lt;br&gt;<br>
&gt; &nbsp; &nbsp; observed.&nbsp;There&nbsp;are&nbsp;no&nbsp;other&nbsp;problems&nbsp;with&nbsp;the&nbsp;unavailability&nbsp;of&nbsp;any&lt;br&gt;<br>
&gt; &nbsp; &nbsp; sites.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; When&nbsp;connecting&nbsp;directly&nbsp;(bypassing&nbsp;the&nbsp;proxy&nbsp;server),&nbsp;all&nbsp;Google&lt;br&gt;<br>
&gt; &nbsp; &nbsp; services&nbsp;work&nbsp;completely&nbsp;correctly.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; The&nbsp;platform&nbsp;on&nbsp;which&nbsp;the&nbsp;problem&nbsp;was&nbsp;suddenly&nbsp;discovered:&lt;br&gt;<br>
&gt; &nbsp; &nbsp; FreeBSD&nbsp;13.2-RELEASE-p9&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Squid&nbsp;6.6&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; A&nbsp;new&nbsp;separate&nbsp;server&nbsp;was&nbsp;deployed&nbsp;for&nbsp;objectivity&nbsp;and&nbsp;finding&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; cause,&nbsp;but&nbsp;the&nbsp;problem&nbsp;was&nbsp;also&nbsp;reproduced&nbsp;there,&nbsp;its&nbsp;platform.&lt;br&gt;<br>
&gt; &nbsp; &nbsp; FreeBSD&nbsp;13.4-RELEASE-p2&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Squid&nbsp;6.10&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; I&nbsp;tried&nbsp;using&nbsp;the&nbsp;default&nbsp;configuration&nbsp;file&nbsp;(recommended&nbsp;minimum&lt;br&gt;<br>
&gt; &nbsp; &nbsp; configuration)&nbsp;to&nbsp;eliminate&nbsp;the&nbsp;problem&nbsp;in&nbsp;my&nbsp;working&nbsp;squid.conf,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; but&nbsp;the&nbsp;problem&nbsp;remained&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; I&nbsp;repeat,&nbsp;the&nbsp;problem&nbsp;reproduced&nbsp;suddenly,&nbsp;no&nbsp;changes&nbsp;were&nbsp;made&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; the&nbsp;proxy&nbsp;server&nbsp;configuration&nbsp;on&nbsp;our&nbsp;side,&nbsp;no&nbsp;problems&nbsp;with&nbsp;Google&lt;br&gt;<br>
&gt; &nbsp; &nbsp; have&nbsp;arisen&nbsp;for&nbsp;many&nbsp;years.&nbsp;What&nbsp;should&nbsp;I&nbsp;pay&nbsp;attention&nbsp;to&nbsp;in&nbsp;the&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Squid&nbsp;configuration?&nbsp;Any&nbsp;idea&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
