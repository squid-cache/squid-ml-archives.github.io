<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&lt;div&gt;I&nbsp;want&nbsp;to&nbsp;write&nbsp;my&nbsp;own&nbsp;ICAP&nbsp;server,&nbsp;but&nbsp;all&nbsp;the&nbsp;sample&nbsp;code&nbsp;I&#39;ve&nbsp;found&nbsp;is&nbsp;failing,&nbsp;the&nbsp;majority&nbsp;with&nbsp;this&nbsp;error&nbsp;from&nbsp;squidclient:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;squidclient&nbsp;-h&nbsp;192.168.0.7&nbsp;-p&nbsp;1344&nbsp;icap://&lt;a&nbsp;href=&quot;http://192.168.0.7:1344/request_mod&quot;&gt;192.168.0.7:1344/request_mod&lt;/a&gt;&lt;br&gt;ICAP/1.0&nbsp;400&nbsp;Bad&nbsp;Request&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;And&nbsp;this&nbsp;error when&nbsp;accessed&nbsp;through&nbsp;Squid&nbsp;itself:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;ICAP&nbsp;protocol&nbsp;error.&lt;br&gt;&lt;br&gt;The&nbsp;system&nbsp;returned:&nbsp;[No&nbsp;Error]&lt;br&gt;&lt;br&gt;This&nbsp;means&nbsp;that&nbsp;some&nbsp;aspect&nbsp;of&nbsp;the&nbsp;ICAP&nbsp;communication&nbsp;failed.&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&#39;ve&nbsp;got&nbsp;this&nbsp;in&nbsp;my&nbsp;squid.conf:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#&nbsp;Enable&nbsp;ICAP&nbsp;for&nbsp;request&nbsp;and&nbsp;response&nbsp;modification&lt;br&gt;icap_enable&nbsp;on&lt;br&gt;icap_service&nbsp;service_req&nbsp;reqmod_precache&nbsp;icap://&lt;a&nbsp;href=&quot;http://192.168.0.7:1344/request_mod&quot;&gt;192.168.0.7:1344/request_mod&lt;/a&gt;&lt;br&gt;icap_service&nbsp;service_resp&nbsp;respmod_precache&nbsp;icap://&lt;a&nbsp;href=&quot;http://192.168.0.7:1344/response_mod&quot;&gt;192.168.0.7:1344/response_mod&lt;/a&gt;&lt;br&gt;&lt;br&gt;#&nbsp;ICAP&nbsp;adaptation&nbsp;rules&lt;br&gt;adaptation_access&nbsp;service_req&nbsp;allow&nbsp;all&lt;br&gt;adaptation_access&nbsp;service_resp&nbsp;allow&nbsp;all&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;I&#39;ve&nbsp;tried&nbsp;running&nbsp;both&nbsp;Python&nbsp;and&nbsp;Ruby&nbsp;servers&nbsp;taken&nbsp;from&nbsp;various&nbsp;places.&nbsp;A&nbsp;lot&nbsp;are&nbsp;logging&nbsp;that&nbsp;they&#39;ve&nbsp;received&nbsp;and&nbsp;replied&nbsp;to&nbsp;requests:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Received&nbsp;request:&nbsp;OPTIONS&nbsp;icap://&lt;a&nbsp;href=&quot;http://192.168.0.7:1344/request_mod&quot;&gt;192.168.0.7:1344/request_mod&lt;/a&gt;&nbsp;ICAP/1.0&lt;br&gt;Responded&nbsp;to&nbsp;OPTIONS&nbsp;request&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;servers&nbsp;are&nbsp;all&nbsp;listening,&nbsp;I&#39;ve&nbsp;checked&nbsp;that:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;$&nbsp;ss&nbsp;-antp&nbsp;|&nbsp;grep&nbsp;1344&lt;br&gt;LISTEN&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 4096&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:1344&quot;&gt;0.0.0.0:1344&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:*&nbsp; &nbsp; &nbsp;users:((&quot;ruby&quot;,pid=563029,fd=5))&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;closest&nbsp;I&#39;ve&nbsp;got&nbsp;is&nbsp;this&nbsp;one:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;a&nbsp;href=&quot;https://gist.github.com/digininja/a98b3567e0aeb218d37cdd337bb12f34&quot;&gt;https://gist.github.com/digininja/a98b3567e0aeb218d37cdd337bb12f34&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;It&nbsp;seems&nbsp;to&nbsp;be&nbsp;working&nbsp;as&nbsp;it&nbsp;sees&nbsp;the&nbsp;headers&nbsp;and&nbsp;says&nbsp;it&nbsp;has&nbsp;returned&nbsp;data:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Received&nbsp;request:&nbsp;REQMOD&nbsp;icap://&lt;a&nbsp;href=&quot;http://192.168.0.7:1344/request_mod&quot;&gt;192.168.0.7:1344/request_mod&lt;/a&gt;&nbsp;ICAP/1.0&lt;br&gt;Original&nbsp;Headers:&lt;br&gt;Host:&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.7:1344&quot;&gt;192.168.0.7:1344&lt;/a&gt;&lt;br&gt;Date:&nbsp;Fri,&nbsp;07&nbsp;Feb&nbsp;2025&nbsp;10:10:30&nbsp;GMT&lt;br&gt;Encapsulated:&nbsp;req-hdr=0,&nbsp;null-body=91&lt;br&gt;Preview:&nbsp;0&lt;br&gt;Allow:&nbsp;204,&nbsp;trailers&lt;br&gt;Modified&nbsp;request&nbsp;sent&nbsp;back&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;But&nbsp;I&nbsp;still&nbsp;get&nbsp;errors.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;What&nbsp;could&nbsp;be&nbsp;wrong?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Does&nbsp;someone&nbsp;have&nbsp;some&nbsp;example&nbsp;server&nbsp;code&nbsp;they&nbsp;know&nbsp;works&nbsp;that&nbsp;I&nbsp;can&nbsp;test&nbsp;to&nbsp;help&nbsp;debug&nbsp;it?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Robin&lt;/div&gt;&lt;/div&gt;<br>

</tt>
