<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;style&nbsp;type=&quot;text/css&quot;&nbsp;style=&quot;display:none;&quot;&gt;&lt;!--&nbsp;P&nbsp;{margin-top:0;margin-bottom:0;}&nbsp;--&gt;&lt;/style&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;style=&quot;font-size:12pt;color:#000000;font-family:Calibri,Helvetica,sans-serif;&quot;&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;&quot;EmojiFont&quot;,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&quot;&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;p&gt;Solution:&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;It&nbsp;is&nbsp;the&nbsp;error&nbsp;message&nbsp;&lt;span&gt;'TCP_DENIED/200&nbsp;0&nbsp;CONNECT&lt;/span&gt;'&nbsp;wich&nbsp;showed&nbsp;me&nbsp;the&nbsp;way.&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;Directive&nbsp;is&nbsp;too&nbsp;restrictive:&lt;/p&gt;<br>
&lt;p&gt;&lt;span&gt;http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;/span&gt;&lt;/p&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;&quot;EmojiFont&quot;,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&quot;&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;&quot;EmojiFont&quot;,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&quot;&nbsp;dir=&quot;ltr&quot;&gt;<br>
It&nbsp;works&nbsp;now&nbsp;with:&lt;br&gt;<br>
&lt;span&gt;http_access&nbsp;allow&nbsp;CONNECT&nbsp;safe_ports&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;&quot;EmojiFont&quot;,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&quot;&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;&quot;EmojiFont&quot;,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&quot;&nbsp;dir=&quot;ltr&quot;&gt;<br>
where&nbsp;safe&nbsp;ports&nbsp;are:&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;&quot;EmojiFont&quot;,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&quot;&nbsp;dir=&quot;ltr&quot;&gt;<br>
80,&nbsp;443,&nbsp;1025-65535&nbsp;(maybe&nbsp;too&nbsp;large)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;div&nbsp;style=&quot;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&quot;&gt;<br>
&lt;hr&nbsp;tabindex=&quot;-1&quot;&nbsp;style=&quot;display:inline-block;&nbsp;width:98%&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divRplyFwdMsg&quot;&nbsp;dir=&quot;ltr&quot;&gt;&lt;font&nbsp;face=&quot;Calibri,&nbsp;sans-serif&quot;&nbsp;color=&quot;#000000&quot;&nbsp;style=&quot;font-size:11pt&quot;&gt;&lt;b&gt;De&nbsp;:&lt;/b&gt;&nbsp;squid-users&nbsp;&lt;squid-users-bounces@lists.squid-cache.org&gt;&nbsp;de&nbsp;la&nbsp;part&nbsp;de&nbsp;BOISIAUD&nbsp;Jean-Yves&nbsp;&lt;jyboisiaud-ext@ecritel.net&gt;&lt;br&gt;<br>
&lt;b&gt;Envoyé&nbsp;:&lt;/b&gt;&nbsp;lundi&nbsp;24&nbsp;février&nbsp;2025&nbsp;16:38&lt;br&gt;<br>
&lt;b&gt;À&nbsp;:&lt;/b&gt;&nbsp;squid-users@lists.squid-cache.org&lt;br&gt;<br>
&lt;b&gt;Objet&nbsp;:&lt;/b&gt;&nbsp;[squid-users]&nbsp;ssl-bump&nbsp;with&nbsp;url_regex&lt;/font&gt;<br>
&lt;div&gt;&nbsp;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:&nbsp;12pt;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-family:&nbsp;Calibri,&nbsp;Helvetica,&nbsp;sans-serif,&nbsp;&quot;EmojiFont&quot;,&nbsp;&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,&nbsp;NotoColorEmoji,&nbsp;&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&nbsp;&quot;Android&nbsp;Emoji&quot;,&nbsp;EmojiSymbols;&quot;&gt;<br>
&lt;div&nbsp;id=&quot;divtagdefaultwrapper&quot;&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:rgb(0,0,0);&nbsp;font-family:Calibri,Helvetica,sans-serif,&quot;EmojiFont&quot;,&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,NotoColorEmoji,&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&quot;Android&nbsp;Emoji&quot;,EmojiSymbols&quot;&gt;<br>
&lt;p&gt;Hello,&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;I&nbsp;am&nbsp;using&nbsp;Squid&nbsp;5.7&nbsp;on&nbsp;a&nbsp;Debian&nbsp;12&nbsp;system.&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;I&nbsp;would&nbsp;like&nbsp;to&nbsp;grant&nbsp;only&nbsp;some&nbsp;given&nbsp;URL&nbsp;path&nbsp;for&nbsp;a&nbsp;site&nbsp;using&nbsp;HTTPS.&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;following&nbsp;configuration:&lt;/p&gt;<br>
&lt;p&gt;...&lt;/p&gt;<br>
&lt;div&gt;http_port&nbsp;3128&nbsp;ssl-bump&nbsp;tcpkeepalive=60,30,3&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cert=/etc/squid/certs/signingCA.crt&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;key=/etc/squid/certs/signingCA.key&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tls-cafile=/etc/squid/certs/chain.pem&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;generate-host-certificates=on&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;dynamic_cert_mem_cache_size=20MB&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cipher=HIGH:MEDIUM:!LOW:!RC4:!SEED:!IDEA:!3DES:!MD5:!EXP:!PSK:!DSS&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;options=NO_TLSv1,NO_SSLv3&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;tls-dh=prime256v1:/etc/squid/certs/dhparam.pem&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;p&gt;&lt;span&gt;acl&nbsp;intermediate_fetching&nbsp;transaction_initiator&nbsp;certificate-fetching&lt;/span&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;&lt;span&gt;acl&nbsp;SSLBumpSites&nbsp;ssl::server_name&nbsp;&lt;a&nbsp;href=&quot;http://www.example.com&quot;&nbsp;class=&quot;OWAAutoLink&quot;&nbsp;id=&quot;LPlnk41316&quot;&nbsp;previewremoved=&quot;true&quot;&gt;<br>
www.example.com&lt;/a&gt;&lt;br&gt;<br>
&lt;/span&gt;&lt;/p&gt;<br>
&lt;p&gt;acl&nbsp;server&nbsp;src&nbsp;192.168.1.1&lt;/p&gt;<br>
&lt;p&gt;acl&nbsp;path&nbsp;urlpath_regex&nbsp;^/valid_path/$&lt;/p&gt;<br>
&lt;p&gt;...&lt;/p&gt;<br>
&lt;p&gt;http_access&nbsp;allow&nbsp;&nbsp;src&nbsp;path&lt;/p&gt;<br>
&lt;p&gt;...&lt;/p&gt;<br>
&lt;div&gt;ssl_bump&nbsp;peek&nbsp;all&lt;br&gt;<br>
ssl_bump&nbsp;bump&nbsp;SSLBumpSites&lt;br&gt;<br>
ssl_bump&nbsp;slice&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
http_access&nbsp;deny&nbsp;all&lt;br&gt;<br>
&lt;br&gt;<br>
cache&nbsp;deny&nbsp;all&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Works&nbsp;with&nbsp;http&nbsp;(curl&nbsp;&lt;a&nbsp;href=&quot;http://www.example.com&quot;&nbsp;class=&quot;OWAAutoLink&quot;&nbsp;id=&quot;LPlnk94300&quot;&nbsp;previewremoved=&quot;true&quot;&gt;<br>
http://www.example.com&lt;/a&gt;/valid_path/):&lt;/div&gt;<br>
&lt;div&gt;-&nbsp;&lt;span&gt;TCP_MISS/200&nbsp;467686&nbsp;GET&nbsp;http://www.example.com/valid_path/&nbsp;-&nbsp;HIER_DIRECT/151.101.122.132&lt;/span&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Does&nbsp;not&nbsp;work&nbsp;with&nbsp;HTTPS&nbsp;(curl&nbsp;&lt;a&nbsp;href=&quot;https://www.example.com/valid_path/&quot;&nbsp;class=&quot;OWAAutoLink&quot;&nbsp;id=&quot;LPlnk326313&quot;&nbsp;previewremoved=&quot;true&quot;&gt;<br>
https://www.example.com/valid_path/&lt;/a&gt;):&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;-&nbsp;TCP_DENIED/200&nbsp;0&nbsp;CONNECT&nbsp;www.example.com:443&nbsp;-&nbsp;HIER_NONE/-&nbsp;-&nbsp;bump<br>
&lt;div&gt;-&nbsp;NONE_NONE/403&nbsp;3894&nbsp;GET&nbsp;https://www.example.com/valid_path/&nbsp;-&nbsp;HIER_NONE/-&nbsp;text/html&nbsp;-&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;style=&quot;font-size:12pt;&nbsp;color:rgb(0,0,0);&nbsp;font-family:Calibri,Helvetica,sans-serif,&quot;EmojiFont&quot;,&quot;Apple&nbsp;Color&nbsp;Emoji&quot;,&quot;Segoe&nbsp;UI&nbsp;Emoji&quot;,NotoColorEmoji,&quot;Segoe&nbsp;UI&nbsp;Symbol&quot;,&quot;Android&nbsp;Emoji&quot;,EmojiSymbols&quot;&gt;<br>
Other&nbsp;https&nbsp;requests&nbsp;work&nbsp;fine:<br>
&lt;p&gt;-&nbsp;&lt;span&gt;TCP_TUNNEL/200&lt;/span&gt;&nbsp;-&nbsp;splice&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;What&nbsp;is&nbsp;wrong&nbsp;in&nbsp;my&nbsp;configuration&nbsp;?&lt;/p&gt;<br>
&lt;p&gt;&lt;br&gt;<br>
&lt;/p&gt;<br>
&lt;p&gt;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;help.&lt;/p&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
