<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello&nbsp;Alex,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks&nbsp;for&nbsp;your&nbsp;reply!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&nbsp;gmail_quote_container&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Mon,&nbsp;Mar&nbsp;3,&nbsp;2025&nbsp;at&nbsp;3:44 PM&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;2025-03-02&nbsp;15:47,&nbsp;Lubos&nbsp;Uhliarik&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid10|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid10|&nbsp;assertion&nbsp;failed:&nbsp;Queue.cc:388:&nbsp;&quot;EX&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
Squid&nbsp;v6&nbsp;has&nbsp;a&nbsp;few&nbsp;changes&nbsp;that&nbsp;affect&nbsp;SMP&nbsp;startup&nbsp;and&nbsp;shutdown&nbsp;&lt;br&gt;<br>
sequences.&nbsp;Since&nbsp;you&nbsp;have&nbsp;ruled&nbsp;out&nbsp;upgrading&nbsp;to&nbsp;a&nbsp;supported&nbsp;version,&nbsp;I&nbsp;&lt;br&gt;<br>
would&nbsp;start&nbsp;by&nbsp;turning&nbsp;on&nbsp;shared_memory_locking&nbsp;in&nbsp;hope&nbsp;that&nbsp;the&nbsp;problem&nbsp;&lt;br&gt;<br>
lies&nbsp;in&nbsp;a&nbsp;problematic&nbsp;OS&nbsp;configuration.&lt;br&gt;<br>
&lt;br&gt;<br>
BTW,&nbsp;that&nbsp;bogus&nbsp;exception&nbsp;text&nbsp;&quot;EX&quot;&nbsp;is&nbsp;a&nbsp;bug.&nbsp;It&nbsp;was&nbsp;fixed&nbsp;in&nbsp;Squid&nbsp;v6.&nbsp;&lt;br&gt;<br>
Squid&nbsp;v5.10&nbsp;has&nbsp;a&nbsp;backport&nbsp;of&nbsp;that&nbsp;fix&nbsp;(commit&nbsp;31f20fda).&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;p&gt;I&nbsp;was&nbsp;able&nbsp;to&nbsp;resolve&nbsp;the&nbsp;issue,&nbsp;so&nbsp;in&nbsp;case&nbsp;someone&nbsp;encounters&nbsp;the&nbsp;same&nbsp;backtrace,&nbsp;&lt;br&gt;here’s&nbsp;what&nbsp;happened:&nbsp;&lt;br&gt;&lt;br&gt;In&nbsp;the&nbsp;end,&nbsp;we&nbsp;discovered&nbsp;that&nbsp;a&nbsp;customer&nbsp;was&nbsp;running&nbsp;two&nbsp;Squid&nbsp;instances&nbsp;on&nbsp;the&nbsp;same&lt;br&gt;machine—one&nbsp;SMP&nbsp;instance&nbsp;with&nbsp;16&nbsp;workers&nbsp;and&nbsp;one&nbsp;single-process&nbsp;instance.&nbsp;For&nbsp;a&nbsp;long&nbsp;&lt;br&gt;time,&nbsp;the&nbsp;single-process&nbsp;Squid&nbsp;instance&nbsp;would&nbsp;start&nbsp;first&nbsp;by&nbsp;chance,&nbsp;followed&nbsp;by&nbsp;&lt;br&gt;the&nbsp;SMP&nbsp;instance,&nbsp;which&nbsp;overwrote&nbsp;the&nbsp;shared&nbsp;memory.&nbsp;However,&nbsp;at&nbsp;some&nbsp;point,&nbsp;&lt;br&gt;the&nbsp;SMP&nbsp;instance&nbsp;started&nbsp;first,&nbsp;and&nbsp;when&nbsp;the&nbsp;single-process&nbsp;Squid&nbsp;instance&nbsp;started&nbsp;&lt;br&gt;second,&nbsp;it&nbsp;overwrote&nbsp;the&nbsp;SHM&nbsp;memory&nbsp;(resetting&nbsp;theProcessCount&nbsp;to&nbsp;1)&nbsp;of&nbsp;the&nbsp;&lt;br&gt;SMP&nbsp;instance,&nbsp;causing&nbsp;it&nbsp;to&nbsp;crash&nbsp;with&nbsp;the&nbsp;mentioned&nbsp;backtrace.&lt;br&gt;&lt;br&gt;The&nbsp;fix&nbsp;is&nbsp;simple—just&nbsp;specify&nbsp;a&nbsp;service&nbsp;name&nbsp;using&nbsp;the&nbsp;-n&nbsp;Squid&nbsp;parameter&nbsp;for&nbsp;&lt;br&gt;one&nbsp;of&nbsp;the&nbsp;Squid&nbsp;instances.&lt;br&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;We&nbsp;have&nbsp;recently&nbsp;experienced&nbsp;Squid&nbsp;crashes&nbsp;when&nbsp;running&nbsp;Squid&nbsp;in&nbsp;SMP&lt;br&gt;<br>
&gt;&nbsp;mode&nbsp;with&nbsp;16&nbsp;workers&nbsp;(workers&nbsp;16).&nbsp;While&nbsp;reviewing&nbsp;the&nbsp;Squid&nbsp;cache&lt;br&gt;<br>
&gt;&nbsp;logs,&nbsp;I&nbsp;noticed&nbsp;that&nbsp;assertion&nbsp;failures&nbsp;sometimes&nbsp;occurred&nbsp;(usually&lt;br&gt;<br>
&gt;&nbsp;during&nbsp;the&nbsp;shutdown&nbsp;process):&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid10|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid10|&nbsp;assertion&nbsp;failed:&nbsp;Queue.cc:388:&nbsp;&quot;EX&quot;&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid7|&nbsp;Squid&nbsp;plugin&nbsp;modules&nbsp;loaded:&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid7|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid7|&nbsp;assertion&nbsp;failed:&nbsp;Queue.cc:388:&nbsp;&quot;EX&quot;&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid4|&nbsp;Finished&nbsp;loading&nbsp;MIME&nbsp;types&nbsp;and&nbsp;icons.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid4|&nbsp;HTCP&nbsp;Disabled.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid4|&nbsp;Squid&nbsp;plugin&nbsp;modules&nbsp;loaded:&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid4|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid4|&nbsp;assertion&nbsp;failed:&nbsp;Queue.cc:388:&nbsp;&quot;EX&quot;&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid3|&nbsp;Finished&nbsp;loading&nbsp;MIME&nbsp;types&nbsp;and&nbsp;icons.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid2|&nbsp;Finished&nbsp;loading&nbsp;MIME&nbsp;types&nbsp;and&nbsp;icons.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:44&nbsp;kid5|&nbsp;Finished&nbsp;loading&nbsp;MIME&nbsp;types&nbsp;and&nbsp;icons.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid3|&nbsp;HTCP&nbsp;Disabled.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid2|&nbsp;HTCP&nbsp;Disabled.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid5|&nbsp;HTCP&nbsp;Disabled.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid5|&nbsp;Squid&nbsp;plugin&nbsp;modules&nbsp;loaded:&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid5|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid2|&nbsp;Squid&nbsp;plugin&nbsp;modules&nbsp;loaded:&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid2|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid3|&nbsp;Squid&nbsp;plugin&nbsp;modules&nbsp;loaded:&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid3|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid5|&nbsp;assertion&nbsp;failed:&nbsp;Queue.cc:388:&nbsp;&quot;EX&quot;&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid2|&nbsp;assertion&nbsp;failed:&nbsp;Queue.cc:388:&nbsp;&quot;EX&quot;&lt;br&gt;<br>
&gt;&nbsp;2024/10/16&nbsp;17:52:45&nbsp;kid3|&nbsp;assertion&nbsp;failed:&nbsp;Queue.cc:388:&nbsp;&quot;EX&quot;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;observed&nbsp;that&nbsp;each&nbsp;&quot;kid&quot;&nbsp;(worker)&nbsp;crashed&nbsp;once,&nbsp;and&nbsp;then&nbsp;Squid&lt;br&gt;<br>
&gt;&nbsp;successfully&nbsp;stopped&nbsp;and&nbsp;restarted.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Recently,&nbsp;however,&nbsp;the&nbsp;Squid&nbsp;crashes&nbsp;started&nbsp;occurring&nbsp;during&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;start&nbsp;process.&nbsp;The&nbsp;crashes&nbsp;now&nbsp;happen&nbsp;multiple&nbsp;times&nbsp;per&nbsp;worker,&lt;br&gt;<br>
&gt;&nbsp;causing&nbsp;Squid&nbsp;to&nbsp;enter&nbsp;a&nbsp;crash&nbsp;loop.&nbsp;This&nbsp;continues&nbsp;until&nbsp;the&nbsp;hard&lt;br&gt;<br>
&gt;&nbsp;drive&nbsp;fills&nbsp;up&nbsp;with&nbsp;core&nbsp;dumps:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid4|&nbsp;assertion&nbsp;failed:&nbsp;Queue.cc:388:&nbsp;&quot;EX&quot;&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Current&nbsp;Directory&nbsp;is&nbsp;/&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Starting&nbsp;Squid&nbsp;Cache&nbsp;version&nbsp;5.5&nbsp;for&lt;br&gt;<br>
&gt;&nbsp;x86_64-redhat-linux-gnu...&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Service&nbsp;Name:&nbsp;squid&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Process&nbsp;ID&nbsp;18779&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Process&nbsp;Roles:&nbsp;worker&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;With&nbsp;65536&nbsp;file&nbsp;descriptors&nbsp;available&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Initializing&nbsp;IP&nbsp;Cache...&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;DNS&nbsp;Socket&nbsp;created&nbsp;at&nbsp;[::],&nbsp;FD&nbsp;13&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;DNS&nbsp;Socket&nbsp;created&nbsp;at&nbsp;0.0.0.0,&nbsp;FD&nbsp;14&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Adding&nbsp;nameserver&nbsp;127.0.0.1&nbsp;from&nbsp;squid.conf&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Logfile:&nbsp;opening&nbsp;log&nbsp;/var/log/squid/access.log&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;WARNING:&nbsp;log&nbsp;name&nbsp;now&nbsp;starts&nbsp;with&nbsp;a&nbsp;module&lt;br&gt;<br>
&gt;&nbsp;name.&nbsp;Use&nbsp;&#39;stdio:/var/log/squid/access.log&#39;&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Local&nbsp;cache&nbsp;digest&nbsp;enabled;&nbsp;rebuild/rewrite&lt;br&gt;<br>
&gt;&nbsp;every&nbsp;3600/3600&nbsp;sec&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Store&nbsp;logging&nbsp;disabled&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Swap&nbsp;maxSize&nbsp;0&nbsp;+&nbsp;262144&nbsp;KB,&nbsp;estimated&nbsp;20164&nbsp;objects&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Target&nbsp;number&nbsp;of&nbsp;buckets:&nbsp;1008&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Using&nbsp;8192&nbsp;Store&nbsp;buckets&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Max&nbsp;Mem &nbsp;size:&nbsp;262144&nbsp;KB&nbsp;[shared]&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Max&nbsp;Swap&nbsp;size:&nbsp;0&nbsp;KB&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Using&nbsp;Least&nbsp;Load&nbsp;store&nbsp;dir&nbsp;selection&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Current&nbsp;Directory&nbsp;is&nbsp;/&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Finished&nbsp;loading&nbsp;MIME&nbsp;types&nbsp;and&nbsp;icons.&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;HTCP&nbsp;Disabled.&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Squid&nbsp;plugin&nbsp;modules&nbsp;loaded:&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;Adaptation&nbsp;support&nbsp;is&nbsp;off.&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid10|&nbsp;assertion&nbsp;failed:&nbsp;Queue.cc:388:&nbsp;&quot;EX&quot;&lt;br&gt;<br>
&gt;&nbsp;2025/02/18&nbsp;10:17:17&nbsp;kid7|&nbsp;Current&nbsp;Directory&nbsp;is&nbsp;/&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;investigated&nbsp;the&nbsp;core&nbsp;dump,&nbsp;and&nbsp;the&nbsp;code&nbsp;where&nbsp;Squid&nbsp;is&nbsp;crashing&nbsp;is&lt;br&gt;<br>
&gt;&nbsp;as&nbsp;follows:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;#0 &nbsp;0x00007f77b288ba6c&nbsp;in&nbsp;__pthread_kill_implementation&nbsp;()&nbsp;from&nbsp;/lib64/libc.so.6&lt;br&gt;<br>
&gt;&nbsp;Missing&nbsp;separate&nbsp;debuginfos,&nbsp;use:&nbsp;dnf&nbsp;debuginfo-install&lt;br&gt;<br>
&gt;&nbsp;glibc-2.34-125.el9_5.1.x86_64&nbsp;keyutils-libs-1.6.3-1.el9.x86_64&lt;br&gt;<br>
&gt;&nbsp;krb5-libs-1.21.1-4.el9_5.x86_64&nbsp;libcap-2.48-9.el9_2.x86_64&lt;br&gt;<br>
&gt;&nbsp;libcom_err-1.46.5-5.el9.x86_64&nbsp;libecap-1.0.1-10.el9.x86_64&lt;br&gt;<br>
&gt;&nbsp;libgcc-11.5.0-2.el9.x86_64&nbsp;libgcrypt-1.10.0-11.el9.x86_64&lt;br&gt;<br>
&gt;&nbsp;libgpg-error-1.42-5.el9.x86_64&nbsp;libselinux-3.6-1.el9.x86_64&lt;br&gt;<br>
&gt;&nbsp;libstdc++-11.5.0-2.el9.x86_64&nbsp;libtool-ltdl-2.4.6-46.el9.x86_64&lt;br&gt;<br>
&gt;&nbsp;libzstd-1.5.1-2.el9.x86_64&nbsp;lz4-libs-1.9.3-5.el9.x86_64&lt;br&gt;<br>
&gt;&nbsp;openssl-libs-3.2.2-6.el9_5.x86_64&nbsp;pcre2-10.40-6.el9.x86_64&lt;br&gt;<br>
&gt;&nbsp;sssd-client-2.9.5-4.el9_5.4.x86_64&nbsp;systemd-libs-252-46.el9_5.2.x86_64&lt;br&gt;<br>
&gt;&nbsp;xz-libs-5.2.5-8.el9_0.x86_64&nbsp;zlib-1.2.11-40.el9.x86_64&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;bt&lt;br&gt;<br>
&gt;&nbsp;#0 &nbsp;0x00007f77b288ba6c&nbsp;in&nbsp;__pthread_kill_implementation&nbsp;()&nbsp;from&nbsp;/lib64/libc.so.6&lt;br&gt;<br>
&gt;&nbsp;#1 &nbsp;0x00007f77b283e686&nbsp;in&nbsp;raise&nbsp;()&nbsp;from&nbsp;/lib64/libc.so.6&lt;br&gt;<br>
&gt;&nbsp;#2 &nbsp;0x00007f77b2828833&nbsp;in&nbsp;abort&nbsp;()&nbsp;from&nbsp;/lib64/libc.so.6&lt;br&gt;<br>
&gt;&nbsp;#3 &nbsp;0x0000559bbb412a9d&nbsp;in&nbsp;xassert&nbsp;(msg=&lt;optimized&nbsp;out&gt;,&lt;br&gt;<br>
&gt;&nbsp;file=&lt;optimized&nbsp;out&gt;,&nbsp;line=&lt;optimized&nbsp;out&gt;)&nbsp;at&lt;br&gt;<br>
&gt;&nbsp;/usr/src/debug/squid-5.5-14.el9_5.3.x86_64/src/debug.cc:624&lt;br&gt;<br>
&gt;&nbsp;#4 &nbsp;0x0000559bbb7549f7&nbsp;in&nbsp;Ipc::MultiQueue::reader&nbsp;(processId=3,&lt;br&gt;<br>
&gt;&nbsp;this=0x559bbccbf6e0)&nbsp;at&nbsp;ipc/Queue.cc:388&lt;br&gt;<br>
&gt;&nbsp;#5 &nbsp;Ipc::MultiQueue::localReader&nbsp;(this=0x559bbccbf6e0)&nbsp;at&nbsp;ipc/Queue.cc:408&lt;br&gt;<br>
&gt;&nbsp;#6 &nbsp;0x0000559bbb74c192&nbsp;in&nbsp;Ipc::BaseMultiQueue::localReader&lt;br&gt;<br>
&gt;&nbsp;(this=&lt;optimized&nbsp;out&gt;)&nbsp;at&nbsp;ipc/Queue.cc:195&lt;br&gt;<br>
&gt;&nbsp;#7 &nbsp;Ipc::BaseMultiQueue::clearAllReaderSignals&nbsp;(this=&lt;optimized&nbsp;out&gt;)&lt;br&gt;<br>
&gt;&nbsp;at&nbsp;ipc/Queue.cc:155&lt;br&gt;<br>
&gt;&nbsp;#8 &nbsp;0x0000559bbb486724&nbsp;in&nbsp;CollapsedForwarding::HandleNewDataAtStart&nbsp;()&lt;br&gt;<br>
&gt;&nbsp;at&nbsp;/usr/src/debug/squid-5.5-14.el9_5.3.x86_64/src/CollapsedForwarding.cc:151&lt;br&gt;<br>
&gt;&nbsp;#9 &nbsp;0x0000559bbb6aa50b&nbsp;in&nbsp;AsyncCallQueue::fireNext&lt;br&gt;<br>
&gt;&nbsp;(this=this@entry=0x559bbccd18a0)&nbsp;at&nbsp;base/../../src/base/RefCount.h:73&lt;br&gt;<br>
&gt;&nbsp;#10&nbsp;0x0000559bbb6aa89a&nbsp;in&nbsp;AsyncCallQueue::fire&nbsp;(this=0x559bbccd18a0)&lt;br&gt;<br>
&gt;&nbsp;at&nbsp;base/AsyncCallQueue.cc:43&lt;br&gt;<br>
&gt;&nbsp;#11&nbsp;0x0000559bbb490da1&nbsp;in&nbsp;EventLoop::dispatchCalls&lt;br&gt;<br>
&gt;&nbsp;(this=0x7fff2d084b90)&nbsp;at&lt;br&gt;<br>
&gt;&nbsp;/usr/src/debug/squid-5.5-14.el9_5.3.x86_64/src/EventLoop.cc:144&lt;br&gt;<br>
&gt;&nbsp;#12&nbsp;EventLoop::runOnce&nbsp;(this=0x7fff2d084b90)&nbsp;at&lt;br&gt;<br>
&gt;&nbsp;/usr/src/debug/squid-5.5-14.el9_5.3.x86_64/src/EventLoop.cc:109&lt;br&gt;<br>
&gt;&nbsp;#13&nbsp;0x0000559bbb5929a8&nbsp;in&nbsp;EventLoop::run&nbsp;(this=0x7fff2d084b90)&nbsp;at&lt;br&gt;<br>
&gt;&nbsp;/usr/src/debug/squid-5.5-14.el9_5.3.x86_64/src/EventLoop.cc:83&lt;br&gt;<br>
&gt;&nbsp;#14&nbsp;SquidMain&nbsp;(argc=argc@entry=5,&nbsp;argv=argv@entry=0x7fff2d084ea8)&nbsp;at&lt;br&gt;<br>
&gt;&nbsp;/usr/src/debug/squid-5.5-14.el9_5.3.x86_64/src/main.cc:1716&lt;br&gt;<br>
&gt;&nbsp;#15&nbsp;0x0000559bbb436086&nbsp;in&nbsp;SquidMainSafe&nbsp;(argv=0x7fff2d084ea8,&nbsp;argc=5)&lt;br&gt;<br>
&gt;&nbsp;at&nbsp;/usr/src/debug/squid-5.5-14.el9_5.3.x86_64/src/main.cc:1403&lt;br&gt;<br>
&gt;&nbsp;#16&nbsp;main&nbsp;(argc=5,&nbsp;argv=0x7fff2d084ea8)&nbsp;at&lt;br&gt;<br>
&gt;&nbsp;/usr/src/debug/squid-5.5-14.el9_5.3.x86_64/src/main.cc:1391&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;f&nbsp;4&lt;br&gt;<br>
&gt;&nbsp;#4 &nbsp;0x0000559bbb7549f7&nbsp;in&nbsp;Ipc::MultiQueue::reader&nbsp;(processId=3,&lt;br&gt;<br>
&gt;&nbsp;this=0x559bbccbf6e0)&nbsp;at&nbsp;ipc/Queue.cc:388&lt;br&gt;<br>
&gt;&nbsp;388 &nbsp; &nbsp; &nbsp; &nbsp;assert(validProcessId(processId));&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;383 &nbsp; &nbsp;}&lt;br&gt;<br>
&gt;&nbsp;384&lt;br&gt;<br>
&gt;&nbsp;385 &nbsp; &nbsp;const&nbsp;Ipc::QueueReader&nbsp;&amp;&lt;br&gt;<br>
&gt;&nbsp;386 &nbsp; &nbsp;Ipc::MultiQueue::reader(const&nbsp;int&nbsp;processId)&nbsp;const&lt;br&gt;<br>
&gt;&nbsp;387 &nbsp; &nbsp;{&lt;br&gt;<br>
&gt;&nbsp;388 &nbsp; &nbsp; &nbsp; &nbsp;assert(validProcessId(processId));&lt;br&gt;<br>
&gt;&nbsp;389 &nbsp; &nbsp; &nbsp; &nbsp;const&nbsp;int&nbsp;index&nbsp;=&nbsp;processId&nbsp;-&nbsp;metadata-&gt;theProcessIdOffset;&lt;br&gt;<br>
&gt;&nbsp;390 &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;readers-&gt;theReaders[index];&lt;br&gt;<br>
&gt;&nbsp;391 &nbsp; &nbsp;}&lt;br&gt;<br>
&gt;&nbsp;392&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;p&nbsp;processId&lt;br&gt;<br>
&gt;&nbsp;$1&nbsp;=&nbsp;3&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;p&nbsp;metadata&lt;br&gt;<br>
&gt;&nbsp;$15&nbsp;=&nbsp;{&lt;RefCount&lt;Ipc::Mem::Object&lt;Ipc::MultiQueue::Metadata&gt;&nbsp;&gt;&gt;&nbsp;=&nbsp;{p_&lt;br&gt;<br>
&gt;&nbsp;=&nbsp;0x559bbccd9f30},&nbsp;&lt;No&nbsp;data&nbsp;fields&gt;}&nbsp;(gdb)&nbsp;p&nbsp;*metadata.p_&lt;br&gt;<br>
&gt;&nbsp;$16&nbsp;=&nbsp;{&lt;Lock&gt;&nbsp;=&nbsp;{_vptr.Lock&nbsp;=&nbsp;0x559bbb96ea30&nbsp;&lt;vtable&nbsp;for&lt;br&gt;<br>
&gt;&nbsp;Ipc::Mem::Object&lt;Ipc::MultiQueue::Metadata&gt;+64&gt;,&nbsp;count_&nbsp;=&nbsp;1},&lt;br&gt;<br>
&gt; &nbsp; &nbsp;_vptr.Object&nbsp;=&nbsp;0x559bbb96ea08&nbsp;&lt;vtable&nbsp;for&lt;br&gt;<br>
&gt;&nbsp;Ipc::Mem::Object&lt;Ipc::MultiQueue::Metadata&gt;+24&gt;,&nbsp;theSegment&nbsp;=&nbsp;{theFD&nbsp;=&lt;br&gt;<br>
&gt;&nbsp;9,&nbsp;theName&nbsp;=&nbsp;{static&nbsp;npos&nbsp;=&nbsp;18446744073709551615,&nbsp;size_&nbsp;=&nbsp;40,&nbsp;len_&nbsp;=&lt;br&gt;<br>
&gt;&nbsp;23,&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; &nbsp;static&nbsp;SizeMax_&nbsp;=&nbsp;196607,&nbsp;buf_&nbsp;=&nbsp;0x559bbccbc460&lt;br&gt;<br>
&gt;&nbsp;&quot;/squid-cf__metadata.shm&quot;},&nbsp;theMem&nbsp;=&nbsp;0x7f77b3720000,&nbsp;theSize&nbsp;=&nbsp;8,&lt;br&gt;<br>
&gt;&nbsp;theReserved&nbsp;=&nbsp;0,&nbsp;doUnlink&nbsp;=&nbsp;false},&nbsp;theObject&nbsp;=&nbsp;0x7f77b3720000}&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;p&nbsp;metadata.p_-&gt;theObject&lt;br&gt;<br>
&gt;&nbsp;$17&nbsp;=&nbsp;(Ipc::MultiQueue::Metadata&nbsp;*)&nbsp;0x7f77b3720000&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;p&nbsp;*metadata.p_-&gt;theObject&lt;br&gt;<br>
&gt;&nbsp;$18&nbsp;=&nbsp;{theProcessCount&nbsp;=&nbsp;0,&nbsp;theProcessIdOffset&nbsp;=&nbsp;0}&lt;br&gt;<br>
&gt;&nbsp;(gdb)&nbsp;p&nbsp;metadata.p_-&gt;theObject-&gt;theProcessIdOffset&lt;br&gt;<br>
&gt;&nbsp;$19&nbsp;=&nbsp;0&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp;From&nbsp;this&nbsp;investigation,&nbsp;it&nbsp;appears&nbsp;that&nbsp;the&nbsp;theProcessCount&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;theProcessIdOffset&nbsp;variables&nbsp;are&nbsp;set&nbsp;to&nbsp;0.&nbsp;However,&nbsp;I&nbsp;don&#39;t&nbsp;think&nbsp;this&lt;br&gt;<br>
&gt;&nbsp;is&nbsp;actually&nbsp;the&nbsp;case,&nbsp;as&nbsp;these&nbsp;variables&nbsp;should&nbsp;be&nbsp;shared&nbsp;in&nbsp;SHM,&nbsp;and&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;content&nbsp;of&nbsp;those&nbsp;files&nbsp;was&nbsp;not&nbsp;included&nbsp;in&nbsp;the&nbsp;core&nbsp;dump.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Have&nbsp;any&nbsp;of&nbsp;you&nbsp;experienced&nbsp;similar&nbsp;crashes?&nbsp;I&nbsp;was&nbsp;trying&nbsp;to&nbsp;search&lt;br&gt;<br>
&gt;&nbsp;for&nbsp;a&nbsp;similar&nbsp;issue&nbsp;but&nbsp;without&nbsp;success.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;backtrace&nbsp;above&nbsp;is&nbsp;from&nbsp;Squid&nbsp;version&nbsp;5.5.&nbsp;While&nbsp;I&nbsp;understand&nbsp;it&lt;br&gt;<br>
&gt;&nbsp;is&nbsp;an&nbsp;older&nbsp;version,&nbsp;I&nbsp;believe&nbsp;the&nbsp;IPC&nbsp;code&nbsp;hasn’t&nbsp;changed&nbsp;much&nbsp;since&lt;br&gt;<br>
&gt;&nbsp;then.&nbsp;Unfortunately,&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;reproducer&nbsp;or&nbsp;the&nbsp;possibility&nbsp;of&lt;br&gt;<br>
&gt;&nbsp;upgrading&nbsp;Squid&nbsp;to&nbsp;a&nbsp;newer&nbsp;version&nbsp;on&nbsp;the&nbsp;running&nbsp;system&nbsp;for&nbsp;testing.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;It&#39;s&nbsp;also&nbsp;worth&nbsp;noting&nbsp;that&nbsp;after&nbsp;restarting&nbsp;Squid,&nbsp;which&nbsp;was&nbsp;stuck&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;crash&nbsp;loop,&nbsp;Squid&nbsp;started&nbsp;normally.&nbsp;I&nbsp;suspect&nbsp;it&nbsp;could&nbsp;be&nbsp;caused&lt;br&gt;<br>
&gt;&nbsp;by&nbsp;uninitialized&nbsp;SHM&nbsp;or&nbsp;something&nbsp;similar.&nbsp;What&nbsp;do&nbsp;you&nbsp;think?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Would&nbsp;it&nbsp;help&nbsp;if&nbsp;I&nbsp;set&nbsp;some&nbsp;debug&nbsp;options&nbsp;and&nbsp;share&nbsp;the&nbsp;output&nbsp;with&lt;br&gt;<br>
&gt;&nbsp;you?&nbsp;I&nbsp;was&nbsp;considering&nbsp;something&nbsp;like:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;debug_options&nbsp;ALL,1&nbsp;1,9&nbsp;54,9&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Thanks&nbsp;in&nbsp;advance&nbsp;for&nbsp;your&nbsp;response.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Regards,&lt;br&gt;<br>
&gt;&nbsp;Lubos&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Lubos &lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
