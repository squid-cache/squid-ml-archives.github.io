<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello&nbsp;everybody,&lt;br&gt;&lt;br&gt;I&nbsp;have&nbsp;configured&nbsp;Squid&nbsp;to&nbsp;use&nbsp;Kerberos&nbsp;authentication&nbsp;and&nbsp;employed&nbsp;ext_kerberos_ldap_group_acl&nbsp;to&nbsp;limit&nbsp;HTTP&nbsp;access.&nbsp;This&nbsp;setup&nbsp;works&nbsp;fine&nbsp;in&nbsp;most&nbsp;cases.&nbsp;However,&nbsp;randomly&nbsp;(and&nbsp;rarely),&nbsp;there&nbsp;seems&nbsp;to&nbsp;be&nbsp;an&nbsp;issue&nbsp;with&nbsp;the&nbsp;LDAP&nbsp;query,&nbsp;causing&nbsp;the&nbsp;Active&nbsp;Directory&nbsp;groups&nbsp;to&nbsp;fail&nbsp;to&nbsp;resolve,&nbsp;which&nbsp;subsequently&nbsp;denies&nbsp;user&nbsp;access.&nbsp;When&nbsp;this&nbsp;occurs,&nbsp;the&nbsp;issue&nbsp;persists&nbsp;for&nbsp;about&nbsp;an&nbsp;hour.&nbsp;I&nbsp;suspect&nbsp;this&nbsp;might&nbsp;be&nbsp;due&nbsp;to&nbsp;caching&nbsp;or&nbsp;TTL.&lt;br&gt;&lt;br&gt;Here&nbsp;is&nbsp;a&nbsp;relevant&nbsp;part&nbsp;of&nbsp;the&nbsp;configuration:&lt;br&gt;&lt;br&gt;auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/lib/squid/negotiate_kerberos_auth&nbsp;-s&nbsp;HTTP/server.fqdn@domain&lt;br&gt;auth_param&nbsp;negotiate&nbsp;children&nbsp;500&lt;br&gt;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;on&lt;br&gt;&lt;br&gt;external_acl_type&nbsp;INetAccess&nbsp;ttl=3600&nbsp;children-max=1000&nbsp;%LOGIN&nbsp;/usr/lib/squid/ext_kerberos_ldap_group_acl&nbsp;-g&nbsp;&quot;INetAccess&quot;&nbsp;-a&nbsp;-i&nbsp;-l&nbsp;ldap://server.fqdn:389&nbsp;-D&nbsp;&quot;DOMAIN&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;The&nbsp;debug&nbsp;output&nbsp;from&nbsp;`ext_kerberos_ldap_group_acl`&nbsp;appears&nbsp;as&nbsp;follows&nbsp;when&nbsp;the&nbsp;error&nbsp;occurs:&lt;br&gt;support_resolv.cc(445):&nbsp;pid=2574238&nbsp;:2025/04/07&nbsp;13:49:52|&nbsp;kerberos_ldap_group:&nbsp;DEBUG:&nbsp;Host:&nbsp;DOMAIN&nbsp;Port:&nbsp;-1&nbsp;Priority:&nbsp;-2&nbsp;Weight:&nbsp;-2&lt;br&gt;support_ldap.cc(1066):&nbsp;pid=2574238&nbsp;:2025/04/07&nbsp;13:49:52|&nbsp;kerberos_ldap_group:&nbsp;DEBUG:&nbsp;Setting&nbsp;up&nbsp;connection&nbsp;to&nbsp;LDAP&nbsp;server&nbsp;server.fqdn:389&lt;br&gt;support_ldap.cc(1079):&nbsp;pid=2574238&nbsp;:2025/04/07&nbsp;13:49:52|&nbsp;kerberos_ldap_group:&nbsp;DEBUG:&nbsp;Bind&nbsp;to&nbsp;LDAP&nbsp;server&nbsp;with&nbsp;SASL/GSSAPI&lt;br&gt;support_ldap.cc(1097):&nbsp;pid=2574238&nbsp;:2025/04/07&nbsp;13:49:55|&nbsp;kerberos_ldap_group:&nbsp;DEBUG:&nbsp;Successfully&nbsp;initialized&nbsp;connection&nbsp;to&nbsp;LDAP&nbsp;server&nbsp;server.fqdn:389&lt;br&gt;support_ldap.cc(314):&nbsp;pid=2574238&nbsp;:2025/04/07&nbsp;13:49:55|&nbsp;kerberos_ldap_group:&nbsp;DEBUG:&nbsp;Search&nbsp;LDAP&nbsp;server&nbsp;with&nbsp;bind&nbsp;path&nbsp;&quot;&quot;&nbsp;and&nbsp;filter:&nbsp;(objectclass=*)&lt;br&gt;support_ldap.cc(336):&nbsp;pid=2574238&nbsp;:2025/04/07&nbsp;13:50:25|&nbsp;kerberos_ldap_group:&nbsp;DEBUG:&nbsp;Did&nbsp;not&nbsp;find&nbsp;LDAP&nbsp;entry&nbsp;for&nbsp;subschemasubentry&lt;br&gt;support_ldap.cc(339):&nbsp;pid=2574238&nbsp;:2025/04/07&nbsp;13:50:25|&nbsp;kerberos_ldap_group:&nbsp;DEBUG:&nbsp;Determined&nbsp;LDAP&nbsp;server&nbsp;not&nbsp;as&nbsp;an&nbsp;Active&nbsp;Directory&nbsp;server&lt;br&gt;support_ldap.cc(1213):&nbsp;pid=2574238&nbsp;:2025/04/07&nbsp;13:50:25|&nbsp;kerberos_ldap_group:&nbsp;ERROR:&nbsp;Error&nbsp;determining&nbsp;LDAP&nbsp;server&nbsp;type:&nbsp;Timed&nbsp;out&lt;br&gt;&lt;br&gt;&lt;br&gt;I&nbsp;manually&nbsp;attempted&nbsp;to&nbsp;retrieve&nbsp;the&nbsp;subschemasubentry&nbsp;using&nbsp;ldapsearch.&nbsp;As&nbsp;far&nbsp;as&nbsp;I&nbsp;can&nbsp;see,&nbsp;there&nbsp;is&nbsp;no&nbsp;issue,&nbsp;or&nbsp;I&nbsp;could&nbsp;not&nbsp;reproduce&nbsp;the&nbsp;problem&nbsp;manually&nbsp;via&nbsp;ldapsearch.&lt;br&gt;&lt;br&gt;Does&nbsp;anyone&nbsp;have&nbsp;any&nbsp;ideas&nbsp;on&nbsp;how&nbsp;to&nbsp;further&nbsp;debug&nbsp;this&nbsp;issue?&nbsp;Additionally,&nbsp;are&nbsp;there&nbsp;any&nbsp;recommendations&nbsp;regarding&nbsp;the&nbsp;TTL&nbsp;value?&nbsp;If&nbsp;I&nbsp;reduce&nbsp;the&nbsp;TTL,&nbsp;the&nbsp;duration&nbsp;of&nbsp;the&nbsp;issue&nbsp;might&nbsp;be&nbsp;shorter&nbsp;for&nbsp;individual&nbsp;users.&lt;br&gt;&lt;br&gt;Thanks&nbsp;in&nbsp;advance.&lt;br&gt;&lt;br&gt;Kind&nbsp;regards,&nbsp;&lt;br&gt;Reinhard&nbsp;Westerholt&nbsp;&lt;/div&gt;<br>

</tt>
