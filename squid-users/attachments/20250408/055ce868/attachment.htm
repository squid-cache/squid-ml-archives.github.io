<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hi&nbsp;all,&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_quote&nbsp;gmail_quote_container&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;p&gt;I&#39;m&nbsp;running&nbsp;into&nbsp;a&nbsp;blocking&nbsp;issue&nbsp;while&nbsp;deploying&nbsp;Squid&nbsp;6.13&nbsp;via&nbsp;Docker&nbsp;(in&nbsp;a&nbsp;Docker&nbsp;Swarm&nbsp;setup)&nbsp;using&nbsp;a&nbsp;Dockerfile&nbsp;based&nbsp;onÂ &lt;a&nbsp;href=&quot;https://github.com/b4tman/docker-squid&quot;&nbsp;style=&quot;color:rgb(86,163,241)&quot;&nbsp;target=&quot;_blank&quot;&gt;b4tman/docker-squid&lt;/a&gt;.&nbsp;My&nbsp;goal&nbsp;is&nbsp;to&nbsp;enable&nbsp;theÂ &lt;strong&gt;&lt;code&gt;PROXY&nbsp;protocol&lt;/code&gt;&lt;/strong&gt;Â support&nbsp;via&nbsp;the&nbsp;following&nbsp;config&nbsp;line:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;http_port&nbsp;3128&nbsp;proxy-protocol<br>
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;However,&nbsp;on&nbsp;startup&nbsp;I&nbsp;consistently&nbsp;get&nbsp;this&nbsp;error:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;2025/04/08&nbsp;13:14:44|&nbsp;Processing&nbsp;Configuration&nbsp;File:&nbsp;/etc/squid/my-squid.conf&nbsp;(depth&nbsp;0)<br>
2025/04/08&nbsp;13:14:44|&nbsp;FATAL:&nbsp;Unknown&nbsp;http_port&nbsp;option&nbsp;&#39;proxy-protocol&#39;.<br>
2025/04/08&nbsp;13:14:44|&nbsp;FATAL:&nbsp;Bungled&nbsp;/etc/squid/my-squid.conf&nbsp;line&nbsp;1:&nbsp;http_port&nbsp;3128&nbsp;proxy-protocol<br>
2025/04/08&nbsp;13:14:44|&nbsp;Squid&nbsp;Cache&nbsp;(Version&nbsp;6.13):&nbsp;Terminated&nbsp;abnormally.<br>
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;&lt;h3&gt;ğŸ”Â &lt;strong&gt;What&nbsp;Iâ€™ve&nbsp;Done&nbsp;So&nbsp;Far:&lt;/strong&gt;&lt;/h3&gt;&lt;ul&gt;&lt;li&nbsp;style=&quot;margin-left:15px&quot;&gt;&lt;p&gt;Using&nbsp;SquidÂ &lt;strong&gt;6.13&lt;/strong&gt;Â (confirmed)&lt;/p&gt;&lt;/li&gt;&lt;li&nbsp;style=&quot;margin-left:15px&quot;&gt;&lt;p&gt;VerifiedÂ &lt;code&gt;--enable-proxy-auth&lt;/code&gt;,Â &lt;code&gt;--enable-auth-*&lt;/code&gt;,&nbsp;and&nbsp;many&nbsp;other&nbsp;flags&nbsp;in&nbsp;my&nbsp;Dockerfile&lt;/p&gt;&lt;/li&gt;&lt;li&nbsp;style=&quot;margin-left:15px&quot;&gt;&lt;p&gt;Using&nbsp;the&nbsp;Dockerfile&nbsp;provided&nbsp;byÂ &lt;code&gt;b4tman/docker-squid&lt;/code&gt;Â repo&lt;/p&gt;&lt;/li&gt;&lt;li&nbsp;style=&quot;margin-left:15px&quot;&gt;&lt;p&gt;Running&nbsp;onÂ &lt;strong&gt;Docker&nbsp;Swarm&lt;/strong&gt;Â and&nbsp;mapping&nbsp;config&nbsp;via:&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;pre&gt;&lt;code&gt;volumes:<br>
&nbsp;&nbsp;-&nbsp;./config/squid.conf:/etc/squid/my-squid.conf:ro<br>
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&lt;li&nbsp;style=&quot;margin-left:15px&quot;&gt;&lt;p&gt;&lt;code&gt;SQUID_CONFIG_FILE&lt;/code&gt;Â is&nbsp;set&nbsp;properly,&nbsp;and&nbsp;the&nbsp;config&nbsp;loads&nbsp;â€”&nbsp;until&nbsp;it&nbsp;hits&nbsp;that&nbsp;line.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;hr&gt;&lt;h3&gt;â“Â &lt;strong&gt;What&nbsp;isÂ &lt;code&gt;proxy-protocol&lt;/code&gt;Â supposed&nbsp;to&nbsp;do?&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;TheÂ &lt;code&gt;proxy-protocol&lt;/code&gt;Â option&nbsp;is&nbsp;designed&nbsp;to&nbsp;allow&nbsp;Squid&nbsp;to&nbsp;acceptÂ &lt;strong&gt;original&nbsp;client&nbsp;IP&nbsp;addresses&lt;/strong&gt;Â from&nbsp;trusted&nbsp;proxies&nbsp;or&nbsp;load&nbsp;balancers&nbsp;(e.g.,&nbsp;HAProxy,&nbsp;AWS&nbsp;ELB,&nbsp;Traefik)&nbsp;via&nbsp;theÂ &lt;a&nbsp;href=&quot;https://www.haproxy.org/download/2.0/doc/proxy-protocol.txt&quot;&nbsp;style=&quot;color:rgb(86,163,241)&quot;&nbsp;target=&quot;_blank&quot;&gt;PROXY&nbsp;protocol&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;It&nbsp;lets&nbsp;you&nbsp;do&nbsp;things&nbsp;like:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;http_port&nbsp;3128&nbsp;proxy-protocol<br>
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Instead&nbsp;of&nbsp;seeing&nbsp;the&nbsp;IP&nbsp;of&nbsp;the&nbsp;load&nbsp;balancer,&nbsp;Squid&nbsp;gets&nbsp;the&nbsp;real&nbsp;client&nbsp;IP&nbsp;passed&nbsp;in&nbsp;the&nbsp;PROXY&nbsp;header&nbsp;â€”&nbsp;which&nbsp;is&nbsp;essential&nbsp;for&nbsp;proper&nbsp;logging,&nbsp;ACLs,&nbsp;or&nbsp;geo-restrictions&nbsp;in&nbsp;reverse-proxy&nbsp;environments.&lt;/p&gt;&lt;hr&gt;&lt;h3&gt;ğŸš«Â &lt;strong&gt;Current&nbsp;Blocker&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;Despite&nbsp;enabling&nbsp;many&nbsp;Squid&nbsp;features&nbsp;in&nbsp;the&nbsp;Docker&nbsp;build,&nbsp;this&nbsp;one&nbsp;fails&nbsp;withÂ &lt;code&gt;Unknown&nbsp;http_port&nbsp;option&nbsp;&#39;proxy-protocol&#39;&lt;/code&gt;,&nbsp;which&nbsp;usually&nbsp;means&nbsp;theÂ &lt;strong&gt;binary&nbsp;wasn&#39;t&nbsp;compiled&nbsp;with&nbsp;support&lt;/strong&gt;Â for&nbsp;it.&lt;/p&gt;&lt;hr&gt;&lt;h3&gt;ğŸ› ï¸Â &lt;strong&gt;Questions&nbsp;/&nbsp;Help&nbsp;Needed&lt;/strong&gt;&lt;/h3&gt;&lt;ul&gt;&lt;li&nbsp;style=&quot;margin-left:15px&quot;&gt;&lt;p&gt;IsÂ &lt;code&gt;--with-proxy-protocol&lt;/code&gt;Â or&nbsp;equivalentÂ &lt;strong&gt;compile&nbsp;flag&lt;/strong&gt;Â required&nbsp;to&nbsp;enable&nbsp;this?&nbsp;(I&nbsp;can&#39;t&nbsp;find&nbsp;it&nbsp;in&nbsp;the&nbsp;list&nbsp;ofÂ &lt;code&gt;./configure&lt;/code&gt;Â options&nbsp;for&nbsp;Squid.)&lt;/p&gt;&lt;/li&gt;&lt;li&nbsp;style=&quot;margin-left:15px&quot;&gt;&lt;p&gt;Has&nbsp;anyone&nbsp;usedÂ &lt;code&gt;proxy-protocol&lt;/code&gt;Â successfully&nbsp;with&nbsp;Squid&nbsp;6.13&nbsp;in&nbsp;Docker&nbsp;or&nbsp;with&nbsp;theÂ &lt;code&gt;b4tman/docker-squid&lt;/code&gt;Â base&nbsp;image?&lt;/p&gt;&lt;/li&gt;&lt;li&nbsp;style=&quot;margin-left:15px&quot;&gt;&lt;p&gt;Is&nbsp;there&nbsp;a&nbsp;specific&nbsp;patch,&nbsp;module,&nbsp;or&nbsp;feature&nbsp;flag&nbsp;I&#39;m&nbsp;missing?&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Thanks&nbsp;in&nbsp;advance&nbsp;â€”&nbsp;this&nbsp;feature&nbsp;is&nbsp;critical&nbsp;for&nbsp;deployment&nbsp;in&nbsp;Swarm&nbsp;behind&nbsp;a&nbsp;reverse&nbsp;proxy,&nbsp;and&nbsp;Iâ€™m&nbsp;stuck!&lt;/p&gt;&lt;p&gt;Best&nbsp;regards,&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;strong&gt;Michael&nbsp;Tint&lt;/strong&gt;&lt;br&gt;Linux&nbsp;Admin&lt;/p&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
