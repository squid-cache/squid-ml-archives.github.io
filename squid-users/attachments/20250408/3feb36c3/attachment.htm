<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;p&nbsp;class=&quot;gmail-&quot;&gt;Hi&nbsp;Alex,&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-&quot;&gt;Thank&nbsp;you&nbsp;very&nbsp;much&nbsp;for&nbsp;your&nbsp;quick&nbsp;and&nbsp;helpful&nbsp;response&nbsp;regarding&nbsp;the&nbsp;PROXY&nbsp;protocol&nbsp;configuration.&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-&quot;&gt;Your&nbsp;clarification&nbsp;about&nbsp;using&nbsp;&lt;code&gt;require-proxy-header&lt;/code&gt;&nbsp;instead&nbsp;of&nbsp;&lt;code&gt;proxy-protocol&lt;/code&gt;&nbsp;was&nbsp;spot&nbsp;on&nbsp;—&nbsp;I’ve&nbsp;updated&nbsp;my&nbsp;&lt;code&gt;squid.conf&lt;/code&gt;&nbsp;accordingly,&nbsp;and&nbsp;it&nbsp;now&nbsp;seems&nbsp;to&nbsp;be&nbsp;working&nbsp;as&nbsp;expected.&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-&quot;&gt;I&nbsp;really&nbsp;appreciate&nbsp;your&nbsp;support&nbsp;and&nbsp;guidance&nbsp;on&nbsp;this!&lt;/p&gt;<br>
&lt;p&nbsp;class=&quot;gmail-&quot;&gt;Best&nbsp;regards,&lt;/p&gt;&lt;p&nbsp;class=&quot;gmail-&quot;&gt;<br>
Michael&nbsp;Tin&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_signature&quot;&nbsp;data-smartmail=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&nbsp;gmail_quote_container&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;class=&quot;gmail_attr&quot;&gt;On&nbsp;Tue,&nbsp;8&nbsp;Apr&nbsp;2025&nbsp;at&nbsp;14:09,&nbsp;Alex&nbsp;Rousskov&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:rousskov@measurement-factory.com&quot;&gt;rousskov@measurement-factory.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;On&nbsp;2025-04-08&nbsp;08:24,&nbsp;Michael&nbsp;Tint&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;I&#39;m&nbsp;running&nbsp;into&nbsp;a&nbsp;blocking&nbsp;issue&nbsp;while&nbsp;deploying&nbsp;Squid&nbsp;6.13&nbsp;...&nbsp;My&nbsp;goal&nbsp;is&nbsp;&lt;br&gt;<br>
&gt;&nbsp;to&nbsp;enable&nbsp;the&nbsp;PROXY&nbsp;protocol support&nbsp;via&nbsp;the&nbsp;following&nbsp;config&nbsp;line:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;3128&nbsp;proxy-protocol&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;correct&nbsp;http_port&nbsp;option&nbsp;name&nbsp;for&nbsp;enabling&nbsp;PROXY&nbsp;protocol&nbsp;support&nbsp;is&nbsp;&lt;br&gt;<br>
not&nbsp;&quot;proxy-protocol&quot;&nbsp;but&nbsp;&quot;require-proxy-header&quot;.&nbsp;See&nbsp;http_port&nbsp;directive&nbsp;&lt;br&gt;<br>
description&nbsp;in&nbsp;your&nbsp;generated&nbsp;squid.conf.documented&nbsp;or&nbsp;at&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://www.squid-cache.org/Doc/config/http_port/&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://www.squid-cache.org/Doc/config/http_port/&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
HTH,&lt;br&gt;<br>
&lt;br&gt;<br>
Alex.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;However,&nbsp;on&nbsp;startup&nbsp;I&nbsp;consistently&nbsp;get&nbsp;this&nbsp;error:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;|2025/04/08&nbsp;13:14:44|&nbsp;Processing&nbsp;Configuration&nbsp;File:&nbsp;&lt;br&gt;<br>
&gt;&nbsp;/etc/squid/my-squid.conf&nbsp;(depth&nbsp;0)&nbsp;2025/04/08&nbsp;13:14:44|&nbsp;FATAL:&nbsp;Unknown&nbsp;&lt;br&gt;<br>
&gt;&nbsp;http_port&nbsp;option&nbsp;&#39;proxy-protocol&#39;.&nbsp;2025/04/08&nbsp;13:14:44|&nbsp;FATAL:&nbsp;Bungled&nbsp;&lt;br&gt;<br>
&gt;&nbsp;/etc/squid/my-squid.conf&nbsp;line&nbsp;1:&nbsp;http_port&nbsp;3128&nbsp;proxy-protocol&nbsp;&lt;br&gt;<br>
&gt;&nbsp;2025/04/08&nbsp;13:14:44|&nbsp;Squid&nbsp;Cache&nbsp;(Version&nbsp;6.13):&nbsp;Terminated&nbsp;abnormally.&nbsp;|&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;------------------------------------------------------------------------&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; 🔍&nbsp;*What&nbsp;I’ve&nbsp;Done&nbsp;So&nbsp;Far:*&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; *&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Using&nbsp;Squid&nbsp;*6.13* (confirmed)&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; *&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Verified&nbsp;|--enable-proxy-auth|,&nbsp;|--enable-auth-*|,&nbsp;and&nbsp;many&nbsp;other&lt;br&gt;<br>
&gt; &nbsp; &nbsp; flags&nbsp;in&nbsp;my&nbsp;Dockerfile&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; *&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Using&nbsp;the&nbsp;Dockerfile&nbsp;provided&nbsp;by&nbsp;|b4tman/docker-squid| repo&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; *&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Running&nbsp;on&nbsp;*Docker&nbsp;Swarm* and&nbsp;mapping&nbsp;config&nbsp;via:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;|volumes:&nbsp;-&nbsp;./config/squid.conf:/etc/squid/my-squid.conf:ro&nbsp;|&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; *&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; |SQUID_CONFIG_FILE| is&nbsp;set&nbsp;properly,&nbsp;and&nbsp;the&nbsp;config&nbsp;loads&nbsp;—&nbsp;until&nbsp;it&lt;br&gt;<br>
&gt; &nbsp; &nbsp; hits&nbsp;that&nbsp;line.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;------------------------------------------------------------------------&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; ❓&nbsp;*What&nbsp;is&nbsp;|proxy-protocol| supposed&nbsp;to&nbsp;do?*&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;|proxy-protocol| option&nbsp;is&nbsp;designed&nbsp;to&nbsp;allow&nbsp;Squid&nbsp;to&nbsp;accept&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*original&nbsp;client&nbsp;IP&nbsp;addresses* from&nbsp;trusted&nbsp;proxies&nbsp;or&nbsp;load&nbsp;balancers&nbsp;&lt;br&gt;<br>
&gt;&nbsp;(e.g.,&nbsp;HAProxy,&nbsp;AWS&nbsp;ELB,&nbsp;Traefik)&nbsp;via&nbsp;the&nbsp;PROXY&nbsp;protocol&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;&lt;a&nbsp;href=&quot;https://www.haproxy.org/download/2.0/doc/proxy-protocol.txt&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://www.haproxy.org/download/2.0/doc/proxy-protocol.txt&lt;/a&gt;&gt;.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;It&nbsp;lets&nbsp;you&nbsp;do&nbsp;things&nbsp;like:&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;|http_port&nbsp;3128&nbsp;proxy-protocol&nbsp;|&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Instead&nbsp;of&nbsp;seeing&nbsp;the&nbsp;IP&nbsp;of&nbsp;the&nbsp;load&nbsp;balancer,&nbsp;Squid&nbsp;gets&nbsp;the&nbsp;real&nbsp;&lt;br&gt;<br>
&gt;&nbsp;client&nbsp;IP&nbsp;passed&nbsp;in&nbsp;the&nbsp;PROXY&nbsp;header&nbsp;—&nbsp;which&nbsp;is&nbsp;essential&nbsp;for&nbsp;proper&nbsp;&lt;br&gt;<br>
&gt;&nbsp;logging,&nbsp;ACLs,&nbsp;or&nbsp;geo-restrictions&nbsp;in&nbsp;reverse-proxy&nbsp;environments.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;------------------------------------------------------------------------&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; 🚫&nbsp;*Current&nbsp;Blocker*&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Despite&nbsp;enabling&nbsp;many&nbsp;Squid&nbsp;features&nbsp;in&nbsp;the&nbsp;Docker&nbsp;build,&nbsp;this&nbsp;one&nbsp;fails&nbsp;&lt;br&gt;<br>
&gt;&nbsp;with&nbsp;|Unknown&nbsp;http_port&nbsp;option&nbsp;&#39;proxy-protocol&#39;|,&nbsp;which&nbsp;usually&nbsp;means&nbsp;&lt;br&gt;<br>
&gt;&nbsp;the&nbsp;*binary&nbsp;wasn&#39;t&nbsp;compiled&nbsp;with&nbsp;support* for&nbsp;it.&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;------------------------------------------------------------------------&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; &nbsp; 🛠️&nbsp;*Questions&nbsp;/&nbsp;Help&nbsp;Needed*&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; *&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Is&nbsp;|--with-proxy-protocol| or&nbsp;equivalent&nbsp;*compile&nbsp;flag* required&nbsp;to&lt;br&gt;<br>
&gt; &nbsp; &nbsp; enable&nbsp;this?&nbsp;(I&nbsp;can&#39;t&nbsp;find&nbsp;it&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;|./configure| options&lt;br&gt;<br>
&gt; &nbsp; &nbsp; for&nbsp;Squid.)&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; *&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Has&nbsp;anyone&nbsp;used&nbsp;|proxy-protocol| successfully&nbsp;with&nbsp;Squid&nbsp;6.13&nbsp;in&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Docker&nbsp;or&nbsp;with&nbsp;the&nbsp;|b4tman/docker-squid| base&nbsp;image?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; *&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt; &nbsp; &nbsp; Is&nbsp;there&nbsp;a&nbsp;specific&nbsp;patch,&nbsp;module,&nbsp;or&nbsp;feature&nbsp;flag&nbsp;I&#39;m&nbsp;missing?&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Thanks&nbsp;in&nbsp;advance&nbsp;—&nbsp;this&nbsp;feature&nbsp;is&nbsp;critical&nbsp;for&nbsp;deployment&nbsp;in&nbsp;Swarm&nbsp;&lt;br&gt;<br>
&gt;&nbsp;behind&nbsp;a&nbsp;reverse&nbsp;proxy,&nbsp;and&nbsp;I’m&nbsp;stuck!&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;Best&nbsp;regards,&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;*Michael&nbsp;Tint*&lt;br&gt;<br>
&gt;&nbsp;Linux&nbsp;Admin&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;&lt;br&gt;<br>
&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;squid-users&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:squid-users@lists.squid-cache.org&quot;&nbsp;target=&quot;_blank&quot;&gt;squid-users@lists.squid-cache.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.squid-cache.org/listinfo/squid-users&quot;&nbsp;rel=&quot;noreferrer&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;<br>

</tt>
