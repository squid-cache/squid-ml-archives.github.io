<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;Hello&nbsp;Team,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;hope&nbsp;you&nbsp;are&nbsp;well,&nbsp;been&nbsp;<br>
working&nbsp;on&nbsp;the&nbsp;powerful&nbsp;squid&nbsp;proxy&nbsp;for&nbsp;the&nbsp;past&nbsp;few&nbsp;months&nbsp;and&nbsp;have&nbsp;<br>
been&nbsp;struck&nbsp;at&nbsp;the&nbsp;dead&nbsp;end&nbsp;while&nbsp;setting&nbsp;up&nbsp;a&nbsp;transparent&nbsp;proxy.&lt;/div&gt;&lt;div&gt;My&nbsp;goal&nbsp;is&nbsp;to&nbsp;set&nbsp;up&nbsp;a&nbsp;squid&nbsp;proxy&nbsp;as&nbsp;a&nbsp;transparent&nbsp;proxy&nbsp;for&nbsp;http.&lt;/div&gt;&lt;div&gt;Below&nbsp;is&nbsp;the&nbsp;config&nbsp;file(have&nbsp;included&nbsp;only&nbsp;the&nbsp;important&nbsp;part&nbsp;not&nbsp;all),&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;fedora&nbsp;box&nbsp;as&nbsp;a&nbsp;client&nbsp;where&nbsp;I&nbsp;have&nbsp;mentioned&nbsp;the&nbsp;squid&nbsp;proxy&nbsp;ip&nbsp;and&nbsp;a&nbsp;demo&nbsp;website&nbsp;in&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/etc/hosts&nbsp;file&nbsp;forcing&nbsp;it&nbsp;to&nbsp;go&nbsp;through&nbsp;the&nbsp;squid&nbsp;proxy.&lt;/div&gt;&lt;div&gt;my.squid.ip.address    &nbsp;&lt;a&nbsp;href=&quot;http://www.neverssl.com&quot;&nbsp;target=&quot;_blank&quot;&gt;www.neverssl.com&lt;/a&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;And&nbsp;on&nbsp;the&nbsp;server&nbsp;is&nbsp;the&nbsp;below&nbsp;configuration&nbsp;and&nbsp;output&nbsp;which&nbsp;I&nbsp;have&nbsp;shared.&lt;/div&gt;&lt;div&gt;_________&lt;/div&gt;&lt;div&gt;&lt;div&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3128&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0:3128&lt;/a&gt;&lt;br&gt;http_port&nbsp;&lt;a&nbsp;href=&quot;http://192.168.124.130:3130&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.124.130:3130&lt;/a&gt;&nbsp;intercept&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;443&nbsp;3128&nbsp;3129&nbsp;3130&nbsp;3131&nbsp;21&nbsp;70&nbsp;210&nbsp;280&nbsp;488&nbsp;591&nbsp;777&nbsp;1025-65535&lt;br&gt;#&nbsp;===&nbsp;ACLs&nbsp;and&nbsp;Access&nbsp;Rules&nbsp;===&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.124.0/24&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.124.0/24&lt;/a&gt;&lt;br&gt;acl&nbsp;fedora_client&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://192.168.0.0/16&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.0.0/16&lt;/a&gt;&lt;br&gt;acl&nbsp;localhost&nbsp;src&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1/32&quot;&nbsp;target=&quot;_blank&quot;&gt;127.0.0.1/32&lt;/a&gt;&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;443&nbsp;3128&nbsp;3129&nbsp;3130&nbsp;3131&nbsp;21&nbsp;70&nbsp;210&nbsp;280&nbsp;488&nbsp;591&nbsp;777&nbsp;1025-65535&lt;br&gt;acl&nbsp;CONNECT&nbsp;method&nbsp;CONNECT&lt;br&gt;&lt;/div&gt;&lt;div&gt;http_access&nbsp;allow&nbsp;all&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;logformat&nbsp;MyLogFormat&nbsp; ---&gt;&nbsp;local_time=&quot;[%tl]&quot;&nbsp;squid_service=%{service}note&nbsp;squid_status=%Ss&nbsp;squid_hierarchy_status=%Sh&nbsp;|&nbsp;lb_sessionid=%{X-SSL-sessionid}&gt;h&nbsp;|&nbsp;**FLOW1**&nbsp;src_ip=%&gt;a&nbsp;src_port=%&gt;p&nbsp;squid_ingress_ip=%&gt;la&nbsp;squid_ingress_port=%&gt;lp&nbsp;|&nbsp;**FLOW2**&nbsp;squid_egress_ip=%&lt;la&nbsp;squid_egress_port=%&lt;lp&nbsp;dst_ip=%&lt;a&nbsp;dst_host=%&lt;A&nbsp;dst_port=%&lt;p&nbsp;ident_username=%[ui&nbsp;username=%[un&nbsp;request_method=%rm&nbsp;request=&quot;%rm&nbsp;%ru&nbsp;HTTP/%rv&quot;&nbsp;dst_url=&quot;%ru&quot;&nbsp;status_code_from_server=%&gt;Hs&nbsp;status_code_to_client=%&lt;Hs&nbsp;referer=&quot;%{Referer}&gt;h&quot;&nbsp;user_agent=&quot;%{User-Agent}&gt;h&quot;&nbsp;protocol_version=%rv&nbsp;**&nbsp;dns_response_time=%dt&nbsp;response_time=%tr&nbsp;mime_type=%mt&nbsp;*XFER*&nbsp;total_request_size=%&gt;st&nbsp;total_reply_size=%&lt;st&nbsp;**&nbsp;%{src_zone}note&nbsp;%{dst_zone}note&nbsp;%{method_category}note&nbsp;%{dst_category}note&nbsp;%{file_upload}note&nbsp;**&nbsp;REQUEST&nbsp;HEADERS&nbsp;%&gt;h&nbsp;***&nbsp;RESPONSE&nbsp;HEADERS&nbsp;%&lt;h&nbsp;***&nbsp;tag_returned=%et&nbsp;tag_string=&quot;%ea&quot;&nbsp;previous_hop_mac=%&gt;eui&nbsp;peer_response_time=%&lt;pt&nbsp;total_response_time=%&lt;tt&nbsp;*SSL*&nbsp;src_ssl_negotiated_version=%ssl::&gt;negotiated_version&nbsp;dst_ssl_negotiated_version=%ssl::&lt;negotiated_version&nbsp;src_tls_hello_version=%ssl::&gt;received_hello_version&nbsp; dst_tls_hello_version=%ssl::&lt;received_hello_version&nbsp;src_tls_max_version=%ssl::&gt;received_supported_version&nbsp;dst_tls_max_version=%ssl::&lt;received_supported_version&nbsp;src_tls_cipher=%ssl::&gt;negotiated_cipher&nbsp;dst_tls_cipher=%ssl::&lt;negotiated_cipher&nbsp;ssl_bump=%&lt;bs&nbsp;ssl_bump_mode=%ssl::bump_mode&nbsp;ssl_sni=%ssl::&gt;sni&nbsp;src_cert_subject=&quot;%ssl::&gt;cert_subject&quot;&nbsp;src_cert_issuer=&quot;%ssl::&gt;cert_issuer&quot;&nbsp;dst_cert_subject=&quot;%ssl::&lt;cert_subject&quot;&nbsp;dst_cert_issuer=&quot;%ssl::&lt;cert_issuer&quot;&nbsp;cert_errors=&quot;%ssl::&lt;cert_errors&quot;&nbsp;ssl_handshake=&quot;%&gt;handshake&quot;&nbsp;***&nbsp;error_page_presented=%err_code&nbsp;err_detail=&quot;%err_detail&quot;&nbsp; rule_id=%{ruleid}note&nbsp;rule_type=%{ruletype}note&nbsp; XFF=&quot;%{X-Forwarded-For}&gt;h&quot;&nbsp;squid_dst_app=%{dst_app}note&nbsp;SkipSsl=%{SkipSslDecrypt}note&nbsp;BrokenButTrusted=%{BrokenButTrusted}note&nbsp;|&nbsp;**&nbsp;dns_response_time=%dt&nbsp;peer_response_time=%&lt;pt&nbsp;total_response_time=%&lt;tt&nbsp;response_time=%tr&nbsp;|&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;__________&lt;/div&gt;&lt;div&gt;Below&nbsp;are&nbsp;the&nbsp;output&nbsp;for&nbsp;netstat&lt;br&gt;[root@redhat&nbsp;squid]#&nbsp;netstat&nbsp;-tulnp&nbsp;|&nbsp;grep&nbsp;-i&nbsp;squid&lt;br&gt;tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp;&lt;a&nbsp;href=&quot;http://0.0.0.0:3128&quot;&nbsp;target=&quot;_blank&quot;&gt;0.0.0.0:3128&lt;/a&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LISTEN&nbsp; &nbsp; &nbsp; 935/(squid-1)&nbsp; &nbsp; &nbsp; &nbsp;&lt;br&gt;tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp;&lt;a&nbsp;href=&quot;http://192.168.124.130:3130&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.124.130:3130&lt;/a&gt;&nbsp; &nbsp; 0.0.0.0:*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LISTEN&nbsp; &nbsp; &nbsp; 935/(squid-1)&nbsp;&lt;br&gt;&lt;/div&gt;&lt;div&gt;____________&lt;/div&gt;&lt;div&gt;Below&nbsp;are&nbsp;the&nbsp;iptables&nbsp;rule&lt;/div&gt;&lt;div&gt;#iptables&nbsp;-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;&lt;div&gt; #iptables&nbsp;-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;3128&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;&lt;div&gt; #iptables&nbsp;-A&nbsp;INPUT&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;3130&nbsp;-j&nbsp;ACCEPT&lt;/div&gt;&lt;div&gt;#iptables&nbsp;-t&nbsp;nat&nbsp;-A&nbsp;PREROUTING&nbsp;-i&nbsp;enp1s0&nbsp;-p&nbsp;tcp&nbsp;--dport&nbsp;80&nbsp;-j&nbsp;REDIRECT&nbsp;--to-port&nbsp;3130&lt;/div&gt;&lt;div&gt;___________________&lt;/div&gt;&lt;div&gt;Below<br>
&nbsp;are&nbsp;the&nbsp;output&nbsp;of&nbsp;the&nbsp;logs&nbsp;(Flow&nbsp;1:&nbsp;Is&nbsp;from&nbsp;client&nbsp;to&nbsp;proxy;&nbsp;Flow&nbsp;2:&nbsp;is&nbsp;from&nbsp;proxy&nbsp;to&nbsp;destination)&nbsp;while&nbsp;executing&nbsp;curl&nbsp;from&nbsp;the&nbsp;client.&nbsp;The&nbsp;<br>
proxy&nbsp;is&nbsp;not&nbsp;reaching&nbsp;the&nbsp;destination&nbsp;server&nbsp;rather&nbsp;talking&nbsp;to&nbsp;itself.&lt;/div&gt;&lt;div&gt;**FLOW1**&nbsp;src_ip=192.168.124.1&nbsp;src_port=53564&nbsp;squid_ingress_ip=192.168.124.130&nbsp;squid_ingress_port=3130&lt;br&gt;**FLOW2**&nbsp;squid_egress_ip=192.168.124.130&nbsp;squid_egress_port=44378&nbsp;dst_ip=192.168.124.130&nbsp;dst_host=&lt;a&nbsp;href=&quot;http://www.neverssl.com&quot;&nbsp;target=&quot;_blank&quot;&gt;www.neverssl.com&lt;/a&gt;&nbsp;dst_port=3130&nbsp;ident_username=-&nbsp;username=-&nbsp;request_method=GET&nbsp;request=&quot;GET&nbsp;&lt;a&nbsp;href=&quot;http://www.neverssl.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.neverssl.com/&lt;/a&gt;&nbsp;HTTP/1.1&quot;&nbsp;dst_url=&quot;&lt;a&nbsp;href=&quot;http://www.neverssl.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;http://www.neverssl.com/&lt;/a&gt;&quot;<br>
&nbsp;status_code_from_server=403&nbsp;status_code_to_client=403&nbsp;referer=&quot;-&quot;&nbsp;<br>
user_agent=&quot;curl/8.9.1&quot;&nbsp;protocol_version=1.1&nbsp;**&nbsp;dns_response_time=22&nbsp;<br>
response_time=24&nbsp;mime_type=text/html&nbsp;*XFER*&nbsp;total_request_size=132&nbsp;<br>
total_reply_size=4127&nbsp;**&nbsp;-&nbsp;-&nbsp;-&nbsp;-&nbsp;-&nbsp;**&nbsp;REQUEST&nbsp;HEADERS&nbsp;<br>
User-Agent:%20curl/8.9.1%0D%0AAccept:%20*/*%0D%0AProxy-Connection:%20Keep-Alive%0D%0AHost:%&lt;a&nbsp;href=&quot;http://20www.neverssl.com&quot;&nbsp;target=&quot;_blank&quot;&gt;20www.neverssl.com&lt;/a&gt;%0D%0A&nbsp;***&nbsp;RESPONSE&nbsp;HEADERS&nbsp;HTTP/1.1%20403%20Forbidden%0D%0AServer:%20squid/5.5%0D%0AMime-Version:%201.0%0D%0ADate:%20Mon,%2007%20Apr%202025%2015:00:52%20GMT%0D%0AContent-Type:%20text/html;charset=utf-8%0D%0AContent-Length:%203633%0D%0AX-Squid-Error:%20ERR_ACCESS_DENIED&lt;/div&gt;&lt;div&gt;-------------------&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;P.S:&nbsp;Have&nbsp;good&nbsp;success&nbsp;on&nbsp;setting&nbsp;it&nbsp;up&nbsp;as&nbsp;explicit&nbsp;by&nbsp;setting&nbsp;the&nbsp;IP&nbsp;on&nbsp;the&nbsp;browser.&nbsp;But&nbsp;that&#39;s&nbsp;not&nbsp;the&nbsp;ultimate&nbsp;goal.&lt;/div&gt;&lt;div&gt;&lt;div&gt;I&nbsp;would&nbsp;appreciate&nbsp;any&nbsp;help&nbsp;that&nbsp;you&nbsp;can&nbsp;offer&nbsp;in&nbsp;this&nbsp;regard.&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
