<tt>
&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;div&nbsp;class=&quot;ydpec8cc22yahoo-style-wrap&quot;&nbsp;style=&quot;font-family:Helvetica&nbsp;Neue,&nbsp;Helvetica,&nbsp;Arial,&nbsp;sans-serif;font-size:16px;&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&nbsp;data-setdir=&quot;false&quot;&gt;&lt;div&gt;Hi,&lt;br&gt;&lt;br&gt;I&nbsp;had&nbsp;successfully&nbsp;setup&nbsp;squid-openssl&nbsp;(6.10)&nbsp;in&nbsp;Ubuntu&nbsp;24.04.02&nbsp;LTS,&nbsp;staging&nbsp;and&nbsp;production.&nbsp;I&nbsp;refer&nbsp;to&nbsp;this&nbsp;squid&nbsp;wiki:&nbsp;https://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory.&nbsp;I&nbsp;had&nbsp;setup&nbsp;Squid-cache&nbsp;authenticate&nbsp;against&nbsp;Activi&nbsp;Directory&nbsp;via&nbsp;kerberos.&nbsp;For&nbsp;proxy&nbsp;user&nbsp;access&nbsp;to&nbsp;staging,&nbsp;windows&nbsp;users&nbsp;(joined&nbsp;AD)&nbsp;no&nbsp;issue&nbsp;on&nbsp;authentication.&nbsp;I&nbsp;test&nbsp;users&nbsp;authenticate&nbsp;seemlessly&nbsp;without&nbsp;any&nbsp;prompt.&lt;br&gt;&lt;br&gt;Our&nbsp;office&nbsp;user&nbsp;around&nbsp;600.&nbsp;when&nbsp;I&nbsp;turn&nbsp;on&nbsp;production&nbsp;proxy.&nbsp;At&nbsp;morning&nbsp;9am,&nbsp;when&nbsp;user&nbsp;number&nbsp;hit&nbsp;around&nbsp;100,&nbsp;no&nbsp;issue&nbsp;raise.&nbsp;when&nbsp;user&nbsp;number&nbsp;hit&nbsp;around&nbsp;250++,&nbsp;windows&nbsp;users,&nbsp;the&nbsp;browser&nbsp;start&nbsp;to&nbsp;prompt&nbsp;user&nbsp;login,&nbsp;even&nbsp;domain&nbsp;credential&nbsp;are&nbsp;correct,&nbsp;but&nbsp;seem&nbsp;not&nbsp;work,&nbsp;after&nbsp;that&nbsp;user&nbsp;cannot&nbsp;surf&nbsp;any&nbsp;website.&lt;br&gt;&lt;br&gt;How&nbsp;to&nbsp;troubleshoot&nbsp;this&nbsp;issue?&lt;br&gt;&lt;br&gt;I&nbsp;use&nbsp;squidclient&nbsp;to&nbsp;monitor&nbsp;external_acl,&nbsp;negotiateauthenticator,&nbsp;ntlmauthenticator,&nbsp;basicauthenticator,&nbsp;so&nbsp;far&nbsp;no&nbsp;requests&nbsp;timedout.&lt;br&gt;&lt;br&gt;I&nbsp;also&nbsp;monitor&nbsp;cache.log&nbsp;with&nbsp;filtering&nbsp;&quot;FATAL:|WARNING:|squidaio_queue_request:|SECURITY&nbsp;ALERT:&quot;&nbsp;didn't&nbsp;find&nbsp;any&nbsp;specifc&nbsp;error.&lt;br&gt;&lt;br&gt;Can&nbsp;help&nbsp;to&nbsp;identify,&nbsp;wonder&nbsp;user&nbsp;still&nbsp;got&nbsp;domain&nbsp;login&nbsp;prompt&nbsp;from,&nbsp;e.g.&nbsp;internet&nbsp;browser,&nbsp;like&nbsp;chrome,&nbsp;edge&nbsp;or&nbsp;firefox,&nbsp;outlook&nbsp;and&nbsp;microsoft&nbsp;teams,&nbsp;etc.&lt;br&gt;&lt;br&gt;Appciate&nbsp;any&nbsp;help.&lt;br&gt;&lt;br&gt;Thanks.&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;attach&nbsp;my&nbsp;squid.conf:&lt;br&gt;=======================================&lt;br&gt;##&nbsp;negotiate&nbsp;kerberos&nbsp;and&nbsp;ntlm&nbsp;authentication&lt;br&gt;auth_param&nbsp;negotiate&nbsp;program&nbsp;/usr/lib/squid/negotiate_wrapper_auth&nbsp;-d&nbsp;--ntlm&nbsp;/usr/bin/ntlm_auth&nbsp;--diagnostics&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--domain=MYCOMPANY&nbsp;--kerberos&nbsp;/usr/lib/squid/negotiate_kerberos_auth&nbsp;-d&nbsp;-s&nbsp;GSS_C_NO_NAME&lt;br&gt;auth_param&nbsp;negotiate&nbsp;children&nbsp;3000&nbsp;startup=500&nbsp;idle=200&lt;br&gt;auth_param&nbsp;negotiate&nbsp;keep_alive&nbsp;on&lt;br&gt;authenticate_ttl&nbsp;15&nbsp;minutes&lt;br&gt;&lt;br&gt;##&nbsp;pure&nbsp;ntlm&nbsp;authentication&lt;br&gt;auth_param&nbsp;ntlm&nbsp;program&nbsp;/usr/bin/ntlm_auth&nbsp;--diagnostics&nbsp;--helper-protocol=squid-2.5-ntlmssp&nbsp;--domain=MYCOMPANY&lt;br&gt;auth_param&nbsp;ntlm&nbsp;children&nbsp;500&nbsp;startup=50&nbsp;idle=10&lt;br&gt;auth_param&nbsp;ntlm&nbsp;keep_alive&nbsp;off&lt;br&gt;&lt;br&gt;###&nbsp;provide&nbsp;basic&nbsp;authentication&nbsp;via&nbsp;ldap&nbsp;for&nbsp;clients&nbsp;not&nbsp;authenticated&nbsp;via&nbsp;kerberos/ntlm&lt;br&gt;auth_param&nbsp;basic&nbsp;program&nbsp;/usr/lib/squid/basic_ldap_auth&nbsp;-R&nbsp;-b&nbsp;&quot;dc=mycompany,dc=com&quot;&nbsp;-D&nbsp;squidproxyuser@mycompany.com&nbsp;-W&nbsp;/etc/squid/ldappass.txt&nbsp;-f&nbsp;sAMAccountName=%s&nbsp;-h&nbsp;mycompanydc.mycompany.com&lt;br&gt;auth_param&nbsp;basic&nbsp;children&nbsp;500&nbsp;startup=50&nbsp;idle=10&lt;br&gt;auth_param&nbsp;basic&nbsp;realm&nbsp;Internet&nbsp;Proxy&lt;br&gt;auth_param&nbsp;basic&nbsp;credentialsttl&nbsp;1&nbsp;minute&lt;br&gt;&lt;br&gt;#external_acl_type&nbsp;hebadgroup&nbsp;%LOGIN&nbsp;/usr/lib/squid/ext_wbinfo_group_acl&lt;br&gt;external_acl_type&nbsp;hebadgroup&nbsp;children-max=1000&nbsp;&nbsp;children-startup=50&nbsp;children-idle=10&nbsp;ttl=900&nbsp;negative_ttl=900&nbsp;%LOGIN&nbsp;/usr/lib/squid/ext_wbinfo_group_acl&lt;br&gt;&lt;br&gt;http_port&nbsp;3128&nbsp;ssl-bump&nbsp;generate-host-certificates=on&nbsp;dynamic_cert_mem_cache_size=20MB&nbsp;tls-cert=/etc/squid/cert/squid.crt&nbsp;tls-key=/etc/squid/cert/ca.key&lt;br&gt;sslcrtd_program&nbsp;/usr/lib/squid/security_file_certgen&nbsp;-s&nbsp;/var/lib/squid/ssl_db&nbsp;-M&nbsp;20MB&lt;br&gt;sslcrtd_children&nbsp;50&lt;br&gt;&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;0.0.0.1-0.255.255.255&nbsp;&nbsp;#&nbsp;RFC&nbsp;1122&nbsp;&quot;this&quot;&nbsp;network&nbsp;(LAN)&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;10.0.0.0/8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;1918&nbsp;local&nbsp;private&nbsp;network&nbsp;(LAN)&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;100.64.0.0/10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;6598&nbsp;shared&nbsp;address&nbsp;space&nbsp;(CGN)&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;169.254.0.0/16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;3927&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;172.16.0.0/12&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;1918&nbsp;local&nbsp;private&nbsp;network&nbsp;(LAN)&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;192.168.0.0/16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;1918&nbsp;local&nbsp;private&nbsp;network&nbsp;(LAN)&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;fc00::/7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4193&nbsp;local&nbsp;private&nbsp;network&nbsp;range&lt;br&gt;acl&nbsp;localnet&nbsp;src&nbsp;fe80::/10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;4291&nbsp;link-local&nbsp;(directly&nbsp;plugged)&nbsp;machines&lt;br&gt;&lt;br&gt;acl&nbsp;SSL_ports&nbsp;port&nbsp;443&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ftp&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;443&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;https&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;70&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gopher&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;wais&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;1025-65535&nbsp;&nbsp;#&nbsp;unregistered&nbsp;ports&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;280&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http-mgmt&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;488&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;gss-http&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;591&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;filemaker&lt;br&gt;acl&nbsp;Safe_ports&nbsp;port&nbsp;777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;multiling&nbsp;http&lt;br&gt;&lt;br&gt;acl&nbsp;direct_access&nbsp;dstdomain&nbsp;openshiftapps.com&lt;br&gt;cache&nbsp;deny&nbsp;direct_access&lt;br&gt;&lt;br&gt;acl&nbsp;urlwhatsapp&nbsp;dstdomain&nbsp;.whatsapp.com&lt;br&gt;acl&nbsp;grpwhatsapp&nbsp;external&nbsp;adgroup&nbsp;sq_whatsapp&lt;br&gt;acl&nbsp;grpgithub&nbsp;external&nbsp;adgroup&nbsp;SSLVPN-GitHub-CoPilot&lt;br&gt;&lt;br&gt;&lt;br&gt;#&nbsp;Enable&nbsp;Proxy&nbsp;Authentication&lt;br&gt;acl&nbsp;aduser&nbsp;proxy_auth&nbsp;REQUIRED&lt;br&gt;&lt;br&gt;#&nbsp;Domains&nbsp;for&nbsp;SSL&nbsp;Bump&lt;br&gt;acl&nbsp;url_sslbump&nbsp;dstdomain&nbsp;.github.com&lt;br&gt;&lt;br&gt;#&nbsp;Define&nbsp;SSL&nbsp;Bump&nbsp;steps&lt;br&gt;acl&nbsp;step1&nbsp;at_step&nbsp;SslBump1&lt;br&gt;acl&nbsp;step2&nbsp;at_step&nbsp;SslBump2&lt;br&gt;acl&nbsp;step3&nbsp;at_step&nbsp;SslBump3&lt;br&gt;&lt;br&gt;#&nbsp;SSL&nbsp;Bump&nbsp;rules&nbsp;for&nbsp;specific&nbsp;traffic&lt;br&gt;ssl_bump&nbsp;peek&nbsp;step1&nbsp;all&lt;br&gt;ssl_bump&nbsp;bump&nbsp;step2&nbsp;url_sslbump&lt;br&gt;ssl_bump&nbsp;splice&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Splice&nbsp;(do&nbsp;not&nbsp;bump)&nbsp;all&nbsp;other&nbsp;traffic&lt;br&gt;sslproxy_cert_error&nbsp;allow&nbsp;url_sslbump&lt;br&gt;&lt;br&gt;&lt;br&gt;#http_access&nbsp;deny&nbsp;!Safe_ports&lt;br&gt;#http_access&nbsp;deny&nbsp;CONNECT&nbsp;!SSL_ports&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&nbsp;manager&lt;br&gt;http_access&nbsp;deny&nbsp;manager&lt;br&gt;http_access&nbsp;allow&nbsp;localhost&lt;br&gt;http_access&nbsp;deny&nbsp;to_localhost&lt;br&gt;http_access&nbsp;deny&nbsp;to_linklocal&lt;br&gt;include&nbsp;/etc/squid/conf.d/*.conf&lt;br&gt;&lt;br&gt;#&nbsp;Access&nbsp;control&nbsp;for&nbsp;GitHub&nbsp;Copilot&nbsp;Group&lt;br&gt;include&nbsp;/etc/squid/github.conf&lt;br&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;urlwhatsapp&nbsp;grpwhatsapp&lt;br&gt;http_access&nbsp;deny&nbsp;urlwhatsapp&lt;br&gt;&lt;br&gt;http_access&nbsp;allow&nbsp;aduser&lt;br&gt;http_access&nbsp;deny&nbsp;all&lt;br&gt;&lt;br&gt;coredump_dir&nbsp;/var/spool/squid&lt;br&gt;#&nbsp;AV&nbsp;updates&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;\.symantecliveupdate\.com\/.*\.(zip|7z|irn|[m|x][0-9][0-9])&nbsp;&nbsp;&nbsp;360&nbsp;&nbsp;50%&nbsp;&nbsp;&nbsp;360&nbsp;&nbsp;reload-into-ims&lt;br&gt;refresh_pattern&nbsp;^ftp:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1440&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10080&lt;br&gt;refresh_pattern&nbsp;-i&nbsp;(/cgi-bin/|\?)&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&lt;br&gt;refresh_pattern&nbsp;\/(Packages|Sources)(|\.bz2|\.gz|\.xz)$&nbsp;0&nbsp;0%&nbsp;0&nbsp;refresh-ims&lt;br&gt;refresh_pattern&nbsp;\/Release(|\.gpg)$&nbsp;0&nbsp;0%&nbsp;0&nbsp;refresh-ims&lt;br&gt;refresh_pattern&nbsp;\/InRelease$&nbsp;0&nbsp;0%&nbsp;0&nbsp;refresh-ims&lt;br&gt;refresh_pattern&nbsp;\/(Translation-.*)(|\.bz2|\.gz|\.xz)$&nbsp;0&nbsp;0%&nbsp;0&nbsp;refresh-ims&lt;br&gt;refresh_pattern&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4320&lt;br&gt;&lt;br&gt;max_filedescriptors&nbsp;65535&lt;br&gt;cache_mem&nbsp;4096&nbsp;MB&lt;br&gt;=======================================&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
