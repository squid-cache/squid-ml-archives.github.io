<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;dir=&quot;auto&quot;&gt;<br>
Hello&nbsp;Mark,<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;You&nbsp;can&nbsp;just&nbsp;export&nbsp;the&nbsp;keytab&nbsp;generated&nbsp;on&nbsp;windows&nbsp;and&nbsp;use&nbsp;it&nbsp;on&nbsp;your&nbsp;proxy&nbsp;-&nbsp;then&nbsp;there&nbsp;is&nbsp;no&nbsp;need&nbsp;to&nbsp;mess&nbsp;with&nbsp;proxy’s&nbsp;account&nbsp;in&nbsp;AD&nbsp;-&nbsp;overall&nbsp;this&nbsp;is&nbsp;much&nbsp;easier&nbsp;I&nbsp;believe&nbsp;-&nbsp;see&nbsp;&lt;a&nbsp;href=&quot;https://www.diladele.com/websafety/docs/authentication/active_directory/kerberos/&quot;&gt;https://www.diladele.com/websafety/docs/authentication/active_directory/kerberos/&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;And&nbsp;it&nbsp;also&nbsp;works&nbsp;pretty&nbsp;nice&nbsp;with&nbsp;several&nbsp;boxes&nbsp;at&nbsp;once&nbsp;-&nbsp;we&nbsp;use&nbsp;it&nbsp;all&nbsp;the&nbsp;time&nbsp;when&nbsp;testing&nbsp;AD&nbsp;integration,&nbsp;see&nbsp;&nbsp;&lt;a&nbsp;href=&quot;https://www.diladele.com/websafety/docs/redundancy/haproxy_proxy_protocol/&quot;&gt;https://www.diladele.com/websafety/docs/redundancy/haproxy_proxy_protocol/&lt;/a&gt;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Hope&nbsp;it&nbsp;helps.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&nbsp;id=&quot;lineBreakAtBeginningOfSignature&quot;&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Best&nbsp;regards,<br>
&lt;div&gt;Rafael&nbsp;Akchurin&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;br&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;23&nbsp;Jun&nbsp;2025,&nbsp;at&nbsp;12:16,&nbsp;Mark&nbsp;Cairney&nbsp;&lt;Mark.Cairney@ed.ac.uk&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;﻿&lt;span&gt;Hi,&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;Thanks-&nbsp;that&nbsp;make&nbsp;sense&nbsp;and&nbsp;as&nbsp;a&nbsp;result&nbsp;I've&nbsp;set&nbsp;the&nbsp;reverse&nbsp;DNS&nbsp;on&nbsp;the&nbsp;2&nbsp;hosts&nbsp;to&nbsp;the&nbsp;round-robin&nbsp;DNS&nbsp;name.&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;RE:&nbsp;the&nbsp;KVNO&nbsp;drift&nbsp;issue,&nbsp;one&nbsp;suggestion&nbsp;was&nbsp;to&nbsp;delete&nbsp;the&nbsp;existing&nbsp;machine&nbsp;account(s)&nbsp;from&nbsp;AD&nbsp;and&nbsp;use&nbsp;ktpass&nbsp;and&nbsp;set&nbsp;the&nbsp;kvno&nbsp;to&nbsp;0.&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;I'd&nbsp;previously&nbsp;used&nbsp;msktutil&nbsp;(as&nbsp;suggested&nbsp;on&nbsp;https://wiki.squid-cache.org/ConfigExamples/Authenticate/WindowsActiveDirectory)&nbsp;with&nbsp;the&nbsp;'dont-expire-password'&nbsp;flag&nbsp;i.e:&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;msktutil&nbsp;-c&nbsp;-h&nbsp;test-squid-cluster.dyn.zone&nbsp;-b&nbsp;'OU=Managed-Linux-Servers'&nbsp;--computer-name&nbsp;TESTSQUID&nbsp;-s&nbsp;HTTP/test-squid-cluster.dyn.zone&nbsp;-k&nbsp;/etc/squid/HTTP.keytab&nbsp;--server&nbsp;domain.controller&nbsp;--realm&nbsp;REALM&nbsp;--use-service-account&nbsp;--dont-expire-password&nbsp;--upn<br>
&nbsp;HTTP/test-squid-cluster.dyn.zone@REALM&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;Which&nbsp;is&nbsp;more&nbsp;likely&nbsp;to&nbsp;be&nbsp;reliable&nbsp;(unfortunately&nbsp;I&nbsp;have&nbsp;to&nbsp;use&nbsp;MS&nbsp;AD&nbsp;as&nbsp;the&nbsp;whole&nbsp;purpose&nbsp;of&nbsp;this&nbsp;proxy&nbsp;is&nbsp;to&nbsp;allow&nbsp;Windows&nbsp;clients&nbsp;to&nbsp;use&nbsp;an&nbsp;authenticated&nbsp;proxy).&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;Kind&nbsp;regards,&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;Mark&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;On&nbsp;19/06/2025&nbsp;15:21,&nbsp;Amos&nbsp;Jeffries&nbsp;wrote:&lt;/span&gt;&lt;br&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;[You&nbsp;don't&nbsp;often&nbsp;get&nbsp;email&nbsp;from&nbsp;squid3@treenet.co.nz.&nbsp;Learn&nbsp;why&nbsp;this&nbsp;is&nbsp;important&nbsp;at&nbsp;https://aka.ms/LearnAboutSenderIdentification&nbsp;]&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;On&nbsp;18/06/25&nbsp;20:49,&nbsp;Mark&nbsp;Cairney&nbsp;wrote:&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;Hi,&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;I’ve&nbsp;been&nbsp;trying&nbsp;to&nbsp;get&nbsp;Kerberos&nbsp;Authentication&nbsp;against&nbsp;AD&nbsp;working&nbsp;but&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;have&nbsp;been&nbsp;seeing&nbsp;inconsistent&nbsp;results/behaviour&nbsp;across&nbsp;multiple&nbsp;Oses&nbsp;and&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;I’m&nbsp;not&nbsp;sure&nbsp;if&nbsp;the&nbsp;issue&nbsp;lies&nbsp;with&nbsp;the&nbsp;DNS&nbsp;configuration,&nbsp;Kerberos&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;itself&nbsp;or&nbsp;with&nbsp;the&nbsp;Squid&nbsp;config:&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;THE&nbsp;DNS&nbsp;setup&nbsp;is&nbsp;as&nbsp;follows:&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;test.squid.cluster.&nbsp;3600&nbsp;IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CNAME&nbsp;test-squid-&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;cluster.dyn-zone.&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;test-squid-cluster.dyn-zone.&nbsp;60&nbsp;IN&nbsp;A&nbsp;1.2.3.4&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;Where&nbsp;1.2.3.4&nbsp;is&nbsp;the&nbsp;IP&nbsp;of&nbsp;one&nbsp;of&nbsp;the&nbsp;servers&nbsp;in&nbsp;the&nbsp;cluster.&nbsp;The&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;intention&nbsp;is&nbsp;to&nbsp;have&nbsp;multiple&nbsp;Squid&nbsp;servers&nbsp;behind&nbsp;a&nbsp;single&nbsp;DNS&nbsp;name&nbsp;for&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;high-availability.&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;FYI,&nbsp;you&nbsp;cannot&nbsp;have&nbsp;multiple&nbsp;CNAME&nbsp;for&nbsp;test.squid.cluster&nbsp;pointing&nbsp;at&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;different&nbsp;Squid&nbsp;server&nbsp;names.&nbsp;So&nbsp;this&nbsp;should&nbsp;not&nbsp;be&nbsp;a&nbsp;problem.&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;In&nbsp;Kerberos:&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;*&nbsp;Setup&nbsp;your&nbsp;keytab&nbsp;entry&nbsp;for&nbsp;HTTP/test-squid-cluster.dyn-zone@REALM.&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;*&nbsp;export&nbsp;the&nbsp;HTTP/test-squid-cluster.dyn-zone@REALM&nbsp;keytab&nbsp;to&nbsp;each&nbsp;proxy&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;In&nbsp;DNS:&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;*&nbsp;Add&nbsp;as&nbsp;many&nbsp;proxy&nbsp;as&nbsp;you&nbsp;want&nbsp;to&nbsp;test-squid-cluster.dyn-zone&nbsp;with&nbsp;A&nbsp;or&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;AAAA&nbsp;records&nbsp;in&nbsp;DNS.&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;*&nbsp;point&nbsp;any&nbsp;domains&nbsp;you&nbsp;want&nbsp;those&nbsp;proxy&nbsp;to&nbsp;be&nbsp;acting&nbsp;as&nbsp;a&nbsp;CDN&nbsp;to&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;test-squid-cluster.dyn-zone&nbsp;using&nbsp;CNAME&nbsp;in&nbsp;DNS.&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;Cheers&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;Amos&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;_______________________________________________&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;squid-users&nbsp;mailing&nbsp;list&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;squid-users@lists.squid-cache.org&lt;/span&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;span&gt;https://lists.squid-cache.org/listinfo/squid-users&nbsp;&lt;/span&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;--&nbsp;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;/****************************&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;Mark&nbsp;Cairney&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;ITI&nbsp;Enterprise&nbsp;Services&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;Information&nbsp;Services&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;University&nbsp;of&nbsp;Edinburgh&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;Tel:&nbsp;0131&nbsp;650&nbsp;6565&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;Email:&nbsp;Mark.Cairney@ed.ac.uk&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;*******************************/&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;The&nbsp;University&nbsp;of&nbsp;Edinburgh&nbsp;is&nbsp;a&nbsp;charitable&nbsp;body,&nbsp;registered&nbsp;in&nbsp;Scotland,&nbsp;with&nbsp;registration&nbsp;number&nbsp;SC005336.&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;_______________________________________________&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;squid-users&nbsp;mailing&nbsp;list&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;squid-users@lists.squid-cache.org&lt;/span&gt;&lt;br&gt;<br>
&lt;span&gt;https://lists.squid-cache.org/listinfo/squid-users&lt;/span&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
